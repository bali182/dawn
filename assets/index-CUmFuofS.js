function lB(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(i,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var Ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Eb(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Mb={exports:{}},tc={},Lb={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fl=Symbol.for("react.element"),hB=Symbol.for("react.portal"),uB=Symbol.for("react.fragment"),cB=Symbol.for("react.strict_mode"),dB=Symbol.for("react.profiler"),fB=Symbol.for("react.provider"),pB=Symbol.for("react.context"),gB=Symbol.for("react.forward_ref"),mB=Symbol.for("react.suspense"),yB=Symbol.for("react.memo"),bB=Symbol.for("react.lazy"),ey=Symbol.iterator;function wB(i){return i===null||typeof i!="object"?null:(i=ey&&i[ey]||i["@@iterator"],typeof i=="function"?i:null)}var Rb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Fb=Object.assign,Ib={};function ao(i,e,t){this.props=i,this.context=e,this.refs=Ib,this.updater=t||Rb}ao.prototype.isReactComponent={};ao.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};ao.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Ob(){}Ob.prototype=ao.prototype;function Jp(i,e,t){this.props=i,this.context=e,this.refs=Ib,this.updater=t||Rb}var Zp=Jp.prototype=new Ob;Zp.constructor=Jp;Fb(Zp,ao.prototype);Zp.isPureReactComponent=!0;var ty=Array.isArray,Db=Object.prototype.hasOwnProperty,eg={current:null},Ab={key:!0,ref:!0,__self:!0,__source:!0};function Vb(i,e,t){var r,s={},n=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(n=""+e.key),e)Db.call(e,r)&&!Ab.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),h=0;h<o;h++)l[h]=arguments[h+2];s.children=l}if(i&&i.defaultProps)for(r in o=i.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Fl,type:i,key:n,ref:a,props:s,_owner:eg.current}}function SB(i,e){return{$$typeof:Fl,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function tg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Fl}function vB(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var iy=/\/+/g;function hd(i,e){return typeof i=="object"&&i!==null&&i.key!=null?vB(""+i.key):e.toString(36)}function Ah(i,e,t,r,s){var n=typeof i;(n==="undefined"||n==="boolean")&&(i=null);var a=!1;if(i===null)a=!0;else switch(n){case"string":case"number":a=!0;break;case"object":switch(i.$$typeof){case Fl:case hB:a=!0}}if(a)return a=i,s=s(a),i=r===""?"."+hd(a,0):r,ty(s)?(t="",i!=null&&(t=i.replace(iy,"$&/")+"/"),Ah(s,e,t,"",function(h){return h})):s!=null&&(tg(s)&&(s=SB(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(iy,"$&/")+"/")+i)),e.push(s)),1;if(a=0,r=r===""?".":r+":",ty(i))for(var o=0;o<i.length;o++){n=i[o];var l=r+hd(n,o);a+=Ah(n,e,t,l,s)}else if(l=wB(i),typeof l=="function")for(i=l.call(i),o=0;!(n=i.next()).done;)n=n.value,l=r+hd(n,o++),a+=Ah(n,e,t,l,s);else if(n==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Jl(i,e,t){if(i==null)return i;var r=[],s=0;return Ah(i,r,"","",function(n){return e.call(t,n,s++)}),r}function kB(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var Ai={current:null},Vh={transition:null},xB={ReactCurrentDispatcher:Ai,ReactCurrentBatchConfig:Vh,ReactCurrentOwner:eg};He.Children={map:Jl,forEach:function(i,e,t){Jl(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return Jl(i,function(){e++}),e},toArray:function(i){return Jl(i,function(e){return e})||[]},only:function(i){if(!tg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};He.Component=ao;He.Fragment=uB;He.Profiler=dB;He.PureComponent=Jp;He.StrictMode=cB;He.Suspense=mB;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xB;He.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var r=Fb({},i.props),s=i.key,n=i.ref,a=i._owner;if(e!=null){if(e.ref!==void 0&&(n=e.ref,a=eg.current),e.key!==void 0&&(s=""+e.key),i.type&&i.type.defaultProps)var o=i.type.defaultProps;for(l in e)Db.call(e,l)&&!Ab.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var h=0;h<l;h++)o[h]=arguments[h+2];r.children=o}return{$$typeof:Fl,type:i.type,key:s,ref:n,props:r,_owner:a}};He.createContext=function(i){return i={$$typeof:pB,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:fB,_context:i},i.Consumer=i};He.createElement=Vb;He.createFactory=function(i){var e=Vb.bind(null,i);return e.type=i,e};He.createRef=function(){return{current:null}};He.forwardRef=function(i){return{$$typeof:gB,render:i}};He.isValidElement=tg;He.lazy=function(i){return{$$typeof:bB,_payload:{_status:-1,_result:i},_init:kB}};He.memo=function(i,e){return{$$typeof:yB,type:i,compare:e===void 0?null:e}};He.startTransition=function(i){var e=Vh.transition;Vh.transition={};try{i()}finally{Vh.transition=e}};He.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};He.useCallback=function(i,e){return Ai.current.useCallback(i,e)};He.useContext=function(i){return Ai.current.useContext(i)};He.useDebugValue=function(){};He.useDeferredValue=function(i){return Ai.current.useDeferredValue(i)};He.useEffect=function(i,e){return Ai.current.useEffect(i,e)};He.useId=function(){return Ai.current.useId()};He.useImperativeHandle=function(i,e,t){return Ai.current.useImperativeHandle(i,e,t)};He.useInsertionEffect=function(i,e){return Ai.current.useInsertionEffect(i,e)};He.useLayoutEffect=function(i,e){return Ai.current.useLayoutEffect(i,e)};He.useMemo=function(i,e){return Ai.current.useMemo(i,e)};He.useReducer=function(i,e,t){return Ai.current.useReducer(i,e,t)};He.useRef=function(i){return Ai.current.useRef(i)};He.useState=function(i){return Ai.current.useState(i)};He.useSyncExternalStore=function(i,e,t){return Ai.current.useSyncExternalStore(i,e,t)};He.useTransition=function(){return Ai.current.useTransition()};He.version="18.2.0";Lb.exports=He;var T=Lb.exports;const Cs=Eb(T),$o=lB({__proto__:null,default:Cs},[T]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BB=T,_B=Symbol.for("react.element"),TB=Symbol.for("react.fragment"),CB=Object.prototype.hasOwnProperty,NB=BB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,PB={key:!0,ref:!0,__self:!0,__source:!0};function Hb(i,e,t){var r,s={},n=null,a=null;t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)CB.call(e,r)&&!PB.hasOwnProperty(r)&&(s[r]=e[r]);if(i&&i.defaultProps)for(r in e=i.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:_B,type:i,key:n,ref:a,props:s,_owner:NB.current}}tc.Fragment=TB;tc.jsx=Hb;tc.jsxs=Hb;Mb.exports=tc;var k=Mb.exports,Wb={exports:{}},yr={},zb={exports:{}},Gb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(G,re){var se=G.length;G.push(re);e:for(;0<se;){var we=se-1>>>1,Z=G[we];if(0<s(Z,re))G[we]=re,G[se]=Z,se=we;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var re=G[0],se=G.pop();if(se!==re){G[0]=se;e:for(var we=0,Z=G.length,ze=Z>>>1;we<ze;){var Qe=2*(we+1)-1,Ve=G[Qe],pt=Qe+1,wt=G[pt];if(0>s(Ve,se))pt<Z&&0>s(wt,Ve)?(G[we]=wt,G[pt]=se,we=pt):(G[we]=Ve,G[Qe]=se,we=Qe);else if(pt<Z&&0>s(wt,se))G[we]=wt,G[pt]=se,we=pt;else break e}}return re}function s(G,re){var se=G.sortIndex-re.sortIndex;return se!==0?se:G.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;i.unstable_now=function(){return n.now()}}else{var a=Date,o=a.now();i.unstable_now=function(){return a.now()-o}}var l=[],h=[],u=1,c=null,d=3,p=!1,f=!1,m=!1,S=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(G){for(var re=t(h);re!==null;){if(re.callback===null)r(h);else if(re.startTime<=G)r(h),re.sortIndex=re.expirationTime,e(l,re);else break;re=t(h)}}function x(G){if(m=!1,w(G),!f)if(t(l)!==null)f=!0,_e(v);else{var re=t(h);re!==null&&ot(x,re.startTime-G)}}function v(G,re){f=!1,m&&(m=!1,y(N),N=-1),p=!0;var se=d;try{for(w(re),c=t(l);c!==null&&(!(c.expirationTime>re)||G&&!me());){var we=c.callback;if(typeof we=="function"){c.callback=null,d=c.priorityLevel;var Z=we(c.expirationTime<=re);re=i.unstable_now(),typeof Z=="function"?c.callback=Z:c===t(l)&&r(l),w(re)}else r(l);c=t(l)}if(c!==null)var ze=!0;else{var Qe=t(h);Qe!==null&&ot(x,Qe.startTime-re),ze=!1}return ze}finally{c=null,d=se,p=!1}}var C=!1,P=null,N=-1,W=5,Y=-1;function me(){return!(i.unstable_now()-Y<W)}function Ee(){if(P!==null){var G=i.unstable_now();Y=G;var re=!0;try{re=P(!0,G)}finally{re?Xe():(C=!1,P=null)}}else C=!1}var Xe;if(typeof b=="function")Xe=function(){b(Ee)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,qe=je.port2;je.port1.onmessage=Ee,Xe=function(){qe.postMessage(null)}}else Xe=function(){S(Ee,0)};function _e(G){P=G,C||(C=!0,Xe())}function ot(G,re){N=S(function(){G(i.unstable_now())},re)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(G){G.callback=null},i.unstable_continueExecution=function(){f||p||(f=!0,_e(v))},i.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<G?Math.floor(1e3/G):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(G){switch(d){case 1:case 2:case 3:var re=3;break;default:re=d}var se=d;d=re;try{return G()}finally{d=se}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(G,re){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var se=d;d=G;try{return re()}finally{d=se}},i.unstable_scheduleCallback=function(G,re,se){var we=i.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?we+se:we):se=we,G){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=se+Z,G={id:u++,callback:re,priorityLevel:G,startTime:se,expirationTime:Z,sortIndex:-1},se>we?(G.sortIndex=se,e(h,G),t(l)===null&&G===t(h)&&(m?(y(N),N=-1):m=!0,ot(x,se-we))):(G.sortIndex=Z,e(l,G),f||p||(f=!0,_e(v))),G},i.unstable_shouldYield=me,i.unstable_wrapCallback=function(G){var re=d;return function(){var se=d;d=re;try{return G.apply(this,arguments)}finally{d=se}}}})(Gb);zb.exports=Gb;var EB=zb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ub=T,pr=EB;function U(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Yb=new Set,Xo={};function na(i,e){Ua(i,e),Ua(i+"Capture",e)}function Ua(i,e){for(Xo[i]=e,i=0;i<e.length;i++)Yb.add(e[i])}var Ls=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_f=Object.prototype.hasOwnProperty,MB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ry={},sy={};function LB(i){return _f.call(sy,i)?!0:_f.call(ry,i)?!1:MB.test(i)?sy[i]=!0:(ry[i]=!0,!1)}function RB(i,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function FB(i,e,t,r){if(e===null||typeof e>"u"||RB(i,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vi(i,e,t,r,s,n,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=n,this.removeEmptyString=a}var Si={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Si[i]=new Vi(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];Si[e]=new Vi(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Si[i]=new Vi(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Si[i]=new Vi(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Si[i]=new Vi(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Si[i]=new Vi(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Si[i]=new Vi(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Si[i]=new Vi(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Si[i]=new Vi(i,5,!1,i.toLowerCase(),null,!1,!1)});var ig=/[\-:]([a-z])/g;function rg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(ig,rg);Si[e]=new Vi(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(ig,rg);Si[e]=new Vi(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(ig,rg);Si[e]=new Vi(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Si[i]=new Vi(i,1,!1,i.toLowerCase(),null,!1,!1)});Si.xlinkHref=new Vi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Si[i]=new Vi(i,1,!1,i.toLowerCase(),null,!0,!0)});function sg(i,e,t,r){var s=Si.hasOwnProperty(e)?Si[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(FB(e,t,s,r)&&(t=null),r||s===null?LB(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):s.mustUseProperty?i[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?i.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?i.setAttributeNS(r,e,t):i.setAttribute(e,t))))}var Ws=Ub.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zl=Symbol.for("react.element"),Sa=Symbol.for("react.portal"),va=Symbol.for("react.fragment"),ng=Symbol.for("react.strict_mode"),Tf=Symbol.for("react.profiler"),$b=Symbol.for("react.provider"),Xb=Symbol.for("react.context"),ag=Symbol.for("react.forward_ref"),Cf=Symbol.for("react.suspense"),Nf=Symbol.for("react.suspense_list"),og=Symbol.for("react.memo"),Ks=Symbol.for("react.lazy"),jb=Symbol.for("react.offscreen"),ny=Symbol.iterator;function fo(i){return i===null||typeof i!="object"?null:(i=ny&&i[ny]||i["@@iterator"],typeof i=="function"?i:null)}var Lt=Object.assign,ud;function Bo(i){if(ud===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);ud=e&&e[1]||""}return`
`+ud+i}var cd=!1;function dd(i,e){if(!i||cd)return"";cd=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var r=h}Reflect.construct(i,[],e)}else{try{e.call()}catch(h){r=h}i.call(e.prototype)}else{try{throw Error()}catch(h){r=h}i()}}catch(h){if(h&&r&&typeof h.stack=="string"){for(var s=h.stack.split(`
`),n=r.stack.split(`
`),a=s.length-1,o=n.length-1;1<=a&&0<=o&&s[a]!==n[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==n[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==n[o]){var l=`
`+s[a].replace(" at new "," at ");return i.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",i.displayName)),l}while(1<=a&&0<=o);break}}}finally{cd=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?Bo(i):""}function IB(i){switch(i.tag){case 5:return Bo(i.type);case 16:return Bo("Lazy");case 13:return Bo("Suspense");case 19:return Bo("SuspenseList");case 0:case 2:case 15:return i=dd(i.type,!1),i;case 11:return i=dd(i.type.render,!1),i;case 1:return i=dd(i.type,!0),i;default:return""}}function Pf(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case va:return"Fragment";case Sa:return"Portal";case Tf:return"Profiler";case ng:return"StrictMode";case Cf:return"Suspense";case Nf:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Xb:return(i.displayName||"Context")+".Consumer";case $b:return(i._context.displayName||"Context")+".Provider";case ag:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case og:return e=i.displayName||null,e!==null?e:Pf(i.type)||"Memo";case Ks:e=i._payload,i=i._init;try{return Pf(i(e))}catch{}}return null}function OB(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Pf(e);case 8:return e===ng?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function mn(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function qb(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function DB(i){var e=qb(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),r=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,n=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,n.call(this,a)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function eh(i){i._valueTracker||(i._valueTracker=DB(i))}function Qb(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return i&&(r=qb(i)?i.checked?"true":"false":i.value),i=r,i!==t?(e.setValue(i),!0):!1}function su(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Ef(i,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function ay(i,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=mn(e.value!=null?e.value:t),i._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Kb(i,e){e=e.checked,e!=null&&sg(i,"checked",e,!1)}function Mf(i,e){Kb(i,e);var t=mn(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(r==="submit"||r==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?Lf(i,e.type,t):e.hasOwnProperty("defaultValue")&&Lf(i,e.type,mn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function oy(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function Lf(i,e,t){(e!=="number"||su(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var _o=Array.isArray;function Ia(i,e,t,r){if(i=i.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<i.length;t++)s=e.hasOwnProperty("$"+i[t].value),i[t].selected!==s&&(i[t].selected=s),s&&r&&(i[t].defaultSelected=!0)}else{for(t=""+mn(t),e=null,s=0;s<i.length;s++){if(i[s].value===t){i[s].selected=!0,r&&(i[s].defaultSelected=!0);return}e!==null||i[s].disabled||(e=i[s])}e!==null&&(e.selected=!0)}}function Rf(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(U(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function ly(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(U(92));if(_o(t)){if(1<t.length)throw Error(U(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:mn(t)}}function Jb(i,e){var t=mn(e.value),r=mn(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),r!=null&&(i.defaultValue=""+r)}function hy(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function Zb(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ff(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?Zb(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var th,ew=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return i(e,t,r,s)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(th=th||document.createElement("div"),th.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=th.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function jo(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var Ro={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},AB=["Webkit","ms","Moz","O"];Object.keys(Ro).forEach(function(i){AB.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),Ro[e]=Ro[i]})});function tw(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ro.hasOwnProperty(i)&&Ro[i]?(""+e).trim():e+"px"}function iw(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=tw(t,e[t],r);t==="float"&&(t="cssFloat"),r?i.setProperty(t,s):i[t]=s}}var VB=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function If(i,e){if(e){if(VB[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(U(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(U(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(U(61))}if(e.style!=null&&typeof e.style!="object")throw Error(U(62))}}function Of(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Df=null;function lg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Af=null,Oa=null,Da=null;function uy(i){if(i=Dl(i)){if(typeof Af!="function")throw Error(U(280));var e=i.stateNode;e&&(e=ac(e),Af(i.stateNode,i.type,e))}}function rw(i){Oa?Da?Da.push(i):Da=[i]:Oa=i}function sw(){if(Oa){var i=Oa,e=Da;if(Da=Oa=null,uy(i),e)for(i=0;i<e.length;i++)uy(e[i])}}function nw(i,e){return i(e)}function aw(){}var fd=!1;function ow(i,e,t){if(fd)return i(e,t);fd=!0;try{return nw(i,e,t)}finally{fd=!1,(Oa!==null||Da!==null)&&(aw(),sw())}}function qo(i,e){var t=i.stateNode;if(t===null)return null;var r=ac(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(i=i.type,r=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!r;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(U(231,e,typeof t));return t}var Vf=!1;if(Ls)try{var po={};Object.defineProperty(po,"passive",{get:function(){Vf=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{Vf=!1}function HB(i,e,t,r,s,n,a,o,l){var h=Array.prototype.slice.call(arguments,3);try{e.apply(t,h)}catch(u){this.onError(u)}}var Fo=!1,nu=null,au=!1,Hf=null,WB={onError:function(i){Fo=!0,nu=i}};function zB(i,e,t,r,s,n,a,o,l){Fo=!1,nu=null,HB.apply(WB,arguments)}function GB(i,e,t,r,s,n,a,o,l){if(zB.apply(this,arguments),Fo){if(Fo){var h=nu;Fo=!1,nu=null}else throw Error(U(198));au||(au=!0,Hf=h)}}function aa(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function lw(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function cy(i){if(aa(i)!==i)throw Error(U(188))}function UB(i){var e=i.alternate;if(!e){if(e=aa(i),e===null)throw Error(U(188));return e!==i?null:i}for(var t=i,r=e;;){var s=t.return;if(s===null)break;var n=s.alternate;if(n===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===n.child){for(n=s.child;n;){if(n===t)return cy(s),i;if(n===r)return cy(s),e;n=n.sibling}throw Error(U(188))}if(t.return!==r.return)t=s,r=n;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,r=n;break}if(o===r){a=!0,r=s,t=n;break}o=o.sibling}if(!a){for(o=n.child;o;){if(o===t){a=!0,t=n,r=s;break}if(o===r){a=!0,r=n,t=s;break}o=o.sibling}if(!a)throw Error(U(189))}}if(t.alternate!==r)throw Error(U(190))}if(t.tag!==3)throw Error(U(188));return t.stateNode.current===t?i:e}function hw(i){return i=UB(i),i!==null?uw(i):null}function uw(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=uw(i);if(e!==null)return e;i=i.sibling}return null}var cw=pr.unstable_scheduleCallback,dy=pr.unstable_cancelCallback,YB=pr.unstable_shouldYield,$B=pr.unstable_requestPaint,Ht=pr.unstable_now,XB=pr.unstable_getCurrentPriorityLevel,hg=pr.unstable_ImmediatePriority,dw=pr.unstable_UserBlockingPriority,ou=pr.unstable_NormalPriority,jB=pr.unstable_LowPriority,fw=pr.unstable_IdlePriority,ic=null,ls=null;function qB(i){if(ls&&typeof ls.onCommitFiberRoot=="function")try{ls.onCommitFiberRoot(ic,i,void 0,(i.current.flags&128)===128)}catch{}}var Gr=Math.clz32?Math.clz32:JB,QB=Math.log,KB=Math.LN2;function JB(i){return i>>>=0,i===0?32:31-(QB(i)/KB|0)|0}var ih=64,rh=4194304;function To(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function lu(i,e){var t=i.pendingLanes;if(t===0)return 0;var r=0,s=i.suspendedLanes,n=i.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?r=To(o):(n&=a,n!==0&&(r=To(n)))}else a=t&~s,a!==0?r=To(a):n!==0&&(r=To(n));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,n=e&-e,s>=n||s===16&&(n&4194240)!==0))return e;if(r&4&&(r|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=r;0<e;)t=31-Gr(e),s=1<<t,r|=i[t],e&=~s;return r}function ZB(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function e_(i,e){for(var t=i.suspendedLanes,r=i.pingedLanes,s=i.expirationTimes,n=i.pendingLanes;0<n;){var a=31-Gr(n),o=1<<a,l=s[a];l===-1?(!(o&t)||o&r)&&(s[a]=ZB(o,e)):l<=e&&(i.expiredLanes|=o),n&=~o}}function Wf(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function pw(){var i=ih;return ih<<=1,!(ih&4194240)&&(ih=64),i}function pd(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function Il(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-Gr(e),i[e]=t}function t_(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var r=i.eventTimes;for(i=i.expirationTimes;0<t;){var s=31-Gr(t),n=1<<s;e[s]=0,r[s]=-1,i[s]=-1,t&=~n}}function ug(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var r=31-Gr(t),s=1<<r;s&e|i[r]&e&&(i[r]|=e),t&=~s}}var it=0;function gw(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var mw,cg,yw,bw,ww,zf=!1,sh=[],nn=null,an=null,on=null,Qo=new Map,Ko=new Map,Zs=[],i_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fy(i,e){switch(i){case"focusin":case"focusout":nn=null;break;case"dragenter":case"dragleave":an=null;break;case"mouseover":case"mouseout":on=null;break;case"pointerover":case"pointerout":Qo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ko.delete(e.pointerId)}}function go(i,e,t,r,s,n){return i===null||i.nativeEvent!==n?(i={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:n,targetContainers:[s]},e!==null&&(e=Dl(e),e!==null&&cg(e)),i):(i.eventSystemFlags|=r,e=i.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),i)}function r_(i,e,t,r,s){switch(e){case"focusin":return nn=go(nn,i,e,t,r,s),!0;case"dragenter":return an=go(an,i,e,t,r,s),!0;case"mouseover":return on=go(on,i,e,t,r,s),!0;case"pointerover":var n=s.pointerId;return Qo.set(n,go(Qo.get(n)||null,i,e,t,r,s)),!0;case"gotpointercapture":return n=s.pointerId,Ko.set(n,go(Ko.get(n)||null,i,e,t,r,s)),!0}return!1}function Sw(i){var e=Rn(i.target);if(e!==null){var t=aa(e);if(t!==null){if(e=t.tag,e===13){if(e=lw(t),e!==null){i.blockedOn=e,ww(i.priority,function(){yw(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Hh(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=Gf(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var r=new t.constructor(t.type,t);Df=r,t.target.dispatchEvent(r),Df=null}else return e=Dl(t),e!==null&&cg(e),i.blockedOn=t,!1;e.shift()}return!0}function py(i,e,t){Hh(i)&&t.delete(e)}function s_(){zf=!1,nn!==null&&Hh(nn)&&(nn=null),an!==null&&Hh(an)&&(an=null),on!==null&&Hh(on)&&(on=null),Qo.forEach(py),Ko.forEach(py)}function mo(i,e){i.blockedOn===e&&(i.blockedOn=null,zf||(zf=!0,pr.unstable_scheduleCallback(pr.unstable_NormalPriority,s_)))}function Jo(i){function e(s){return mo(s,i)}if(0<sh.length){mo(sh[0],i);for(var t=1;t<sh.length;t++){var r=sh[t];r.blockedOn===i&&(r.blockedOn=null)}}for(nn!==null&&mo(nn,i),an!==null&&mo(an,i),on!==null&&mo(on,i),Qo.forEach(e),Ko.forEach(e),t=0;t<Zs.length;t++)r=Zs[t],r.blockedOn===i&&(r.blockedOn=null);for(;0<Zs.length&&(t=Zs[0],t.blockedOn===null);)Sw(t),t.blockedOn===null&&Zs.shift()}var Aa=Ws.ReactCurrentBatchConfig,hu=!0;function n_(i,e,t,r){var s=it,n=Aa.transition;Aa.transition=null;try{it=1,dg(i,e,t,r)}finally{it=s,Aa.transition=n}}function a_(i,e,t,r){var s=it,n=Aa.transition;Aa.transition=null;try{it=4,dg(i,e,t,r)}finally{it=s,Aa.transition=n}}function dg(i,e,t,r){if(hu){var s=Gf(i,e,t,r);if(s===null)Bd(i,e,r,uu,t),fy(i,r);else if(r_(s,i,e,t,r))r.stopPropagation();else if(fy(i,r),e&4&&-1<i_.indexOf(i)){for(;s!==null;){var n=Dl(s);if(n!==null&&mw(n),n=Gf(i,e,t,r),n===null&&Bd(i,e,r,uu,t),n===s)break;s=n}s!==null&&r.stopPropagation()}else Bd(i,e,r,null,t)}}var uu=null;function Gf(i,e,t,r){if(uu=null,i=lg(r),i=Rn(i),i!==null)if(e=aa(i),e===null)i=null;else if(t=e.tag,t===13){if(i=lw(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return uu=i,null}function vw(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XB()){case hg:return 1;case dw:return 4;case ou:case jB:return 16;case fw:return 536870912;default:return 16}default:return 16}}var tn=null,fg=null,Wh=null;function kw(){if(Wh)return Wh;var i,e=fg,t=e.length,r,s="value"in tn?tn.value:tn.textContent,n=s.length;for(i=0;i<t&&e[i]===s[i];i++);var a=t-i;for(r=1;r<=a&&e[t-r]===s[n-r];r++);return Wh=s.slice(i,1<r?1-r:void 0)}function zh(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function nh(){return!0}function gy(){return!1}function br(i){function e(t,r,s,n,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=n,this.target=a,this.currentTarget=null;for(var o in i)i.hasOwnProperty(o)&&(t=i[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?nh:gy,this.isPropagationStopped=gy,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=nh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=nh)},persist:function(){},isPersistent:nh}),e}var oo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pg=br(oo),Ol=Lt({},oo,{view:0,detail:0}),o_=br(Ol),gd,md,yo,rc=Lt({},Ol,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==yo&&(yo&&i.type==="mousemove"?(gd=i.screenX-yo.screenX,md=i.screenY-yo.screenY):md=gd=0,yo=i),gd)},movementY:function(i){return"movementY"in i?i.movementY:md}}),my=br(rc),l_=Lt({},rc,{dataTransfer:0}),h_=br(l_),u_=Lt({},Ol,{relatedTarget:0}),yd=br(u_),c_=Lt({},oo,{animationName:0,elapsedTime:0,pseudoElement:0}),d_=br(c_),f_=Lt({},oo,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),p_=br(f_),g_=Lt({},oo,{data:0}),yy=br(g_),m_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},y_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},b_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function w_(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=b_[i])?!!e[i]:!1}function gg(){return w_}var S_=Lt({},Ol,{key:function(i){if(i.key){var e=m_[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=zh(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?y_[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gg,charCode:function(i){return i.type==="keypress"?zh(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zh(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),v_=br(S_),k_=Lt({},rc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),by=br(k_),x_=Lt({},Ol,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gg}),B_=br(x_),__=Lt({},oo,{propertyName:0,elapsedTime:0,pseudoElement:0}),T_=br(__),C_=Lt({},rc,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),N_=br(C_),P_=[9,13,27,32],mg=Ls&&"CompositionEvent"in window,Io=null;Ls&&"documentMode"in document&&(Io=document.documentMode);var E_=Ls&&"TextEvent"in window&&!Io,xw=Ls&&(!mg||Io&&8<Io&&11>=Io),wy=" ",Sy=!1;function Bw(i,e){switch(i){case"keyup":return P_.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _w(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ka=!1;function M_(i,e){switch(i){case"compositionend":return _w(e);case"keypress":return e.which!==32?null:(Sy=!0,wy);case"textInput":return i=e.data,i===wy&&Sy?null:i;default:return null}}function L_(i,e){if(ka)return i==="compositionend"||!mg&&Bw(i,e)?(i=kw(),Wh=fg=tn=null,ka=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xw&&e.locale!=="ko"?null:e.data;default:return null}}var R_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vy(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!R_[i.type]:e==="textarea"}function Tw(i,e,t,r){rw(r),e=cu(e,"onChange"),0<e.length&&(t=new pg("onChange","change",null,t,r),i.push({event:t,listeners:e}))}var Oo=null,Zo=null;function F_(i){Dw(i,0)}function sc(i){var e=_a(i);if(Qb(e))return i}function I_(i,e){if(i==="change")return e}var Cw=!1;if(Ls){var bd;if(Ls){var wd="oninput"in document;if(!wd){var ky=document.createElement("div");ky.setAttribute("oninput","return;"),wd=typeof ky.oninput=="function"}bd=wd}else bd=!1;Cw=bd&&(!document.documentMode||9<document.documentMode)}function xy(){Oo&&(Oo.detachEvent("onpropertychange",Nw),Zo=Oo=null)}function Nw(i){if(i.propertyName==="value"&&sc(Zo)){var e=[];Tw(e,Zo,i,lg(i)),ow(F_,e)}}function O_(i,e,t){i==="focusin"?(xy(),Oo=e,Zo=t,Oo.attachEvent("onpropertychange",Nw)):i==="focusout"&&xy()}function D_(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return sc(Zo)}function A_(i,e){if(i==="click")return sc(e)}function V_(i,e){if(i==="input"||i==="change")return sc(e)}function H_(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var $r=typeof Object.is=="function"?Object.is:H_;function el(i,e){if($r(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!_f.call(e,s)||!$r(i[s],e[s]))return!1}return!0}function By(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function _y(i,e){var t=By(i);i=0;for(var r;t;){if(t.nodeType===3){if(r=i+t.textContent.length,i<=e&&r>=e)return{node:t,offset:e-i};i=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=By(t)}}function Pw(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?Pw(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function Ew(){for(var i=window,e=su();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=su(i.document)}return e}function yg(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function W_(i){var e=Ew(),t=i.focusedElem,r=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&Pw(t.ownerDocument.documentElement,t)){if(r!==null&&yg(t)){if(e=r.start,i=r.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var s=t.textContent.length,n=Math.min(r.start,s);r=r.end===void 0?n:Math.min(r.end,s),!i.extend&&n>r&&(s=r,r=n,n=s),s=_y(t,n);var a=_y(t,r);s&&a&&(i.rangeCount!==1||i.anchorNode!==s.node||i.anchorOffset!==s.offset||i.focusNode!==a.node||i.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),i.removeAllRanges(),n>r?(i.addRange(e),i.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var z_=Ls&&"documentMode"in document&&11>=document.documentMode,xa=null,Uf=null,Do=null,Yf=!1;function Ty(i,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Yf||xa==null||xa!==su(r)||(r=xa,"selectionStart"in r&&yg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Do&&el(Do,r)||(Do=r,r=cu(Uf,"onSelect"),0<r.length&&(e=new pg("onSelect","select",null,e,t),i.push({event:e,listeners:r}),e.target=xa)))}function ah(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var Ba={animationend:ah("Animation","AnimationEnd"),animationiteration:ah("Animation","AnimationIteration"),animationstart:ah("Animation","AnimationStart"),transitionend:ah("Transition","TransitionEnd")},Sd={},Mw={};Ls&&(Mw=document.createElement("div").style,"AnimationEvent"in window||(delete Ba.animationend.animation,delete Ba.animationiteration.animation,delete Ba.animationstart.animation),"TransitionEvent"in window||delete Ba.transitionend.transition);function nc(i){if(Sd[i])return Sd[i];if(!Ba[i])return i;var e=Ba[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in Mw)return Sd[i]=e[t];return i}var Lw=nc("animationend"),Rw=nc("animationiteration"),Fw=nc("animationstart"),Iw=nc("transitionend"),Ow=new Map,Cy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xn(i,e){Ow.set(i,e),na(e,[i])}for(var vd=0;vd<Cy.length;vd++){var kd=Cy[vd],G_=kd.toLowerCase(),U_=kd[0].toUpperCase()+kd.slice(1);xn(G_,"on"+U_)}xn(Lw,"onAnimationEnd");xn(Rw,"onAnimationIteration");xn(Fw,"onAnimationStart");xn("dblclick","onDoubleClick");xn("focusin","onFocus");xn("focusout","onBlur");xn(Iw,"onTransitionEnd");Ua("onMouseEnter",["mouseout","mouseover"]);Ua("onMouseLeave",["mouseout","mouseover"]);Ua("onPointerEnter",["pointerout","pointerover"]);Ua("onPointerLeave",["pointerout","pointerover"]);na("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));na("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));na("onBeforeInput",["compositionend","keypress","textInput","paste"]);na("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));na("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));na("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Y_=new Set("cancel close invalid load scroll toggle".split(" ").concat(Co));function Ny(i,e,t){var r=i.type||"unknown-event";i.currentTarget=t,GB(r,e,void 0,i),i.currentTarget=null}function Dw(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var r=i[t],s=r.event;r=r.listeners;e:{var n=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==n&&s.isPropagationStopped())break e;Ny(s,o,h),n=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,h=o.currentTarget,o=o.listener,l!==n&&s.isPropagationStopped())break e;Ny(s,o,h),n=l}}}if(au)throw i=Hf,au=!1,Hf=null,i}function gt(i,e){var t=e[Qf];t===void 0&&(t=e[Qf]=new Set);var r=i+"__bubble";t.has(r)||(Aw(e,i,2,!1),t.add(r))}function xd(i,e,t){var r=0;e&&(r|=4),Aw(t,i,r,e)}var oh="_reactListening"+Math.random().toString(36).slice(2);function tl(i){if(!i[oh]){i[oh]=!0,Yb.forEach(function(t){t!=="selectionchange"&&(Y_.has(t)||xd(t,!1,i),xd(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[oh]||(e[oh]=!0,xd("selectionchange",!1,e))}}function Aw(i,e,t,r){switch(vw(e)){case 1:var s=n_;break;case 4:s=a_;break;default:s=dg}t=s.bind(null,e,t,i),s=void 0,!Vf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?i.addEventListener(e,t,{capture:!0,passive:s}):i.addEventListener(e,t,!0):s!==void 0?i.addEventListener(e,t,{passive:s}):i.addEventListener(e,t,!1)}function Bd(i,e,t,r,s){var n=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=Rn(o),a===null)return;if(l=a.tag,l===5||l===6){r=n=a;continue e}o=o.parentNode}}r=r.return}ow(function(){var h=n,u=lg(t),c=[];e:{var d=Ow.get(i);if(d!==void 0){var p=pg,f=i;switch(i){case"keypress":if(zh(t)===0)break e;case"keydown":case"keyup":p=v_;break;case"focusin":f="focus",p=yd;break;case"focusout":f="blur",p=yd;break;case"beforeblur":case"afterblur":p=yd;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=my;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=h_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=B_;break;case Lw:case Rw:case Fw:p=d_;break;case Iw:p=T_;break;case"scroll":p=o_;break;case"wheel":p=N_;break;case"copy":case"cut":case"paste":p=p_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=by}var m=(e&4)!==0,S=!m&&i==="scroll",y=m?d!==null?d+"Capture":null:d;m=[];for(var b=h,w;b!==null;){w=b;var x=w.stateNode;if(w.tag===5&&x!==null&&(w=x,y!==null&&(x=qo(b,y),x!=null&&m.push(il(b,x,w)))),S)break;b=b.return}0<m.length&&(d=new p(d,f,null,t,u),c.push({event:d,listeners:m}))}}if(!(e&7)){e:{if(d=i==="mouseover"||i==="pointerover",p=i==="mouseout"||i==="pointerout",d&&t!==Df&&(f=t.relatedTarget||t.fromElement)&&(Rn(f)||f[Rs]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=t.relatedTarget||t.toElement,p=h,f=f?Rn(f):null,f!==null&&(S=aa(f),f!==S||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=h),p!==f)){if(m=my,x="onMouseLeave",y="onMouseEnter",b="mouse",(i==="pointerout"||i==="pointerover")&&(m=by,x="onPointerLeave",y="onPointerEnter",b="pointer"),S=p==null?d:_a(p),w=f==null?d:_a(f),d=new m(x,b+"leave",p,t,u),d.target=S,d.relatedTarget=w,x=null,Rn(u)===h&&(m=new m(y,b+"enter",f,t,u),m.target=w,m.relatedTarget=S,x=m),S=x,p&&f)t:{for(m=p,y=f,b=0,w=m;w;w=fa(w))b++;for(w=0,x=y;x;x=fa(x))w++;for(;0<b-w;)m=fa(m),b--;for(;0<w-b;)y=fa(y),w--;for(;b--;){if(m===y||y!==null&&m===y.alternate)break t;m=fa(m),y=fa(y)}m=null}else m=null;p!==null&&Py(c,d,p,m,!1),f!==null&&S!==null&&Py(c,S,f,m,!0)}}e:{if(d=h?_a(h):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var v=I_;else if(vy(d))if(Cw)v=V_;else{v=D_;var C=O_}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(v=A_);if(v&&(v=v(i,h))){Tw(c,v,t,u);break e}C&&C(i,d,h),i==="focusout"&&(C=d._wrapperState)&&C.controlled&&d.type==="number"&&Lf(d,"number",d.value)}switch(C=h?_a(h):window,i){case"focusin":(vy(C)||C.contentEditable==="true")&&(xa=C,Uf=h,Do=null);break;case"focusout":Do=Uf=xa=null;break;case"mousedown":Yf=!0;break;case"contextmenu":case"mouseup":case"dragend":Yf=!1,Ty(c,t,u);break;case"selectionchange":if(z_)break;case"keydown":case"keyup":Ty(c,t,u)}var P;if(mg)e:{switch(i){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else ka?Bw(i,t)&&(N="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(N="onCompositionStart");N&&(xw&&t.locale!=="ko"&&(ka||N!=="onCompositionStart"?N==="onCompositionEnd"&&ka&&(P=kw()):(tn=u,fg="value"in tn?tn.value:tn.textContent,ka=!0)),C=cu(h,N),0<C.length&&(N=new yy(N,i,null,t,u),c.push({event:N,listeners:C}),P?N.data=P:(P=_w(t),P!==null&&(N.data=P)))),(P=E_?M_(i,t):L_(i,t))&&(h=cu(h,"onBeforeInput"),0<h.length&&(u=new yy("onBeforeInput","beforeinput",null,t,u),c.push({event:u,listeners:h}),u.data=P))}Dw(c,e)})}function il(i,e,t){return{instance:i,listener:e,currentTarget:t}}function cu(i,e){for(var t=e+"Capture",r=[];i!==null;){var s=i,n=s.stateNode;s.tag===5&&n!==null&&(s=n,n=qo(i,t),n!=null&&r.unshift(il(i,n,s)),n=qo(i,e),n!=null&&r.push(il(i,n,s))),i=i.return}return r}function fa(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Py(i,e,t,r,s){for(var n=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,h=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&h!==null&&(o=h,s?(l=qo(t,n),l!=null&&a.unshift(il(t,l,o))):s||(l=qo(t,n),l!=null&&a.push(il(t,l,o)))),t=t.return}a.length!==0&&i.push({event:e,listeners:a})}var $_=/\r\n?/g,X_=/\u0000|\uFFFD/g;function Ey(i){return(typeof i=="string"?i:""+i).replace($_,`
`).replace(X_,"")}function lh(i,e,t){if(e=Ey(e),Ey(i)!==e&&t)throw Error(U(425))}function du(){}var $f=null,Xf=null;function jf(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var qf=typeof setTimeout=="function"?setTimeout:void 0,j_=typeof clearTimeout=="function"?clearTimeout:void 0,My=typeof Promise=="function"?Promise:void 0,q_=typeof queueMicrotask=="function"?queueMicrotask:typeof My<"u"?function(i){return My.resolve(null).then(i).catch(Q_)}:qf;function Q_(i){setTimeout(function(){throw i})}function _d(i,e){var t=e,r=0;do{var s=t.nextSibling;if(i.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){i.removeChild(s),Jo(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Jo(e)}function ln(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function Ly(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var lo=Math.random().toString(36).slice(2),ss="__reactFiber$"+lo,rl="__reactProps$"+lo,Rs="__reactContainer$"+lo,Qf="__reactEvents$"+lo,K_="__reactListeners$"+lo,J_="__reactHandles$"+lo;function Rn(i){var e=i[ss];if(e)return e;for(var t=i.parentNode;t;){if(e=t[Rs]||t[ss]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=Ly(i);i!==null;){if(t=i[ss])return t;i=Ly(i)}return e}i=t,t=i.parentNode}return null}function Dl(i){return i=i[ss]||i[Rs],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function _a(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(U(33))}function ac(i){return i[rl]||null}var Kf=[],Ta=-1;function Bn(i){return{current:i}}function yt(i){0>Ta||(i.current=Kf[Ta],Kf[Ta]=null,Ta--)}function dt(i,e){Ta++,Kf[Ta]=i.current,i.current=e}var yn={},Ci=Bn(yn),Qi=Bn(!1),$n=yn;function Ya(i,e){var t=i.type.contextTypes;if(!t)return yn;var r=i.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},n;for(n in t)s[n]=e[n];return r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=s),s}function Ki(i){return i=i.childContextTypes,i!=null}function fu(){yt(Qi),yt(Ci)}function Ry(i,e,t){if(Ci.current!==yn)throw Error(U(168));dt(Ci,e),dt(Qi,t)}function Vw(i,e,t){var r=i.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(U(108,OB(i)||"Unknown",s));return Lt({},t,r)}function pu(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||yn,$n=Ci.current,dt(Ci,i),dt(Qi,Qi.current),!0}function Fy(i,e,t){var r=i.stateNode;if(!r)throw Error(U(169));t?(i=Vw(i,e,$n),r.__reactInternalMemoizedMergedChildContext=i,yt(Qi),yt(Ci),dt(Ci,i)):yt(Qi),dt(Qi,t)}var bs=null,oc=!1,Td=!1;function Hw(i){bs===null?bs=[i]:bs.push(i)}function Z_(i){oc=!0,Hw(i)}function _n(){if(!Td&&bs!==null){Td=!0;var i=0,e=it;try{var t=bs;for(it=1;i<t.length;i++){var r=t[i];do r=r(!0);while(r!==null)}bs=null,oc=!1}catch(s){throw bs!==null&&(bs=bs.slice(i+1)),cw(hg,_n),s}finally{it=e,Td=!1}}return null}var Ca=[],Na=0,gu=null,mu=0,xr=[],Br=0,Xn=null,ks=1,xs="";function Pn(i,e){Ca[Na++]=mu,Ca[Na++]=gu,gu=i,mu=e}function Ww(i,e,t){xr[Br++]=ks,xr[Br++]=xs,xr[Br++]=Xn,Xn=i;var r=ks;i=xs;var s=32-Gr(r)-1;r&=~(1<<s),t+=1;var n=32-Gr(e)+s;if(30<n){var a=s-s%5;n=(r&(1<<a)-1).toString(32),r>>=a,s-=a,ks=1<<32-Gr(e)+s|t<<s|r,xs=n+i}else ks=1<<n|t<<s|r,xs=i}function bg(i){i.return!==null&&(Pn(i,1),Ww(i,1,0))}function wg(i){for(;i===gu;)gu=Ca[--Na],Ca[Na]=null,mu=Ca[--Na],Ca[Na]=null;for(;i===Xn;)Xn=xr[--Br],xr[Br]=null,xs=xr[--Br],xr[Br]=null,ks=xr[--Br],xr[Br]=null}var cr=null,lr=null,_t=!1,Dr=null;function zw(i,e){var t=Cr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function Iy(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,cr=i,lr=ln(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,cr=i,lr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Xn!==null?{id:ks,overflow:xs}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Cr(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,cr=i,lr=null,!0):!1;default:return!1}}function Jf(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Zf(i){if(_t){var e=lr;if(e){var t=e;if(!Iy(i,e)){if(Jf(i))throw Error(U(418));e=ln(t.nextSibling);var r=cr;e&&Iy(i,e)?zw(r,t):(i.flags=i.flags&-4097|2,_t=!1,cr=i)}}else{if(Jf(i))throw Error(U(418));i.flags=i.flags&-4097|2,_t=!1,cr=i}}}function Oy(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;cr=i}function hh(i){if(i!==cr)return!1;if(!_t)return Oy(i),_t=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!jf(i.type,i.memoizedProps)),e&&(e=lr)){if(Jf(i))throw Gw(),Error(U(418));for(;e;)zw(i,e),e=ln(e.nextSibling)}if(Oy(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){lr=ln(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}lr=null}}else lr=cr?ln(i.stateNode.nextSibling):null;return!0}function Gw(){for(var i=lr;i;)i=ln(i.nextSibling)}function $a(){lr=cr=null,_t=!1}function Sg(i){Dr===null?Dr=[i]:Dr.push(i)}var eT=Ws.ReactCurrentBatchConfig;function Fr(i,e){if(i&&i.defaultProps){e=Lt({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}var yu=Bn(null),bu=null,Pa=null,vg=null;function kg(){vg=Pa=bu=null}function xg(i){var e=yu.current;yt(yu),i._currentValue=e}function ep(i,e,t){for(;i!==null;){var r=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),i===t)break;i=i.return}}function Va(i,e){bu=i,vg=Pa=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(ji=!0),i.firstContext=null)}function Er(i){var e=i._currentValue;if(vg!==i)if(i={context:i,memoizedValue:e,next:null},Pa===null){if(bu===null)throw Error(U(308));Pa=i,bu.dependencies={lanes:0,firstContext:i}}else Pa=Pa.next=i;return e}var Fn=null;function Bg(i){Fn===null?Fn=[i]:Fn.push(i)}function Uw(i,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Bg(e)):(t.next=s.next,s.next=t),e.interleaved=t,Fs(i,r)}function Fs(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var Js=!1;function _g(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yw(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ns(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function hn(i,e,t){var r=i.updateQueue;if(r===null)return null;if(r=r.shared,Ge&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Fs(i,t)}return s=r.interleaved,s===null?(e.next=e,Bg(r)):(e.next=s.next,s.next=e),r.interleaved=e,Fs(i,t)}function Gh(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=i.pendingLanes,t|=r,e.lanes=t,ug(i,t)}}function Dy(i,e){var t=i.updateQueue,r=i.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,n=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};n===null?s=n=a:n=n.next=a,t=t.next}while(t!==null);n===null?s=n=e:n=n.next=e}else s=n=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:r.shared,effects:r.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function wu(i,e,t,r){var s=i.updateQueue;Js=!1;var n=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,h=l.next;l.next=null,a===null?n=h:a.next=h,a=l;var u=i.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=h:o.next=h,u.lastBaseUpdate=l))}if(n!==null){var c=s.baseState;a=0,u=h=l=null,o=n;do{var d=o.lane,p=o.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=i,m=o;switch(d=e,p=t,m.tag){case 1:if(f=m.payload,typeof f=="function"){c=f.call(p,c,d);break e}c=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=m.payload,d=typeof f=="function"?f.call(p,c,d):f,d==null)break e;c=Lt({},c,d);break e;case 2:Js=!0}}o.callback!==null&&o.lane!==0&&(i.flags|=64,d=s.effects,d===null?s.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(h=u=p,l=c):u=u.next=p,a|=d;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;d=o,o=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(u===null&&(l=c),s.baseState=l,s.firstBaseUpdate=h,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else n===null&&(s.shared.lanes=0);qn|=a,i.lanes=a,i.memoizedState=c}}function Ay(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var r=i[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(U(191,s));s.call(r)}}}var $w=new Ub.Component().refs;function tp(i,e,t,r){e=i.memoizedState,t=t(r,e),t=t==null?e:Lt({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var lc={isMounted:function(i){return(i=i._reactInternals)?aa(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var r=Oi(),s=cn(i),n=Ns(r,s);n.payload=e,t!=null&&(n.callback=t),e=hn(i,n,s),e!==null&&(Ur(e,i,s,r),Gh(e,i,s))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var r=Oi(),s=cn(i),n=Ns(r,s);n.tag=1,n.payload=e,t!=null&&(n.callback=t),e=hn(i,n,s),e!==null&&(Ur(e,i,s,r),Gh(e,i,s))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=Oi(),r=cn(i),s=Ns(t,r);s.tag=2,e!=null&&(s.callback=e),e=hn(i,s,r),e!==null&&(Ur(e,i,r,t),Gh(e,i,r))}};function Vy(i,e,t,r,s,n,a){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(r,n,a):e.prototype&&e.prototype.isPureReactComponent?!el(t,r)||!el(s,n):!0}function Xw(i,e,t){var r=!1,s=yn,n=e.contextType;return typeof n=="object"&&n!==null?n=Er(n):(s=Ki(e)?$n:Ci.current,r=e.contextTypes,n=(r=r!=null)?Ya(i,s):yn),e=new e(t,n),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=lc,i.stateNode=e,e._reactInternals=i,r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=n),e}function Hy(i,e,t,r){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==i&&lc.enqueueReplaceState(e,e.state,null)}function ip(i,e,t,r){var s=i.stateNode;s.props=t,s.state=i.memoizedState,s.refs=$w,_g(i);var n=e.contextType;typeof n=="object"&&n!==null?s.context=Er(n):(n=Ki(e)?$n:Ci.current,s.context=Ya(i,n)),s.state=i.memoizedState,n=e.getDerivedStateFromProps,typeof n=="function"&&(tp(i,e,n,t),s.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&lc.enqueueReplaceState(s,s.state,null),wu(i,t,s,r),s.state=i.memoizedState),typeof s.componentDidMount=="function"&&(i.flags|=4194308)}function bo(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(U(309));var r=t.stateNode}if(!r)throw Error(U(147,i));var s=r,n=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===n?e.ref:(e=function(a){var o=s.refs;o===$w&&(o=s.refs={}),a===null?delete o[n]:o[n]=a},e._stringRef=n,e)}if(typeof i!="string")throw Error(U(284));if(!t._owner)throw Error(U(290,i))}return i}function uh(i,e){throw i=Object.prototype.toString.call(e),Error(U(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function Wy(i){var e=i._init;return e(i._payload)}function jw(i){function e(y,b){if(i){var w=y.deletions;w===null?(y.deletions=[b],y.flags|=16):w.push(b)}}function t(y,b){if(!i)return null;for(;b!==null;)e(y,b),b=b.sibling;return null}function r(y,b){for(y=new Map;b!==null;)b.key!==null?y.set(b.key,b):y.set(b.index,b),b=b.sibling;return y}function s(y,b){return y=dn(y,b),y.index=0,y.sibling=null,y}function n(y,b,w){return y.index=w,i?(w=y.alternate,w!==null?(w=w.index,w<b?(y.flags|=2,b):w):(y.flags|=2,b)):(y.flags|=1048576,b)}function a(y){return i&&y.alternate===null&&(y.flags|=2),y}function o(y,b,w,x){return b===null||b.tag!==6?(b=Rd(w,y.mode,x),b.return=y,b):(b=s(b,w),b.return=y,b)}function l(y,b,w,x){var v=w.type;return v===va?u(y,b,w.props.children,x,w.key):b!==null&&(b.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===Ks&&Wy(v)===b.type)?(x=s(b,w.props),x.ref=bo(y,b,w),x.return=y,x):(x=qh(w.type,w.key,w.props,null,y.mode,x),x.ref=bo(y,b,w),x.return=y,x)}function h(y,b,w,x){return b===null||b.tag!==4||b.stateNode.containerInfo!==w.containerInfo||b.stateNode.implementation!==w.implementation?(b=Fd(w,y.mode,x),b.return=y,b):(b=s(b,w.children||[]),b.return=y,b)}function u(y,b,w,x,v){return b===null||b.tag!==7?(b=Wn(w,y.mode,x,v),b.return=y,b):(b=s(b,w),b.return=y,b)}function c(y,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Rd(""+b,y.mode,w),b.return=y,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Zl:return w=qh(b.type,b.key,b.props,null,y.mode,w),w.ref=bo(y,null,b),w.return=y,w;case Sa:return b=Fd(b,y.mode,w),b.return=y,b;case Ks:var x=b._init;return c(y,x(b._payload),w)}if(_o(b)||fo(b))return b=Wn(b,y.mode,w,null),b.return=y,b;uh(y,b)}return null}function d(y,b,w,x){var v=b!==null?b.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return v!==null?null:o(y,b,""+w,x);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Zl:return w.key===v?l(y,b,w,x):null;case Sa:return w.key===v?h(y,b,w,x):null;case Ks:return v=w._init,d(y,b,v(w._payload),x)}if(_o(w)||fo(w))return v!==null?null:u(y,b,w,x,null);uh(y,w)}return null}function p(y,b,w,x,v){if(typeof x=="string"&&x!==""||typeof x=="number")return y=y.get(w)||null,o(b,y,""+x,v);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Zl:return y=y.get(x.key===null?w:x.key)||null,l(b,y,x,v);case Sa:return y=y.get(x.key===null?w:x.key)||null,h(b,y,x,v);case Ks:var C=x._init;return p(y,b,w,C(x._payload),v)}if(_o(x)||fo(x))return y=y.get(w)||null,u(b,y,x,v,null);uh(b,x)}return null}function f(y,b,w,x){for(var v=null,C=null,P=b,N=b=0,W=null;P!==null&&N<w.length;N++){P.index>N?(W=P,P=null):W=P.sibling;var Y=d(y,P,w[N],x);if(Y===null){P===null&&(P=W);break}i&&P&&Y.alternate===null&&e(y,P),b=n(Y,b,N),C===null?v=Y:C.sibling=Y,C=Y,P=W}if(N===w.length)return t(y,P),_t&&Pn(y,N),v;if(P===null){for(;N<w.length;N++)P=c(y,w[N],x),P!==null&&(b=n(P,b,N),C===null?v=P:C.sibling=P,C=P);return _t&&Pn(y,N),v}for(P=r(y,P);N<w.length;N++)W=p(P,y,N,w[N],x),W!==null&&(i&&W.alternate!==null&&P.delete(W.key===null?N:W.key),b=n(W,b,N),C===null?v=W:C.sibling=W,C=W);return i&&P.forEach(function(me){return e(y,me)}),_t&&Pn(y,N),v}function m(y,b,w,x){var v=fo(w);if(typeof v!="function")throw Error(U(150));if(w=v.call(w),w==null)throw Error(U(151));for(var C=v=null,P=b,N=b=0,W=null,Y=w.next();P!==null&&!Y.done;N++,Y=w.next()){P.index>N?(W=P,P=null):W=P.sibling;var me=d(y,P,Y.value,x);if(me===null){P===null&&(P=W);break}i&&P&&me.alternate===null&&e(y,P),b=n(me,b,N),C===null?v=me:C.sibling=me,C=me,P=W}if(Y.done)return t(y,P),_t&&Pn(y,N),v;if(P===null){for(;!Y.done;N++,Y=w.next())Y=c(y,Y.value,x),Y!==null&&(b=n(Y,b,N),C===null?v=Y:C.sibling=Y,C=Y);return _t&&Pn(y,N),v}for(P=r(y,P);!Y.done;N++,Y=w.next())Y=p(P,y,N,Y.value,x),Y!==null&&(i&&Y.alternate!==null&&P.delete(Y.key===null?N:Y.key),b=n(Y,b,N),C===null?v=Y:C.sibling=Y,C=Y);return i&&P.forEach(function(Ee){return e(y,Ee)}),_t&&Pn(y,N),v}function S(y,b,w,x){if(typeof w=="object"&&w!==null&&w.type===va&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Zl:e:{for(var v=w.key,C=b;C!==null;){if(C.key===v){if(v=w.type,v===va){if(C.tag===7){t(y,C.sibling),b=s(C,w.props.children),b.return=y,y=b;break e}}else if(C.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===Ks&&Wy(v)===C.type){t(y,C.sibling),b=s(C,w.props),b.ref=bo(y,C,w),b.return=y,y=b;break e}t(y,C);break}else e(y,C);C=C.sibling}w.type===va?(b=Wn(w.props.children,y.mode,x,w.key),b.return=y,y=b):(x=qh(w.type,w.key,w.props,null,y.mode,x),x.ref=bo(y,b,w),x.return=y,y=x)}return a(y);case Sa:e:{for(C=w.key;b!==null;){if(b.key===C)if(b.tag===4&&b.stateNode.containerInfo===w.containerInfo&&b.stateNode.implementation===w.implementation){t(y,b.sibling),b=s(b,w.children||[]),b.return=y,y=b;break e}else{t(y,b);break}else e(y,b);b=b.sibling}b=Fd(w,y.mode,x),b.return=y,y=b}return a(y);case Ks:return C=w._init,S(y,b,C(w._payload),x)}if(_o(w))return f(y,b,w,x);if(fo(w))return m(y,b,w,x);uh(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,b!==null&&b.tag===6?(t(y,b.sibling),b=s(b,w),b.return=y,y=b):(t(y,b),b=Rd(w,y.mode,x),b.return=y,y=b),a(y)):t(y,b)}return S}var Xa=jw(!0),qw=jw(!1),Al={},hs=Bn(Al),sl=Bn(Al),nl=Bn(Al);function In(i){if(i===Al)throw Error(U(174));return i}function Tg(i,e){switch(dt(nl,e),dt(sl,i),dt(hs,Al),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ff(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=Ff(e,i)}yt(hs),dt(hs,e)}function ja(){yt(hs),yt(sl),yt(nl)}function Qw(i){In(nl.current);var e=In(hs.current),t=Ff(e,i.type);e!==t&&(dt(sl,i),dt(hs,t))}function Cg(i){sl.current===i&&(yt(hs),yt(sl))}var Pt=Bn(0);function Su(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Cd=[];function Ng(){for(var i=0;i<Cd.length;i++)Cd[i]._workInProgressVersionPrimary=null;Cd.length=0}var Uh=Ws.ReactCurrentDispatcher,Nd=Ws.ReactCurrentBatchConfig,jn=0,Mt=null,ti=null,ui=null,vu=!1,Ao=!1,al=0,tT=0;function ki(){throw Error(U(321))}function Pg(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!$r(i[t],e[t]))return!1;return!0}function Eg(i,e,t,r,s,n){if(jn=n,Mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Uh.current=i===null||i.memoizedState===null?nT:aT,i=t(r,s),Ao){n=0;do{if(Ao=!1,al=0,25<=n)throw Error(U(301));n+=1,ui=ti=null,e.updateQueue=null,Uh.current=oT,i=t(r,s)}while(Ao)}if(Uh.current=ku,e=ti!==null&&ti.next!==null,jn=0,ui=ti=Mt=null,vu=!1,e)throw Error(U(300));return i}function Mg(){var i=al!==0;return al=0,i}function Zr(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ui===null?Mt.memoizedState=ui=i:ui=ui.next=i,ui}function Mr(){if(ti===null){var i=Mt.alternate;i=i!==null?i.memoizedState:null}else i=ti.next;var e=ui===null?Mt.memoizedState:ui.next;if(e!==null)ui=e,ti=i;else{if(i===null)throw Error(U(310));ti=i,i={memoizedState:ti.memoizedState,baseState:ti.baseState,baseQueue:ti.baseQueue,queue:ti.queue,next:null},ui===null?Mt.memoizedState=ui=i:ui=ui.next=i}return ui}function ol(i,e){return typeof e=="function"?e(i):e}function Pd(i){var e=Mr(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=i;var r=ti,s=r.baseQueue,n=t.pending;if(n!==null){if(s!==null){var a=s.next;s.next=n.next,n.next=a}r.baseQueue=s=n,t.pending=null}if(s!==null){n=s.next,r=r.baseState;var o=a=null,l=null,h=n;do{var u=h.lane;if((jn&u)===u)l!==null&&(l=l.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:i(r,h.action);else{var c={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};l===null?(o=l=c,a=r):l=l.next=c,Mt.lanes|=u,qn|=u}h=h.next}while(h!==null&&h!==n);l===null?a=r:l.next=o,$r(r,e.memoizedState)||(ji=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(i=t.interleaved,i!==null){s=i;do n=s.lane,Mt.lanes|=n,qn|=n,s=s.next;while(s!==i)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Ed(i){var e=Mr(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=i;var r=t.dispatch,s=t.pending,n=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do n=i(n,a.action),a=a.next;while(a!==s);$r(n,e.memoizedState)||(ji=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),t.lastRenderedState=n}return[n,r]}function Kw(){}function Jw(i,e){var t=Mt,r=Mr(),s=e(),n=!$r(r.memoizedState,s);if(n&&(r.memoizedState=s,ji=!0),r=r.queue,Lg(tS.bind(null,t,r,i),[i]),r.getSnapshot!==e||n||ui!==null&&ui.memoizedState.tag&1){if(t.flags|=2048,ll(9,eS.bind(null,t,r,s,e),void 0,null),di===null)throw Error(U(349));jn&30||Zw(t,e,s)}return s}function Zw(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=Mt.updateQueue,e===null?(e={lastEffect:null,stores:null},Mt.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function eS(i,e,t,r){e.value=t,e.getSnapshot=r,iS(e)&&rS(i)}function tS(i,e,t){return t(function(){iS(e)&&rS(i)})}function iS(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!$r(i,t)}catch{return!0}}function rS(i){var e=Fs(i,1);e!==null&&Ur(e,i,1,-1)}function zy(i){var e=Zr();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ol,lastRenderedState:i},e.queue=i,i=i.dispatch=sT.bind(null,Mt,i),[e.memoizedState,i]}function ll(i,e,t,r){return i={tag:i,create:e,destroy:t,deps:r,next:null},e=Mt.updateQueue,e===null?(e={lastEffect:null,stores:null},Mt.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(r=t.next,t.next=i,i.next=r,e.lastEffect=i)),i}function sS(){return Mr().memoizedState}function Yh(i,e,t,r){var s=Zr();Mt.flags|=i,s.memoizedState=ll(1|e,t,void 0,r===void 0?null:r)}function hc(i,e,t,r){var s=Mr();r=r===void 0?null:r;var n=void 0;if(ti!==null){var a=ti.memoizedState;if(n=a.destroy,r!==null&&Pg(r,a.deps)){s.memoizedState=ll(e,t,n,r);return}}Mt.flags|=i,s.memoizedState=ll(1|e,t,n,r)}function Gy(i,e){return Yh(8390656,8,i,e)}function Lg(i,e){return hc(2048,8,i,e)}function nS(i,e){return hc(4,2,i,e)}function aS(i,e){return hc(4,4,i,e)}function oS(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function lS(i,e,t){return t=t!=null?t.concat([i]):null,hc(4,4,oS.bind(null,e,i),t)}function Rg(){}function hS(i,e){var t=Mr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Pg(e,r[1])?r[0]:(t.memoizedState=[i,e],i)}function uS(i,e){var t=Mr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Pg(e,r[1])?r[0]:(i=i(),t.memoizedState=[i,e],i)}function cS(i,e,t){return jn&21?($r(t,e)||(t=pw(),Mt.lanes|=t,qn|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,ji=!0),i.memoizedState=t)}function iT(i,e){var t=it;it=t!==0&&4>t?t:4,i(!0);var r=Nd.transition;Nd.transition={};try{i(!1),e()}finally{it=t,Nd.transition=r}}function dS(){return Mr().memoizedState}function rT(i,e,t){var r=cn(i);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},fS(i))pS(e,t);else if(t=Uw(i,e,t,r),t!==null){var s=Oi();Ur(t,i,r,s),gS(t,e,r)}}function sT(i,e,t){var r=cn(i),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(fS(i))pS(e,s);else{var n=i.alternate;if(i.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var a=e.lastRenderedState,o=n(a,t);if(s.hasEagerState=!0,s.eagerState=o,$r(o,a)){var l=e.interleaved;l===null?(s.next=s,Bg(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=Uw(i,e,s,r),t!==null&&(s=Oi(),Ur(t,i,r,s),gS(t,e,r))}}function fS(i){var e=i.alternate;return i===Mt||e!==null&&e===Mt}function pS(i,e){Ao=vu=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function gS(i,e,t){if(t&4194240){var r=e.lanes;r&=i.pendingLanes,t|=r,e.lanes=t,ug(i,t)}}var ku={readContext:Er,useCallback:ki,useContext:ki,useEffect:ki,useImperativeHandle:ki,useInsertionEffect:ki,useLayoutEffect:ki,useMemo:ki,useReducer:ki,useRef:ki,useState:ki,useDebugValue:ki,useDeferredValue:ki,useTransition:ki,useMutableSource:ki,useSyncExternalStore:ki,useId:ki,unstable_isNewReconciler:!1},nT={readContext:Er,useCallback:function(i,e){return Zr().memoizedState=[i,e===void 0?null:e],i},useContext:Er,useEffect:Gy,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,Yh(4194308,4,oS.bind(null,e,i),t)},useLayoutEffect:function(i,e){return Yh(4194308,4,i,e)},useInsertionEffect:function(i,e){return Yh(4,2,i,e)},useMemo:function(i,e){var t=Zr();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var r=Zr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},r.queue=i,i=i.dispatch=rT.bind(null,Mt,i),[r.memoizedState,i]},useRef:function(i){var e=Zr();return i={current:i},e.memoizedState=i},useState:zy,useDebugValue:Rg,useDeferredValue:function(i){return Zr().memoizedState=i},useTransition:function(){var i=zy(!1),e=i[0];return i=iT.bind(null,i[1]),Zr().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var r=Mt,s=Zr();if(_t){if(t===void 0)throw Error(U(407));t=t()}else{if(t=e(),di===null)throw Error(U(349));jn&30||Zw(r,e,t)}s.memoizedState=t;var n={value:t,getSnapshot:e};return s.queue=n,Gy(tS.bind(null,r,n,i),[i]),r.flags|=2048,ll(9,eS.bind(null,r,n,t,e),void 0,null),t},useId:function(){var i=Zr(),e=di.identifierPrefix;if(_t){var t=xs,r=ks;t=(r&~(1<<32-Gr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=al++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=tT++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},aT={readContext:Er,useCallback:hS,useContext:Er,useEffect:Lg,useImperativeHandle:lS,useInsertionEffect:nS,useLayoutEffect:aS,useMemo:uS,useReducer:Pd,useRef:sS,useState:function(){return Pd(ol)},useDebugValue:Rg,useDeferredValue:function(i){var e=Mr();return cS(e,ti.memoizedState,i)},useTransition:function(){var i=Pd(ol)[0],e=Mr().memoizedState;return[i,e]},useMutableSource:Kw,useSyncExternalStore:Jw,useId:dS,unstable_isNewReconciler:!1},oT={readContext:Er,useCallback:hS,useContext:Er,useEffect:Lg,useImperativeHandle:lS,useInsertionEffect:nS,useLayoutEffect:aS,useMemo:uS,useReducer:Ed,useRef:sS,useState:function(){return Ed(ol)},useDebugValue:Rg,useDeferredValue:function(i){var e=Mr();return ti===null?e.memoizedState=i:cS(e,ti.memoizedState,i)},useTransition:function(){var i=Ed(ol)[0],e=Mr().memoizedState;return[i,e]},useMutableSource:Kw,useSyncExternalStore:Jw,useId:dS,unstable_isNewReconciler:!1};function qa(i,e){try{var t="",r=e;do t+=IB(r),r=r.return;while(r);var s=t}catch(n){s=`
Error generating stack: `+n.message+`
`+n.stack}return{value:i,source:e,stack:s,digest:null}}function Md(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function rp(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var lT=typeof WeakMap=="function"?WeakMap:Map;function mS(i,e,t){t=Ns(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Bu||(Bu=!0,fp=r),rp(i,e)},t}function yS(i,e,t){t=Ns(-1,t),t.tag=3;var r=i.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){rp(i,e)}}var n=i.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(t.callback=function(){rp(i,e),typeof r!="function"&&(un===null?un=new Set([this]):un.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Uy(i,e,t){var r=i.pingCache;if(r===null){r=i.pingCache=new lT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),i=kT.bind(null,i,e,t),e.then(i,i))}function Yy(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function $y(i,e,t,r,s){return i.mode&1?(i.flags|=65536,i.lanes=s,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ns(-1,1),e.tag=2,hn(t,e,1))),t.lanes|=1),i)}var hT=Ws.ReactCurrentOwner,ji=!1;function Li(i,e,t,r){e.child=i===null?qw(e,null,t,r):Xa(e,i.child,t,r)}function Xy(i,e,t,r,s){t=t.render;var n=e.ref;return Va(e,s),r=Eg(i,e,t,r,n,s),t=Mg(),i!==null&&!ji?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,Is(i,e,s)):(_t&&t&&bg(e),e.flags|=1,Li(i,e,r,s),e.child)}function jy(i,e,t,r,s){if(i===null){var n=t.type;return typeof n=="function"&&!Wg(n)&&n.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=n,bS(i,e,n,r,s)):(i=qh(t.type,null,r,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}if(n=i.child,!(i.lanes&s)){var a=n.memoizedProps;if(t=t.compare,t=t!==null?t:el,t(a,r)&&i.ref===e.ref)return Is(i,e,s)}return e.flags|=1,i=dn(n,r),i.ref=e.ref,i.return=e,e.child=i}function bS(i,e,t,r,s){if(i!==null){var n=i.memoizedProps;if(el(n,r)&&i.ref===e.ref)if(ji=!1,e.pendingProps=r=n,(i.lanes&s)!==0)i.flags&131072&&(ji=!0);else return e.lanes=i.lanes,Is(i,e,s)}return sp(i,e,t,r,s)}function wS(i,e,t){var r=e.pendingProps,s=r.children,n=i!==null?i.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt(Ma,rr),rr|=t;else{if(!(t&1073741824))return i=n!==null?n.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,dt(Ma,rr),rr|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=n!==null?n.baseLanes:t,dt(Ma,rr),rr|=r}else n!==null?(r=n.baseLanes|t,e.memoizedState=null):r=t,dt(Ma,rr),rr|=r;return Li(i,e,s,t),e.child}function SS(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function sp(i,e,t,r,s){var n=Ki(t)?$n:Ci.current;return n=Ya(e,n),Va(e,s),t=Eg(i,e,t,r,n,s),r=Mg(),i!==null&&!ji?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,Is(i,e,s)):(_t&&r&&bg(e),e.flags|=1,Li(i,e,t,s),e.child)}function qy(i,e,t,r,s){if(Ki(t)){var n=!0;pu(e)}else n=!1;if(Va(e,s),e.stateNode===null)$h(i,e),Xw(e,t,r),ip(e,t,r,s),r=!0;else if(i===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,h=t.contextType;typeof h=="object"&&h!==null?h=Er(h):(h=Ki(t)?$n:Ci.current,h=Ya(e,h));var u=t.getDerivedStateFromProps,c=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==h)&&Hy(e,a,r,h),Js=!1;var d=e.memoizedState;a.state=d,wu(e,r,a,s),l=e.memoizedState,o!==r||d!==l||Qi.current||Js?(typeof u=="function"&&(tp(e,t,u,r),l=e.memoizedState),(o=Js||Vy(e,t,o,r,d,l,h))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=h,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Yw(i,e),o=e.memoizedProps,h=e.type===e.elementType?o:Fr(e.type,o),a.props=h,c=e.pendingProps,d=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Er(l):(l=Ki(t)?$n:Ci.current,l=Ya(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==c||d!==l)&&Hy(e,a,r,l),Js=!1,d=e.memoizedState,a.state=d,wu(e,r,a,s);var f=e.memoizedState;o!==c||d!==f||Qi.current||Js?(typeof p=="function"&&(tp(e,t,p,r),f=e.memoizedState),(h=Js||Vy(e,t,h,r,d,f,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,f,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,f,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=f),a.props=r,a.state=f,a.context=l,r=h):(typeof a.componentDidUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),r=!1)}return np(i,e,t,r,n,s)}function np(i,e,t,r,s,n){SS(i,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Fy(e,t,!1),Is(i,e,n);r=e.stateNode,hT.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,i!==null&&a?(e.child=Xa(e,i.child,null,n),e.child=Xa(e,null,o,n)):Li(i,e,o,n),e.memoizedState=r.state,s&&Fy(e,t,!0),e.child}function vS(i){var e=i.stateNode;e.pendingContext?Ry(i,e.pendingContext,e.pendingContext!==e.context):e.context&&Ry(i,e.context,!1),Tg(i,e.containerInfo)}function Qy(i,e,t,r,s){return $a(),Sg(s),e.flags|=256,Li(i,e,t,r),e.child}var ap={dehydrated:null,treeContext:null,retryLane:0};function op(i){return{baseLanes:i,cachePool:null,transitions:null}}function kS(i,e,t){var r=e.pendingProps,s=Pt.current,n=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=i!==null&&i.memoizedState===null?!1:(s&2)!==0),o?(n=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(s|=1),dt(Pt,s&1),i===null)return Zf(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,i=r.fallback,n?(r=e.mode,n=e.child,a={mode:"hidden",children:a},!(r&1)&&n!==null?(n.childLanes=0,n.pendingProps=a):n=dc(a,r,0,null),i=Wn(i,r,t,null),n.return=e,i.return=e,n.sibling=i,e.child=n,e.child.memoizedState=op(t),e.memoizedState=ap,i):Fg(e,a));if(s=i.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return uT(i,e,a,r,o,s,t);if(n){n=r.fallback,a=e.mode,s=i.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=dn(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?n=dn(o,n):(n=Wn(n,a,t,null),n.flags|=2),n.return=e,r.return=e,r.sibling=n,e.child=r,r=n,n=e.child,a=i.child.memoizedState,a=a===null?op(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},n.memoizedState=a,n.childLanes=i.childLanes&~t,e.memoizedState=ap,r}return n=i.child,i=n.sibling,r=dn(n,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=r,e.memoizedState=null,r}function Fg(i,e){return e=dc({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function ch(i,e,t,r){return r!==null&&Sg(r),Xa(e,i.child,null,t),i=Fg(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function uT(i,e,t,r,s,n,a){if(t)return e.flags&256?(e.flags&=-257,r=Md(Error(U(422))),ch(i,e,a,r)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(n=r.fallback,s=e.mode,r=dc({mode:"visible",children:r.children},s,0,null),n=Wn(n,s,a,null),n.flags|=2,r.return=e,n.return=e,r.sibling=n,e.child=r,e.mode&1&&Xa(e,i.child,null,a),e.child.memoizedState=op(a),e.memoizedState=ap,n);if(!(e.mode&1))return ch(i,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,n=Error(U(419)),r=Md(n,r,void 0),ch(i,e,a,r)}if(o=(a&i.childLanes)!==0,ji||o){if(r=di,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==n.retryLane&&(n.retryLane=s,Fs(i,s),Ur(r,i,s,-1))}return Hg(),r=Md(Error(U(421))),ch(i,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=i.child,e=xT.bind(null,i),s._reactRetry=e,null):(i=n.treeContext,lr=ln(s.nextSibling),cr=e,_t=!0,Dr=null,i!==null&&(xr[Br++]=ks,xr[Br++]=xs,xr[Br++]=Xn,ks=i.id,xs=i.overflow,Xn=e),e=Fg(e,r.children),e.flags|=4096,e)}function Ky(i,e,t){i.lanes|=e;var r=i.alternate;r!==null&&(r.lanes|=e),ep(i.return,e,t)}function Ld(i,e,t,r,s){var n=i.memoizedState;n===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(n.isBackwards=e,n.rendering=null,n.renderingStartTime=0,n.last=r,n.tail=t,n.tailMode=s)}function xS(i,e,t){var r=e.pendingProps,s=r.revealOrder,n=r.tail;if(Li(i,e,r.children,t),r=Pt.current,r&2)r=r&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Ky(i,t,e);else if(i.tag===19)Ky(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}r&=1}if(dt(Pt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)i=t.alternate,i!==null&&Su(i)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Ld(e,!1,s,t,n);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(i=s.alternate,i!==null&&Su(i)===null){e.child=s;break}i=s.sibling,s.sibling=t,t=s,s=i}Ld(e,!0,t,null,n);break;case"together":Ld(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $h(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function Is(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),qn|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(U(153));if(e.child!==null){for(i=e.child,t=dn(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=dn(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function cT(i,e,t){switch(e.tag){case 3:vS(e),$a();break;case 5:Qw(e);break;case 1:Ki(e.type)&&pu(e);break;case 4:Tg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;dt(yu,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(dt(Pt,Pt.current&1),e.flags|=128,null):t&e.child.childLanes?kS(i,e,t):(dt(Pt,Pt.current&1),i=Is(i,e,t),i!==null?i.sibling:null);dt(Pt,Pt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,i.flags&128){if(r)return xS(i,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),dt(Pt,Pt.current),r)break;return null;case 22:case 23:return e.lanes=0,wS(i,e,t)}return Is(i,e,t)}var BS,lp,_S,TS;BS=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};lp=function(){};_S=function(i,e,t,r){var s=i.memoizedProps;if(s!==r){i=e.stateNode,In(hs.current);var n=null;switch(t){case"input":s=Ef(i,s),r=Ef(i,r),n=[];break;case"select":s=Lt({},s,{value:void 0}),r=Lt({},r,{value:void 0}),n=[];break;case"textarea":s=Rf(i,s),r=Rf(i,r),n=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(i.onclick=du)}If(t,r);var a;t=null;for(h in s)if(!r.hasOwnProperty(h)&&s.hasOwnProperty(h)&&s[h]!=null)if(h==="style"){var o=s[h];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Xo.hasOwnProperty(h)?n||(n=[]):(n=n||[]).push(h,null));for(h in r){var l=r[h];if(o=s!=null?s[h]:void 0,r.hasOwnProperty(h)&&l!==o&&(l!=null||o!=null))if(h==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(n||(n=[]),n.push(h,t)),t=l;else h==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(n=n||[]).push(h,l)):h==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(h,""+l):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(Xo.hasOwnProperty(h)?(l!=null&&h==="onScroll"&&gt("scroll",i),n||o===l||(n=[])):(n=n||[]).push(h,l))}t&&(n=n||[]).push("style",t);var h=n;(e.updateQueue=h)&&(e.flags|=4)}};TS=function(i,e,t,r){t!==r&&(e.flags|=4)};function wo(i,e){if(!_t)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:r.sibling=null}}function xi(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,r=0;if(e)for(var s=i.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=i,s=s.sibling;else for(s=i.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=i,s=s.sibling;return i.subtreeFlags|=r,i.childLanes=t,e}function dT(i,e,t){var r=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xi(e),null;case 1:return Ki(e.type)&&fu(),xi(e),null;case 3:return r=e.stateNode,ja(),yt(Qi),yt(Ci),Ng(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(i===null||i.child===null)&&(hh(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Dr!==null&&(mp(Dr),Dr=null))),lp(i,e),xi(e),null;case 5:Cg(e);var s=In(nl.current);if(t=e.type,i!==null&&e.stateNode!=null)_S(i,e,t,r,s),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(U(166));return xi(e),null}if(i=In(hs.current),hh(e)){r=e.stateNode,t=e.type;var n=e.memoizedProps;switch(r[ss]=e,r[rl]=n,i=(e.mode&1)!==0,t){case"dialog":gt("cancel",r),gt("close",r);break;case"iframe":case"object":case"embed":gt("load",r);break;case"video":case"audio":for(s=0;s<Co.length;s++)gt(Co[s],r);break;case"source":gt("error",r);break;case"img":case"image":case"link":gt("error",r),gt("load",r);break;case"details":gt("toggle",r);break;case"input":ay(r,n),gt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!n.multiple},gt("invalid",r);break;case"textarea":ly(r,n),gt("invalid",r)}If(t,n),s=null;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];a==="children"?typeof o=="string"?r.textContent!==o&&(n.suppressHydrationWarning!==!0&&lh(r.textContent,o,i),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(n.suppressHydrationWarning!==!0&&lh(r.textContent,o,i),s=["children",""+o]):Xo.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&gt("scroll",r)}switch(t){case"input":eh(r),oy(r,n,!0);break;case"textarea":eh(r),hy(r);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(r.onclick=du)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Zb(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=a.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof r.is=="string"?i=a.createElement(t,{is:r.is}):(i=a.createElement(t),t==="select"&&(a=i,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):i=a.createElementNS(i,t),i[ss]=e,i[rl]=r,BS(i,e,!1,!1),e.stateNode=i;e:{switch(a=Of(t,r),t){case"dialog":gt("cancel",i),gt("close",i),s=r;break;case"iframe":case"object":case"embed":gt("load",i),s=r;break;case"video":case"audio":for(s=0;s<Co.length;s++)gt(Co[s],i);s=r;break;case"source":gt("error",i),s=r;break;case"img":case"image":case"link":gt("error",i),gt("load",i),s=r;break;case"details":gt("toggle",i),s=r;break;case"input":ay(i,r),s=Ef(i,r),gt("invalid",i);break;case"option":s=r;break;case"select":i._wrapperState={wasMultiple:!!r.multiple},s=Lt({},r,{value:void 0}),gt("invalid",i);break;case"textarea":ly(i,r),s=Rf(i,r),gt("invalid",i);break;default:s=r}If(t,s),o=s;for(n in o)if(o.hasOwnProperty(n)){var l=o[n];n==="style"?iw(i,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ew(i,l)):n==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&jo(i,l):typeof l=="number"&&jo(i,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(Xo.hasOwnProperty(n)?l!=null&&n==="onScroll"&&gt("scroll",i):l!=null&&sg(i,n,l,a))}switch(t){case"input":eh(i),oy(i,r,!1);break;case"textarea":eh(i),hy(i);break;case"option":r.value!=null&&i.setAttribute("value",""+mn(r.value));break;case"select":i.multiple=!!r.multiple,n=r.value,n!=null?Ia(i,!!r.multiple,n,!1):r.defaultValue!=null&&Ia(i,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(i.onclick=du)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xi(e),null;case 6:if(i&&e.stateNode!=null)TS(i,e,i.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(U(166));if(t=In(nl.current),In(hs.current),hh(e)){if(r=e.stateNode,t=e.memoizedProps,r[ss]=e,(n=r.nodeValue!==t)&&(i=cr,i!==null))switch(i.tag){case 3:lh(r.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&lh(r.nodeValue,t,(i.mode&1)!==0)}n&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[ss]=e,e.stateNode=r}return xi(e),null;case 13:if(yt(Pt),r=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(_t&&lr!==null&&e.mode&1&&!(e.flags&128))Gw(),$a(),e.flags|=98560,n=!1;else if(n=hh(e),r!==null&&r.dehydrated!==null){if(i===null){if(!n)throw Error(U(318));if(n=e.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(U(317));n[ss]=e}else $a(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xi(e),n=!1}else Dr!==null&&(mp(Dr),Dr=null),n=!0;if(!n)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(i!==null&&i.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(i===null||Pt.current&1?ri===0&&(ri=3):Hg())),e.updateQueue!==null&&(e.flags|=4),xi(e),null);case 4:return ja(),lp(i,e),i===null&&tl(e.stateNode.containerInfo),xi(e),null;case 10:return xg(e.type._context),xi(e),null;case 17:return Ki(e.type)&&fu(),xi(e),null;case 19:if(yt(Pt),n=e.memoizedState,n===null)return xi(e),null;if(r=(e.flags&128)!==0,a=n.rendering,a===null)if(r)wo(n,!1);else{if(ri!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(a=Su(i),a!==null){for(e.flags|=128,wo(n,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)n=t,i=r,n.flags&=14680066,a=n.alternate,a===null?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,i=a.dependencies,n.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return dt(Pt,Pt.current&1|2),e.child}i=i.sibling}n.tail!==null&&Ht()>Qa&&(e.flags|=128,r=!0,wo(n,!1),e.lanes=4194304)}else{if(!r)if(i=Su(a),i!==null){if(e.flags|=128,r=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),wo(n,!0),n.tail===null&&n.tailMode==="hidden"&&!a.alternate&&!_t)return xi(e),null}else 2*Ht()-n.renderingStartTime>Qa&&t!==1073741824&&(e.flags|=128,r=!0,wo(n,!1),e.lanes=4194304);n.isBackwards?(a.sibling=e.child,e.child=a):(t=n.last,t!==null?t.sibling=a:e.child=a,n.last=a)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=Ht(),e.sibling=null,t=Pt.current,dt(Pt,r?t&1|2:t&1),e):(xi(e),null);case 22:case 23:return Vg(),r=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?rr&1073741824&&(xi(e),e.subtreeFlags&6&&(e.flags|=8192)):xi(e),null;case 24:return null;case 25:return null}throw Error(U(156,e.tag))}function fT(i,e){switch(wg(e),e.tag){case 1:return Ki(e.type)&&fu(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return ja(),yt(Qi),yt(Ci),Ng(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return Cg(e),null;case 13:if(yt(Pt),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(U(340));$a()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return yt(Pt),null;case 4:return ja(),null;case 10:return xg(e.type._context),null;case 22:case 23:return Vg(),null;case 24:return null;default:return null}}var dh=!1,_i=!1,pT=typeof WeakSet=="function"?WeakSet:Set,ee=null;function Ea(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ft(i,e,r)}else t.current=null}function hp(i,e,t){try{t()}catch(r){Ft(i,e,r)}}var Jy=!1;function gT(i,e){if($f=hu,i=Ew(),yg(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,n=r.focusNode;r=r.focusOffset;try{t.nodeType,n.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,h=0,u=0,c=i,d=null;t:for(;;){for(var p;c!==t||s!==0&&c.nodeType!==3||(o=a+s),c!==n||r!==0&&c.nodeType!==3||(l=a+r),c.nodeType===3&&(a+=c.nodeValue.length),(p=c.firstChild)!==null;)d=c,c=p;for(;;){if(c===i)break t;if(d===t&&++h===s&&(o=a),d===n&&++u===r&&(l=a),(p=c.nextSibling)!==null)break;c=d,d=c.parentNode}c=p}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Xf={focusedElem:i,selectionRange:t},hu=!1,ee=e;ee!==null;)if(e=ee,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,ee=i;else for(;ee!==null;){e=ee;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var m=f.memoizedProps,S=f.memoizedState,y=e.stateNode,b=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:Fr(e.type,m),S);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(U(163))}}catch(x){Ft(e,e.return,x)}if(i=e.sibling,i!==null){i.return=e.return,ee=i;break}ee=e.return}return f=Jy,Jy=!1,f}function Vo(i,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&i)===i){var n=s.destroy;s.destroy=void 0,n!==void 0&&hp(e,t,n)}s=s.next}while(s!==r)}}function uc(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function up(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function CS(i){var e=i.alternate;e!==null&&(i.alternate=null,CS(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[ss],delete e[rl],delete e[Qf],delete e[K_],delete e[J_])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function NS(i){return i.tag===5||i.tag===3||i.tag===4}function Zy(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||NS(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function cp(i,e,t){var r=i.tag;if(r===5||r===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=du));else if(r!==4&&(i=i.child,i!==null))for(cp(i,e,t),i=i.sibling;i!==null;)cp(i,e,t),i=i.sibling}function dp(i,e,t){var r=i.tag;if(r===5||r===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(r!==4&&(i=i.child,i!==null))for(dp(i,e,t),i=i.sibling;i!==null;)dp(i,e,t),i=i.sibling}var gi=null,Ir=!1;function qs(i,e,t){for(t=t.child;t!==null;)PS(i,e,t),t=t.sibling}function PS(i,e,t){if(ls&&typeof ls.onCommitFiberUnmount=="function")try{ls.onCommitFiberUnmount(ic,t)}catch{}switch(t.tag){case 5:_i||Ea(t,e);case 6:var r=gi,s=Ir;gi=null,qs(i,e,t),gi=r,Ir=s,gi!==null&&(Ir?(i=gi,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):gi.removeChild(t.stateNode));break;case 18:gi!==null&&(Ir?(i=gi,t=t.stateNode,i.nodeType===8?_d(i.parentNode,t):i.nodeType===1&&_d(i,t),Jo(i)):_d(gi,t.stateNode));break;case 4:r=gi,s=Ir,gi=t.stateNode.containerInfo,Ir=!0,qs(i,e,t),gi=r,Ir=s;break;case 0:case 11:case 14:case 15:if(!_i&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var n=s,a=n.destroy;n=n.tag,a!==void 0&&(n&2||n&4)&&hp(t,e,a),s=s.next}while(s!==r)}qs(i,e,t);break;case 1:if(!_i&&(Ea(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){Ft(t,e,o)}qs(i,e,t);break;case 21:qs(i,e,t);break;case 22:t.mode&1?(_i=(r=_i)||t.memoizedState!==null,qs(i,e,t),_i=r):qs(i,e,t);break;default:qs(i,e,t)}}function e0(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new pT),e.forEach(function(r){var s=BT.bind(null,i,r);t.has(r)||(t.add(r),r.then(s,s))})}}function Lr(i,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var n=i,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:gi=o.stateNode,Ir=!1;break e;case 3:gi=o.stateNode.containerInfo,Ir=!0;break e;case 4:gi=o.stateNode.containerInfo,Ir=!0;break e}o=o.return}if(gi===null)throw Error(U(160));PS(n,a,s),gi=null,Ir=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(h){Ft(s,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ES(e,i),e=e.sibling}function ES(i,e){var t=i.alternate,r=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Lr(e,i),Kr(i),r&4){try{Vo(3,i,i.return),uc(3,i)}catch(m){Ft(i,i.return,m)}try{Vo(5,i,i.return)}catch(m){Ft(i,i.return,m)}}break;case 1:Lr(e,i),Kr(i),r&512&&t!==null&&Ea(t,t.return);break;case 5:if(Lr(e,i),Kr(i),r&512&&t!==null&&Ea(t,t.return),i.flags&32){var s=i.stateNode;try{jo(s,"")}catch(m){Ft(i,i.return,m)}}if(r&4&&(s=i.stateNode,s!=null)){var n=i.memoizedProps,a=t!==null?t.memoizedProps:n,o=i.type,l=i.updateQueue;if(i.updateQueue=null,l!==null)try{o==="input"&&n.type==="radio"&&n.name!=null&&Kb(s,n),Of(o,a);var h=Of(o,n);for(a=0;a<l.length;a+=2){var u=l[a],c=l[a+1];u==="style"?iw(s,c):u==="dangerouslySetInnerHTML"?ew(s,c):u==="children"?jo(s,c):sg(s,u,c,h)}switch(o){case"input":Mf(s,n);break;case"textarea":Jb(s,n);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!n.multiple;var p=n.value;p!=null?Ia(s,!!n.multiple,p,!1):d!==!!n.multiple&&(n.defaultValue!=null?Ia(s,!!n.multiple,n.defaultValue,!0):Ia(s,!!n.multiple,n.multiple?[]:"",!1))}s[rl]=n}catch(m){Ft(i,i.return,m)}}break;case 6:if(Lr(e,i),Kr(i),r&4){if(i.stateNode===null)throw Error(U(162));s=i.stateNode,n=i.memoizedProps;try{s.nodeValue=n}catch(m){Ft(i,i.return,m)}}break;case 3:if(Lr(e,i),Kr(i),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Jo(e.containerInfo)}catch(m){Ft(i,i.return,m)}break;case 4:Lr(e,i),Kr(i);break;case 13:Lr(e,i),Kr(i),s=i.child,s.flags&8192&&(n=s.memoizedState!==null,s.stateNode.isHidden=n,!n||s.alternate!==null&&s.alternate.memoizedState!==null||(Dg=Ht())),r&4&&e0(i);break;case 22:if(u=t!==null&&t.memoizedState!==null,i.mode&1?(_i=(h=_i)||u,Lr(e,i),_i=h):Lr(e,i),Kr(i),r&8192){if(h=i.memoizedState!==null,(i.stateNode.isHidden=h)&&!u&&i.mode&1)for(ee=i,u=i.child;u!==null;){for(c=ee=u;ee!==null;){switch(d=ee,p=d.child,d.tag){case 0:case 11:case 14:case 15:Vo(4,d,d.return);break;case 1:Ea(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,t=d.return;try{e=r,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(m){Ft(r,t,m)}}break;case 5:Ea(d,d.return);break;case 22:if(d.memoizedState!==null){i0(c);continue}}p!==null?(p.return=d,ee=p):i0(c)}u=u.sibling}e:for(u=null,c=i;;){if(c.tag===5){if(u===null){u=c;try{s=c.stateNode,h?(n=s.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(o=c.stateNode,l=c.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=tw("display",a))}catch(m){Ft(i,i.return,m)}}}else if(c.tag===6){if(u===null)try{c.stateNode.nodeValue=h?"":c.memoizedProps}catch(m){Ft(i,i.return,m)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===i)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break e;for(;c.sibling===null;){if(c.return===null||c.return===i)break e;u===c&&(u=null),c=c.return}u===c&&(u=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:Lr(e,i),Kr(i),r&4&&e0(i);break;case 21:break;default:Lr(e,i),Kr(i)}}function Kr(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(NS(t)){var r=t;break e}t=t.return}throw Error(U(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(jo(s,""),r.flags&=-33);var n=Zy(i);dp(i,n,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=Zy(i);cp(i,o,a);break;default:throw Error(U(161))}}catch(l){Ft(i,i.return,l)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function mT(i,e,t){ee=i,MS(i)}function MS(i,e,t){for(var r=(i.mode&1)!==0;ee!==null;){var s=ee,n=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||dh;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||_i;o=dh;var h=_i;if(dh=a,(_i=l)&&!h)for(ee=s;ee!==null;)a=ee,l=a.child,a.tag===22&&a.memoizedState!==null?r0(s):l!==null?(l.return=a,ee=l):r0(s);for(;n!==null;)ee=n,MS(n),n=n.sibling;ee=s,dh=o,_i=h}t0(i)}else s.subtreeFlags&8772&&n!==null?(n.return=s,ee=n):t0(i)}}function t0(i){for(;ee!==null;){var e=ee;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:_i||uc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!_i)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Fr(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;n!==null&&Ay(e,n,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Ay(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var u=h.memoizedState;if(u!==null){var c=u.dehydrated;c!==null&&Jo(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(U(163))}_i||e.flags&512&&up(e)}catch(d){Ft(e,e.return,d)}}if(e===i){ee=null;break}if(t=e.sibling,t!==null){t.return=e.return,ee=t;break}ee=e.return}}function i0(i){for(;ee!==null;){var e=ee;if(e===i){ee=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ee=t;break}ee=e.return}}function r0(i){for(;ee!==null;){var e=ee;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{uc(4,e)}catch(l){Ft(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Ft(e,s,l)}}var n=e.return;try{up(e)}catch(l){Ft(e,n,l)}break;case 5:var a=e.return;try{up(e)}catch(l){Ft(e,a,l)}}}catch(l){Ft(e,e.return,l)}if(e===i){ee=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ee=o;break}ee=e.return}}var yT=Math.ceil,xu=Ws.ReactCurrentDispatcher,Ig=Ws.ReactCurrentOwner,Pr=Ws.ReactCurrentBatchConfig,Ge=0,di=null,Kt=null,bi=0,rr=0,Ma=Bn(0),ri=0,hl=null,qn=0,cc=0,Og=0,Ho=null,Gi=null,Dg=0,Qa=1/0,ys=null,Bu=!1,fp=null,un=null,fh=!1,rn=null,_u=0,Wo=0,pp=null,Xh=-1,jh=0;function Oi(){return Ge&6?Ht():Xh!==-1?Xh:Xh=Ht()}function cn(i){return i.mode&1?Ge&2&&bi!==0?bi&-bi:eT.transition!==null?(jh===0&&(jh=pw()),jh):(i=it,i!==0||(i=window.event,i=i===void 0?16:vw(i.type)),i):1}function Ur(i,e,t,r){if(50<Wo)throw Wo=0,pp=null,Error(U(185));Il(i,t,r),(!(Ge&2)||i!==di)&&(i===di&&(!(Ge&2)&&(cc|=t),ri===4&&en(i,bi)),Ji(i,r),t===1&&Ge===0&&!(e.mode&1)&&(Qa=Ht()+500,oc&&_n()))}function Ji(i,e){var t=i.callbackNode;e_(i,e);var r=lu(i,i===di?bi:0);if(r===0)t!==null&&dy(t),i.callbackNode=null,i.callbackPriority=0;else if(e=r&-r,i.callbackPriority!==e){if(t!=null&&dy(t),e===1)i.tag===0?Z_(s0.bind(null,i)):Hw(s0.bind(null,i)),q_(function(){!(Ge&6)&&_n()}),t=null;else{switch(gw(r)){case 1:t=hg;break;case 4:t=dw;break;case 16:t=ou;break;case 536870912:t=fw;break;default:t=ou}t=VS(t,LS.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function LS(i,e){if(Xh=-1,jh=0,Ge&6)throw Error(U(327));var t=i.callbackNode;if(Ha()&&i.callbackNode!==t)return null;var r=lu(i,i===di?bi:0);if(r===0)return null;if(r&30||r&i.expiredLanes||e)e=Tu(i,r);else{e=r;var s=Ge;Ge|=2;var n=FS();(di!==i||bi!==e)&&(ys=null,Qa=Ht()+500,Hn(i,e));do try{ST();break}catch(o){RS(i,o)}while(!0);kg(),xu.current=n,Ge=s,Kt!==null?e=0:(di=null,bi=0,e=ri)}if(e!==0){if(e===2&&(s=Wf(i),s!==0&&(r=s,e=gp(i,s))),e===1)throw t=hl,Hn(i,0),en(i,r),Ji(i,Ht()),t;if(e===6)en(i,r);else{if(s=i.current.alternate,!(r&30)&&!bT(s)&&(e=Tu(i,r),e===2&&(n=Wf(i),n!==0&&(r=n,e=gp(i,n))),e===1))throw t=hl,Hn(i,0),en(i,r),Ji(i,Ht()),t;switch(i.finishedWork=s,i.finishedLanes=r,e){case 0:case 1:throw Error(U(345));case 2:En(i,Gi,ys);break;case 3:if(en(i,r),(r&130023424)===r&&(e=Dg+500-Ht(),10<e)){if(lu(i,0)!==0)break;if(s=i.suspendedLanes,(s&r)!==r){Oi(),i.pingedLanes|=i.suspendedLanes&s;break}i.timeoutHandle=qf(En.bind(null,i,Gi,ys),e);break}En(i,Gi,ys);break;case 4:if(en(i,r),(r&4194240)===r)break;for(e=i.eventTimes,s=-1;0<r;){var a=31-Gr(r);n=1<<a,a=e[a],a>s&&(s=a),r&=~n}if(r=s,r=Ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*yT(r/1960))-r,10<r){i.timeoutHandle=qf(En.bind(null,i,Gi,ys),r);break}En(i,Gi,ys);break;case 5:En(i,Gi,ys);break;default:throw Error(U(329))}}}return Ji(i,Ht()),i.callbackNode===t?LS.bind(null,i):null}function gp(i,e){var t=Ho;return i.current.memoizedState.isDehydrated&&(Hn(i,e).flags|=256),i=Tu(i,e),i!==2&&(e=Gi,Gi=t,e!==null&&mp(e)),i}function mp(i){Gi===null?Gi=i:Gi.push.apply(Gi,i)}function bT(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],n=s.getSnapshot;s=s.value;try{if(!$r(n(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function en(i,e){for(e&=~Og,e&=~cc,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-Gr(e),r=1<<t;i[t]=-1,e&=~r}}function s0(i){if(Ge&6)throw Error(U(327));Ha();var e=lu(i,0);if(!(e&1))return Ji(i,Ht()),null;var t=Tu(i,e);if(i.tag!==0&&t===2){var r=Wf(i);r!==0&&(e=r,t=gp(i,r))}if(t===1)throw t=hl,Hn(i,0),en(i,e),Ji(i,Ht()),t;if(t===6)throw Error(U(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,En(i,Gi,ys),Ji(i,Ht()),null}function Ag(i,e){var t=Ge;Ge|=1;try{return i(e)}finally{Ge=t,Ge===0&&(Qa=Ht()+500,oc&&_n())}}function Qn(i){rn!==null&&rn.tag===0&&!(Ge&6)&&Ha();var e=Ge;Ge|=1;var t=Pr.transition,r=it;try{if(Pr.transition=null,it=1,i)return i()}finally{it=r,Pr.transition=t,Ge=e,!(Ge&6)&&_n()}}function Vg(){rr=Ma.current,yt(Ma)}function Hn(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,j_(t)),Kt!==null)for(t=Kt.return;t!==null;){var r=t;switch(wg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&fu();break;case 3:ja(),yt(Qi),yt(Ci),Ng();break;case 5:Cg(r);break;case 4:ja();break;case 13:yt(Pt);break;case 19:yt(Pt);break;case 10:xg(r.type._context);break;case 22:case 23:Vg()}t=t.return}if(di=i,Kt=i=dn(i.current,null),bi=rr=e,ri=0,hl=null,Og=cc=qn=0,Gi=Ho=null,Fn!==null){for(e=0;e<Fn.length;e++)if(t=Fn[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,n=t.pending;if(n!==null){var a=n.next;n.next=s,r.next=a}t.pending=r}Fn=null}return i}function RS(i,e){do{var t=Kt;try{if(kg(),Uh.current=ku,vu){for(var r=Mt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}vu=!1}if(jn=0,ui=ti=Mt=null,Ao=!1,al=0,Ig.current=null,t===null||t.return===null){ri=1,hl=e,Kt=null;break}e:{var n=i,a=t.return,o=t,l=e;if(e=bi,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var h=l,u=o,c=u.tag;if(!(u.mode&1)&&(c===0||c===11||c===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Yy(a);if(p!==null){p.flags&=-257,$y(p,a,o,n,e),p.mode&1&&Uy(n,h,e),e=p,l=h;var f=e.updateQueue;if(f===null){var m=new Set;m.add(l),e.updateQueue=m}else f.add(l);break e}else{if(!(e&1)){Uy(n,h,e),Hg();break e}l=Error(U(426))}}else if(_t&&o.mode&1){var S=Yy(a);if(S!==null){!(S.flags&65536)&&(S.flags|=256),$y(S,a,o,n,e),Sg(qa(l,o));break e}}n=l=qa(l,o),ri!==4&&(ri=2),Ho===null?Ho=[n]:Ho.push(n),n=a;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e;var y=mS(n,l,e);Dy(n,y);break e;case 1:o=l;var b=n.type,w=n.stateNode;if(!(n.flags&128)&&(typeof b.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(un===null||!un.has(w)))){n.flags|=65536,e&=-e,n.lanes|=e;var x=yS(n,o,e);Dy(n,x);break e}}n=n.return}while(n!==null)}OS(t)}catch(v){e=v,Kt===t&&t!==null&&(Kt=t=t.return);continue}break}while(!0)}function FS(){var i=xu.current;return xu.current=ku,i===null?ku:i}function Hg(){(ri===0||ri===3||ri===2)&&(ri=4),di===null||!(qn&268435455)&&!(cc&268435455)||en(di,bi)}function Tu(i,e){var t=Ge;Ge|=2;var r=FS();(di!==i||bi!==e)&&(ys=null,Hn(i,e));do try{wT();break}catch(s){RS(i,s)}while(!0);if(kg(),Ge=t,xu.current=r,Kt!==null)throw Error(U(261));return di=null,bi=0,ri}function wT(){for(;Kt!==null;)IS(Kt)}function ST(){for(;Kt!==null&&!YB();)IS(Kt)}function IS(i){var e=AS(i.alternate,i,rr);i.memoizedProps=i.pendingProps,e===null?OS(i):Kt=e,Ig.current=null}function OS(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=fT(t,e),t!==null){t.flags&=32767,Kt=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{ri=6,Kt=null;return}}else if(t=dT(t,e,rr),t!==null){Kt=t;return}if(e=e.sibling,e!==null){Kt=e;return}Kt=e=i}while(e!==null);ri===0&&(ri=5)}function En(i,e,t){var r=it,s=Pr.transition;try{Pr.transition=null,it=1,vT(i,e,t,r)}finally{Pr.transition=s,it=r}return null}function vT(i,e,t,r){do Ha();while(rn!==null);if(Ge&6)throw Error(U(327));t=i.finishedWork;var s=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(U(177));i.callbackNode=null,i.callbackPriority=0;var n=t.lanes|t.childLanes;if(t_(i,n),i===di&&(Kt=di=null,bi=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||fh||(fh=!0,VS(ou,function(){return Ha(),null})),n=(t.flags&15990)!==0,t.subtreeFlags&15990||n){n=Pr.transition,Pr.transition=null;var a=it;it=1;var o=Ge;Ge|=4,Ig.current=null,gT(i,t),ES(t,i),W_(Xf),hu=!!$f,Xf=$f=null,i.current=t,mT(t),$B(),Ge=o,it=a,Pr.transition=n}else i.current=t;if(fh&&(fh=!1,rn=i,_u=s),n=i.pendingLanes,n===0&&(un=null),qB(t.stateNode),Ji(i,Ht()),e!==null)for(r=i.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Bu)throw Bu=!1,i=fp,fp=null,i;return _u&1&&i.tag!==0&&Ha(),n=i.pendingLanes,n&1?i===pp?Wo++:(Wo=0,pp=i):Wo=0,_n(),null}function Ha(){if(rn!==null){var i=gw(_u),e=Pr.transition,t=it;try{if(Pr.transition=null,it=16>i?16:i,rn===null)var r=!1;else{if(i=rn,rn=null,_u=0,Ge&6)throw Error(U(331));var s=Ge;for(Ge|=4,ee=i.current;ee!==null;){var n=ee,a=n.child;if(ee.flags&16){var o=n.deletions;if(o!==null){for(var l=0;l<o.length;l++){var h=o[l];for(ee=h;ee!==null;){var u=ee;switch(u.tag){case 0:case 11:case 15:Vo(8,u,n)}var c=u.child;if(c!==null)c.return=u,ee=c;else for(;ee!==null;){u=ee;var d=u.sibling,p=u.return;if(CS(u),u===h){ee=null;break}if(d!==null){d.return=p,ee=d;break}ee=p}}}var f=n.alternate;if(f!==null){var m=f.child;if(m!==null){f.child=null;do{var S=m.sibling;m.sibling=null,m=S}while(m!==null)}}ee=n}}if(n.subtreeFlags&2064&&a!==null)a.return=n,ee=a;else e:for(;ee!==null;){if(n=ee,n.flags&2048)switch(n.tag){case 0:case 11:case 15:Vo(9,n,n.return)}var y=n.sibling;if(y!==null){y.return=n.return,ee=y;break e}ee=n.return}}var b=i.current;for(ee=b;ee!==null;){a=ee;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,ee=w;else e:for(a=b;ee!==null;){if(o=ee,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:uc(9,o)}}catch(v){Ft(o,o.return,v)}if(o===a){ee=null;break e}var x=o.sibling;if(x!==null){x.return=o.return,ee=x;break e}ee=o.return}}if(Ge=s,_n(),ls&&typeof ls.onPostCommitFiberRoot=="function")try{ls.onPostCommitFiberRoot(ic,i)}catch{}r=!0}return r}finally{it=t,Pr.transition=e}}return!1}function n0(i,e,t){e=qa(t,e),e=mS(i,e,1),i=hn(i,e,1),e=Oi(),i!==null&&(Il(i,1,e),Ji(i,e))}function Ft(i,e,t){if(i.tag===3)n0(i,i,t);else for(;e!==null;){if(e.tag===3){n0(e,i,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(un===null||!un.has(r))){i=qa(t,i),i=yS(e,i,1),e=hn(e,i,1),i=Oi(),e!==null&&(Il(e,1,i),Ji(e,i));break}}e=e.return}}function kT(i,e,t){var r=i.pingCache;r!==null&&r.delete(e),e=Oi(),i.pingedLanes|=i.suspendedLanes&t,di===i&&(bi&t)===t&&(ri===4||ri===3&&(bi&130023424)===bi&&500>Ht()-Dg?Hn(i,0):Og|=t),Ji(i,e)}function DS(i,e){e===0&&(i.mode&1?(e=rh,rh<<=1,!(rh&130023424)&&(rh=4194304)):e=1);var t=Oi();i=Fs(i,e),i!==null&&(Il(i,e,t),Ji(i,t))}function xT(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),DS(i,t)}function BT(i,e){var t=0;switch(i.tag){case 13:var r=i.stateNode,s=i.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=i.stateNode;break;default:throw Error(U(314))}r!==null&&r.delete(e),DS(i,t)}var AS;AS=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||Qi.current)ji=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return ji=!1,cT(i,e,t);ji=!!(i.flags&131072)}else ji=!1,_t&&e.flags&1048576&&Ww(e,mu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;$h(i,e),i=e.pendingProps;var s=Ya(e,Ci.current);Va(e,t),s=Eg(null,e,r,i,s,t);var n=Mg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ki(r)?(n=!0,pu(e)):n=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,_g(e),s.updater=lc,e.stateNode=s,s._reactInternals=e,ip(e,r,i,t),e=np(null,e,r,!0,n,t)):(e.tag=0,_t&&n&&bg(e),Li(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch($h(i,e),i=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=TT(r),i=Fr(r,i),s){case 0:e=sp(null,e,r,i,t);break e;case 1:e=qy(null,e,r,i,t);break e;case 11:e=Xy(null,e,r,i,t);break e;case 14:e=jy(null,e,r,Fr(r.type,i),t);break e}throw Error(U(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fr(r,s),sp(i,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fr(r,s),qy(i,e,r,s,t);case 3:e:{if(vS(e),i===null)throw Error(U(387));r=e.pendingProps,n=e.memoizedState,s=n.element,Yw(i,e),wu(e,r,null,t);var a=e.memoizedState;if(r=a.element,n.isDehydrated)if(n={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){s=qa(Error(U(423)),e),e=Qy(i,e,r,t,s);break e}else if(r!==s){s=qa(Error(U(424)),e),e=Qy(i,e,r,t,s);break e}else for(lr=ln(e.stateNode.containerInfo.firstChild),cr=e,_t=!0,Dr=null,t=qw(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if($a(),r===s){e=Is(i,e,t);break e}Li(i,e,r,t)}e=e.child}return e;case 5:return Qw(e),i===null&&Zf(e),r=e.type,s=e.pendingProps,n=i!==null?i.memoizedProps:null,a=s.children,jf(r,s)?a=null:n!==null&&jf(r,n)&&(e.flags|=32),SS(i,e),Li(i,e,a,t),e.child;case 6:return i===null&&Zf(e),null;case 13:return kS(i,e,t);case 4:return Tg(e,e.stateNode.containerInfo),r=e.pendingProps,i===null?e.child=Xa(e,null,r,t):Li(i,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fr(r,s),Xy(i,e,r,s,t);case 7:return Li(i,e,e.pendingProps,t),e.child;case 8:return Li(i,e,e.pendingProps.children,t),e.child;case 12:return Li(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,n=e.memoizedProps,a=s.value,dt(yu,r._currentValue),r._currentValue=a,n!==null)if($r(n.value,a)){if(n.children===s.children&&!Qi.current){e=Is(i,e,t);break e}}else for(n=e.child,n!==null&&(n.return=e);n!==null;){var o=n.dependencies;if(o!==null){a=n.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(n.tag===1){l=Ns(-1,t&-t),l.tag=2;var h=n.updateQueue;if(h!==null){h=h.shared;var u=h.pending;u===null?l.next=l:(l.next=u.next,u.next=l),h.pending=l}}n.lanes|=t,l=n.alternate,l!==null&&(l.lanes|=t),ep(n.return,t,e),o.lanes|=t;break}l=l.next}}else if(n.tag===10)a=n.type===e.type?null:n.child;else if(n.tag===18){if(a=n.return,a===null)throw Error(U(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),ep(a,t,e),a=n.sibling}else a=n.child;if(a!==null)a.return=n;else for(a=n;a!==null;){if(a===e){a=null;break}if(n=a.sibling,n!==null){n.return=a.return,a=n;break}a=a.return}n=a}Li(i,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Va(e,t),s=Er(s),r=r(s),e.flags|=1,Li(i,e,r,t),e.child;case 14:return r=e.type,s=Fr(r,e.pendingProps),s=Fr(r.type,s),jy(i,e,r,s,t);case 15:return bS(i,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Fr(r,s),$h(i,e),e.tag=1,Ki(r)?(i=!0,pu(e)):i=!1,Va(e,t),Xw(e,r,s),ip(e,r,s,t),np(null,e,r,!0,i,t);case 19:return xS(i,e,t);case 22:return wS(i,e,t)}throw Error(U(156,e.tag))};function VS(i,e){return cw(i,e)}function _T(i,e,t,r){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(i,e,t,r){return new _T(i,e,t,r)}function Wg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function TT(i){if(typeof i=="function")return Wg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ag)return 11;if(i===og)return 14}return 2}function dn(i,e){var t=i.alternate;return t===null?(t=Cr(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function qh(i,e,t,r,s,n){var a=2;if(r=i,typeof i=="function")Wg(i)&&(a=1);else if(typeof i=="string")a=5;else e:switch(i){case va:return Wn(t.children,s,n,e);case ng:a=8,s|=8;break;case Tf:return i=Cr(12,t,e,s|2),i.elementType=Tf,i.lanes=n,i;case Cf:return i=Cr(13,t,e,s),i.elementType=Cf,i.lanes=n,i;case Nf:return i=Cr(19,t,e,s),i.elementType=Nf,i.lanes=n,i;case jb:return dc(t,s,n,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case $b:a=10;break e;case Xb:a=9;break e;case ag:a=11;break e;case og:a=14;break e;case Ks:a=16,r=null;break e}throw Error(U(130,i==null?i:typeof i,""))}return e=Cr(a,t,e,s),e.elementType=i,e.type=r,e.lanes=n,e}function Wn(i,e,t,r){return i=Cr(7,i,r,e),i.lanes=t,i}function dc(i,e,t,r){return i=Cr(22,i,r,e),i.elementType=jb,i.lanes=t,i.stateNode={isHidden:!1},i}function Rd(i,e,t){return i=Cr(6,i,null,e),i.lanes=t,i}function Fd(i,e,t){return e=Cr(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function CT(i,e,t,r,s){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pd(0),this.expirationTimes=pd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pd(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function zg(i,e,t,r,s,n,a,o,l){return i=new CT(i,e,t,o,l),e===1?(e=1,n===!0&&(e|=8)):e=0,n=Cr(3,null,null,e),i.current=n,n.stateNode=i,n.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},_g(n),i}function NT(i,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Sa,key:r==null?null:""+r,children:i,containerInfo:e,implementation:t}}function HS(i){if(!i)return yn;i=i._reactInternals;e:{if(aa(i)!==i||i.tag!==1)throw Error(U(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ki(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(U(171))}if(i.tag===1){var t=i.type;if(Ki(t))return Vw(i,t,e)}return e}function WS(i,e,t,r,s,n,a,o,l){return i=zg(t,r,!0,i,s,n,a,o,l),i.context=HS(null),t=i.current,r=Oi(),s=cn(t),n=Ns(r,s),n.callback=e??null,hn(t,n,s),i.current.lanes=s,Il(i,s,r),Ji(i,r),i}function fc(i,e,t,r){var s=e.current,n=Oi(),a=cn(s);return t=HS(t),e.context===null?e.context=t:e.pendingContext=t,e=Ns(n,a),e.payload={element:i},r=r===void 0?null:r,r!==null&&(e.callback=r),i=hn(s,e,a),i!==null&&(Ur(i,s,a,n),Gh(i,s,a)),a}function Cu(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function a0(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function Gg(i,e){a0(i,e),(i=i.alternate)&&a0(i,e)}function PT(){return null}var zS=typeof reportError=="function"?reportError:function(i){console.error(i)};function Ug(i){this._internalRoot=i}pc.prototype.render=Ug.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(U(409));fc(i,e,null,null)};pc.prototype.unmount=Ug.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;Qn(function(){fc(null,i,null,null)}),e[Rs]=null}};function pc(i){this._internalRoot=i}pc.prototype.unstable_scheduleHydration=function(i){if(i){var e=bw();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Zs.length&&e!==0&&e<Zs[t].priority;t++);Zs.splice(t,0,i),t===0&&Sw(i)}};function Yg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function gc(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function o0(){}function ET(i,e,t,r,s){if(s){if(typeof r=="function"){var n=r;r=function(){var h=Cu(a);n.call(h)}}var a=WS(e,r,i,0,null,!1,!1,"",o0);return i._reactRootContainer=a,i[Rs]=a.current,tl(i.nodeType===8?i.parentNode:i),Qn(),a}for(;s=i.lastChild;)i.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var h=Cu(l);o.call(h)}}var l=zg(i,0,!1,null,null,!1,!1,"",o0);return i._reactRootContainer=l,i[Rs]=l.current,tl(i.nodeType===8?i.parentNode:i),Qn(function(){fc(e,l,t,r)}),l}function mc(i,e,t,r,s){var n=t._reactRootContainer;if(n){var a=n;if(typeof s=="function"){var o=s;s=function(){var l=Cu(a);o.call(l)}}fc(e,a,i,s)}else a=ET(t,e,i,s,r);return Cu(a)}mw=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=To(e.pendingLanes);t!==0&&(ug(e,t|1),Ji(e,Ht()),!(Ge&6)&&(Qa=Ht()+500,_n()))}break;case 13:Qn(function(){var r=Fs(i,1);if(r!==null){var s=Oi();Ur(r,i,1,s)}}),Gg(i,1)}};cg=function(i){if(i.tag===13){var e=Fs(i,134217728);if(e!==null){var t=Oi();Ur(e,i,134217728,t)}Gg(i,134217728)}};yw=function(i){if(i.tag===13){var e=cn(i),t=Fs(i,e);if(t!==null){var r=Oi();Ur(t,i,e,r)}Gg(i,e)}};bw=function(){return it};ww=function(i,e){var t=it;try{return it=i,e()}finally{it=t}};Af=function(i,e,t){switch(e){case"input":if(Mf(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==i&&r.form===i.form){var s=ac(r);if(!s)throw Error(U(90));Qb(r),Mf(r,s)}}}break;case"textarea":Jb(i,t);break;case"select":e=t.value,e!=null&&Ia(i,!!t.multiple,e,!1)}};nw=Ag;aw=Qn;var MT={usingClientEntryPoint:!1,Events:[Dl,_a,ac,rw,sw,Ag]},So={findFiberByHostInstance:Rn,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},LT={bundleType:So.bundleType,version:So.version,rendererPackageName:So.rendererPackageName,rendererConfig:So.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ws.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=hw(i),i===null?null:i.stateNode},findFiberByHostInstance:So.findFiberByHostInstance||PT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ph.isDisabled&&ph.supportsFiber)try{ic=ph.inject(LT),ls=ph}catch{}}yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=MT;yr.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yg(e))throw Error(U(200));return NT(i,e,null,t)};yr.createRoot=function(i,e){if(!Yg(i))throw Error(U(299));var t=!1,r="",s=zS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=zg(i,1,!1,null,null,t,!1,r,s),i[Rs]=e.current,tl(i.nodeType===8?i.parentNode:i),new Ug(e)};yr.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(U(188)):(i=Object.keys(i).join(","),Error(U(268,i)));return i=hw(e),i=i===null?null:i.stateNode,i};yr.flushSync=function(i){return Qn(i)};yr.hydrate=function(i,e,t){if(!gc(e))throw Error(U(200));return mc(null,i,e,!0,t)};yr.hydrateRoot=function(i,e,t){if(!Yg(i))throw Error(U(405));var r=t!=null&&t.hydratedSources||null,s=!1,n="",a=zS;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=WS(e,null,i,1,t??null,s,!1,n,a),i[Rs]=e.current,tl(i),r)for(i=0;i<r.length;i++)t=r[i],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new pc(e)};yr.render=function(i,e,t){if(!gc(e))throw Error(U(200));return mc(null,i,e,!1,t)};yr.unmountComponentAtNode=function(i){if(!gc(i))throw Error(U(40));return i._reactRootContainer?(Qn(function(){mc(null,null,i,!1,function(){i._reactRootContainer=null,i[Rs]=null})}),!0):!1};yr.unstable_batchedUpdates=Ag;yr.unstable_renderSubtreeIntoContainer=function(i,e,t,r){if(!gc(t))throw Error(U(200));if(i==null||i._reactInternals===void 0)throw Error(U(38));return mc(i,e,t,!1,r)};yr.version="18.2.0-next-9e3b772b8-20220608";function GS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(GS)}catch(i){console.error(i)}}GS(),Wb.exports=yr;var yc=Wb.exports,US,l0=yc;US=l0.createRoot,l0.hydrateRoot;var YS={exports:{}},$S={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vl=T;function RT(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var FT=typeof Object.is=="function"?Object.is:RT,IT=Vl.useSyncExternalStore,OT=Vl.useRef,DT=Vl.useEffect,AT=Vl.useMemo,VT=Vl.useDebugValue;$S.useSyncExternalStoreWithSelector=function(i,e,t,r,s){var n=OT(null);if(n.current===null){var a={hasValue:!1,value:null};n.current=a}else a=n.current;n=AT(function(){function l(p){if(!h){if(h=!0,u=p,p=r(p),s!==void 0&&a.hasValue){var f=a.value;if(s(f,p))return c=f}return c=p}if(f=c,FT(u,p))return f;var m=r(p);return s!==void 0&&s(f,m)?f:(u=p,c=m)}var h=!1,u,c,d=t===void 0?null:t;return[function(){return l(e())},d===null?void 0:function(){return l(d())}]},[e,t,r,s]);var o=IT(i,n[0],n[1]);return DT(function(){a.hasValue=!0,a.value=o},[o]),VT(o),o};YS.exports=$S;var HT=YS.exports,hr="default"in $o?Cs:$o,h0=Symbol.for("react-redux-context"),u0=typeof globalThis<"u"?globalThis:{};function WT(){if(!hr.createContext)return{};const i=u0[h0]??(u0[h0]=new Map);let e=i.get(hr.createContext);return e||(e=hr.createContext(null),i.set(hr.createContext,e)),e}var bn=WT(),zT=()=>{throw new Error("uSES not initialized!")};function $g(i=bn){return function(){return hr.useContext(i)}}var XS=$g(),jS=zT,GT=i=>{jS=i},UT=(i,e)=>i===e;function YT(i=bn){const e=i===bn?XS:$g(i),t=(r,s={})=>{const{equalityFn:n=UT,devModeChecks:a={}}=typeof s=="function"?{equalityFn:s}:s,{store:o,subscription:l,getServerState:h,stabilityCheck:u,identityFunctionCheck:c}=e();hr.useRef(!0);const d=hr.useCallback({[r.name](f){return r(f)}}[r.name],[r,u,a.stabilityCheck]),p=jS(l.addNestedSub,o.getState,h||o.getState,d,n);return hr.useDebugValue(p),p};return Object.assign(t,{withTypes:()=>t}),t}var Zt=YT();function $T(i){i()}function XT(){let i=null,e=null;return{clear(){i=null,e=null},notify(){$T(()=>{let t=i;for(;t;)t.callback(),t=t.next})},get(){const t=[];let r=i;for(;r;)t.push(r),r=r.next;return t},subscribe(t){let r=!0;const s=e={callback:t,next:null,prev:e};return s.prev?s.prev.next=s:i=s,function(){!r||i===null||(r=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:i=s.next)}}}}var c0={notify(){},get:()=>[]};function jT(i,e){let t,r=c0,s=0,n=!1;function a(m){u();const S=r.subscribe(m);let y=!1;return()=>{y||(y=!0,S(),c())}}function o(){r.notify()}function l(){f.onStateChange&&f.onStateChange()}function h(){return n}function u(){s++,t||(t=i.subscribe(l),r=XT())}function c(){s--,t&&s===0&&(t(),t=void 0,r.clear(),r=c0)}function d(){n||(n=!0,u())}function p(){n&&(n=!1,c())}const f={addNestedSub:a,notifyNestedSubs:o,handleChangeWrapper:l,isSubscribed:h,trySubscribe:d,tryUnsubscribe:p,getListeners:()=>r};return f}var qT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",QT=typeof navigator<"u"&&navigator.product==="ReactNative",KT=qT||QT?hr.useLayoutEffect:hr.useEffect;function JT({store:i,context:e,children:t,serverState:r,stabilityCheck:s="once",identityFunctionCheck:n="once"}){const a=hr.useMemo(()=>{const h=jT(i);return{store:i,subscription:h,getServerState:r?()=>r:void 0,stabilityCheck:s,identityFunctionCheck:n}},[i,r,s,n]),o=hr.useMemo(()=>i.getState(),[i]);KT(()=>{const{subscription:h}=a;return h.onStateChange=h.notifyNestedSubs,h.trySubscribe(),o!==i.getState()&&h.notifyNestedSubs(),()=>{h.tryUnsubscribe(),h.onStateChange=void 0}},[a,o]);const l=e||bn;return hr.createElement(l.Provider,{value:a},t)}var ZT=JT;function qS(i=bn){const e=i===bn?XS:$g(i),t=()=>{const{store:r}=e();return r};return Object.assign(t,{withTypes:()=>t}),t}var eC=qS();function tC(i=bn){const e=i===bn?eC:qS(i),t=()=>e().dispatch;return Object.assign(t,{withTypes:()=>t}),t}var wr=tC();GT(HT.useSyncExternalStoreWithSelector);function pi(i){return`Minified Redux error #${i}; visit https://redux.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}var iC=typeof Symbol=="function"&&Symbol.observable||"@@observable",d0=iC,Id=()=>Math.random().toString(36).substring(7).split("").join("."),rC={INIT:`@@redux/INIT${Id()}`,REPLACE:`@@redux/REPLACE${Id()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Id()}`},Nu=rC;function Xg(i){if(typeof i!="object"||i===null)return!1;let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e||Object.getPrototypeOf(i)===null}function QS(i,e,t){if(typeof i!="function")throw new Error(pi(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(pi(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(pi(1));return t(QS)(i,e)}let r=i,s=e,n=new Map,a=n,o=0,l=!1;function h(){a===n&&(a=new Map,n.forEach((S,y)=>{a.set(y,S)}))}function u(){if(l)throw new Error(pi(3));return s}function c(S){if(typeof S!="function")throw new Error(pi(4));if(l)throw new Error(pi(5));let y=!0;h();const b=o++;return a.set(b,S),function(){if(y){if(l)throw new Error(pi(6));y=!1,h(),a.delete(b),n=null}}}function d(S){if(!Xg(S))throw new Error(pi(7));if(typeof S.type>"u")throw new Error(pi(8));if(typeof S.type!="string")throw new Error(pi(17));if(l)throw new Error(pi(9));try{l=!0,s=r(s,S)}finally{l=!1}return(n=a).forEach(b=>{b()}),S}function p(S){if(typeof S!="function")throw new Error(pi(10));r=S,d({type:Nu.REPLACE})}function f(){const S=c;return{subscribe(y){if(typeof y!="object"||y===null)throw new Error(pi(11));function b(){const x=y;x.next&&x.next(u())}return b(),{unsubscribe:S(b)}},[d0](){return this}}}return d({type:Nu.INIT}),{dispatch:d,subscribe:c,getState:u,replaceReducer:p,[d0]:f}}function sC(i){Object.keys(i).forEach(e=>{const t=i[e];if(typeof t(void 0,{type:Nu.INIT})>"u")throw new Error(pi(12));if(typeof t(void 0,{type:Nu.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(pi(13))})}function KS(i){const e=Object.keys(i),t={};for(let n=0;n<e.length;n++){const a=e[n];typeof i[a]=="function"&&(t[a]=i[a])}const r=Object.keys(t);let s;try{sC(t)}catch(n){s=n}return function(a={},o){if(s)throw s;let l=!1;const h={};for(let u=0;u<r.length;u++){const c=r[u],d=t[c],p=a[c],f=d(p,o);if(typeof f>"u")throw o&&o.type,new Error(pi(14));h[c]=f,l=l||f!==p}return l=l||r.length!==Object.keys(a).length,l?h:a}}function Pu(...i){return i.length===0?e=>e:i.length===1?i[0]:i.reduce((e,t)=>(...r)=>e(t(...r)))}function nC(...i){return e=>(t,r)=>{const s=e(t,r);let n=()=>{throw new Error(pi(15))};const a={getState:s.getState,dispatch:(l,...h)=>n(l,...h)},o=i.map(l=>l(a));return n=Pu(...o)(s.dispatch),{...s,dispatch:n}}}function aC(i){return Xg(i)&&"type"in i&&typeof i.type=="string"}var JS=Symbol.for("immer-nothing"),f0=Symbol.for("immer-draftable"),gr=Symbol.for("immer-state");function Vr(i,...e){throw new Error(`[Immer] minified error nr: ${i}. Full error at: https://bit.ly/3cXEKWf`)}var Ka=Object.getPrototypeOf;function wn(i){return!!i&&!!i[gr]}function Os(i){var e;return i?ZS(i)||Array.isArray(i)||!!i[f0]||!!((e=i.constructor)!=null&&e[f0])||wc(i)||Sc(i):!1}var oC=Object.prototype.constructor.toString();function ZS(i){if(!i||typeof i!="object")return!1;const e=Ka(i);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===oC}function Eu(i,e){bc(i)===0?Reflect.ownKeys(i).forEach(t=>{e(t,i[t],i)}):i.forEach((t,r)=>e(r,t,i))}function bc(i){const e=i[gr];return e?e.type_:Array.isArray(i)?1:wc(i)?2:Sc(i)?3:0}function yp(i,e){return bc(i)===2?i.has(e):Object.prototype.hasOwnProperty.call(i,e)}function ev(i,e,t){const r=bc(i);r===2?i.set(e,t):r===3?i.add(t):i[e]=t}function lC(i,e){return i===e?i!==0||1/i===1/e:i!==i&&e!==e}function wc(i){return i instanceof Map}function Sc(i){return i instanceof Set}function Mn(i){return i.copy_||i.base_}function bp(i,e){if(wc(i))return new Map(i);if(Sc(i))return new Set(i);if(Array.isArray(i))return Array.prototype.slice.call(i);const t=ZS(i);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(i);delete r[gr];let s=Reflect.ownKeys(r);for(let n=0;n<s.length;n++){const a=s[n],o=r[a];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[a]={configurable:!0,writable:!0,enumerable:o.enumerable,value:i[a]})}return Object.create(Ka(i),r)}else{const r=Ka(i);if(r!==null&&t)return{...i};const s=Object.create(r);return Object.assign(s,i)}}function jg(i,e=!1){return vc(i)||wn(i)||!Os(i)||(bc(i)>1&&(i.set=i.add=i.clear=i.delete=hC),Object.freeze(i),e&&Object.entries(i).forEach(([t,r])=>jg(r,!0))),i}function hC(){Vr(2)}function vc(i){return Object.isFrozen(i)}var uC={};function Kn(i){const e=uC[i];return e||Vr(0,i),e}var ul;function tv(){return ul}function cC(i,e){return{drafts_:[],parent_:i,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function p0(i,e){e&&(Kn("Patches"),i.patches_=[],i.inversePatches_=[],i.patchListener_=e)}function wp(i){Sp(i),i.drafts_.forEach(dC),i.drafts_=null}function Sp(i){i===ul&&(ul=i.parent_)}function g0(i){return ul=cC(ul,i)}function dC(i){const e=i[gr];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function m0(i,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return i!==void 0&&i!==t?(t[gr].modified_&&(wp(e),Vr(4)),Os(i)&&(i=Mu(e,i),e.parent_||Lu(e,i)),e.patches_&&Kn("Patches").generateReplacementPatches_(t[gr].base_,i,e.patches_,e.inversePatches_)):i=Mu(e,t,[]),wp(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),i!==JS?i:void 0}function Mu(i,e,t){if(vc(e))return e;const r=e[gr];if(!r)return Eu(e,(s,n)=>y0(i,r,e,s,n,t)),e;if(r.scope_!==i)return e;if(!r.modified_)return Lu(i,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let n=s,a=!1;r.type_===3&&(n=new Set(s),s.clear(),a=!0),Eu(n,(o,l)=>y0(i,r,s,o,l,t,a)),Lu(i,s,!1),t&&i.patches_&&Kn("Patches").generatePatches_(r,t,i.patches_,i.inversePatches_)}return r.copy_}function y0(i,e,t,r,s,n,a){if(wn(s)){const o=n&&e&&e.type_!==3&&!yp(e.assigned_,r)?n.concat(r):void 0,l=Mu(i,s,o);if(ev(t,r,l),wn(l))i.canAutoFreeze_=!1;else return}else a&&t.add(s);if(Os(s)&&!vc(s)){if(!i.immer_.autoFreeze_&&i.unfinalizedDrafts_<1)return;Mu(i,s),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,r)&&Lu(i,s)}}function Lu(i,e,t=!1){!i.parent_&&i.immer_.autoFreeze_&&i.canAutoFreeze_&&jg(e,t)}function fC(i,e){const t=Array.isArray(i),r={type_:t?1:0,scope_:e?e.scope_:tv(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:i,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,n=qg;t&&(s=[r],n=cl);const{revoke:a,proxy:o}=Proxy.revocable(s,n);return r.draft_=o,r.revoke_=a,o}var qg={get(i,e){if(e===gr)return i;const t=Mn(i);if(!yp(t,e))return pC(i,t,e);const r=t[e];return i.finalized_||!Os(r)?r:r===Od(i.base_,e)?(Dd(i),i.copy_[e]=kp(r,i)):r},has(i,e){return e in Mn(i)},ownKeys(i){return Reflect.ownKeys(Mn(i))},set(i,e,t){const r=iv(Mn(i),e);if(r!=null&&r.set)return r.set.call(i.draft_,t),!0;if(!i.modified_){const s=Od(Mn(i),e),n=s==null?void 0:s[gr];if(n&&n.base_===t)return i.copy_[e]=t,i.assigned_[e]=!1,!0;if(lC(t,s)&&(t!==void 0||yp(i.base_,e)))return!0;Dd(i),vp(i)}return i.copy_[e]===t&&(t!==void 0||e in i.copy_)||Number.isNaN(t)&&Number.isNaN(i.copy_[e])||(i.copy_[e]=t,i.assigned_[e]=!0),!0},deleteProperty(i,e){return Od(i.base_,e)!==void 0||e in i.base_?(i.assigned_[e]=!1,Dd(i),vp(i)):delete i.assigned_[e],i.copy_&&delete i.copy_[e],!0},getOwnPropertyDescriptor(i,e){const t=Mn(i),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:i.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){Vr(11)},getPrototypeOf(i){return Ka(i.base_)},setPrototypeOf(){Vr(12)}},cl={};Eu(qg,(i,e)=>{cl[i]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});cl.deleteProperty=function(i,e){return cl.set.call(this,i,e,void 0)};cl.set=function(i,e,t){return qg.set.call(this,i[0],e,t,i[0])};function Od(i,e){const t=i[gr];return(t?Mn(t):i)[e]}function pC(i,e,t){var s;const r=iv(e,t);return r?"value"in r?r.value:(s=r.get)==null?void 0:s.call(i.draft_):void 0}function iv(i,e){if(!(e in i))return;let t=Ka(i);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=Ka(t)}}function vp(i){i.modified_||(i.modified_=!0,i.parent_&&vp(i.parent_))}function Dd(i){i.copy_||(i.copy_=bp(i.base_,i.scope_.immer_.useStrictShallowCopy_))}var gC=class{constructor(i){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const n=t;t=e;const a=this;return function(l=n,...h){return a.produce(l,u=>t.call(this,u,...h))}}typeof t!="function"&&Vr(6),r!==void 0&&typeof r!="function"&&Vr(7);let s;if(Os(e)){const n=g0(this),a=kp(e,void 0);let o=!0;try{s=t(a),o=!1}finally{o?wp(n):Sp(n)}return p0(n,r),m0(s,n)}else if(!e||typeof e!="object"){if(s=t(e),s===void 0&&(s=e),s===JS&&(s=void 0),this.autoFreeze_&&jg(s,!0),r){const n=[],a=[];Kn("Patches").generateReplacementPatches_(e,s,n,a),r(n,a)}return s}else Vr(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(a,...o)=>this.produceWithPatches(a,l=>e(l,...o));let r,s;return[this.produce(e,t,(a,o)=>{r=a,s=o}),r,s]},typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze),typeof(i==null?void 0:i.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(i.useStrictShallowCopy)}createDraft(i){Os(i)||Vr(8),wn(i)&&(i=rv(i));const e=g0(this),t=kp(i,void 0);return t[gr].isManual_=!0,Sp(e),t}finishDraft(i,e){const t=i&&i[gr];(!t||!t.isManual_)&&Vr(9);const{scope_:r}=t;return p0(r,e),m0(void 0,r)}setAutoFreeze(i){this.autoFreeze_=i}setUseStrictShallowCopy(i){this.useStrictShallowCopy_=i}applyPatches(i,e){let t;for(t=e.length-1;t>=0;t--){const s=e[t];if(s.path.length===0&&s.op==="replace"){i=s.value;break}}t>-1&&(e=e.slice(t+1));const r=Kn("Patches").applyPatches_;return wn(i)?r(i,e):this.produce(i,s=>r(s,e))}};function kp(i,e){const t=wc(i)?Kn("MapSet").proxyMap_(i,e):Sc(i)?Kn("MapSet").proxySet_(i,e):fC(i,e);return(e?e.scope_:tv()).drafts_.push(t),t}function rv(i){return wn(i)||Vr(10,i),sv(i)}function sv(i){if(!Os(i)||vc(i))return i;const e=i[gr];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=bp(i,e.scope_.immer_.useStrictShallowCopy_)}else t=bp(i,!0);return Eu(t,(r,s)=>{ev(t,r,sv(s))}),e&&(e.finalized_=!1),t}var mr=new gC,nv=mr.produce;mr.produceWithPatches.bind(mr);mr.setAutoFreeze.bind(mr);mr.setUseStrictShallowCopy.bind(mr);mr.applyPatches.bind(mr);mr.createDraft.bind(mr);mr.finishDraft.bind(mr);function mC(i,e=`expected a function, instead received ${typeof i}`){if(typeof i!="function")throw new TypeError(e)}function yC(i,e=`expected an object, instead received ${typeof i}`){if(typeof i!="object")throw new TypeError(e)}function bC(i,e="expected all items to be functions, instead received the following types: "){if(!i.every(t=>typeof t=="function")){const t=i.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${t}]`)}}var b0=i=>Array.isArray(i)?i:[i];function wC(i){const e=Array.isArray(i[0])?i[0]:i;return bC(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function SC(i,e){const t=[],{length:r}=i;for(let s=0;s<r;s++)t.push(i[s].apply(null,e));return t}var vC=class{constructor(i){this.value=i}deref(){return this.value}},kC=typeof WeakRef<"u"?WeakRef:vC,xC=0,w0=1;function gh(){return{s:xC,v:void 0,o:null,p:null}}function Qg(i,e={}){let t=gh();const{resultEqualityCheck:r}=e;let s,n=0;function a(){var c;let o=t;const{length:l}=arguments;for(let d=0,p=l;d<p;d++){const f=arguments[d];if(typeof f=="function"||typeof f=="object"&&f!==null){let m=o.o;m===null&&(o.o=m=new WeakMap);const S=m.get(f);S===void 0?(o=gh(),m.set(f,o)):o=S}else{let m=o.p;m===null&&(o.p=m=new Map);const S=m.get(f);S===void 0?(o=gh(),m.set(f,o)):o=S}}const h=o;let u;if(o.s===w0)u=o.v;else if(u=i.apply(null,arguments),n++,r){const d=((c=s==null?void 0:s.deref)==null?void 0:c.call(s))??s;d!=null&&r(d,u)&&(u=d,n!==0&&n--),s=typeof u=="object"&&u!==null||typeof u=="function"?new kC(u):u}return h.s=w0,h.v=u,u}return a.clearCache=()=>{t=gh(),a.resetResultsCount()},a.resultsCount=()=>n,a.resetResultsCount=()=>{n=0},a}function av(i,...e){const t=typeof i=="function"?{memoize:i,memoizeOptions:e}:i,r=(...s)=>{let n=0,a=0,o,l={},h=s.pop();typeof h=="object"&&(l=h,h=s.pop()),mC(h,`createSelector expects an output function after the inputs, but received: [${typeof h}]`);const u={...t,...l},{memoize:c,memoizeOptions:d=[],argsMemoize:p=Qg,argsMemoizeOptions:f=[],devModeChecks:m={}}=u,S=b0(d),y=b0(f),b=wC(s),w=c(function(){return n++,h.apply(null,arguments)},...S),x=p(function(){a++;const C=SC(b,arguments);return o=w.apply(null,C),o},...y);return Object.assign(x,{resultFunc:h,memoizedResultFunc:w,dependencies:b,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>o,recomputations:()=>n,resetRecomputations:()=>{n=0},memoize:c,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var BC=av(Qg),_C=Object.assign((i,e=BC)=>{yC(i,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof i}`);const t=Object.keys(i),r=t.map(n=>i[n]);return e(r,(...n)=>n.reduce((a,o,l)=>(a[t[l]]=o,a),{}))},{withTypes:()=>_C});function ov(i){return({dispatch:t,getState:r})=>s=>n=>typeof n=="function"?n(t,r,i):s(n)}var TC=ov(),CC=ov,NC=(...i)=>{const e=av(...i),t=Object.assign((...r)=>{const s=e(...r),n=(a,...o)=>s(wn(a)?rv(a):a,...o);return Object.assign(n,s),n},{withTypes:()=>t});return t};NC(Qg);var PC=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Pu:Pu.apply(null,arguments)};function Ja(i,e){function t(...r){if(e){let s=e(...r);if(!s)throw new Error(Zi(0));return{type:i,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:i,payload:r[0]}}return t.toString=()=>`${i}`,t.type=i,t.match=r=>aC(r)&&r.type===i,t}var lv=class No extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,No.prototype)}static get[Symbol.species](){return No}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new No(...e[0].concat(this)):new No(...e.concat(this))}};function S0(i){return Os(i)?nv(i,()=>{}):i}function v0(i,e,t){if(i.has(e)){let s=i.get(e);return t.update&&(s=t.update(s,e,i),i.set(e,s)),s}if(!t.insert)throw new Error(Zi(10));const r=t.insert(e,i);return i.set(e,r),r}function EC(i){return typeof i=="boolean"}var MC=()=>function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:s=!0,actionCreatorCheck:n=!0}=e??{};let a=new lv;return t&&(EC(t)?a.push(TC):a.push(CC(t.extraArgument))),a},LC="RTK_autoBatch",hv=i=>e=>{setTimeout(e,i)},RC=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:hv(10),FC=(i={type:"raf"})=>e=>(...t)=>{const r=e(...t);let s=!0,n=!1,a=!1;const o=new Set,l=i.type==="tick"?queueMicrotask:i.type==="raf"?RC:i.type==="callback"?i.queueNotification:hv(i.timeout),h=()=>{a=!1,n&&(n=!1,o.forEach(u=>u()))};return Object.assign({},r,{subscribe(u){const c=()=>s&&u(),d=r.subscribe(c);return o.add(u),()=>{d(),o.delete(u)}},dispatch(u){var c;try{return s=!((c=u==null?void 0:u.meta)!=null&&c[LC]),n=!s,n&&(a||(a=!0,l(h))),r.dispatch(u)}finally{s=!0}}})},IC=i=>function(t){const{autoBatch:r=!0}=t??{};let s=new lv(i);return r&&s.push(FC(typeof r=="object"?r:void 0)),s},OC=!0;function DC(i){const e=MC(),{reducer:t=void 0,middleware:r,devTools:s=!0,preloadedState:n=void 0,enhancers:a=void 0}=i||{};let o;if(typeof t=="function")o=t;else if(Xg(t))o=KS(t);else throw new Error(Zi(1));let l;typeof r=="function"?l=r(e):l=e();let h=Pu;s&&(h=PC({trace:!OC,...typeof s=="object"&&s}));const u=nC(...l),c=IC(u);let d=typeof a=="function"?a(c):c();const p=h(...d);return QS(o,n,p)}function uv(i){const e={},t=[];let r;const s={addCase(n,a){const o=typeof n=="string"?n:n.type;if(!o)throw new Error(Zi(28));if(o in e)throw new Error(Zi(29));return e[o]=a,s},addMatcher(n,a){return t.push({matcher:n,reducer:a}),s},addDefaultCase(n){return r=n,s}};return i(s),[e,t,r]}function AC(i){return typeof i=="function"}function VC(i,e){let[t,r,s]=uv(e),n;if(AC(i))n=()=>S0(i());else{const o=S0(i);n=()=>o}function a(o=n(),l){let h=[t[l.type],...r.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return h.filter(u=>!!u).length===0&&(h=[s]),h.reduce((u,c)=>{if(c)if(wn(u)){const p=c(u,l);return p===void 0?u:p}else{if(Os(u))return nv(u,d=>c(d,l));{const d=c(u,l);if(d===void 0){if(u===null)return u;throw new Error(Zi(9))}return d}}return u},o)}return a.getInitialState=n,a}var HC="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",WC=(i=21)=>{let e="",t=i;for(;t--;)e+=HC[Math.random()*64|0];return e},zC=Symbol.for("rtk-slice-createasyncthunk");function GC(i,e){return`${i}/${e}`}function UC({creators:i}={}){var t;const e=(t=i==null?void 0:i.asyncThunk)==null?void 0:t[zC];return function(s){const{name:n,reducerPath:a=n}=s;if(!n)throw new Error(Zi(11));typeof process<"u";const o=(typeof s.reducers=="function"?s.reducers($C()):s.reducers)||{},l=Object.keys(o),h={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},u={addCase(w,x){const v=typeof w=="string"?w:w.type;if(!v)throw new Error(Zi(12));if(v in h.sliceCaseReducersByType)throw new Error(Zi(13));return h.sliceCaseReducersByType[v]=x,u},addMatcher(w,x){return h.sliceMatchers.push({matcher:w,reducer:x}),u},exposeAction(w,x){return h.actionCreators[w]=x,u},exposeCaseReducer(w,x){return h.sliceCaseReducersByName[w]=x,u}};l.forEach(w=>{const x=o[w],v={reducerName:w,type:GC(n,w),createNotation:typeof s.reducers=="function"};jC(x)?QC(v,x,u,e):XC(v,x,u)});function c(){const[w={},x=[],v=void 0]=typeof s.extraReducers=="function"?uv(s.extraReducers):[s.extraReducers],C={...w,...h.sliceCaseReducersByType};return VC(s.initialState,P=>{for(let N in C)P.addCase(N,C[N]);for(let N of h.sliceMatchers)P.addMatcher(N.matcher,N.reducer);for(let N of x)P.addMatcher(N.matcher,N.reducer);v&&P.addDefaultCase(v)})}const d=w=>w,p=new Map;let f;function m(w,x){return f||(f=c()),f(w,x)}function S(){return f||(f=c()),f.getInitialState()}function y(w,x=!1){function v(P){let N=P[w];return typeof N>"u"&&x&&(N=S()),N}function C(P=d){const N=v0(p,x,{insert:()=>new WeakMap});return v0(N,P,{insert:()=>{const W={};for(const[Y,me]of Object.entries(s.selectors??{}))W[Y]=YC(me,P,S,x);return W}})}return{reducerPath:w,getSelectors:C,get selectors(){return C(v)},selectSlice:v}}const b={name:n,reducer:m,actions:h.actionCreators,caseReducers:h.sliceCaseReducersByName,getInitialState:S,...y(a),injectInto(w,{reducerPath:x,...v}={}){const C=x??a;return w.inject({reducerPath:C,reducer:m},v),{...b,...y(C,!0)}}};return b}}function YC(i,e,t,r){function s(n,...a){let o=e(n);return typeof o>"u"&&r&&(o=t()),i(o,...a)}return s.unwrapped=i,s}var kc=UC();function $C(){function i(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return i.withTypes=()=>i,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:i}}function XC({type:i,reducerName:e,createNotation:t},r,s){let n,a;if("reducer"in r){if(t&&!qC(r))throw new Error(Zi(17));n=r.reducer,a=r.prepare}else n=r;s.addCase(i,n).exposeCaseReducer(e,n).exposeAction(e,a?Ja(i,a):Ja(i))}function jC(i){return i._reducerDefinitionType==="asyncThunk"}function qC(i){return i._reducerDefinitionType==="reducerWithPrepare"}function QC({type:i,reducerName:e},t,r,s){if(!s)throw new Error(Zi(18));const{payloadCreator:n,fulfilled:a,pending:o,rejected:l,settled:h,options:u}=t,c=s(i,n,u);r.exposeAction(e,c),a&&r.addCase(c.fulfilled,a),o&&r.addCase(c.pending,o),l&&r.addCase(c.rejected,l),h&&r.addMatcher(c.settled,h),r.exposeCaseReducer(e,{fulfilled:a||mh,pending:o||mh,rejected:l||mh,settled:h||mh})}function mh(){}var KC=(i,e)=>{if(typeof i!="function")throw new Error(Zi(32))},Kg="listenerMiddleware",JC=i=>{let{type:e,actionCreator:t,matcher:r,predicate:s,effect:n}=i;if(e)s=Ja(e).match;else if(t)e=t.type,s=t.match;else if(r)s=r;else if(!s)throw new Error(Zi(21));return KC(n),{predicate:s,type:e,effect:n}},ZC=Object.assign(i=>{const{type:e,predicate:t,effect:r}=JC(i);return{id:WC(),effect:r,type:e,predicate:t,pending:new Set,unsubscribe:()=>{throw new Error(Zi(22))}}},{withTypes:()=>ZC}),eN=Object.assign(Ja(`${Kg}/add`),{withTypes:()=>eN});Ja(`${Kg}/removeAll`);var tN=Object.assign(Ja(`${Kg}/remove`),{withTypes:()=>tN});function Zi(i){return`Minified Redux Toolkit error #${i}; visit https://redux-toolkit.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}function cv(i){return i!==null&&typeof i=="object"&&"name"in i&&typeof i.name=="string"}function dv(i){return i!==null&&typeof i=="object"&&"step"in i&&typeof i.step=="number"&&"alt"in i&&typeof i.alt=="number"&&!isNaN(i.step)&&!isNaN(i.alt)}var fv=[0,2,4,-1,1,3,5],pv=fv.map(i=>Math.floor(i*7/12));function gv(i){const{step:e,alt:t,oct:r,dir:s=1}=i,n=fv[e]+7*t;if(r===void 0)return[s*n];const a=r-pv[e]-4*t;return[s*n,s*a]}var iN=[3,0,4,1,5,2,6];function mv(i){const[e,t,r]=i,s=iN[rN(e)],n=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:n,dir:r};const a=t+4*n+pv[s];return{step:s,alt:n,oct:a,dir:r}}function rN(i){const e=(i+1)%7;return e<0?7+e:e}var k0=(i,e)=>Array(Math.abs(e)+1).join(i),xp=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),sN="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",nN="(AA|A|P|M|m|d|dd)([-+]?\\d+)",aN=new RegExp("^"+sN+"|"+nN+"$");function oN(i){const e=aN.exec(`${i}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var x0={};function Di(i){return typeof i=="string"?x0[i]||(x0[i]=lN(i)):dv(i)?Di(uN(i)):cv(i)?Di(i.name):xp}var B0=[0,2,4,5,7,9,11],yv="PMMPPMM";function lN(i){const e=oN(i);if(e[0]==="")return xp;const t=+e[0],r=e[1],s=(Math.abs(t)-1)%7,n=yv[s];if(n==="M"&&r==="P")return xp;const a=n==="M"?"majorable":"perfectable",o=""+t+r,l=t<0?-1:1,h=t===8||t===-8?t:l*(s+1),u=hN(a,r),c=Math.floor((Math.abs(t)-1)/7),d=l*(B0[s]+u+12*c),p=(l*(B0[s]+u)%12+12)%12,f=gv({step:s,alt:u,oct:c,dir:l});return{empty:!1,name:o,num:t,q:r,step:s,alt:u,dir:l,type:a,simple:h,semitones:d,chroma:p,coord:f,oct:c}}function Jg(i,e){const[t,r=0]=i,s=t*7+r*12<0,n=e||s?[-t,-r,-1]:[t,r,1];return Di(mv(n))}function hN(i,e){return e==="M"&&i==="majorable"||e==="P"&&i==="perfectable"?0:e==="m"&&i==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(i==="perfectable"?e.length:e.length+1):0}function uN(i){const{step:e,alt:t,oct:r=0,dir:s}=i;if(!s)return"";const n=e+1+7*r,a=n===0?e+1:n,o=s<0?"-":"",l=yv[e]==="M"?"majorable":"perfectable";return o+a+cN(l,t)}function cN(i,e){return e===0?i==="majorable"?"M":"P":e===-1&&i==="majorable"?"m":e>0?k0("A",e):k0("d",i==="perfectable"?e:e+1)}var _0=(i,e)=>Array(Math.abs(e)+1).join(i),bv=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),T0=new Map,dN=i=>"CDEFGAB".charAt(i),fN=i=>i<0?_0("b",-i):_0("#",i),pN=i=>i[0]==="b"?-i.length:i.length;function wi(i){const e=JSON.stringify(i),t=T0.get(e);if(t)return t;const r=typeof i=="string"?bN(i):dv(i)?wi(wN(i)):cv(i)?wi(i.name):bv;return T0.set(e,r),r}var gN=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Zg(i){const e=gN.exec(i);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function mN(i){return wi(mv(i))}var yN=(i,e)=>(i%e+e)%e,Ad=[0,2,4,5,7,9,11];function bN(i){const e=Zg(i);if(e[0]===""||e[3]!=="")return bv;const t=e[0],r=e[1],s=e[2],n=(t.charCodeAt(0)+3)%7,a=pN(r),o=s.length?+s:void 0,l=gv({step:n,alt:a,oct:o}),h=t+r+s,u=t+r,c=(Ad[n]+a+120)%12,d=o===void 0?yN(Ad[n]+a,12)-12*99:Ad[n]+a+12*(o+1),p=d>=0&&d<=127?d:null,f=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:r,alt:a,chroma:c,coord:l,freq:f,height:d,letter:t,midi:p,name:h,oct:o,pc:u,step:n}}function wN(i){const{step:e,alt:t,oct:r}=i,s=dN(e);if(!s)return"";const n=s+fN(t);return r||r===0?n+r:n}function er(i,e){const t=wi(i),r=Array.isArray(e)?e:Di(e).coord;if(t.empty||!r||r.length<2)return"";const s=t.coord,n=s.length===1?[s[0]+r[0]]:[s[0]+r[0],s[1]+r[1]];return mN(n).name}function wv(i,e){const t=i.length;return r=>{if(!e)return"";const s=r<0?(t- -r%t)%t:r%t,n=Math.floor(r/t),a=er(e,[0,n]);return er(a,i[s])}}function dl(i,e){const t=wi(i),r=wi(e);if(t.empty||r.empty)return"";const s=t.coord,n=r.coord,a=n[0]-s[0],o=s.length===2&&n.length===2?n[1]-s[1]:-Math.floor(a*7/12),l=r.height===t.height&&r.midi!==null&&t.midi!==null&&t.step>r.step;return Jg([a,o],l).name}function em(i,e){const t=e.length,r=(i%t+t)%t;return e.slice(r,t).concat(e.slice(0,r))}function SN(i){return i.filter(e=>e===0||e)}var Jn={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Sv=i=>Number(i).toString(2).padStart(12,"0"),C0=i=>parseInt(i,2),vN=/^[01]{12}$/;function vv(i){return vN.test(i)}var kN=i=>typeof i=="number"&&i>=0&&i<=4095,xN=i=>i&&vv(i.chroma),N0={[Jn.chroma]:Jn};function Zn(i){const e=vv(i)?i:kN(i)?Sv(i):Array.isArray(i)?EN(i):xN(i)?i.chroma:Jn.chroma;return N0[e]=N0[e]||PN(e)}var BN=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function _N(i){const e=[];for(let t=0;t<12;t++)i.charAt(t)==="1"&&e.push(BN[t]);return e}function TN(i,e=!0){const r=Zn(i).chroma.split("");return SN(r.map((s,n)=>{const a=em(n,r);return e&&a[0]==="0"?null:a.join("")}))}function CN(i){const e=Zn(i).setNum;return t=>{const r=Zn(t).setNum;return e&&e!==r&&(r&e)===r}}function kv(i){const e=Zn(i).setNum;return t=>{const r=Zn(t).setNum;return e&&e!==r&&(r|e)===r}}function NN(i){const e=i.split("");return e.map((t,r)=>em(r,e).join(""))}function PN(i){const e=C0(i),t=NN(i).map(C0).filter(n=>n>=2048).sort()[0],r=Sv(t),s=_N(i);return{empty:!1,name:"",setNum:e,chroma:i,normalized:r,intervals:s}}function EN(i){if(i.length===0)return Jn.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<i.length;r++)e=wi(i[r]),e.empty&&(e=Di(i[r])),e.empty||(t[e.chroma]=1);return t.join("")}var MN=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],LN=MN,RN={...Jn,name:"",quality:"Unknown",intervals:[],aliases:[]},tm=[],zo={};function FN(i){return zo[i]||RN}function im(){return tm.slice()}function IN(i,e,t){const r=DN(i),s={...Zn(i),name:t||"",quality:r,intervals:i,aliases:e};tm.push(s),s.name&&(zo[s.name]=s),zo[s.setNum]=s,zo[s.chroma]=s,s.aliases.forEach(n=>ON(s,n))}function ON(i,e){zo[e]=i}function DN(i){const e=t=>i.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}LN.forEach(([i,e,t])=>IN(i.split(" "),t.split(" "),e));tm.sort((i,e)=>i.setNum-e.setNum);var AN=i=>{const e=i.reduce((t,r)=>{const s=wi(r).chroma;return s!==void 0&&(t[s]=t[s]||wi(r).name),t},{});return t=>e[t]};function VN(i,e={}){const t=i.map(s=>wi(s).pc).filter(s=>s);return wi.length===0?[]:$N(t,1,e).filter(s=>s.weight).sort((s,n)=>n.weight-s.weight).map(s=>s.name)}var xc={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},Bc=i=>e=>!!(e&i),HN=Bc(xc.anyThirds),WN=Bc(xc.perfectFifth),zN=Bc(xc.anySeventh),GN=Bc(xc.nonPerfectFifths);function UN(i){const e=parseInt(i.chroma,2);return HN(e)&&WN(e)&&zN(e)}function YN(i){const e=parseInt(i,2);return GN(e)?i:(e|16).toString(2)}function $N(i,e,t){const r=i[0],s=wi(r).chroma,n=AN(i),a=TN(i,!1),o=[];return a.forEach((l,h)=>{const u=t.assumePerfectFifth&&YN(l);im().filter(d=>t.assumePerfectFifth&&UN(d)?d.chroma===u:d.chroma===l).forEach(d=>{const p=d.aliases[0],f=n(h);h!==s?o.push({weight:.5*e,name:`${f}${p}/${r}`}):o.push({weight:1*e,name:`${f}${p}`})})}),o}function XN(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")}var xv=Di,jN=i=>Di(i).name,qN=i=>Di(i).semitones,QN=i=>Di(i).q,KN=i=>Di(i).num;function JN(i){const e=Di(i);return e.empty?"":e.simple+e.q}function ZN(i){const e=Di(i);if(e.empty)return"";const t=(7-e.step)%7,r=e.type==="perfectable"?-e.alt:-(e.alt+1);return Di({step:t,alt:r,oct:e.oct,dir:e.dir}).name}var eP=[1,2,2,3,3,4,5,5,6,6,7,7],tP="P m M m M P d P m M m M".split(" ");function iP(i){const e=i<0?-1:1,t=Math.abs(i),r=t%12,s=Math.floor(t/12);return e*(eP[r]+7*s)+tP[r]}var rP=dl,Bv=Tv((i,e)=>[i[0]+e[0],i[1]+e[1]]),sP=i=>e=>Bv(i,e),_v=Tv((i,e)=>[i[0]-e[0],i[1]-e[1]]);function nP(i,e){const t=xv(i);if(t.empty)return"";const[r,s,n]=t.coord;return Jg([r+e,s,n]).name}var Tn={names:XN,get:xv,name:jN,num:KN,semitones:qN,quality:QN,fromSemitones:iP,distance:rP,invert:ZN,simplify:JN,add:Bv,addTo:sP,subtract:_v,transposeFifths:nP};function Tv(i){return(e,t)=>{const r=Di(e).coord,s=Di(t).coord;if(r&&s){const n=i(r,s);return Jg(n).name}}}var aP=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],oP=aP,lP={...Jn,intervals:[],aliases:[]},Cv=[],Go={};function hP(i){return Go[i]||lP}function uP(){return Cv.slice()}function cP(i,e,t=[]){const r={...Zn(i),name:e,intervals:i,aliases:t};return Cv.push(r),Go[r.name]=r,Go[r.setNum]=r,Go[r.chroma]=r,r.aliases.forEach(s=>dP(r,s)),r}function dP(i,e){Go[e]=i}oP.forEach(([i,e,...t])=>cP(i.split(" "),e,t));var Nv={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function rm(i){const[e,t,r,s]=Zg(i);return e===""?Vd("",i):e==="A"&&s==="ug"?Vd("","aug"):Vd(e+t,r+s)}function Vd(i,e){const t=e.split("/");if(t.length===1)return[i,t[0],""];const[r,s,n,a]=Zg(t[1]);return r!==""&&n===""&&a===""?[i,t[0],r+s]:[i,e,""]}function Cn(i){if(Array.isArray(i))return Qh(i[1]||"",i[0],i[2]);if(i==="")return Nv;{const[e,t,r]=rm(i),s=Qh(t,e,r);return s.empty?Qh(i):s}}function Qh(i,e,t){const r=FN(i),s=wi(e||""),n=wi(t||"");if(r.empty||e&&s.empty||t&&n.empty)return Nv;const a=dl(s.pc,n.pc),o=r.intervals.indexOf(a),l=o>=0,h=l?n:wi(""),u=o===-1?NaN:o+1,c=n.pc&&n.pc!==s.pc,d=Array.from(r.intervals);if(l)for(let S=1;S<u;S++){const y=d[0][0],b=d[0][1],w=parseInt(y,10)+7;d.push(`${w}${b}`),d.shift()}else if(c){const S=_v(dl(s.pc,n.pc),"8P");S&&d.unshift(S)}const p=s.empty?[]:d.map(S=>er(s.pc,S));i=r.aliases.indexOf(i)!==-1?i:r.aliases[0];const f=`${s.empty?"":s.pc}${i}${l&&u>1?"/"+h.pc:c?"/"+n.pc:""}`,m=`${e?s.pc+" ":""}${r.name}${l&&u>1?" over "+h.pc:c?" over "+n.pc:""}`;return{...r,name:m,symbol:f,tonic:s.pc,type:r.name,root:h.pc,bass:c?n.pc:"",intervals:d,rootDegree:u,notes:p}}var fP=Cn;function pP(i,e){const[t,r,s]=rm(i);if(!t)return i;const n=er(s,e),a=n?"/"+n:"";return er(t,e)+r+a}function gP(i){const e=Cn(i),t=kv(e.chroma);return uP().filter(r=>t(r.chroma)).map(r=>r.name)}function mP(i){const e=Cn(i),t=kv(e.chroma);return im().filter(r=>t(r.chroma)).map(r=>e.tonic+r.aliases[0])}function yP(i){const e=Cn(i),t=CN(e.chroma);return im().filter(r=>t(r.chroma)).map(r=>e.tonic+r.aliases[0])}function bP(i,e){const t=Cn(i),r=e||t.tonic;return!r||t.empty?[]:t.intervals.map(s=>er(r,s))}function wP(i,e){const t=Cn(i),r=e||t.tonic,s=wv(t.intervals,r);return n=>n?s(n>0?n-1:n):""}function SP(i,e){const t=Cn(i),r=e||t.tonic;return wv(t.intervals,r)}var Pv={getChord:Qh,get:Cn,detect:VN,chordScales:gP,extended:mP,reduced:yP,tokenize:rm,transpose:pP,degrees:wP,steps:SP,notes:bP,chord:fP},vP=Math.log(2),kP=Math.log(440);function Ev(i){const e=12*(Math.log(i)-kP)/vP+69;return Math.round(e*100)/100}var xP="C C# D D# E F F# G G# A A# B".split(" "),BP="C Db D Eb E F Gb G Ab A Bb B".split(" ");function ho(i,e={}){if(isNaN(i)||i===-1/0||i===1/0)return"";i=Math.round(i);const r=(e.sharps===!0?xP:BP)[i%12];if(e.pitchClass)return r;const s=Math.floor(i/12)-1;return r+s}var _P=["C","D","E","F","G","A","B"],Mv=i=>i.name,Lv=i=>i.map(wi).filter(e=>!e.empty);function TP(i){return i===void 0?_P.slice():Array.isArray(i)?Lv(i).map(Mv):[]}var Xr=wi,CP=i=>Xr(i).name,NP=i=>Xr(i).pc,PP=i=>Xr(i).acc,EP=i=>Xr(i).oct,MP=i=>Xr(i).midi,LP=i=>Xr(i).freq,RP=i=>Xr(i).chroma;function FP(i){return ho(i)}function IP(i){return ho(Ev(i))}function OP(i){return ho(Ev(i),{sharps:!0})}function DP(i){return ho(i,{sharps:!0})}var Hl=er,AP=er,Rv=i=>e=>Hl(e,i),VP=Rv,Fv=i=>e=>Hl(i,e),HP=Fv;function Iv(i,e){return Hl(i,[e,0])}var WP=Iv;function zP(i,e){return Hl(i,[0,e])}var sm=(i,e)=>i.height-e.height,GP=(i,e)=>e.height-i.height;function Ov(i,e){return e=e||sm,Lv(i).sort(e).map(Mv)}function UP(i){return Ov(i,sm).filter((e,t,r)=>t===0||e!==r[t-1])}var YP=i=>{const e=Xr(i);return e.empty?"":ho(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function $P(i,e){const t=Xr(i);if(t.empty)return"";const r=Xr(e||ho(t.midi||t.chroma,{sharps:t.alt<0,pitchClass:!0}));if(r.empty||r.chroma!==t.chroma)return"";if(t.oct===void 0)return r.pc;const s=t.chroma-t.alt,n=r.chroma-r.alt,a=s>11||n<0?-1:s<0||n>11?1:0,o=t.oct+a;return r.pc+o}var Za={names:TP,get:Xr,name:CP,pitchClass:NP,accidentals:PP,octave:EP,midi:MP,ascending:sm,descending:GP,sortedNames:Ov,sortedUniqNames:UP,fromMidi:FP,fromMidiSharps:DP,freq:LP,fromFreq:IP,fromFreqSharps:OP,chroma:RP,transpose:Hl,tr:AP,transposeBy:Rv,trBy:VP,transposeFrom:Fv,trFrom:HP,transposeFifths:Iv,transposeOctaves:zP,trFifths:WP,simplify:YP,enharmonic:$P},nm=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],P0={...Jn,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},XP=nm.map(jP),Bp={};XP.forEach(i=>{Bp[i.name]=i,i.aliases.forEach(e=>{Bp[e]=i})});function Dv(i){return typeof i=="string"?Bp[i.toLowerCase()]||P0:i&&i.name?Dv(i.name):P0}function jP(i){const[e,t,r,s,n,a,o]=i,l=o?[o]:[],h=Number(t).toString(2);return{empty:!1,intervals:hP(s).intervals,modeNum:e,chroma:h,normalized:h,name:s,setNum:t,alt:r,triad:n,seventh:a,aliases:l}}function Av(i){return(e,t)=>{const r=Dv(e);if(r.empty)return[];const s=em(r.modeNum,i),n=r.intervals.map(a=>er(t,a));return s.map((a,o)=>n[o]+a)}}Av(nm.map(i=>i[4]));Av(nm.map(i=>i[5]));function Te(i){return i==null}function fl(i){if(Te(i))throw new TypeError("note must be a valid note");const e=i.replace(/[0-9]+/g,""),t=parseInt(i.replace(/[^0-9]+/g,""));return[e,t]}const qP={id:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;",name:"R 3↑ 5↑ NR-1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:-1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},QP={id:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;",name:"R 3↑ 5↑ NR+1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},KP={id:"S?;T?;C,R->C,T,D->C,F,D->N,R-1;",name:"R 3↓ 5↓ NR-1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:-1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},JP={id:"S?;T?;C,R->C,T,D->C,F,D->N,R+1;",name:"R 3↓ 5↓ NR+1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},ZP={id:"S?;T?;C,R->C,T,U->C,F,D->N,R-1;",name:"R 3↑ 5↓ NR-1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:-1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},e2={id:"S?;T?;C,R->C,T,U->C,F,D->N,R+1;",name:"R 3↑ 5↓ NR+1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},t2={id:"S?;T?;C,R->C,T,D->C,F,U->N,R-1;",name:"R 3↓ 5↑ NR-1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:-1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},i2={id:"S?;T?;C,R->C,T,D->C,F,U->N,R+1;",name:"R 3↓ 5↑ NR+1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"THIRD"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"FIFTH"},{chordRef:"NEXT",dir:"NONE",interval:1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},r2={id:"chordTonesWithChromaticLeadingTone",description:"Universal transitions between any 2 chords, using only chord tones and a chromatic passing note before the change",name:"Chord tones + chromatic",tags:["CHROMATIC_APPROACH"],transitions:[qP,QP,KP,JP,ZP,e2,t2,i2]},s2={id:"S?;T?;C,R->C,T,U;",name:"R 3↑",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"THIRD"}],tags:["CHORD_TONE_ONLY"]},n2={id:"S?;T?;C,R->C,T,D;",name:"R 3↓",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"THIRD"}],tags:["CHORD_TONE_ONLY"]},a2={id:"S?;T?;C,R->C,F,U;",name:"R 5↑",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"UP",interval:0,tone:"FIFTH"}],tags:["CHORD_TONE_ONLY"]},o2={id:"S?;T?;C,R->C,F,D;",name:"R 5↓",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"CURRENT",dir:"DOWN",interval:0,tone:"FIFTH"}],tags:["CHORD_TONE_ONLY"]},l2={id:"rootAndChordTone",description:"Root and another chord tone passing to the next chord.",name:"Root + chord tone",tags:["CHORD_TONE_ONLY"],transitions:[s2,n2,a2,o2]},h2={id:"S?;T?;C,R->N,R-1;",name:"R NR-1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"NEXT",dir:"NONE",interval:-1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},u2={id:"S?;T?;C,R->N,R+1;",name:"R NR+1",steps:[{chordRef:"CURRENT",dir:"NONE",interval:0,tone:"ROOT"},{chordRef:"NEXT",dir:"NONE",interval:1,tone:"ROOT"}],tags:["CHROMATIC_APPROACH"]},c2={id:"rootToChromaticPassingTone",description:"Root and chromatic note moving to the next chord.",name:"Root + chromatic",tags:["CHROMATIC_APPROACH"],transitions:[h2,u2]},Vv=[r2,l2,c2],d2=["G2","D2","A1","E1"],f2=["G2","D2","A1","E1","B0"],Hv=["E5","B4","G4","D4","A3","E3"],Wv={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},p2={0:["C"],1:["C#","Db"],2:["D"],3:["D#","Eb"],4:["E"],5:["F"],6:["F#","Gb"],7:["G"],8:["G#","Ab"],9:["A"],10:["A#","Bb"],11:["B"]},g2=[0,1,2,3,4,5,6,7,8],zv=g2.flatMap(i=>Object.keys(Wv).map(e=>`${e}${i}`));zv.reduce((i,e)=>{const[t]=fl(e);return Array.isArray(i[t])||(i[t]=[]),i[t].push(e),i},{});const Gv={MAJOR:"Major","DOMINANT-SEVENTH":"Dominant 7th","MAJOR-SEVENTH":"Major 7th",MINOR:"Minor","MINOR-SEVENTH":"Minor 7th",DIMINISHED:"Diminished","HALF-DIMINISHED":"Half-Diminished","DIMINISHED-SEVENTH":"Diminished 7th",AUGMENTED:"Augmented","AUGMENTED-SEVENTH":"Augmented 7th"},_c=12,m2=Tn.fromSemitones(_c),y2=Tn.fromSemitones(_c*2),b2=Tn.fromSemitones(-_c);Tn.fromSemitones(-_c*2);const w2=[0,1,2,3,4,5,6,7,8,9,10,11,12].map(Tn.fromSemitones),am=Vv.flatMap(({transitions:i})=>i).reduce((i,e)=>Object.assign(i,{[e.id]:e}),{}),S2=Object.values(am);function om(i,{[i]:e,...t}){return t}function v2(i,e){return Object.entries(e??{}).filter(([t])=>!i.includes(t)).reduce((t,[r,s])=>({...t,[r]:s}),{})}function E0(i,e){return e.filter(t=>{const[r]=fl(t);return r===i})}function k2(i,e,t){return Math.floor((1-t)*i+t*e)}function x2(i,e){if(e<=0||e>=i.length)return[...i];const t=[...i],r=t[e];return t[e]=t[e-1],t[e-1]=r,t}function B2(i,e){return i.slice(0,e).concat(i.slice(e+1))}function _2(i,e){if(e<0||e>=i.length-1)return[...i];const t=[...i],r=t[e];return t[e]=t[e+1],t[e+1]=r,t}function lm(i,e,t="-"){let r=i,s=1;for(;e.has(r);)r=`${i}${t}${s++}`;return r}const Wl={bars:{jywxjNyYIMZeJdAN8NzzE:{id:"jywxjNyYIMZeJdAN8NzzE",chords:["56g913ZHvhA94K3K06aEK"]},"1lSOLUu0-qLrsAOnsTHAH":{id:"1lSOLUu0-qLrsAOnsTHAH",chords:["c_H_aiu6Y3xZ9FZ8myRVm"]},LIz2iFSV8DuhmaTzXPAMG:{id:"LIz2iFSV8DuhmaTzXPAMG",chords:["fY2252W_noaipy7BE4qZb"]}},chords:{"56g913ZHvhA94K3K06aEK":{id:"56g913ZHvhA94K3K06aEK",name:"D",type:"MINOR",root:"D2",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},c_H_aiu6Y3xZ9FZ8myRVm:{id:"c_H_aiu6Y3xZ9FZ8myRVm",name:"A",type:"DOMINANT-SEVENTH",root:"A1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},fY2252W_noaipy7BE4qZb:{id:"fY2252W_noaipy7BE4qZb",name:"D",type:"MINOR",root:"D2"}},config:{isLooping:!1,masterVolume:1,bassVolume:.5,metronomeVolume:0,chordsVolume:0},progressions:{default:{id:"default",noteCount:4,tuning:["G2","D2","A1","E1"],name:"default",bars:["jywxjNyYIMZeJdAN8NzzE","1lSOLUu0-qLrsAOnsTHAH","LIz2iFSV8DuhmaTzXPAMG"]}}},ur=kc({name:"bars",initialState:Wl.bars,reducers:{createBar:(i,{payload:e})=>({...i,[e.bar.id]:e.bar}),updateBar:(i,{payload:e})=>({...i,[e.bar.id]:e.bar}),deleteBar:(i,{payload:e})=>om(e.barId,i),addChords:(i,{payload:e})=>{const t=i[e.barId];return t?{...i,[e.barId]:{...t,chords:[...t.chords,...e.chordIds]}}:i},removeChords:(i,{payload:e})=>{const t=i[e.barId];return t?{...i,[e.barId]:{...t,chords:t.chords.filter(r=>!e.chordIds.includes(r))}}:i}},selectors:{getBar:(i,e)=>i[e]}}),Wt=kc({name:"chords",initialState:Wl.chords,reducers:{createChord:(i,{payload:e})=>({...i,[e.chord.id]:e.chord}),updateChord:(i,{payload:e})=>{const t=i[e.chord.id];return t?{...i,[e.chord.id]:{...t,...e.chord}}:i},deleteChord:(i,{payload:e})=>om(e.chordId,i),deleteChords:(i,{payload:e})=>v2(e.chordIds,i)},selectors:{getChord:(i,e)=>i[e]}}),Po=kc({name:"config",initialState:Wl.config,reducers:{updateConfig:(i,{payload:e})=>({...i,...e})},selectors:{}}),ai=kc({name:"progressions",initialState:Wl.progressions,reducers:{createProgression:(i,{payload:e})=>({...i,[e.progression.id]:e.progression}),updateProgression:(i,{payload:e})=>({...i,[e.progression.id]:e.progression}),deleteProgression:(i,{payload:e})=>om(e.progressionId,i),addBars:(i,{payload:e})=>{const t=i[e.progressionId];return t?{...i,[e.progressionId]:{...t,bars:[...t.bars,...e.barIds]}}:i},removeBars:(i,{payload:e})=>{const t=i[e.progressionId];return t?{...i,[e.progressionId]:{...t,bars:t.bars.filter(r=>!e.barIds.includes(r))}}:i}},selectors:{getProgressions:i=>Array.from(Object.values(i)),getProgression:(i,e)=>Te(e)?void 0:i[e],getDefaultProgression:i=>i.default}});function T2(i){if(i.length===0)throw new Error(`Needs at least one note, was: ${i}`);const e=i.map(s=>[s,Za.freq(s)]);let t=e[0],r=e[0];for(let s=1;s<e.length;s++){const n=e[s];n[1]<t[1]&&(t=n),n[1]>r[1]&&(r=n)}return[t[1],Za.freq(er(r[0],y2))]}function hm(i,e=!0){switch(i){case"MAJOR":return e?"":"maj";case"DOMINANT-SEVENTH":return"7";case"MAJOR-SEVENTH":return"maj7";case"MINOR":return"m";case"MINOR-SEVENTH":return"m7";case"DIMINISHED":return"dim";case"HALF-DIMINISHED":return"m7b5";case"DIMINISHED-SEVENTH":return"dim7";case"AUGMENTED":return"aug";case"AUGMENTED-SEVENTH":return"aug7"}}function C2(i,e){const t=hm(i.type,!1),r=Pv.notes(t,i.root);switch(e){case"ROOT":return r[0];case"THIRD":return r[1];case"FIFTH":return r[2]}}function N2(i,e,t){const r=C2(i,e);switch(t){case"NONE":{if(e!=="ROOT")throw new TypeError('cannot be "NONE" unless referring a root');return r}case"UP":return e==="ROOT"?er(r,m2):r;case"DOWN":return er(r,b2)}}function P2(i,e,t){const r=t.chordRef==="CURRENT"?i:e,s=N2(r,t.tone,t.dir),n=Tn.fromSemitones(t.interval);return er(s,n)}function Uv(i,e,t){return t.steps.map(r=>P2(i,e,r))}function Yv(i,e,t,r){const s=Uv(i,e,r),[n,a]=T2(t);return s.every(o=>{const l=Za.freq(o);return l>=n&&l<=a})}function E2(i){return i[Math.floor(Math.random()*i.length)]}const M2={allowEmptyProgression:!1,allowEmptyBars:!1};function*$v(i,e,t={}){const r={...M2,...t},s=ai.selectors.getProgression(i,e);if(Te(s))throw new Error(`Progression with id "${e}" doesn't exist.`);if(!r.allowEmptyProgression&&s.bars.length===0)throw new TypeError(`Progression "${e}" has no bars.`);for(let n=0;n<s.bars.length;n+=1){const a=s.bars[n],o=ur.selectors.getBar(i,a);if(Te(o))throw new Error(`Bar with id "${a}" doesn't exist.`);if(!r.allowEmptyBars&&o.chords.length===0&&n!==s.bars.length-1)throw new Error(`Bar "${a}" has no chords.`);for(let l=0;l<o.chords.length;l+=1){const h=o.chords[l],u=Wt.selectors.getChord(i,h);if(Te(u))throw new Error(`Chord with id "${h}" doesn't exist.`);yield[u,o]}}}function L2(i,e){try{const t=ai.selectors.getProgression(i,e.payload.progressionId),r=t==null?void 0:t.tuning;if(Te(t)||Te(r))return i;const s=[],n=$v(i,e.payload.progressionId),a=Array.from(n);for(let l=0;l<a.length;l+=1){const[h]=a[l];if(!Te(h.transitionId)||l===a.length-1)continue;const[u]=a[l+1],c=h.noteCount??t.noteCount??4,d=Array.from(new Set([...t.tags??[],...h.tags??[]])),p=S2.filter(m=>Yv(h,u,r,m)).filter(m=>m.steps.length===c).filter(m=>d.every(S=>m.tags.includes(S)));if(p.length===0)continue;const f=E2(p);s.push({...h,transitionId:f.id})}const o={...i.chords};for(let l of s)o[l.id]=l;return{...i,chords:o}}catch(t){return console.error(t),i}}function R2(i,e){try{const t={...i.chords},r=$v(i,e.payload.progressionId,{allowEmptyBars:!0,allowEmptyProgression:!0});for(let[{transitionId:s,...n}]of r)t[n.id]=n;return{...i,chords:t}}catch(t){return console.error(t),i}}function F2(i,e){const t=e.payload.template;return{...i,bars:{...i.bars,...t.bars},chords:{...i.chords,...t.chords},progressions:{...i.progressions,[t.progression.id]:t.progression}}}const I2=KS({bars:ur.reducer,chords:Wt.reducer,config:Po.reducer,progressions:ai.reducer});function O2(i,e){switch(e.type){case"global/fillTransitions":return L2(i,e);case"global/clearTransitions":return R2(i,e);case"global/createProgressionFromTemplate":return F2(i,e);default:return I2(i,e)}}const D2="stick-app-data";function A2(i){try{localStorage.setItem(D2,JSON.stringify(i))}catch(e){console.error("Could not save state",e)}}function V2(){return Wl}const H2=i=>e=>t=>{const r=e(t);return A2(i.getState()),r},W2=DC({reducer:O2,middleware:i=>i().concat(H2),preloadedState:V2()});function z2(i){if(i.sheet)return i.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===i)return document.styleSheets[e]}function G2(i){var e=document.createElement("style");return e.setAttribute("data-emotion",i.key),i.nonce!==void 0&&e.setAttribute("nonce",i.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var U2=function(){function i(t){var r=this;this._insertTag=function(s){var n;r.tags.length===0?r.insertionPoint?n=r.insertionPoint.nextSibling:r.prepend?n=r.container.firstChild:n=r.before:n=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(s,n),r.tags.push(s)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=i.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(G2(this));var s=this.tags[this.tags.length-1];if(this.isSpeedy){var n=z2(s);try{n.insertRule(r,n.cssRules.length)}catch{}}else s.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){return r.parentNode&&r.parentNode.removeChild(r)}),this.tags=[],this.ctr=0},i}(),Bi="-ms-",Ru="-moz-",Je="-webkit-",Xv="comm",um="rule",cm="decl",Y2="@import",jv="@keyframes",$2="@layer",X2=Math.abs,Tc=String.fromCharCode,j2=Object.assign;function q2(i,e){return yi(i,0)^45?(((e<<2^yi(i,0))<<2^yi(i,1))<<2^yi(i,2))<<2^yi(i,3):0}function qv(i){return i.trim()}function Q2(i,e){return(i=e.exec(i))?i[0]:i}function Ze(i,e,t){return i.replace(e,t)}function _p(i,e){return i.indexOf(e)}function yi(i,e){return i.charCodeAt(e)|0}function pl(i,e,t){return i.slice(e,t)}function ts(i){return i.length}function dm(i){return i.length}function yh(i,e){return e.push(i),i}function K2(i,e){return i.map(e).join("")}var Cc=1,eo=1,Qv=0,tr=0,Qt=0,uo="";function Nc(i,e,t,r,s,n,a){return{value:i,root:e,parent:t,type:r,props:s,children:n,line:Cc,column:eo,length:a,return:""}}function vo(i,e){return j2(Nc("",null,null,"",null,null,0),i,{length:-i.length},e)}function J2(){return Qt}function Z2(){return Qt=tr>0?yi(uo,--tr):0,eo--,Qt===10&&(eo=1,Cc--),Qt}function dr(){return Qt=tr<Qv?yi(uo,tr++):0,eo++,Qt===10&&(eo=1,Cc++),Qt}function us(){return yi(uo,tr)}function Kh(){return tr}function zl(i,e){return pl(uo,i,e)}function gl(i){switch(i){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Kv(i){return Cc=eo=1,Qv=ts(uo=i),tr=0,[]}function Jv(i){return uo="",i}function Jh(i){return qv(zl(tr-1,Tp(i===91?i+2:i===40?i+1:i)))}function eE(i){for(;(Qt=us())&&Qt<33;)dr();return gl(i)>2||gl(Qt)>3?"":" "}function tE(i,e){for(;--e&&dr()&&!(Qt<48||Qt>102||Qt>57&&Qt<65||Qt>70&&Qt<97););return zl(i,Kh()+(e<6&&us()==32&&dr()==32))}function Tp(i){for(;dr();)switch(Qt){case i:return tr;case 34:case 39:i!==34&&i!==39&&Tp(Qt);break;case 40:i===41&&Tp(i);break;case 92:dr();break}return tr}function iE(i,e){for(;dr()&&i+Qt!==57;)if(i+Qt===84&&us()===47)break;return"/*"+zl(e,tr-1)+"*"+Tc(i===47?i:dr())}function rE(i){for(;!gl(us());)dr();return zl(i,tr)}function sE(i){return Jv(Zh("",null,null,null,[""],i=Kv(i),0,[0],i))}function Zh(i,e,t,r,s,n,a,o,l){for(var h=0,u=0,c=a,d=0,p=0,f=0,m=1,S=1,y=1,b=0,w="",x=s,v=n,C=r,P=w;S;)switch(f=b,b=dr()){case 40:if(f!=108&&yi(P,c-1)==58){_p(P+=Ze(Jh(b),"&","&\f"),"&\f")!=-1&&(y=-1);break}case 34:case 39:case 91:P+=Jh(b);break;case 9:case 10:case 13:case 32:P+=eE(f);break;case 92:P+=tE(Kh()-1,7);continue;case 47:switch(us()){case 42:case 47:yh(nE(iE(dr(),Kh()),e,t),l);break;default:P+="/"}break;case 123*m:o[h++]=ts(P)*y;case 125*m:case 59:case 0:switch(b){case 0:case 125:S=0;case 59+u:y==-1&&(P=Ze(P,/\f/g,"")),p>0&&ts(P)-c&&yh(p>32?L0(P+";",r,t,c-1):L0(Ze(P," ","")+";",r,t,c-2),l);break;case 59:P+=";";default:if(yh(C=M0(P,e,t,h,u,s,o,w,x=[],v=[],c),n),b===123)if(u===0)Zh(P,e,C,C,x,n,c,o,v);else switch(d===99&&yi(P,3)===110?100:d){case 100:case 108:case 109:case 115:Zh(i,C,C,r&&yh(M0(i,C,C,0,0,s,o,w,s,x=[],c),v),s,v,c,o,r?x:v);break;default:Zh(P,C,C,C,[""],v,0,o,v)}}h=u=p=0,m=y=1,w=P="",c=a;break;case 58:c=1+ts(P),p=f;default:if(m<1){if(b==123)--m;else if(b==125&&m++==0&&Z2()==125)continue}switch(P+=Tc(b),b*m){case 38:y=u>0?1:(P+="\f",-1);break;case 44:o[h++]=(ts(P)-1)*y,y=1;break;case 64:us()===45&&(P+=Jh(dr())),d=us(),u=c=ts(w=P+=rE(Kh())),b++;break;case 45:f===45&&ts(P)==2&&(m=0)}}return n}function M0(i,e,t,r,s,n,a,o,l,h,u){for(var c=s-1,d=s===0?n:[""],p=dm(d),f=0,m=0,S=0;f<r;++f)for(var y=0,b=pl(i,c+1,c=X2(m=a[f])),w=i;y<p;++y)(w=qv(m>0?d[y]+" "+b:Ze(b,/&\f/g,d[y])))&&(l[S++]=w);return Nc(i,e,t,s===0?um:o,l,h,u)}function nE(i,e,t){return Nc(i,e,t,Xv,Tc(J2()),pl(i,2,-2),0)}function L0(i,e,t,r){return Nc(i,e,t,cm,pl(i,0,r),pl(i,r+1,-1),r)}function Wa(i,e){for(var t="",r=dm(i),s=0;s<r;s++)t+=e(i[s],s,i,e)||"";return t}function aE(i,e,t,r){switch(i.type){case $2:if(i.children.length)break;case Y2:case cm:return i.return=i.return||i.value;case Xv:return"";case jv:return i.return=i.value+"{"+Wa(i.children,r)+"}";case um:i.value=i.props.join(",")}return ts(t=Wa(i.children,r))?i.return=i.value+"{"+t+"}":""}function oE(i){var e=dm(i);return function(t,r,s,n){for(var a="",o=0;o<e;o++)a+=i[o](t,r,s,n)||"";return a}}function lE(i){return function(e){e.root||(e=e.return)&&i(e)}}function hE(i){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=i(t)),e[t]}}var uE=function(e,t,r){for(var s=0,n=0;s=n,n=us(),s===38&&n===12&&(t[r]=1),!gl(n);)dr();return zl(e,tr)},cE=function(e,t){var r=-1,s=44;do switch(gl(s)){case 0:s===38&&us()===12&&(t[r]=1),e[r]+=uE(tr-1,t,r);break;case 2:e[r]+=Jh(s);break;case 4:if(s===44){e[++r]=us()===58?"&\f":"",t[r]=e[r].length;break}default:e[r]+=Tc(s)}while(s=dr());return e},dE=function(e,t){return Jv(cE(Kv(e),t))},R0=new WeakMap,fE=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,r=e.parent,s=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!R0.get(r))&&!s){R0.set(e,!0);for(var n=[],a=dE(t,n),o=r.props,l=0,h=0;l<a.length;l++)for(var u=0;u<o.length;u++,h++)e.props[h]=n[l]?a[l].replace(/&\f/g,o[u]):o[u]+" "+a[l]}}},pE=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}};function Zv(i,e){switch(q2(i,e)){case 5103:return Je+"print-"+i+i;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Je+i+i;case 5349:case 4246:case 4810:case 6968:case 2756:return Je+i+Ru+i+Bi+i+i;case 6828:case 4268:return Je+i+Bi+i+i;case 6165:return Je+i+Bi+"flex-"+i+i;case 5187:return Je+i+Ze(i,/(\w+).+(:[^]+)/,Je+"box-$1$2"+Bi+"flex-$1$2")+i;case 5443:return Je+i+Bi+"flex-item-"+Ze(i,/flex-|-self/,"")+i;case 4675:return Je+i+Bi+"flex-line-pack"+Ze(i,/align-content|flex-|-self/,"")+i;case 5548:return Je+i+Bi+Ze(i,"shrink","negative")+i;case 5292:return Je+i+Bi+Ze(i,"basis","preferred-size")+i;case 6060:return Je+"box-"+Ze(i,"-grow","")+Je+i+Bi+Ze(i,"grow","positive")+i;case 4554:return Je+Ze(i,/([^-])(transform)/g,"$1"+Je+"$2")+i;case 6187:return Ze(Ze(Ze(i,/(zoom-|grab)/,Je+"$1"),/(image-set)/,Je+"$1"),i,"")+i;case 5495:case 3959:return Ze(i,/(image-set\([^]*)/,Je+"$1$`$1");case 4968:return Ze(Ze(i,/(.+:)(flex-)?(.*)/,Je+"box-pack:$3"+Bi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Je+i+i;case 4095:case 3583:case 4068:case 2532:return Ze(i,/(.+)-inline(.+)/,Je+"$1$2")+i;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ts(i)-1-e>6)switch(yi(i,e+1)){case 109:if(yi(i,e+4)!==45)break;case 102:return Ze(i,/(.+:)(.+)-([^]+)/,"$1"+Je+"$2-$3$1"+Ru+(yi(i,e+3)==108?"$3":"$2-$3"))+i;case 115:return~_p(i,"stretch")?Zv(Ze(i,"stretch","fill-available"),e)+i:i}break;case 4949:if(yi(i,e+1)!==115)break;case 6444:switch(yi(i,ts(i)-3-(~_p(i,"!important")&&10))){case 107:return Ze(i,":",":"+Je)+i;case 101:return Ze(i,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Je+(yi(i,14)===45?"inline-":"")+"box$3$1"+Je+"$2$3$1"+Bi+"$2box$3")+i}break;case 5936:switch(yi(i,e+11)){case 114:return Je+i+Bi+Ze(i,/[svh]\w+-[tblr]{2}/,"tb")+i;case 108:return Je+i+Bi+Ze(i,/[svh]\w+-[tblr]{2}/,"tb-rl")+i;case 45:return Je+i+Bi+Ze(i,/[svh]\w+-[tblr]{2}/,"lr")+i}return Je+i+Bi+i+i}return i}var gE=function(e,t,r,s){if(e.length>-1&&!e.return)switch(e.type){case cm:e.return=Zv(e.value,e.length);break;case jv:return Wa([vo(e,{value:Ze(e.value,"@","@"+Je)})],s);case um:if(e.length)return K2(e.props,function(n){switch(Q2(n,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Wa([vo(e,{props:[Ze(n,/:(read-\w+)/,":"+Ru+"$1")]})],s);case"::placeholder":return Wa([vo(e,{props:[Ze(n,/:(plac\w+)/,":"+Je+"input-$1")]}),vo(e,{props:[Ze(n,/:(plac\w+)/,":"+Ru+"$1")]}),vo(e,{props:[Ze(n,/:(plac\w+)/,Bi+"input-$1")]})],s)}return""})}},mE=[gE],ek=function(e){var t=e.key;if(t==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(m){var S=m.getAttribute("data-emotion");S.indexOf(" ")!==-1&&(document.head.appendChild(m),m.setAttribute("data-s",""))})}var s=e.stylisPlugins||mE,n={},a,o=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(m){for(var S=m.getAttribute("data-emotion").split(" "),y=1;y<S.length;y++)n[S[y]]=!0;o.push(m)});var l,h=[fE,pE];{var u,c=[aE,lE(function(m){u.insert(m)})],d=oE(h.concat(s,c)),p=function(S){return Wa(sE(S),d)};l=function(S,y,b,w){u=b,p(S?S+"{"+y.styles+"}":y.styles),w&&(f.inserted[y.name]=!0)}}var f={key:t,sheet:new U2({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:n,registered:{},insert:l};return f.sheet.hydrate(o),f};function Se(){return Se=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},Se.apply(this,arguments)}var tk={exports:{}},rt={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fi=typeof Symbol=="function"&&Symbol.for,fm=fi?Symbol.for("react.element"):60103,pm=fi?Symbol.for("react.portal"):60106,Pc=fi?Symbol.for("react.fragment"):60107,Ec=fi?Symbol.for("react.strict_mode"):60108,Mc=fi?Symbol.for("react.profiler"):60114,Lc=fi?Symbol.for("react.provider"):60109,Rc=fi?Symbol.for("react.context"):60110,gm=fi?Symbol.for("react.async_mode"):60111,Fc=fi?Symbol.for("react.concurrent_mode"):60111,Ic=fi?Symbol.for("react.forward_ref"):60112,Oc=fi?Symbol.for("react.suspense"):60113,yE=fi?Symbol.for("react.suspense_list"):60120,Dc=fi?Symbol.for("react.memo"):60115,Ac=fi?Symbol.for("react.lazy"):60116,bE=fi?Symbol.for("react.block"):60121,wE=fi?Symbol.for("react.fundamental"):60117,SE=fi?Symbol.for("react.responder"):60118,vE=fi?Symbol.for("react.scope"):60119;function Sr(i){if(typeof i=="object"&&i!==null){var e=i.$$typeof;switch(e){case fm:switch(i=i.type,i){case gm:case Fc:case Pc:case Mc:case Ec:case Oc:return i;default:switch(i=i&&i.$$typeof,i){case Rc:case Ic:case Ac:case Dc:case Lc:return i;default:return e}}case pm:return e}}}function ik(i){return Sr(i)===Fc}rt.AsyncMode=gm;rt.ConcurrentMode=Fc;rt.ContextConsumer=Rc;rt.ContextProvider=Lc;rt.Element=fm;rt.ForwardRef=Ic;rt.Fragment=Pc;rt.Lazy=Ac;rt.Memo=Dc;rt.Portal=pm;rt.Profiler=Mc;rt.StrictMode=Ec;rt.Suspense=Oc;rt.isAsyncMode=function(i){return ik(i)||Sr(i)===gm};rt.isConcurrentMode=ik;rt.isContextConsumer=function(i){return Sr(i)===Rc};rt.isContextProvider=function(i){return Sr(i)===Lc};rt.isElement=function(i){return typeof i=="object"&&i!==null&&i.$$typeof===fm};rt.isForwardRef=function(i){return Sr(i)===Ic};rt.isFragment=function(i){return Sr(i)===Pc};rt.isLazy=function(i){return Sr(i)===Ac};rt.isMemo=function(i){return Sr(i)===Dc};rt.isPortal=function(i){return Sr(i)===pm};rt.isProfiler=function(i){return Sr(i)===Mc};rt.isStrictMode=function(i){return Sr(i)===Ec};rt.isSuspense=function(i){return Sr(i)===Oc};rt.isValidElementType=function(i){return typeof i=="string"||typeof i=="function"||i===Pc||i===Fc||i===Mc||i===Ec||i===Oc||i===yE||typeof i=="object"&&i!==null&&(i.$$typeof===Ac||i.$$typeof===Dc||i.$$typeof===Lc||i.$$typeof===Rc||i.$$typeof===Ic||i.$$typeof===wE||i.$$typeof===SE||i.$$typeof===vE||i.$$typeof===bE)};rt.typeOf=Sr;tk.exports=rt;var kE=tk.exports,rk=kE,xE={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},BE={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},sk={};sk[rk.ForwardRef]=xE;sk[rk.Memo]=BE;var _E=!0;function mm(i,e,t){var r="";return t.split(" ").forEach(function(s){i[s]!==void 0?e.push(i[s]+";"):r+=s+" "}),r}var nk=function(e,t,r){var s=e.key+"-"+t.name;(r===!1||_E===!1)&&e.registered[s]===void 0&&(e.registered[s]=t.styles)},ym=function(e,t,r){nk(e,t,r);var s=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var n=t;do e.insert(t===n?"."+s:"",n,e.sheet,!0),n=n.next;while(n!==void 0)}};function TE(i){for(var e=0,t,r=0,s=i.length;s>=4;++r,s-=4)t=i.charCodeAt(r)&255|(i.charCodeAt(++r)&255)<<8|(i.charCodeAt(++r)&255)<<16|(i.charCodeAt(++r)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(s){case 3:e^=(i.charCodeAt(r+2)&255)<<16;case 2:e^=(i.charCodeAt(r+1)&255)<<8;case 1:e^=i.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var CE={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},NE=/[A-Z]|^ms/g,PE=/_EMO_([^_]+?)_([^]*?)_EMO_/g,ak=function(e){return e.charCodeAt(1)===45},F0=function(e){return e!=null&&typeof e!="boolean"},Hd=hE(function(i){return ak(i)?i:i.replace(NE,"-$&").toLowerCase()}),I0=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(PE,function(r,s,n){return is={name:s,styles:n,next:is},s})}return CE[e]!==1&&!ak(e)&&typeof t=="number"&&t!==0?t+"px":t};function ml(i,e,t){if(t==null)return"";if(t.__emotion_styles!==void 0)return t;switch(typeof t){case"boolean":return"";case"object":{if(t.anim===1)return is={name:t.name,styles:t.styles,next:is},t.name;if(t.styles!==void 0){var r=t.next;if(r!==void 0)for(;r!==void 0;)is={name:r.name,styles:r.styles,next:is},r=r.next;var s=t.styles+";";return s}return EE(i,e,t)}case"function":{if(i!==void 0){var n=is,a=t(i);return is=n,ml(i,e,a)}break}}if(e==null)return t;var o=e[t];return o!==void 0?o:t}function EE(i,e,t){var r="";if(Array.isArray(t))for(var s=0;s<t.length;s++)r+=ml(i,e,t[s])+";";else for(var n in t){var a=t[n];if(typeof a!="object")e!=null&&e[a]!==void 0?r+=n+"{"+e[a]+"}":F0(a)&&(r+=Hd(n)+":"+I0(n,a)+";");else if(Array.isArray(a)&&typeof a[0]=="string"&&(e==null||e[a[0]]===void 0))for(var o=0;o<a.length;o++)F0(a[o])&&(r+=Hd(n)+":"+I0(n,a[o])+";");else{var l=ml(i,e,a);switch(n){case"animation":case"animationName":{r+=Hd(n)+":"+l+";";break}default:r+=n+"{"+l+"}"}}}return r}var O0=/label:\s*([^\s;\n{]+)\s*(;|$)/g,is,za=function(e,t,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var s=!0,n="";is=void 0;var a=e[0];a==null||a.raw===void 0?(s=!1,n+=ml(r,t,a)):n+=a[0];for(var o=1;o<e.length;o++)n+=ml(r,t,e[o]),s&&(n+=a[o]);O0.lastIndex=0;for(var l="",h;(h=O0.exec(n))!==null;)l+="-"+h[1];var u=TE(n)+l;return{name:u,styles:n,next:is}},ME=function(e){return e()},ok=$o.useInsertionEffect?$o.useInsertionEffect:!1,LE=ok||ME,D0=ok||T.useLayoutEffect,bm={}.hasOwnProperty,lk=T.createContext(typeof HTMLElement<"u"?ek({key:"css"}):null);lk.Provider;var hk=function(e){return T.forwardRef(function(t,r){var s=T.useContext(lk);return e(t,s,r)})},uk=T.createContext({}),Cp="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",RE=function(e,t){var r={};for(var s in t)bm.call(t,s)&&(r[s]=t[s]);return r[Cp]=e,r},FE=function(e){var t=e.cache,r=e.serialized,s=e.isStringTag;return nk(t,r,s),LE(function(){return ym(t,r,s)}),null},IE=hk(function(i,e,t){var r=i.css;typeof r=="string"&&e.registered[r]!==void 0&&(r=e.registered[r]);var s=i[Cp],n=[r],a="";typeof i.className=="string"?a=mm(e.registered,n,i.className):i.className!=null&&(a=i.className+" ");var o=za(n,void 0,T.useContext(uk));a+=e.key+"-"+o.name;var l={};for(var h in i)bm.call(i,h)&&h!=="css"&&h!==Cp&&(l[h]=i[h]);return l.ref=t,l.className=a,T.createElement(T.Fragment,null,T.createElement(FE,{cache:e,serialized:o,isStringTag:typeof s=="string"}),T.createElement(s,l))}),OE=IE,ge=function(e,t){var r=arguments;if(t==null||!bm.call(t,"css"))return T.createElement.apply(void 0,r);var s=r.length,n=new Array(s);n[0]=OE,n[1]=RE(e,t);for(var a=2;a<s;a++)n[a]=r[a];return T.createElement.apply(null,n)},DE=hk(function(i,e){var t=i.styles,r=za([t],void 0,T.useContext(uk)),s=T.useRef();return D0(function(){var n=e.key+"-global",a=new e.sheet.constructor({key:n,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),o=!1,l=document.querySelector('style[data-emotion="'+n+" "+r.name+'"]');return e.sheet.tags.length&&(a.before=e.sheet.tags[0]),l!==null&&(o=!0,l.setAttribute("data-emotion",n),a.hydrate([l])),s.current=[a,o],function(){a.flush()}},[e]),D0(function(){var n=s.current,a=n[0],o=n[1];if(o){n[1]=!1;return}if(r.next!==void 0&&ym(e,r.next,!0),a.tags.length){var l=a.tags[a.tags.length-1].nextElementSibling;a.before=l,a.flush()}e.insert("",r,a,!1)},[e,r.name]),null});function Vc(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return za(e)}var AE=function(){var e=Vc.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};const VE=Vc`
  #root {
    width: 100vw;
    height: 100vh;
  }

  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0px;
    padding: 0px;
  }

  div,
  span {
    font-family: 'Poppins', sans-serif;
  }

  body {
    -webkit-font-smoothing: antialiased;
    background-color: #000000;
    /* background: linear-gradient(147deg, #000000 0%, #434343 74%); */
    height: 100vh;
    width: 100vw;
    overflow: hidden;
  }

  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
  }

  input,
  button,
  textarea,
  select {
    font: inherit;
  }

  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    overflow-wrap: break-word;
  }

  a:-webkit-any-link {
    text-decoration: none;
  }

  a {
    text-decoration: none !important;
  }

  // Custom scrollbar
  * {
    --sb-track-color: #ffffff20;
    --sb-thumb-color: #ffffff60;
    --sb-size: 8px;
  }

  *::-webkit-scrollbar {
    width: var(--sb-size);
    height: var(--sb-size);
  }

  *::-webkit-scrollbar-track {
    background: var(--sb-track-color);
    border-radius: 4px;
  }

  *::-webkit-scrollbar-thumb {
    background: var(--sb-thumb-color);
    border-radius: 4px;
  }

  @supports not selector(::-webkit-scrollbar) {
    * {
      scrollbar-color: var(--sb-thumb-color) var(--sb-track-color);
    }
  }

  /** Alphatab stuff */
  .at-footer {
    flex: 0 0 auto;
    background: #436d9d;
    color: #fff;
  }
  /* Player */
  .at-cursor-bar {
    /* Defines the color of the bar background when a bar is played */
    background: #ffffff30;
  }
  .at-selection div {
    /* Defines the color of the selection background */
    background: #ffffff20;
  }
  .at-cursor-beat {
    /* Defines the beat cursor */
    background: red;
    width: 3px;
  }
  .at-highlight * {
    /* Defines the color of the music symbols when played (svg) */
    /* fill: #0078ff;
    stroke: #0078ff; */
  }
  // Hide big rendered by label, and display clickable logo elsewhere
  .at-surface > div:last-child {
    display: none !important;
  }
`;function A0(i,e){if(i.inserted[e.name]===void 0)return i.insert("",e,i.sheet,!0)}function V0(i,e,t){var r=[],s=mm(i,r,t);return r.length<2?t:s+e(r)}var HE=function(e){var t=ek(e);t.sheet.speedy=function(o){this.isSpeedy=o},t.compat=!0;var r=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];var c=za(h,t.registered,void 0);return ym(t,c,!1),t.key+"-"+c.name},s=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];var c=za(h,t.registered),d="animation-"+c.name;return A0(t,{name:c.name,styles:"@keyframes "+d+"{"+c.styles+"}"}),d},n=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];var c=za(h,t.registered);A0(t,c)},a=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];return V0(t.registered,r,WE(h))};return{css:r,cx:a,injectGlobal:n,keyframes:s,hydrate:function(l){l.forEach(function(h){t.inserted[h]=!0})},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:mm.bind(null,t.registered),merge:V0.bind(null,t.registered,r)}},WE=function i(e){for(var t="",r=0;r<e.length;r++){var s=e[r];if(s!=null){var n=void 0;switch(typeof s){case"boolean":break;case"object":{if(Array.isArray(s))n=i(s);else{n="";for(var a in s)s[a]&&a&&(n&&(n+=" "),n+=a)}break}default:n=s}n&&(t&&(t+=" "),t+=n)}}return t},ck=HE({key:"css"}),ea=ck.cx,M=ck.css;/**
 * @remix-run/router v1.17.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yl(){return yl=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},yl.apply(this,arguments)}var sn;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(sn||(sn={}));const H0="popstate";function zE(i){i===void 0&&(i={});function e(s,n){let{pathname:a="/",search:o="",hash:l=""}=oa(s.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Np("",{pathname:a,search:o,hash:l},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(s,n){let a=s.document.querySelector("base"),o="";if(a&&a.getAttribute("href")){let l=s.location.href,h=l.indexOf("#");o=h===-1?l:l.slice(0,h)}return o+"#"+(typeof n=="string"?n:dk(n))}function r(s,n){wm(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(n)+")")}return UE(e,t,r,i)}function ni(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function wm(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function GE(){return Math.random().toString(36).substr(2,8)}function W0(i,e){return{usr:i.state,key:i.key,idx:e}}function Np(i,e,t,r){return t===void 0&&(t=null),yl({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof e=="string"?oa(e):e,{state:t,key:e&&e.key||r||GE()})}function dk(i){let{pathname:e="/",search:t="",hash:r=""}=i;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function oa(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substr(t),i=i.substr(0,t));let r=i.indexOf("?");r>=0&&(e.search=i.substr(r),i=i.substr(0,r)),i&&(e.pathname=i)}return e}function UE(i,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:n=!1}=r,a=s.history,o=sn.Pop,l=null,h=u();h==null&&(h=0,a.replaceState(yl({},a.state,{idx:h}),""));function u(){return(a.state||{idx:null}).idx}function c(){o=sn.Pop;let S=u(),y=S==null?null:S-h;h=S,l&&l({action:o,location:m.location,delta:y})}function d(S,y){o=sn.Push;let b=Np(m.location,S,y);t&&t(b,S),h=u()+1;let w=W0(b,h),x=m.createHref(b);try{a.pushState(w,"",x)}catch(v){if(v instanceof DOMException&&v.name==="DataCloneError")throw v;s.location.assign(x)}n&&l&&l({action:o,location:m.location,delta:1})}function p(S,y){o=sn.Replace;let b=Np(m.location,S,y);t&&t(b,S),h=u();let w=W0(b,h),x=m.createHref(b);a.replaceState(w,"",x),n&&l&&l({action:o,location:m.location,delta:0})}function f(S){let y=s.location.origin!=="null"?s.location.origin:s.location.href,b=typeof S=="string"?S:dk(S);return b=b.replace(/ $/,"%20"),ni(y,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,y)}let m={get action(){return o},get location(){return i(s,a)},listen(S){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(H0,c),l=S,()=>{s.removeEventListener(H0,c),l=null}},createHref(S){return e(s,S)},createURL:f,encodeLocation(S){let y=f(S);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:d,replace:p,go(S){return a.go(S)}};return m}var z0;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(z0||(z0={}));function YE(i,e,t){return t===void 0&&(t="/"),$E(i,e,t,!1)}function $E(i,e,t,r){let s=typeof e=="string"?oa(e):e,n=gk(s.pathname||"/",t);if(n==null)return null;let a=fk(i);XE(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let h=sM(n);o=iM(a[l],h,r)}return o}function fk(i,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(n,a,o)=>{let l={relativePath:o===void 0?n.path||"":o,caseSensitive:n.caseSensitive===!0,childrenIndex:a,route:n};l.relativePath.startsWith("/")&&(ni(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let h=zn([r,l.relativePath]),u=t.concat(l);n.children&&n.children.length>0&&(ni(n.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),fk(n.children,e,u,h)),!(n.path==null&&!n.index)&&e.push({path:h,score:eM(h,n.index),routesMeta:u})};return i.forEach((n,a)=>{var o;if(n.path===""||!((o=n.path)!=null&&o.includes("?")))s(n,a);else for(let l of pk(n.path))s(n,a,l)}),e}function pk(i){let e=i.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),n=t.replace(/\?$/,"");if(r.length===0)return s?[n,""]:[n];let a=pk(r.join("/")),o=[];return o.push(...a.map(l=>l===""?n:[n,l].join("/"))),s&&o.push(...a),o.map(l=>i.startsWith("/")&&l===""?"/":l)}function XE(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:tM(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const jE=/^:[\w-]+$/,qE=3,QE=2,KE=1,JE=10,ZE=-2,G0=i=>i==="*";function eM(i,e){let t=i.split("/"),r=t.length;return t.some(G0)&&(r+=ZE),e&&(r+=QE),t.filter(s=>!G0(s)).reduce((s,n)=>s+(jE.test(n)?qE:n===""?KE:JE),r)}function tM(i,e){return i.length===e.length&&i.slice(0,-1).every((r,s)=>r===e[s])?i[i.length-1]-e[e.length-1]:0}function iM(i,e,t){let{routesMeta:r}=i,s={},n="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],h=o===r.length-1,u=n==="/"?e:e.slice(n.length)||"/",c=U0({path:l.relativePath,caseSensitive:l.caseSensitive,end:h},u),d=l.route;if(!c&&h&&t&&!r[r.length-1].route.index&&(c=U0({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!c)return null;Object.assign(s,c.params),a.push({params:s,pathname:zn([n,c.pathname]),pathnameBase:uM(zn([n,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(n=zn([n,c.pathnameBase]))}return a}function U0(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,r]=rM(i.path,i.caseSensitive,i.end),s=e.match(t);if(!s)return null;let n=s[0],a=n.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((h,u,c)=>{let{paramName:d,isOptional:p}=u;if(d==="*"){let m=o[c]||"";a=n.slice(0,n.length-m.length).replace(/(.)\/+$/,"$1")}const f=o[c];return p&&!f?h[d]=void 0:h[d]=(f||"").replace(/%2F/g,"/"),h},{}),pathname:n,pathnameBase:a,pattern:i}}function rM(i,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),wm(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let r=[],s="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(r.push({paramName:"*"}),s+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":i!==""&&i!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function sM(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return wm(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),i}}function gk(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=i.charAt(t);return r&&r!=="/"?null:i.slice(t)||"/"}function nM(i,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof i=="string"?oa(i):i;return{pathname:t?t.startsWith("/")?t:aM(t,e):e,search:cM(r),hash:dM(s)}}function aM(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Wd(i,e,t,r){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function oM(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function lM(i,e){let t=oM(i);return e?t.map((r,s)=>s===i.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function hM(i,e,t,r){r===void 0&&(r=!1);let s;typeof i=="string"?s=oa(i):(s=yl({},i),ni(!s.pathname||!s.pathname.includes("?"),Wd("?","pathname","search",s)),ni(!s.pathname||!s.pathname.includes("#"),Wd("#","pathname","hash",s)),ni(!s.search||!s.search.includes("#"),Wd("#","search","hash",s)));let n=i===""||s.pathname==="",a=n?"/":s.pathname,o;if(a==null)o=t;else{let c=e.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),c-=1;s.pathname=d.join("/")}o=c>=0?e[c]:"/"}let l=nM(s,o),h=a&&a!=="/"&&a.endsWith("/"),u=(n||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(h||u)&&(l.pathname+="/"),l}const zn=i=>i.join("/").replace(/\/\/+/g,"/"),uM=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),cM=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,dM=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function fM(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const mk=["post","put","patch","delete"];new Set(mk);const pM=["get",...mk];new Set(pM);/**
 * React Router v6.24.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bl(){return bl=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},bl.apply(this,arguments)}const Sm=T.createContext(null),gM=T.createContext(null),Hc=T.createContext(null),Wc=T.createContext(null),la=T.createContext({outlet:null,matches:[],isDataRoute:!1}),yk=T.createContext(null);function zc(){return T.useContext(Wc)!=null}function vm(){return zc()||ni(!1),T.useContext(Wc).location}function bk(i){T.useContext(Hc).static||T.useLayoutEffect(i)}function Gc(){let{isDataRoute:i}=T.useContext(la);return i?PM():mM()}function mM(){zc()||ni(!1);let i=T.useContext(Sm),{basename:e,future:t,navigator:r}=T.useContext(Hc),{matches:s}=T.useContext(la),{pathname:n}=vm(),a=JSON.stringify(lM(s,t.v7_relativeSplatPath)),o=T.useRef(!1);return bk(()=>{o.current=!0}),T.useCallback(function(h,u){if(u===void 0&&(u={}),!o.current)return;if(typeof h=="number"){r.go(h);return}let c=hM(h,JSON.parse(a),n,u.relative==="path");i==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:zn([e,c.pathname])),(u.replace?r.replace:r.push)(c,u.state,u)},[e,r,a,n,i])}function yM(){let{matches:i}=T.useContext(la),e=i[i.length-1];return e?e.params:{}}function bM(i,e){return wM(i,e)}function wM(i,e,t,r){zc()||ni(!1);let{navigator:s}=T.useContext(Hc),{matches:n}=T.useContext(la),a=n[n.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let h=vm(),u;if(e){var c;let S=typeof e=="string"?oa(e):e;l==="/"||(c=S.pathname)!=null&&c.startsWith(l)||ni(!1),u=S}else u=h;let d=u.pathname||"/",p=d;if(l!=="/"){let S=l.replace(/^\//,"").split("/");p="/"+d.replace(/^\//,"").split("/").slice(S.length).join("/")}let f=YE(i,{pathname:p}),m=BM(f&&f.map(S=>Object.assign({},S,{params:Object.assign({},o,S.params),pathname:zn([l,s.encodeLocation?s.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?l:zn([l,s.encodeLocation?s.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),n,t,r);return e&&m?T.createElement(Wc.Provider,{value:{location:bl({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:sn.Pop}},m):m}function SM(){let i=NM(),e=fM(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),t?T.createElement("pre",{style:s},t):null,null)}const vM=T.createElement(SM,null);class kM extends T.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?T.createElement(la.Provider,{value:this.props.routeContext},T.createElement(yk.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xM(i){let{routeContext:e,match:t,children:r}=i,s=T.useContext(Sm);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),T.createElement(la.Provider,{value:e},r)}function BM(i,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),i==null){var n;if((n=t)!=null&&n.errors)i=t.matches;else return null}let a=i,o=(s=t)==null?void 0:s.errors;if(o!=null){let u=a.findIndex(c=>c.route.id&&(o==null?void 0:o[c.route.id])!==void 0);u>=0||ni(!1),a=a.slice(0,Math.min(a.length,u+1))}let l=!1,h=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<a.length;u++){let c=a[u];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(h=u),c.route.id){let{loaderData:d,errors:p}=t,f=c.route.loader&&d[c.route.id]===void 0&&(!p||p[c.route.id]===void 0);if(c.route.lazy||f){l=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}return a.reduceRight((u,c,d)=>{let p,f=!1,m=null,S=null;t&&(p=o&&c.route.id?o[c.route.id]:void 0,m=c.route.errorElement||vM,l&&(h<0&&d===0?(f=!0,S=null):h===d&&(f=!0,S=c.route.hydrateFallbackElement||null)));let y=e.concat(a.slice(0,d+1)),b=()=>{let w;return p?w=m:f?w=S:c.route.Component?w=T.createElement(c.route.Component,null):c.route.element?w=c.route.element:w=u,T.createElement(xM,{match:c,routeContext:{outlet:u,matches:y,isDataRoute:t!=null},children:w})};return t&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?T.createElement(kM,{location:t.location,revalidation:t.revalidation,component:m,error:p,children:b(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):b()},null)}var wk=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(wk||{}),Fu=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(Fu||{});function _M(i){let e=T.useContext(Sm);return e||ni(!1),e}function TM(i){let e=T.useContext(gM);return e||ni(!1),e}function CM(i){let e=T.useContext(la);return e||ni(!1),e}function Sk(i){let e=CM(),t=e.matches[e.matches.length-1];return t.route.id||ni(!1),t.route.id}function NM(){var i;let e=T.useContext(yk),t=TM(Fu.UseRouteError),r=Sk(Fu.UseRouteError);return e!==void 0?e:(i=t.errors)==null?void 0:i[r]}function PM(){let{router:i}=_M(wk.UseNavigateStable),e=Sk(Fu.UseNavigateStable),t=T.useRef(!1);return bk(()=>{t.current=!0}),T.useCallback(function(s,n){n===void 0&&(n={}),t.current&&(typeof s=="number"?i.navigate(s):i.navigate(s,bl({fromRouteId:e},n)))},[i,e])}function Eo(i){ni(!1)}function EM(i){let{basename:e="/",children:t=null,location:r,navigationType:s=sn.Pop,navigator:n,static:a=!1,future:o}=i;zc()&&ni(!1);let l=e.replace(/^\/*/,"/"),h=T.useMemo(()=>({basename:l,navigator:n,static:a,future:bl({v7_relativeSplatPath:!1},o)}),[l,o,n,a]);typeof r=="string"&&(r=oa(r));let{pathname:u="/",search:c="",hash:d="",state:p=null,key:f="default"}=r,m=T.useMemo(()=>{let S=gk(u,l);return S==null?null:{location:{pathname:S,search:c,hash:d,state:p,key:f},navigationType:s}},[l,u,c,d,p,f,s]);return m==null?null:T.createElement(Hc.Provider,{value:h},T.createElement(Wc.Provider,{children:t,value:m}))}function MM(i){let{children:e,location:t}=i;return bM(Pp(e),t)}new Promise(()=>{});function Pp(i,e){e===void 0&&(e=[]);let t=[];return T.Children.forEach(i,(r,s)=>{if(!T.isValidElement(r))return;let n=[...e,s];if(r.type===T.Fragment){t.push.apply(t,Pp(r.props.children,n));return}r.type!==Eo&&ni(!1),!r.props.index||!r.props.children||ni(!1);let a={id:r.props.id||n.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Pp(r.props.children,n)),t.push(a)}),t}var vk={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Y0=Cs.createContext&&Cs.createContext(vk),LM=["attr","size","title"];function RM(i,e){if(i==null)return{};var t=FM(i,e),r,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(i,r)&&(t[r]=i[r])}return t}function FM(i,e){if(i==null)return{};var t={};for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)){if(e.indexOf(r)>=0)continue;t[r]=i[r]}return t}function Iu(){return Iu=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},Iu.apply(this,arguments)}function $0(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}function Ou(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$0(Object(t),!0).forEach(function(r){IM(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):$0(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function IM(i,e,t){return e=OM(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function OM(i){var e=DM(i,"string");return typeof e=="symbol"?e:e+""}function DM(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function kk(i){return i&&i.map((e,t)=>Cs.createElement(e.tag,Ou({key:t},e.attr),kk(e.child)))}function at(i){return e=>Cs.createElement(AM,Iu({attr:Ou({},i.attr)},e),kk(i.child))}function AM(i){var e=t=>{var{attr:r,size:s,title:n}=i,a=RM(i,LM),o=s||t.size||"1em",l;return t.className&&(l=t.className),i.className&&(l=(l?l+" ":"")+i.className),Cs.createElement("svg",Iu({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:l,style:Ou(Ou({color:i.color||t.color},t.style),i.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),n&&Cs.createElement("title",null,n),i.children)};return Y0!==void 0?Cs.createElement(Y0.Consumer,null,t=>e(t)):e(vk)}function xk(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"16"},child:[]},{tag:"line",attr:{x1:"8",y1:"12",x2:"16",y2:"12"},child:[]}]})(i)}function Gl(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"},child:[]},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"},child:[]},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"},child:[]},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"},child:[]}]})(i)}function VM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M15.4565 9.67503L15.3144 9.53297C14.6661 8.90796 13.8549 8.43369 12.9235 8.18412C10.0168 7.40527 7.22541 9.05273 6.43185 12.0143C6.38901 12.1742 6.36574 12.3537 6.3285 12.8051C6.17423 14.6752 5.73449 16.0697 4.5286 17.4842C6.78847 18.3727 9.46572 18.9986 11.5016 18.9986C13.9702 18.9986 16.1644 17.3394 16.8126 14.9202C17.3306 12.9869 16.7513 11.0181 15.4565 9.67503ZM13.2886 6.21301L18.2278 2.37142C18.6259 2.0618 19.1922 2.09706 19.5488 2.45367L22.543 5.44787C22.8997 5.80448 22.9349 6.37082 22.6253 6.76891L18.7847 11.7068C19.0778 12.8951 19.0836 14.1721 18.7444 15.4379C17.8463 18.7897 14.8142 20.9986 11.5016 20.9986C8 20.9986 3.5 19.4967 1 17.9967C4.97978 14.9967 4.04722 13.1865 4.5 11.4967C5.55843 7.54658 9.34224 5.23935 13.2886 6.21301ZM16.7015 8.09161C16.7673 8.15506 16.8319 8.21964 16.8952 8.28533L18.0297 9.41984L20.5046 6.23786L18.7589 4.4921L15.5769 6.96698L16.7015 8.09161Z"},child:[]}]})(i)}function Bk(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 18.0001H9.5V19.2501C9.5 20.7688 8.26878 22.0001 6.75 22.0001C5.23122 22.0001 4 20.7688 4 19.2501V18.0001ZM8 6.12067C10 6.12067 11 9.00006 11 11.0001C11 12.0001 10.5 13.0001 10 14.5001L9.5 16.0001H4C4 15.0001 3.5 13.5001 3.5 11.0001C3.5 8.50006 5.49783 6.12067 8 6.12067ZM20.054 14.0984L19.8369 15.3294C19.5732 16.8251 18.1468 17.8238 16.6511 17.5601C15.1554 17.2964 14.1567 15.87 14.4205 14.3743L14.6375 13.1433L20.054 14.0984ZM18.1776 1.70488C20.6417 2.13938 22.196 4.82954 21.7619 7.29156C21.3278 9.75358 20.5749 11.144 20.4013 12.1288L14.9848 11.1737L14.7529 9.60967C14.5209 8.04564 14.2022 6.974 14.3758 5.9892C14.7231 4.01958 16.2079 1.35759 18.1776 1.70488Z"},child:[]}]})(i)}function HM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6 3H8V21H6V3ZM16 3H18V21H16V3Z"},child:[]}]})(i)}function WM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6 20.1957V3.80421C6 3.01878 6.86395 2.53993 7.53 2.95621L20.6432 11.152C21.2699 11.5436 21.2699 12.4563 20.6432 12.848L7.53 21.0437C6.86395 21.46 6 20.9812 6 20.1957Z"},child:[]}]})(i)}function zM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4C3 3.44772 3.44772 3 4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4Z"},child:[]}]})(i)}function GM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5.88889 16H2C1.44772 16 1 15.5523 1 15V9.00001C1 8.44772 1.44772 8.00001 2 8.00001H5.88889L11.1834 3.66815C11.3971 3.49329 11.7121 3.52479 11.887 3.73851C11.9601 3.82784 12 3.93971 12 4.05513V19.9449C12 20.221 11.7761 20.4449 11.5 20.4449C11.3846 20.4449 11.2727 20.405 11.1834 20.3319L5.88889 16ZM20.4142 12L23.9497 15.5355L22.5355 16.9498L19 13.4142L15.4645 16.9498L14.0503 15.5355L17.5858 12L14.0503 8.46447L15.4645 7.05026L19 10.5858L22.5355 7.05026L23.9497 8.46447L20.4142 12Z"},child:[]}]})(i)}function UM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"},child:[]}]})(i)}function YM(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"},child:[]}]})(i)}function $M(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(i)}function XM(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(i)}function jM(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M219.05,201.94l-27.4-86.12,25.23-27.75a12,12,0,0,0-17.76-16.14L183.24,89.39l-15.1-47.45A19.93,19.93,0,0,0,149.08,28H106.91A19.93,19.93,0,0,0,87.85,41.94l-50.91,160A20,20,0,0,0,56,228H200a20,20,0,0,0,19.06-26.06ZM179.25,156H155.12L173,136.34ZM109.83,52h36.33l18.42,57.91L122.69,156H76.74ZM61.47,204l7.63-24H186.89l7.63,24Z"},child:[]}]})(i)}function Uc(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(i)}function qM(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,130.16q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.6,107.6,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.29,107.29,0,0,0-26.25-10.86,8,8,0,0,0-7.06,1.48L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.6,107.6,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(i)}function QM(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M210.3,56.34l-80-24A8,8,0,0,0,120,40V148.26A48,48,0,1,0,136,184V50.75l69.7,20.91a8,8,0,1,0,4.6-15.32Z"},child:[]}]})(i)}function _k(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212.24,83.76l-56-56A6,6,0,0,0,152,26H56A14,14,0,0,0,42,40V216a14,14,0,0,0,14,14H200a14,14,0,0,0,14-14V88A6,6,0,0,0,212.24,83.76ZM158,46.48,193.52,82H158ZM200,218H56a2,2,0,0,1-2-2V40a2,2,0,0,1,2-2h90V88a6,6,0,0,0,6,6h50V216A2,2,0,0,1,200,218Z"},child:[]}]})(i)}function wl(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M211.69,19.27a6,6,0,0,0-5.15-1.09l-128,32A6,6,0,0,0,74,56V170.11A34,34,0,1,0,86,196V108.68l116-29v58.43A34,34,0,1,0,214,164V24A6,6,0,0,0,211.69,19.27ZM52,218a22,22,0,1,1,22-22A22,22,0,0,1,52,218ZM86,96.32V60.68l116-29V67.32ZM180,186a22,22,0,1,1,22-22A22,22,0,0,1,180,186Z"},child:[]}]})(i)}function KM(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M90,96a6,6,0,0,1,6-6h64a6,6,0,0,1,0,12H96A6,6,0,0,1,90,96Zm6,38h64a6,6,0,0,0,0-12H96a6,6,0,0,0,0,12Zm32,20H96a6,6,0,0,0,0,12h32a6,6,0,0,0,0-12ZM222,48V156.69a13.94,13.94,0,0,1-4.1,9.9L166.59,217.9a13.94,13.94,0,0,1-9.9,4.1H48a14,14,0,0,1-14-14V48A14,14,0,0,1,48,34H208A14,14,0,0,1,222,48ZM48,210H154V160a6,6,0,0,1,6-6h50V48a2,2,0,0,0-2-2H48a2,2,0,0,0-2,2V208A2,2,0,0,0,48,210Zm153.52-44H166v35.52Z"},child:[]}]})(i)}function Tk(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"},child:[]}]})(i)}function Du(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M210.3,56.34l-80-24A8,8,0,0,0,120,40V148.26A48,48,0,1,0,136,184V50.75l69.7,20.91a8,8,0,1,0,4.6-15.32ZM88,216a32,32,0,1,1,32-32A32,32,0,0,1,88,216Z"},child:[]}]})(i)}function JM(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M227.32,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H216a8,8,0,0,0,0-16H115.32l112-112A16,16,0,0,0,227.32,73.37ZM136,75.31,152.69,92,68,176.69,51.31,160ZM48,208V179.31L76.69,208Zm48-3.31L79.32,188,164,103.31,180.69,120Zm96-96L147.32,64l24-24L216,84.69Z"},child:[]}]})(i)}function Ck(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236.8,188.09,149.35,36.22h0a24.76,24.76,0,0,0-42.7,0L19.2,188.09a23.51,23.51,0,0,0,0,23.72A24.35,24.35,0,0,0,40.55,224h174.9a24.35,24.35,0,0,0,21.33-12.19A23.51,23.51,0,0,0,236.8,188.09ZM222.93,203.8a8.5,8.5,0,0,1-7.48,4.2H40.55a8.5,8.5,0,0,1-7.48-4.2,7.59,7.59,0,0,1,0-7.72L120.52,44.21a8.75,8.75,0,0,1,15,0l87.45,151.87A7.59,7.59,0,0,1,222.93,203.8ZM120,144V104a8,8,0,0,1,16,0v40a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,180Z"},child:[]}]})(i)}function km(i){return at({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"},child:[]}]})(i)}function ZM(i,e){return!(i.some(t=>t.chords.length===0)||e.slice(0,-1).every(t=>!Te(t.transitionId)))}function eL(i,e){if(i.some(s=>s.chords.length===0))return!1;const t=e.slice(0,-1),r=e[e.length-1];return!(t.some(s=>Te(s.transitionId))||!Te(r.transitionId))}function tL(i,e){return e.some(t=>t.transitionId!==void 0)}const bh={canAutoFillTransitions:!1,canGenerateScore:!1,canClearTransitions:!1};function Nk(i,e){if(Te(e))return bh;const t=ai.selectors.getProgression(i,e);if(Te(t))return bh;const r=t.bars.map(n=>ur.selectors.getBar(i,n));if(r.length===0||r.some(Te))return bh;const s=r.flatMap(n=>n.chords).map(n=>Wt.selectors.getChord(i,n));return s.some(Te)?bh:{canAutoFillTransitions:ZM(r,s),canGenerateScore:eL(r,s),canClearTransitions:tL(r,s)}}const iL="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let cs=(i=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(i));for(;i--;)e+=iL[t[i]&63];return e};const rL=M`
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100vw;
  height: 100vh;
  z-index: 2;
  backdrop-filter: blur(30px);
  background-color: #00000005;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
`,sL=M`
  background-color: #1c1c1c;
  border-radius: 14px;
  user-select: text;
  display: flex;
  flex-direction: row;
  align-items: stretch;
  box-shadow: rgba(0, 0, 0, 0.07) 0px 1px 2px, rgba(0, 0, 0, 0.07) 0px 2px 4px,
    rgba(0, 0, 0, 0.07) 0px 4px 8px, rgba(0, 0, 0, 0.07) 0px 8px 16px,
    rgba(0, 0, 0, 0.07) 0px 16px 32px, rgba(0, 0, 0, 0.07) 0px 32px 64px;
`,nL=document.getElementById("modal"),Pk=({onBackdropClick:i,modalClassName:e,backdropClassName:t,children:r})=>{const s=n=>{n.preventDefault(),n.stopPropagation()};return yc.createPortal(k.jsx("div",{className:ea(rL,t),onClick:i,children:k.jsx("div",{onClick:s,className:ea(sL,e),children:r})}),nL)},aL=M`
  display: flex;
  flex-direction: column;
  padding: 14px;
  pointer-events: auto;
`,oL=M`
  font-size: 1em;
  color: #ffffff;
  margin-bottom: 2px;
  pointer-events: auto;
`,lL=M`
  font-size: 0.8em;
  margin-bottom: 10px;
  color: #ffffffaa;
`;function zd({Editor:i,name:e,value:t,data:r,description:s,onChange:n}){const a=T.useMemo(()=>`${e.toLowerCase().replace(/^\W/gi,"").replace(/\s+/g,"-")}-${cs()}`,[e]);return k.jsxs("div",{className:aL,children:[k.jsx("label",{className:oL,htmlFor:a,children:e}),k.jsx("span",{className:lL,children:s}),k.jsx(i,{id:a,value:t,data:r,onChange:n})]})}const hL=M`
  border-radius: 6px;
  background-color: #ffffff10;
  flex: 1;
  color: #ffffff;
  border: none;
  outline: none;
  padding: 10px 14px;
  font-size: 1em;
  &:hover {
    background-color: #ffffff30;
  }
  &:focus {
    background-color: #ffffff50;
  }
`,uL=({id:i,value:e,onChange:t,data:r})=>{const s=n=>{t(n.target.value)};return k.jsx("input",{type:"text",className:hL,...r??{},id:i,value:e,onChange:s})};function ta(i){"@babel/helpers - typeof";return ta=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(i)}function cL(i,e){if(ta(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(ta(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Ek(i){var e=cL(i,"string");return ta(e)==="symbol"?e:String(e)}function Mo(i,e,t){return e=Ek(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function X0(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,r)}return t}function ye(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?X0(Object(t),!0).forEach(function(r){Mo(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):X0(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function dL(i){if(Array.isArray(i))return i}function fL(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var r,s,n,a,o=[],l=!0,h=!1;try{if(n=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=n.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(u){h=!0,s=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw s}}return o}}function Ep(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function Mk(i,e){if(i){if(typeof i=="string")return Ep(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ep(i,e)}}function pL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ps(i,e){return dL(i)||fL(i,e)||Mk(i,e)||pL()}function gL(i,e){if(i==null)return{};var t={},r=Object.keys(i),s,n;for(n=0;n<r.length;n++)s=r[n],!(e.indexOf(s)>=0)&&(t[s]=i[s]);return t}function zs(i,e){if(i==null)return{};var t=gL(i,e),r,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(i,r)&&(t[r]=i[r])}return t}var mL=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function yL(i){var e=i.defaultInputValue,t=e===void 0?"":e,r=i.defaultMenuIsOpen,s=r===void 0?!1:r,n=i.defaultValue,a=n===void 0?null:n,o=i.inputValue,l=i.menuIsOpen,h=i.onChange,u=i.onInputChange,c=i.onMenuClose,d=i.onMenuOpen,p=i.value,f=zs(i,mL),m=T.useState(o!==void 0?o:t),S=Ps(m,2),y=S[0],b=S[1],w=T.useState(l!==void 0?l:s),x=Ps(w,2),v=x[0],C=x[1],P=T.useState(p!==void 0?p:a),N=Ps(P,2),W=N[0],Y=N[1],me=T.useCallback(function(G,re){typeof h=="function"&&h(G,re),Y(G)},[h]),Ee=T.useCallback(function(G,re){var se;typeof u=="function"&&(se=u(G,re)),b(se!==void 0?se:G)},[u]),Xe=T.useCallback(function(){typeof d=="function"&&d(),C(!0)},[d]),je=T.useCallback(function(){typeof c=="function"&&c(),C(!1)},[c]),qe=o!==void 0?o:y,_e=l!==void 0?l:v,ot=p!==void 0?p:W;return ye(ye({},f),{},{inputValue:qe,menuIsOpen:_e,onChange:me,onInputChange:Ee,onMenuClose:je,onMenuOpen:Xe,value:ot})}function bL(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function j0(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,Ek(r.key),r)}}function wL(i,e,t){return e&&j0(i.prototype,e),t&&j0(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function Mp(i,e){return Mp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Mp(i,e)}function SL(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&Mp(i,e)}function Au(i){return Au=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Au(i)}function vL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function kL(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function xL(i,e){if(e&&(ta(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kL(i)}function BL(i){var e=vL();return function(){var r=Au(i),s;if(e){var n=Au(this).constructor;s=Reflect.construct(r,arguments,n)}else s=r.apply(this,arguments);return xL(this,s)}}function _L(i){if(Array.isArray(i))return Ep(i)}function TL(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function CL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xm(i){return _L(i)||TL(i)||Mk(i)||CL()}function NL(i,e){return e||(e=i.slice(0)),Object.freeze(Object.defineProperties(i,{raw:{value:Object.freeze(e)}}))}const PL=Math.min,EL=Math.max,Vu=Math.round,wh=Math.floor,Hu=i=>({x:i,y:i});function ML(i){const{x:e,y:t,width:r,height:s}=i;return{width:r,height:s,top:t,left:e,right:e+r,bottom:t+s,x:e,y:t}}function Lk(i){return Fk(i)?(i.nodeName||"").toLowerCase():"#document"}function Ds(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function Rk(i){var e;return(e=(Fk(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function Fk(i){return i instanceof Node||i instanceof Ds(i).Node}function LL(i){return i instanceof Element||i instanceof Ds(i).Element}function Bm(i){return i instanceof HTMLElement||i instanceof Ds(i).HTMLElement}function q0(i){return typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Ds(i).ShadowRoot}function Ik(i){const{overflow:e,overflowX:t,overflowY:r,display:s}=_m(i);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(s)}function RL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function FL(i){return["html","body","#document"].includes(Lk(i))}function _m(i){return Ds(i).getComputedStyle(i)}function IL(i){if(Lk(i)==="html")return i;const e=i.assignedSlot||i.parentNode||q0(i)&&i.host||Rk(i);return q0(e)?e.host:e}function Ok(i){const e=IL(i);return FL(e)?i.ownerDocument?i.ownerDocument.body:i.body:Bm(e)&&Ik(e)?e:Ok(e)}function Wu(i,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=Ok(i),n=s===((r=i.ownerDocument)==null?void 0:r.body),a=Ds(s);return n?e.concat(a,a.visualViewport||[],Ik(s)?s:[],a.frameElement&&t?Wu(a.frameElement):[]):e.concat(s,Wu(s,[],t))}function OL(i){const e=_m(i);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=Bm(i),n=s?i.offsetWidth:t,a=s?i.offsetHeight:r,o=Vu(t)!==n||Vu(r)!==a;return o&&(t=n,r=a),{width:t,height:r,$:o}}function Tm(i){return LL(i)?i:i.contextElement}function Q0(i){const e=Tm(i);if(!Bm(e))return Hu(1);const t=e.getBoundingClientRect(),{width:r,height:s,$:n}=OL(e);let a=(n?Vu(t.width):t.width)/r,o=(n?Vu(t.height):t.height)/s;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const DL=Hu(0);function AL(i){const e=Ds(i);return!RL()||!e.visualViewport?DL:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function VL(i,e,t){return!1}function K0(i,e,t,r){e===void 0&&(e=!1);const s=i.getBoundingClientRect(),n=Tm(i);let a=Hu(1);e&&(a=Q0(i));const o=VL()?AL(n):Hu(0);let l=(s.left+o.x)/a.x,h=(s.top+o.y)/a.y,u=s.width/a.x,c=s.height/a.y;if(n){const d=Ds(n),p=r;let f=d,m=f.frameElement;for(;m&&r&&p!==f;){const S=Q0(m),y=m.getBoundingClientRect(),b=_m(m),w=y.left+(m.clientLeft+parseFloat(b.paddingLeft))*S.x,x=y.top+(m.clientTop+parseFloat(b.paddingTop))*S.y;l*=S.x,h*=S.y,u*=S.x,c*=S.y,l+=w,h+=x,f=Ds(m),m=f.frameElement}}return ML({width:u,height:c,x:l,y:h})}function HL(i,e){let t=null,r;const s=Rk(i);function n(){var o;clearTimeout(r),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),n();const{left:h,top:u,width:c,height:d}=i.getBoundingClientRect();if(o||e(),!c||!d)return;const p=wh(u),f=wh(s.clientWidth-(h+c)),m=wh(s.clientHeight-(u+d)),S=wh(h),b={rootMargin:-p+"px "+-f+"px "+-m+"px "+-S+"px",threshold:EL(0,PL(1,l))||1};let w=!0;function x(v){const C=v[0].intersectionRatio;if(C!==l){if(!w)return a();C?a(!1,C):r=setTimeout(()=>{a(!1,1e-7)},1e3)}w=!1}try{t=new IntersectionObserver(x,{...b,root:s.ownerDocument})}catch{t=new IntersectionObserver(x,b)}t.observe(i)}return a(!0),n}function WL(i,e,t,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:n=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,h=Tm(i),u=s||n?[...h?Wu(h):[],...Wu(e)]:[];u.forEach(y=>{s&&y.addEventListener("scroll",t,{passive:!0}),n&&y.addEventListener("resize",t)});const c=h&&o?HL(h,t):null;let d=-1,p=null;a&&(p=new ResizeObserver(y=>{let[b]=y;b&&b.target===h&&p&&(p.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var w;(w=p)==null||w.observe(e)})),t()}),h&&!l&&p.observe(h),p.observe(e));let f,m=l?K0(i):null;l&&S();function S(){const y=K0(i);m&&(y.x!==m.x||y.y!==m.y||y.width!==m.width||y.height!==m.height)&&t(),m=y,f=requestAnimationFrame(S)}return t(),()=>{var y;u.forEach(b=>{s&&b.removeEventListener("scroll",t),n&&b.removeEventListener("resize",t)}),c==null||c(),(y=p)==null||y.disconnect(),p=null,l&&cancelAnimationFrame(f)}}var Lp=T.useLayoutEffect,zL=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],zu=function(){};function GL(i,e){return e?e[0]==="-"?i+e:i+"__"+e:i}function UL(i,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),s=2;s<t;s++)r[s-2]=arguments[s];var n=[].concat(r);if(e&&i)for(var a in e)e.hasOwnProperty(a)&&e[a]&&n.push("".concat(GL(i,a)));return n.filter(function(o){return o}).map(function(o){return String(o).trim()}).join(" ")}var J0=function(e){return ZL(e)?e.filter(Boolean):ta(e)==="object"&&e!==null?[e]:[]},Dk=function(e){e.className,e.clearValue,e.cx,e.getStyles,e.getClassNames,e.getValue,e.hasValue,e.isMulti,e.isRtl,e.options,e.selectOption,e.selectProps,e.setValue,e.theme;var t=zs(e,zL);return ye({},t)},Vt=function(e,t,r){var s=e.cx,n=e.getStyles,a=e.getClassNames,o=e.className;return{css:n(t,e),className:s(r??{},a(t,e),o)}};function Yc(i){return[document.documentElement,document.body,window].indexOf(i)>-1}function YL(i){return Yc(i)?window.innerHeight:i.clientHeight}function Ak(i){return Yc(i)?window.pageYOffset:i.scrollTop}function Gu(i,e){if(Yc(i)){window.scrollTo(0,e);return}i.scrollTop=e}function $L(i){var e=getComputedStyle(i),t=e.position==="absolute",r=/(auto|scroll)/;if(e.position==="fixed")return document.documentElement;for(var s=i;s=s.parentElement;)if(e=getComputedStyle(s),!(t&&e.position==="static")&&r.test(e.overflow+e.overflowY+e.overflowX))return s;return document.documentElement}function XL(i,e,t,r){return t*((i=i/r-1)*i*i+1)+e}function Sh(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:zu,s=Ak(i),n=e-s,a=10,o=0;function l(){o+=a;var h=XL(o,s,n,t);Gu(i,h),o<t?window.requestAnimationFrame(l):r(i)}l()}function Z0(i,e){var t=i.getBoundingClientRect(),r=e.getBoundingClientRect(),s=e.offsetHeight/3;r.bottom+s>t.bottom?Gu(i,Math.min(e.offsetTop+e.clientHeight-i.offsetHeight+s,i.scrollHeight)):r.top-s<t.top&&Gu(i,Math.max(e.offsetTop-s,0))}function jL(i){var e=i.getBoundingClientRect();return{bottom:e.bottom,height:e.height,left:e.left,right:e.right,top:e.top,width:e.width}}function e1(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function qL(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var Vk=!1,QL={get passive(){return Vk=!0}},vh=typeof window<"u"?window:{};vh.addEventListener&&vh.removeEventListener&&(vh.addEventListener("p",zu,QL),vh.removeEventListener("p",zu,!1));var KL=Vk;function JL(i){return i!=null}function ZL(i){return Array.isArray(i)}function kh(i,e,t){return i?e:t}var eR=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];var n=Object.entries(e).filter(function(a){var o=Ps(a,1),l=o[0];return!r.includes(l)});return n.reduce(function(a,o){var l=Ps(o,2),h=l[0],u=l[1];return a[h]=u,a},{})},tR=["children","innerProps"],iR=["children","innerProps"];function rR(i){var e=i.maxHeight,t=i.menuEl,r=i.minHeight,s=i.placement,n=i.shouldScroll,a=i.isFixedPosition,o=i.controlHeight,l=$L(t),h={placement:"bottom",maxHeight:e};if(!t||!t.offsetParent)return h;var u=l.getBoundingClientRect(),c=u.height,d=t.getBoundingClientRect(),p=d.bottom,f=d.height,m=d.top,S=t.offsetParent.getBoundingClientRect(),y=S.top,b=a?window.innerHeight:YL(l),w=Ak(l),x=parseInt(getComputedStyle(t).marginBottom,10),v=parseInt(getComputedStyle(t).marginTop,10),C=y-v,P=b-m,N=C+w,W=c-w-m,Y=p-b+w+x,me=w+m-v,Ee=160;switch(s){case"auto":case"bottom":if(P>=f)return{placement:"bottom",maxHeight:e};if(W>=f&&!a)return n&&Sh(l,Y,Ee),{placement:"bottom",maxHeight:e};if(!a&&W>=r||a&&P>=r){n&&Sh(l,Y,Ee);var Xe=a?P-x:W-x;return{placement:"bottom",maxHeight:Xe}}if(s==="auto"||a){var je=e,qe=a?C:N;return qe>=r&&(je=Math.min(qe-x-o,e)),{placement:"top",maxHeight:je}}if(s==="bottom")return n&&Gu(l,Y),{placement:"bottom",maxHeight:e};break;case"top":if(C>=f)return{placement:"top",maxHeight:e};if(N>=f&&!a)return n&&Sh(l,me,Ee),{placement:"top",maxHeight:e};if(!a&&N>=r||a&&C>=r){var _e=e;return(!a&&N>=r||a&&C>=r)&&(_e=a?C-v:N-v),n&&Sh(l,me,Ee),{placement:"top",maxHeight:_e}}return{placement:"bottom",maxHeight:e};default:throw new Error('Invalid placement provided "'.concat(s,'".'))}return h}function sR(i){var e={bottom:"top",top:"bottom"};return i?e[i]:"bottom"}var Hk=function(e){return e==="auto"?"bottom":e},nR=function(e,t){var r,s=e.placement,n=e.theme,a=n.borderRadius,o=n.spacing,l=n.colors;return ye((r={label:"menu"},Mo(r,sR(s),"100%"),Mo(r,"position","absolute"),Mo(r,"width","100%"),Mo(r,"zIndex",1),r),t?{}:{backgroundColor:l.neutral0,borderRadius:a,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:o.menuGutter,marginTop:o.menuGutter})},Wk=T.createContext(null),aR=function(e){var t=e.children,r=e.minMenuHeight,s=e.maxMenuHeight,n=e.menuPlacement,a=e.menuPosition,o=e.menuShouldScrollIntoView,l=e.theme,h=T.useContext(Wk)||{},u=h.setPortalPlacement,c=T.useRef(null),d=T.useState(s),p=Ps(d,2),f=p[0],m=p[1],S=T.useState(null),y=Ps(S,2),b=y[0],w=y[1],x=l.spacing.controlHeight;return Lp(function(){var v=c.current;if(v){var C=a==="fixed",P=o&&!C,N=rR({maxHeight:s,menuEl:v,minHeight:r,placement:n,shouldScroll:P,isFixedPosition:C,controlHeight:x});m(N.maxHeight),w(N.placement),u==null||u(N.placement)}},[s,n,a,o,r,u,x]),t({ref:c,placerProps:ye(ye({},e),{},{placement:b||Hk(n),maxHeight:f})})},oR=function(e){var t=e.children,r=e.innerRef,s=e.innerProps;return ge("div",Se({},Vt(e,"menu",{menu:!0}),{ref:r},s),t)},lR=oR,hR=function(e,t){var r=e.maxHeight,s=e.theme.spacing.baseUnit;return ye({maxHeight:r,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},t?{}:{paddingBottom:s,paddingTop:s})},uR=function(e){var t=e.children,r=e.innerProps,s=e.innerRef,n=e.isMulti;return ge("div",Se({},Vt(e,"menuList",{"menu-list":!0,"menu-list--is-multi":n}),{ref:s},r),t)},zk=function(e,t){var r=e.theme,s=r.spacing.baseUnit,n=r.colors;return ye({textAlign:"center"},t?{}:{color:n.neutral40,padding:"".concat(s*2,"px ").concat(s*3,"px")})},cR=zk,dR=zk,fR=function(e){var t=e.children,r=t===void 0?"No options":t,s=e.innerProps,n=zs(e,tR);return ge("div",Se({},Vt(ye(ye({},n),{},{children:r,innerProps:s}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),s),r)},pR=function(e){var t=e.children,r=t===void 0?"Loading...":t,s=e.innerProps,n=zs(e,iR);return ge("div",Se({},Vt(ye(ye({},n),{},{children:r,innerProps:s}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),s),r)},gR=function(e){var t=e.rect,r=e.offset,s=e.position;return{left:t.left,position:s,top:r,width:t.width,zIndex:1}},mR=function(e){var t=e.appendTo,r=e.children,s=e.controlElement,n=e.innerProps,a=e.menuPlacement,o=e.menuPosition,l=T.useRef(null),h=T.useRef(null),u=T.useState(Hk(a)),c=Ps(u,2),d=c[0],p=c[1],f=T.useMemo(function(){return{setPortalPlacement:p}},[]),m=T.useState(null),S=Ps(m,2),y=S[0],b=S[1],w=T.useCallback(function(){if(s){var P=jL(s),N=o==="fixed"?0:window.pageYOffset,W=P[d]+N;(W!==(y==null?void 0:y.offset)||P.left!==(y==null?void 0:y.rect.left)||P.width!==(y==null?void 0:y.rect.width))&&b({offset:W,rect:P})}},[s,o,d,y==null?void 0:y.offset,y==null?void 0:y.rect.left,y==null?void 0:y.rect.width]);Lp(function(){w()},[w]);var x=T.useCallback(function(){typeof h.current=="function"&&(h.current(),h.current=null),s&&l.current&&(h.current=WL(s,l.current,w,{elementResize:"ResizeObserver"in window}))},[s,w]);Lp(function(){x()},[x]);var v=T.useCallback(function(P){l.current=P,x()},[x]);if(!t&&o!=="fixed"||!y)return null;var C=ge("div",Se({ref:v},Vt(ye(ye({},e),{},{offset:y.offset,position:o,rect:y.rect}),"menuPortal",{"menu-portal":!0}),n),r);return ge(Wk.Provider,{value:f},t?yc.createPortal(C,t):C)},yR=function(e){var t=e.isDisabled,r=e.isRtl;return{label:"container",direction:r?"rtl":void 0,pointerEvents:t?"none":void 0,position:"relative"}},bR=function(e){var t=e.children,r=e.innerProps,s=e.isDisabled,n=e.isRtl;return ge("div",Se({},Vt(e,"container",{"--is-disabled":s,"--is-rtl":n}),r),t)},wR=function(e,t){var r=e.theme.spacing,s=e.isMulti,n=e.hasValue,a=e.selectProps.controlShouldRenderValue;return ye({alignItems:"center",display:s&&n&&a?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},t?{}:{padding:"".concat(r.baseUnit/2,"px ").concat(r.baseUnit*2,"px")})},SR=function(e){var t=e.children,r=e.innerProps,s=e.isMulti,n=e.hasValue;return ge("div",Se({},Vt(e,"valueContainer",{"value-container":!0,"value-container--is-multi":s,"value-container--has-value":n}),r),t)},vR=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},kR=function(e){var t=e.children,r=e.innerProps;return ge("div",Se({},Vt(e,"indicatorsContainer",{indicators:!0}),r),t)},t1,xR=["size"],BR=["innerProps","isRtl","size"],_R={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},Gk=function(e){var t=e.size,r=zs(e,xR);return ge("svg",Se({height:t,width:t,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:_R},r))},Cm=function(e){return ge(Gk,Se({size:20},e),ge("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},Uk=function(e){return ge(Gk,Se({size:20},e),ge("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},Yk=function(e,t){var r=e.isFocused,s=e.theme,n=s.spacing.baseUnit,a=s.colors;return ye({label:"indicatorContainer",display:"flex",transition:"color 150ms"},t?{}:{color:r?a.neutral60:a.neutral20,padding:n*2,":hover":{color:r?a.neutral80:a.neutral40}})},TR=Yk,CR=function(e){var t=e.children,r=e.innerProps;return ge("div",Se({},Vt(e,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),r),t||ge(Uk,null))},NR=Yk,PR=function(e){var t=e.children,r=e.innerProps;return ge("div",Se({},Vt(e,"clearIndicator",{indicator:!0,"clear-indicator":!0}),r),t||ge(Cm,null))},ER=function(e,t){var r=e.isDisabled,s=e.theme,n=s.spacing.baseUnit,a=s.colors;return ye({label:"indicatorSeparator",alignSelf:"stretch",width:1},t?{}:{backgroundColor:r?a.neutral10:a.neutral20,marginBottom:n*2,marginTop:n*2})},MR=function(e){var t=e.innerProps;return ge("span",Se({},t,Vt(e,"indicatorSeparator",{"indicator-separator":!0})))},LR=AE(t1||(t1=NL([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),RR=function(e,t){var r=e.isFocused,s=e.size,n=e.theme,a=n.colors,o=n.spacing.baseUnit;return ye({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:s,lineHeight:1,marginRight:s,textAlign:"center",verticalAlign:"middle"},t?{}:{color:r?a.neutral60:a.neutral20,padding:o*2})},Gd=function(e){var t=e.delay,r=e.offset;return ge("span",{css:Vc({animation:"".concat(LR," 1s ease-in-out ").concat(t,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:r?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},FR=function(e){var t=e.innerProps,r=e.isRtl,s=e.size,n=s===void 0?4:s,a=zs(e,BR);return ge("div",Se({},Vt(ye(ye({},a),{},{innerProps:t,isRtl:r,size:n}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),t),ge(Gd,{delay:0,offset:r}),ge(Gd,{delay:160,offset:!0}),ge(Gd,{delay:320,offset:!r}))},IR=function(e,t){var r=e.isDisabled,s=e.isFocused,n=e.theme,a=n.colors,o=n.borderRadius,l=n.spacing;return ye({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:l.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},t?{}:{backgroundColor:r?a.neutral5:a.neutral0,borderColor:r?a.neutral10:s?a.primary:a.neutral20,borderRadius:o,borderStyle:"solid",borderWidth:1,boxShadow:s?"0 0 0 1px ".concat(a.primary):void 0,"&:hover":{borderColor:s?a.primary:a.neutral30}})},OR=function(e){var t=e.children,r=e.isDisabled,s=e.isFocused,n=e.innerRef,a=e.innerProps,o=e.menuIsOpen;return ge("div",Se({ref:n},Vt(e,"control",{control:!0,"control--is-disabled":r,"control--is-focused":s,"control--menu-is-open":o}),a,{"aria-disabled":r||void 0}),t)},DR=OR,AR=["data"],VR=function(e,t){var r=e.theme.spacing;return t?{}:{paddingBottom:r.baseUnit*2,paddingTop:r.baseUnit*2}},HR=function(e){var t=e.children,r=e.cx,s=e.getStyles,n=e.getClassNames,a=e.Heading,o=e.headingProps,l=e.innerProps,h=e.label,u=e.theme,c=e.selectProps;return ge("div",Se({},Vt(e,"group",{group:!0}),l),ge(a,Se({},o,{selectProps:c,theme:u,getStyles:s,getClassNames:n,cx:r}),h),ge("div",null,t))},WR=function(e,t){var r=e.theme,s=r.colors,n=r.spacing;return ye({label:"group",cursor:"default",display:"block"},t?{}:{color:s.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:n.baseUnit*3,paddingRight:n.baseUnit*3,textTransform:"uppercase"})},zR=function(e){var t=Dk(e);t.data;var r=zs(t,AR);return ge("div",Se({},Vt(e,"groupHeading",{"group-heading":!0}),r))},GR=HR,UR=["innerRef","isDisabled","isHidden","inputClassName"],YR=function(e,t){var r=e.isDisabled,s=e.value,n=e.theme,a=n.spacing,o=n.colors;return ye(ye({visibility:r?"hidden":"visible",transform:s?"translateZ(0)":""},$R),t?{}:{margin:a.baseUnit/2,paddingBottom:a.baseUnit/2,paddingTop:a.baseUnit/2,color:o.neutral80})},$k={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},$R={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":ye({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},$k)},XR=function(e){return ye({label:"input",color:"inherit",background:0,opacity:e?0:1,width:"100%"},$k)},jR=function(e){var t=e.cx,r=e.value,s=Dk(e),n=s.innerRef,a=s.isDisabled,o=s.isHidden,l=s.inputClassName,h=zs(s,UR);return ge("div",Se({},Vt(e,"input",{"input-container":!0}),{"data-value":r||""}),ge("input",Se({className:t({input:!0},l),ref:n,style:XR(o),disabled:a},h)))},qR=jR,QR=function(e,t){var r=e.theme,s=r.spacing,n=r.borderRadius,a=r.colors;return ye({label:"multiValue",display:"flex",minWidth:0},t?{}:{backgroundColor:a.neutral10,borderRadius:n/2,margin:s.baseUnit/2})},KR=function(e,t){var r=e.theme,s=r.borderRadius,n=r.colors,a=e.cropWithEllipsis;return ye({overflow:"hidden",textOverflow:a||a===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},t?{}:{borderRadius:s/2,color:n.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},JR=function(e,t){var r=e.theme,s=r.spacing,n=r.borderRadius,a=r.colors,o=e.isFocused;return ye({alignItems:"center",display:"flex"},t?{}:{borderRadius:n/2,backgroundColor:o?a.dangerLight:void 0,paddingLeft:s.baseUnit,paddingRight:s.baseUnit,":hover":{backgroundColor:a.dangerLight,color:a.danger}})},Xk=function(e){var t=e.children,r=e.innerProps;return ge("div",r,t)},ZR=Xk,eF=Xk;function tF(i){var e=i.children,t=i.innerProps;return ge("div",Se({role:"button"},t),e||ge(Cm,{size:14}))}var iF=function(e){var t=e.children,r=e.components,s=e.data,n=e.innerProps,a=e.isDisabled,o=e.removeProps,l=e.selectProps,h=r.Container,u=r.Label,c=r.Remove;return ge(h,{data:s,innerProps:ye(ye({},Vt(e,"multiValue",{"multi-value":!0,"multi-value--is-disabled":a})),n),selectProps:l},ge(u,{data:s,innerProps:ye({},Vt(e,"multiValueLabel",{"multi-value__label":!0})),selectProps:l},t),ge(c,{data:s,innerProps:ye(ye({},Vt(e,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(t||"option")},o),selectProps:l}))},rF=iF,sF=function(e,t){var r=e.isDisabled,s=e.isFocused,n=e.isSelected,a=e.theme,o=a.spacing,l=a.colors;return ye({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},t?{}:{backgroundColor:n?l.primary:s?l.primary25:"transparent",color:r?l.neutral20:n?l.neutral0:"inherit",padding:"".concat(o.baseUnit*2,"px ").concat(o.baseUnit*3,"px"),":active":{backgroundColor:r?void 0:n?l.primary:l.primary50}})},nF=function(e){var t=e.children,r=e.isDisabled,s=e.isFocused,n=e.isSelected,a=e.innerRef,o=e.innerProps;return ge("div",Se({},Vt(e,"option",{option:!0,"option--is-disabled":r,"option--is-focused":s,"option--is-selected":n}),{ref:a,"aria-disabled":r},o),t)},aF=nF,oF=function(e,t){var r=e.theme,s=r.spacing,n=r.colors;return ye({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},t?{}:{color:n.neutral50,marginLeft:s.baseUnit/2,marginRight:s.baseUnit/2})},lF=function(e){var t=e.children,r=e.innerProps;return ge("div",Se({},Vt(e,"placeholder",{placeholder:!0}),r),t)},hF=lF,uF=function(e,t){var r=e.isDisabled,s=e.theme,n=s.spacing,a=s.colors;return ye({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},t?{}:{color:r?a.neutral40:a.neutral80,marginLeft:n.baseUnit/2,marginRight:n.baseUnit/2})},cF=function(e){var t=e.children,r=e.isDisabled,s=e.innerProps;return ge("div",Se({},Vt(e,"singleValue",{"single-value":!0,"single-value--is-disabled":r}),s),t)},dF=cF,fF={ClearIndicator:PR,Control:DR,DropdownIndicator:CR,DownChevron:Uk,CrossIcon:Cm,Group:GR,GroupHeading:zR,IndicatorsContainer:kR,IndicatorSeparator:MR,Input:qR,LoadingIndicator:FR,Menu:lR,MenuList:uR,MenuPortal:mR,LoadingMessage:pR,NoOptionsMessage:fR,MultiValue:rF,MultiValueContainer:ZR,MultiValueLabel:eF,MultiValueRemove:tF,Option:aF,Placeholder:hF,SelectContainer:bR,SingleValue:dF,ValueContainer:SR},pF=function(e){return ye(ye({},fF),e.components)},i1=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function gF(i,e){return!!(i===e||i1(i)&&i1(e))}function mF(i,e){if(i.length!==e.length)return!1;for(var t=0;t<i.length;t++)if(!gF(i[t],e[t]))return!1;return!0}function yF(i,e){e===void 0&&(e=mF);var t=null;function r(){for(var s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];if(t&&t.lastThis===this&&e(s,t.lastArgs))return t.lastResult;var a=i.apply(this,s);return t={lastResult:a,lastArgs:s,lastThis:this},a}return r.clear=function(){t=null},r}var bF={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},wF=function(e){return ge("span",Se({css:bF},e))},r1=wF,SF={guidance:function(e){var t=e.isSearchable,r=e.isMulti,s=e.tabSelectsValue,n=e.context,a=e.isInitialFocus;switch(n){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(s?", press Tab to select the option and exit the menu":"",".");case"input":return a?"".concat(e["aria-label"]||"Select"," is focused ").concat(t?",type to refine list":"",", press Down to open the menu, ").concat(r?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(e){var t=e.action,r=e.label,s=r===void 0?"":r,n=e.labels,a=e.isDisabled;switch(t){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(s,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(n.length>1?"s":""," ").concat(n.join(","),", selected.");case"select-option":return a?"option ".concat(s," is disabled. Select another option."):"option ".concat(s,", selected.");default:return""}},onFocus:function(e){var t=e.context,r=e.focused,s=e.options,n=e.label,a=n===void 0?"":n,o=e.selectValue,l=e.isDisabled,h=e.isSelected,u=e.isAppleDevice,c=function(m,S){return m&&m.length?"".concat(m.indexOf(S)+1," of ").concat(m.length):""};if(t==="value"&&o)return"value ".concat(a," focused, ").concat(c(o,r),".");if(t==="menu"&&u){var d=l?" disabled":"",p="".concat(h?" selected":"").concat(d);return"".concat(a).concat(p,", ").concat(c(s,r),".")}return""},onFilter:function(e){var t=e.inputValue,r=e.resultsMessage;return"".concat(r).concat(t?" for search term "+t:"",".")}},vF=function(e){var t=e.ariaSelection,r=e.focusedOption,s=e.focusedValue,n=e.focusableOptions,a=e.isFocused,o=e.selectValue,l=e.selectProps,h=e.id,u=e.isAppleDevice,c=l.ariaLiveMessages,d=l.getOptionLabel,p=l.inputValue,f=l.isMulti,m=l.isOptionDisabled,S=l.isSearchable,y=l.menuIsOpen,b=l.options,w=l.screenReaderStatus,x=l.tabSelectsValue,v=l.isLoading,C=l["aria-label"],P=l["aria-live"],N=T.useMemo(function(){return ye(ye({},SF),c||{})},[c]),W=T.useMemo(function(){var qe="";if(t&&N.onChange){var _e=t.option,ot=t.options,G=t.removedValue,re=t.removedValues,se=t.value,we=function(Ni){return Array.isArray(Ni)?null:Ni},Z=G||_e||we(se),ze=Z?d(Z):"",Qe=ot||re||void 0,Ve=Qe?Qe.map(d):[],pt=ye({isDisabled:Z&&m(Z,o),label:ze,labels:Ve},t);qe=N.onChange(pt)}return qe},[t,N,m,o,d]),Y=T.useMemo(function(){var qe="",_e=r||s,ot=!!(r&&o&&o.includes(r));if(_e&&N.onFocus){var G={focused:_e,label:d(_e),isDisabled:m(_e,o),isSelected:ot,options:n,context:_e===r?"menu":"value",selectValue:o,isAppleDevice:u};qe=N.onFocus(G)}return qe},[r,s,d,m,N,n,o,u]),me=T.useMemo(function(){var qe="";if(y&&b.length&&!v&&N.onFilter){var _e=w({count:n.length});qe=N.onFilter({inputValue:p,resultsMessage:_e})}return qe},[n,p,y,N,b,w,v]),Ee=(t==null?void 0:t.action)==="initial-input-focus",Xe=T.useMemo(function(){var qe="";if(N.guidance){var _e=s?"value":y?"menu":"input";qe=N.guidance({"aria-label":C,context:_e,isDisabled:r&&m(r,o),isMulti:f,isSearchable:S,tabSelectsValue:x,isInitialFocus:Ee})}return qe},[C,r,s,f,m,S,y,N,o,x,Ee]),je=ge(T.Fragment,null,ge("span",{id:"aria-selection"},W),ge("span",{id:"aria-focused"},Y),ge("span",{id:"aria-results"},me),ge("span",{id:"aria-guidance"},Xe));return ge(T.Fragment,null,ge(r1,{id:h},Ee&&je),ge(r1,{"aria-live":P,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},a&&!Ee&&je))},kF=vF,Rp=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],xF=new RegExp("["+Rp.map(function(i){return i.letters}).join("")+"]","g"),jk={};for(var Ud=0;Ud<Rp.length;Ud++)for(var Yd=Rp[Ud],$d=0;$d<Yd.letters.length;$d++)jk[Yd.letters[$d]]=Yd.base;var qk=function(e){return e.replace(xF,function(t){return jk[t]})},BF=yF(qk),s1=function(e){return e.replace(/^\s+|\s+$/g,"")},_F=function(e){return"".concat(e.label," ").concat(e.value)},TF=function(e){return function(t,r){if(t.data.__isNew__)return!0;var s=ye({ignoreCase:!0,ignoreAccents:!0,stringify:_F,trim:!0,matchFrom:"any"},e),n=s.ignoreCase,a=s.ignoreAccents,o=s.stringify,l=s.trim,h=s.matchFrom,u=l?s1(r):r,c=l?s1(o(t)):o(t);return n&&(u=u.toLowerCase(),c=c.toLowerCase()),a&&(u=BF(u),c=qk(c)),h==="start"?c.substr(0,u.length)===u:c.indexOf(u)>-1}},CF=["innerRef"];function NF(i){var e=i.innerRef,t=zs(i,CF),r=eR(t,"onExited","in","enter","exit","appear");return ge("input",Se({ref:e},r,{css:Vc({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var PF=function(e){e.cancelable&&e.preventDefault(),e.stopPropagation()};function EF(i){var e=i.isEnabled,t=i.onBottomArrive,r=i.onBottomLeave,s=i.onTopArrive,n=i.onTopLeave,a=T.useRef(!1),o=T.useRef(!1),l=T.useRef(0),h=T.useRef(null),u=T.useCallback(function(S,y){if(h.current!==null){var b=h.current,w=b.scrollTop,x=b.scrollHeight,v=b.clientHeight,C=h.current,P=y>0,N=x-v-w,W=!1;N>y&&a.current&&(r&&r(S),a.current=!1),P&&o.current&&(n&&n(S),o.current=!1),P&&y>N?(t&&!a.current&&t(S),C.scrollTop=x,W=!0,a.current=!0):!P&&-y>w&&(s&&!o.current&&s(S),C.scrollTop=0,W=!0,o.current=!0),W&&PF(S)}},[t,r,s,n]),c=T.useCallback(function(S){u(S,S.deltaY)},[u]),d=T.useCallback(function(S){l.current=S.changedTouches[0].clientY},[]),p=T.useCallback(function(S){var y=l.current-S.changedTouches[0].clientY;u(S,y)},[u]),f=T.useCallback(function(S){if(S){var y=KL?{passive:!1}:!1;S.addEventListener("wheel",c,y),S.addEventListener("touchstart",d,y),S.addEventListener("touchmove",p,y)}},[p,d,c]),m=T.useCallback(function(S){S&&(S.removeEventListener("wheel",c,!1),S.removeEventListener("touchstart",d,!1),S.removeEventListener("touchmove",p,!1))},[p,d,c]);return T.useEffect(function(){if(e){var S=h.current;return f(S),function(){m(S)}}},[e,f,m]),function(S){h.current=S}}var n1=["boxSizing","height","overflow","paddingRight","position"],a1={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function o1(i){i.preventDefault()}function l1(i){i.stopPropagation()}function h1(){var i=this.scrollTop,e=this.scrollHeight,t=i+this.offsetHeight;i===0?this.scrollTop=1:t===e&&(this.scrollTop=i-1)}function u1(){return"ontouchstart"in window||navigator.maxTouchPoints}var c1=!!(typeof window<"u"&&window.document&&window.document.createElement),ko=0,pa={capture:!1,passive:!1};function MF(i){var e=i.isEnabled,t=i.accountForScrollbars,r=t===void 0?!0:t,s=T.useRef({}),n=T.useRef(null),a=T.useCallback(function(l){if(c1){var h=document.body,u=h&&h.style;if(r&&n1.forEach(function(f){var m=u&&u[f];s.current[f]=m}),r&&ko<1){var c=parseInt(s.current.paddingRight,10)||0,d=document.body?document.body.clientWidth:0,p=window.innerWidth-d+c||0;Object.keys(a1).forEach(function(f){var m=a1[f];u&&(u[f]=m)}),u&&(u.paddingRight="".concat(p,"px"))}h&&u1()&&(h.addEventListener("touchmove",o1,pa),l&&(l.addEventListener("touchstart",h1,pa),l.addEventListener("touchmove",l1,pa))),ko+=1}},[r]),o=T.useCallback(function(l){if(c1){var h=document.body,u=h&&h.style;ko=Math.max(ko-1,0),r&&ko<1&&n1.forEach(function(c){var d=s.current[c];u&&(u[c]=d)}),h&&u1()&&(h.removeEventListener("touchmove",o1,pa),l&&(l.removeEventListener("touchstart",h1,pa),l.removeEventListener("touchmove",l1,pa)))}},[r]);return T.useEffect(function(){if(e){var l=n.current;return a(l),function(){o(l)}}},[e,a,o]),function(l){n.current=l}}var LF=function(e){var t=e.target;return t.ownerDocument.activeElement&&t.ownerDocument.activeElement.blur()},RF={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function FF(i){var e=i.children,t=i.lockEnabled,r=i.captureEnabled,s=r===void 0?!0:r,n=i.onBottomArrive,a=i.onBottomLeave,o=i.onTopArrive,l=i.onTopLeave,h=EF({isEnabled:s,onBottomArrive:n,onBottomLeave:a,onTopArrive:o,onTopLeave:l}),u=MF({isEnabled:t}),c=function(p){h(p),u(p)};return ge(T.Fragment,null,t&&ge("div",{onClick:LF,css:RF}),e(c))}var IF={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},OF=function(e){var t=e.name,r=e.onFocus;return ge("input",{required:!0,name:t,tabIndex:-1,"aria-hidden":"true",onFocus:r,css:IF,value:"",onChange:function(){}})},DF=OF;function Nm(i){var e;return typeof window<"u"&&window.navigator!=null?i.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function AF(){return Nm(/^iPhone/i)}function Qk(){return Nm(/^Mac/i)}function VF(){return Nm(/^iPad/i)||Qk()&&navigator.maxTouchPoints>1}function HF(){return AF()||VF()}function WF(){return Qk()||HF()}var zF=function(e){return e.label},GF=function(e){return e.label},UF=function(e){return e.value},YF=function(e){return!!e.isDisabled},$F={clearIndicator:NR,container:yR,control:IR,dropdownIndicator:TR,group:VR,groupHeading:WR,indicatorsContainer:vR,indicatorSeparator:ER,input:YR,loadingIndicator:RR,loadingMessage:dR,menu:nR,menuList:hR,menuPortal:gR,multiValue:QR,multiValueLabel:KR,multiValueRemove:JR,noOptionsMessage:cR,option:sF,placeholder:oF,singleValue:uF,valueContainer:wR},XF={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},jF=4,Kk=4,qF=38,QF=Kk*2,KF={baseUnit:Kk,controlHeight:qF,menuGutter:QF},Xd={borderRadius:jF,colors:XF,spacing:KF},JF={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:e1(),captureMenuScroll:!e1(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:TF(),formatGroupLabel:zF,getOptionLabel:GF,getOptionValue:UF,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:YF,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!qL(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(e){var t=e.count;return"".concat(t," result").concat(t!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function d1(i,e,t,r){var s=ex(i,e,t),n=tx(i,e,t),a=Zk(i,e),o=Uu(i,e);return{type:"option",data:e,isDisabled:s,isSelected:n,label:a,value:o,index:r}}function eu(i,e){return i.options.map(function(t,r){if("options"in t){var s=t.options.map(function(a,o){return d1(i,a,e,o)}).filter(function(a){return p1(i,a)});return s.length>0?{type:"group",data:t,options:s,index:r}:void 0}var n=d1(i,t,e,r);return p1(i,n)?n:void 0}).filter(JL)}function Jk(i){return i.reduce(function(e,t){return t.type==="group"?e.push.apply(e,xm(t.options.map(function(r){return r.data}))):e.push(t.data),e},[])}function f1(i,e){return i.reduce(function(t,r){return r.type==="group"?t.push.apply(t,xm(r.options.map(function(s){return{data:s.data,id:"".concat(e,"-").concat(r.index,"-").concat(s.index)}}))):t.push({data:r.data,id:"".concat(e,"-").concat(r.index)}),t},[])}function ZF(i,e){return Jk(eu(i,e))}function p1(i,e){var t=i.inputValue,r=t===void 0?"":t,s=e.data,n=e.isSelected,a=e.label,o=e.value;return(!rx(i)||!n)&&ix(i,{label:a,value:o,data:s},r)}function eI(i,e){var t=i.focusedValue,r=i.selectValue,s=r.indexOf(t);if(s>-1){var n=e.indexOf(t);if(n>-1)return t;if(s<e.length)return e[s]}return null}function tI(i,e){var t=i.focusedOption;return t&&e.indexOf(t)>-1?t:e[0]}var jd=function(e,t){var r,s=(r=e.find(function(n){return n.data===t}))===null||r===void 0?void 0:r.id;return s||null},Zk=function(e,t){return e.getOptionLabel(t)},Uu=function(e,t){return e.getOptionValue(t)};function ex(i,e,t){return typeof i.isOptionDisabled=="function"?i.isOptionDisabled(e,t):!1}function tx(i,e,t){if(t.indexOf(e)>-1)return!0;if(typeof i.isOptionSelected=="function")return i.isOptionSelected(e,t);var r=Uu(i,e);return t.some(function(s){return Uu(i,s)===r})}function ix(i,e,t){return i.filterOption?i.filterOption(e,t):!0}var rx=function(e){var t=e.hideSelectedOptions,r=e.isMulti;return t===void 0?r:t},iI=1,sx=function(i){SL(t,i);var e=BL(t);function t(r){var s;if(bL(this,t),s=e.call(this,r),s.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:""},s.blockOptionHover=!1,s.isComposing=!1,s.commonProps=void 0,s.initialTouchX=0,s.initialTouchY=0,s.openAfterFocus=!1,s.scrollToFocusedOptionOnUpdate=!1,s.userIsDragging=void 0,s.isAppleDevice=WF(),s.controlRef=null,s.getControlRef=function(l){s.controlRef=l},s.focusedOptionRef=null,s.getFocusedOptionRef=function(l){s.focusedOptionRef=l},s.menuListRef=null,s.getMenuListRef=function(l){s.menuListRef=l},s.inputRef=null,s.getInputRef=function(l){s.inputRef=l},s.focus=s.focusInput,s.blur=s.blurInput,s.onChange=function(l,h){var u=s.props,c=u.onChange,d=u.name;h.name=d,s.ariaOnChange(l,h),c(l,h)},s.setValue=function(l,h,u){var c=s.props,d=c.closeMenuOnSelect,p=c.isMulti,f=c.inputValue;s.onInputChange("",{action:"set-value",prevInputValue:f}),d&&(s.setState({inputIsHiddenAfterUpdate:!p}),s.onMenuClose()),s.setState({clearFocusValueOnUpdate:!0}),s.onChange(l,{action:h,option:u})},s.selectOption=function(l){var h=s.props,u=h.blurInputOnSelect,c=h.isMulti,d=h.name,p=s.state.selectValue,f=c&&s.isOptionSelected(l,p),m=s.isOptionDisabled(l,p);if(f){var S=s.getOptionValue(l);s.setValue(p.filter(function(y){return s.getOptionValue(y)!==S}),"deselect-option",l)}else if(!m)c?s.setValue([].concat(xm(p),[l]),"select-option",l):s.setValue(l,"select-option");else{s.ariaOnChange(l,{action:"select-option",option:l,name:d});return}u&&s.blurInput()},s.removeValue=function(l){var h=s.props.isMulti,u=s.state.selectValue,c=s.getOptionValue(l),d=u.filter(function(f){return s.getOptionValue(f)!==c}),p=kh(h,d,d[0]||null);s.onChange(p,{action:"remove-value",removedValue:l}),s.focusInput()},s.clearValue=function(){var l=s.state.selectValue;s.onChange(kh(s.props.isMulti,[],null),{action:"clear",removedValues:l})},s.popValue=function(){var l=s.props.isMulti,h=s.state.selectValue,u=h[h.length-1],c=h.slice(0,h.length-1),d=kh(l,c,c[0]||null);s.onChange(d,{action:"pop-value",removedValue:u})},s.getFocusedOptionId=function(l){return jd(s.state.focusableOptionsWithIds,l)},s.getFocusableOptionsWithIds=function(){return f1(eu(s.props,s.state.selectValue),s.getElementId("option"))},s.getValue=function(){return s.state.selectValue},s.cx=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];return UL.apply(void 0,[s.props.classNamePrefix].concat(h))},s.getOptionLabel=function(l){return Zk(s.props,l)},s.getOptionValue=function(l){return Uu(s.props,l)},s.getStyles=function(l,h){var u=s.props.unstyled,c=$F[l](h,u);c.boxSizing="border-box";var d=s.props.styles[l];return d?d(c,h):c},s.getClassNames=function(l,h){var u,c;return(u=(c=s.props.classNames)[l])===null||u===void 0?void 0:u.call(c,h)},s.getElementId=function(l){return"".concat(s.state.instancePrefix,"-").concat(l)},s.getComponents=function(){return pF(s.props)},s.buildCategorizedOptions=function(){return eu(s.props,s.state.selectValue)},s.getCategorizedOptions=function(){return s.props.menuIsOpen?s.buildCategorizedOptions():[]},s.buildFocusableOptions=function(){return Jk(s.buildCategorizedOptions())},s.getFocusableOptions=function(){return s.props.menuIsOpen?s.buildFocusableOptions():[]},s.ariaOnChange=function(l,h){s.setState({ariaSelection:ye({value:l},h)})},s.onMenuMouseDown=function(l){l.button===0&&(l.stopPropagation(),l.preventDefault(),s.focusInput())},s.onMenuMouseMove=function(l){s.blockOptionHover=!1},s.onControlMouseDown=function(l){if(!l.defaultPrevented){var h=s.props.openMenuOnClick;s.state.isFocused?s.props.menuIsOpen?l.target.tagName!=="INPUT"&&l.target.tagName!=="TEXTAREA"&&s.onMenuClose():h&&s.openMenu("first"):(h&&(s.openAfterFocus=!0),s.focusInput()),l.target.tagName!=="INPUT"&&l.target.tagName!=="TEXTAREA"&&l.preventDefault()}},s.onDropdownIndicatorMouseDown=function(l){if(!(l&&l.type==="mousedown"&&l.button!==0)&&!s.props.isDisabled){var h=s.props,u=h.isMulti,c=h.menuIsOpen;s.focusInput(),c?(s.setState({inputIsHiddenAfterUpdate:!u}),s.onMenuClose()):s.openMenu("first"),l.preventDefault()}},s.onClearIndicatorMouseDown=function(l){l&&l.type==="mousedown"&&l.button!==0||(s.clearValue(),l.preventDefault(),s.openAfterFocus=!1,l.type==="touchend"?s.focusInput():setTimeout(function(){return s.focusInput()}))},s.onScroll=function(l){typeof s.props.closeMenuOnScroll=="boolean"?l.target instanceof HTMLElement&&Yc(l.target)&&s.props.onMenuClose():typeof s.props.closeMenuOnScroll=="function"&&s.props.closeMenuOnScroll(l)&&s.props.onMenuClose()},s.onCompositionStart=function(){s.isComposing=!0},s.onCompositionEnd=function(){s.isComposing=!1},s.onTouchStart=function(l){var h=l.touches,u=h&&h.item(0);u&&(s.initialTouchX=u.clientX,s.initialTouchY=u.clientY,s.userIsDragging=!1)},s.onTouchMove=function(l){var h=l.touches,u=h&&h.item(0);if(u){var c=Math.abs(u.clientX-s.initialTouchX),d=Math.abs(u.clientY-s.initialTouchY),p=5;s.userIsDragging=c>p||d>p}},s.onTouchEnd=function(l){s.userIsDragging||(s.controlRef&&!s.controlRef.contains(l.target)&&s.menuListRef&&!s.menuListRef.contains(l.target)&&s.blurInput(),s.initialTouchX=0,s.initialTouchY=0)},s.onControlTouchEnd=function(l){s.userIsDragging||s.onControlMouseDown(l)},s.onClearIndicatorTouchEnd=function(l){s.userIsDragging||s.onClearIndicatorMouseDown(l)},s.onDropdownIndicatorTouchEnd=function(l){s.userIsDragging||s.onDropdownIndicatorMouseDown(l)},s.handleInputChange=function(l){var h=s.props.inputValue,u=l.currentTarget.value;s.setState({inputIsHiddenAfterUpdate:!1}),s.onInputChange(u,{action:"input-change",prevInputValue:h}),s.props.menuIsOpen||s.onMenuOpen()},s.onInputFocus=function(l){s.props.onFocus&&s.props.onFocus(l),s.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(s.openAfterFocus||s.props.openMenuOnFocus)&&s.openMenu("first"),s.openAfterFocus=!1},s.onInputBlur=function(l){var h=s.props.inputValue;if(s.menuListRef&&s.menuListRef.contains(document.activeElement)){s.inputRef.focus();return}s.props.onBlur&&s.props.onBlur(l),s.onInputChange("",{action:"input-blur",prevInputValue:h}),s.onMenuClose(),s.setState({focusedValue:null,isFocused:!1})},s.onOptionHover=function(l){if(!(s.blockOptionHover||s.state.focusedOption===l)){var h=s.getFocusableOptions(),u=h.indexOf(l);s.setState({focusedOption:l,focusedOptionId:u>-1?s.getFocusedOptionId(l):null})}},s.shouldHideSelectedOptions=function(){return rx(s.props)},s.onValueInputFocus=function(l){l.preventDefault(),l.stopPropagation(),s.focus()},s.onKeyDown=function(l){var h=s.props,u=h.isMulti,c=h.backspaceRemovesValue,d=h.escapeClearsValue,p=h.inputValue,f=h.isClearable,m=h.isDisabled,S=h.menuIsOpen,y=h.onKeyDown,b=h.tabSelectsValue,w=h.openMenuOnFocus,x=s.state,v=x.focusedOption,C=x.focusedValue,P=x.selectValue;if(!m&&!(typeof y=="function"&&(y(l),l.defaultPrevented))){switch(s.blockOptionHover=!0,l.key){case"ArrowLeft":if(!u||p)return;s.focusValue("previous");break;case"ArrowRight":if(!u||p)return;s.focusValue("next");break;case"Delete":case"Backspace":if(p)return;if(C)s.removeValue(C);else{if(!c)return;u?s.popValue():f&&s.clearValue()}break;case"Tab":if(s.isComposing||l.shiftKey||!S||!b||!v||w&&s.isOptionSelected(v,P))return;s.selectOption(v);break;case"Enter":if(l.keyCode===229)break;if(S){if(!v||s.isComposing)return;s.selectOption(v);break}return;case"Escape":S?(s.setState({inputIsHiddenAfterUpdate:!1}),s.onInputChange("",{action:"menu-close",prevInputValue:p}),s.onMenuClose()):f&&d&&s.clearValue();break;case" ":if(p)return;if(!S){s.openMenu("first");break}if(!v)return;s.selectOption(v);break;case"ArrowUp":S?s.focusOption("up"):s.openMenu("last");break;case"ArrowDown":S?s.focusOption("down"):s.openMenu("first");break;case"PageUp":if(!S)return;s.focusOption("pageup");break;case"PageDown":if(!S)return;s.focusOption("pagedown");break;case"Home":if(!S)return;s.focusOption("first");break;case"End":if(!S)return;s.focusOption("last");break;default:return}l.preventDefault()}},s.state.instancePrefix="react-select-"+(s.props.instanceId||++iI),s.state.selectValue=J0(r.value),r.menuIsOpen&&s.state.selectValue.length){var n=s.getFocusableOptionsWithIds(),a=s.buildFocusableOptions(),o=a.indexOf(s.state.selectValue[0]);s.state.focusableOptionsWithIds=n,s.state.focusedOption=a[o],s.state.focusedOptionId=jd(n,a[o])}return s}return wL(t,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&Z0(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(s){var n=this.props,a=n.isDisabled,o=n.menuIsOpen,l=this.state.isFocused;(l&&!a&&s.isDisabled||l&&o&&!s.menuIsOpen)&&this.focusInput(),l&&a&&!s.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!l&&!a&&s.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(Z0(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(s,n){this.props.onInputChange(s,n)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(s){var n=this,a=this.state,o=a.selectValue,l=a.isFocused,h=this.buildFocusableOptions(),u=s==="first"?0:h.length-1;if(!this.props.isMulti){var c=h.indexOf(o[0]);c>-1&&(u=c)}this.scrollToFocusedOptionOnUpdate=!(l&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:h[u],focusedOptionId:this.getFocusedOptionId(h[u])},function(){return n.onMenuOpen()})}},{key:"focusValue",value:function(s){var n=this.state,a=n.selectValue,o=n.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var l=a.indexOf(o);o||(l=-1);var h=a.length-1,u=-1;if(a.length){switch(s){case"previous":l===0?u=0:l===-1?u=h:u=l-1;break;case"next":l>-1&&l<h&&(u=l+1);break}this.setState({inputIsHidden:u!==-1,focusedValue:a[u]})}}}},{key:"focusOption",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",n=this.props.pageSize,a=this.state.focusedOption,o=this.getFocusableOptions();if(o.length){var l=0,h=o.indexOf(a);a||(h=-1),s==="up"?l=h>0?h-1:o.length-1:s==="down"?l=(h+1)%o.length:s==="pageup"?(l=h-n,l<0&&(l=0)):s==="pagedown"?(l=h+n,l>o.length-1&&(l=o.length-1)):s==="last"&&(l=o.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:o[l],focusedValue:null,focusedOptionId:this.getFocusedOptionId(o[l])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(Xd):ye(ye({},Xd),this.props.theme):Xd}},{key:"getCommonProps",value:function(){var s=this.clearValue,n=this.cx,a=this.getStyles,o=this.getClassNames,l=this.getValue,h=this.selectOption,u=this.setValue,c=this.props,d=c.isMulti,p=c.isRtl,f=c.options,m=this.hasValue();return{clearValue:s,cx:n,getStyles:a,getClassNames:o,getValue:l,hasValue:m,isMulti:d,isRtl:p,options:f,selectOption:h,selectProps:c,setValue:u,theme:this.getTheme()}}},{key:"hasValue",value:function(){var s=this.state.selectValue;return s.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var s=this.props,n=s.isClearable,a=s.isMulti;return n===void 0?a:n}},{key:"isOptionDisabled",value:function(s,n){return ex(this.props,s,n)}},{key:"isOptionSelected",value:function(s,n){return tx(this.props,s,n)}},{key:"filterOption",value:function(s,n){return ix(this.props,s,n)}},{key:"formatOptionLabel",value:function(s,n){if(typeof this.props.formatOptionLabel=="function"){var a=this.props.inputValue,o=this.state.selectValue;return this.props.formatOptionLabel(s,{context:n,inputValue:a,selectValue:o})}else return this.getOptionLabel(s)}},{key:"formatGroupLabel",value:function(s){return this.props.formatGroupLabel(s)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var s=this.props,n=s.isDisabled,a=s.isSearchable,o=s.inputId,l=s.inputValue,h=s.tabIndex,u=s.form,c=s.menuIsOpen,d=s.required,p=this.getComponents(),f=p.Input,m=this.state,S=m.inputIsHidden,y=m.ariaSelection,b=this.commonProps,w=o||this.getElementId("input"),x=ye(ye(ye({"aria-autocomplete":"list","aria-expanded":c,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":d,role:"combobox","aria-activedescendant":this.isAppleDevice?void 0:this.state.focusedOptionId||""},c&&{"aria-controls":this.getElementId("listbox")}),!a&&{"aria-readonly":!0}),this.hasValue()?(y==null?void 0:y.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return a?T.createElement(f,Se({},b,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:w,innerRef:this.getInputRef,isDisabled:n,isHidden:S,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:h,form:u,type:"text",value:l},x)):T.createElement(NF,Se({id:w,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:zu,onFocus:this.onInputFocus,disabled:n,tabIndex:h,inputMode:"none",form:u,value:""},x))}},{key:"renderPlaceholderOrValue",value:function(){var s=this,n=this.getComponents(),a=n.MultiValue,o=n.MultiValueContainer,l=n.MultiValueLabel,h=n.MultiValueRemove,u=n.SingleValue,c=n.Placeholder,d=this.commonProps,p=this.props,f=p.controlShouldRenderValue,m=p.isDisabled,S=p.isMulti,y=p.inputValue,b=p.placeholder,w=this.state,x=w.selectValue,v=w.focusedValue,C=w.isFocused;if(!this.hasValue()||!f)return y?null:T.createElement(c,Se({},d,{key:"placeholder",isDisabled:m,isFocused:C,innerProps:{id:this.getElementId("placeholder")}}),b);if(S)return x.map(function(N,W){var Y=N===v,me="".concat(s.getOptionLabel(N),"-").concat(s.getOptionValue(N));return T.createElement(a,Se({},d,{components:{Container:o,Label:l,Remove:h},isFocused:Y,isDisabled:m,key:me,index:W,removeProps:{onClick:function(){return s.removeValue(N)},onTouchEnd:function(){return s.removeValue(N)},onMouseDown:function(Xe){Xe.preventDefault()}},data:N}),s.formatOptionLabel(N,"value"))});if(y)return null;var P=x[0];return T.createElement(u,Se({},d,{data:P,isDisabled:m}),this.formatOptionLabel(P,"value"))}},{key:"renderClearIndicator",value:function(){var s=this.getComponents(),n=s.ClearIndicator,a=this.commonProps,o=this.props,l=o.isDisabled,h=o.isLoading,u=this.state.isFocused;if(!this.isClearable()||!n||l||!this.hasValue()||h)return null;var c={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return T.createElement(n,Se({},a,{innerProps:c,isFocused:u}))}},{key:"renderLoadingIndicator",value:function(){var s=this.getComponents(),n=s.LoadingIndicator,a=this.commonProps,o=this.props,l=o.isDisabled,h=o.isLoading,u=this.state.isFocused;if(!n||!h)return null;var c={"aria-hidden":"true"};return T.createElement(n,Se({},a,{innerProps:c,isDisabled:l,isFocused:u}))}},{key:"renderIndicatorSeparator",value:function(){var s=this.getComponents(),n=s.DropdownIndicator,a=s.IndicatorSeparator;if(!n||!a)return null;var o=this.commonProps,l=this.props.isDisabled,h=this.state.isFocused;return T.createElement(a,Se({},o,{isDisabled:l,isFocused:h}))}},{key:"renderDropdownIndicator",value:function(){var s=this.getComponents(),n=s.DropdownIndicator;if(!n)return null;var a=this.commonProps,o=this.props.isDisabled,l=this.state.isFocused,h={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return T.createElement(n,Se({},a,{innerProps:h,isDisabled:o,isFocused:l}))}},{key:"renderMenu",value:function(){var s=this,n=this.getComponents(),a=n.Group,o=n.GroupHeading,l=n.Menu,h=n.MenuList,u=n.MenuPortal,c=n.LoadingMessage,d=n.NoOptionsMessage,p=n.Option,f=this.commonProps,m=this.state.focusedOption,S=this.props,y=S.captureMenuScroll,b=S.inputValue,w=S.isLoading,x=S.loadingMessage,v=S.minMenuHeight,C=S.maxMenuHeight,P=S.menuIsOpen,N=S.menuPlacement,W=S.menuPosition,Y=S.menuPortalTarget,me=S.menuShouldBlockScroll,Ee=S.menuShouldScrollIntoView,Xe=S.noOptionsMessage,je=S.onMenuScrollToTop,qe=S.onMenuScrollToBottom;if(!P)return null;var _e=function(ze,Qe){var Ve=ze.type,pt=ze.data,wt=ze.isDisabled,Ni=ze.isSelected,ei=ze.label,ca=ze.value,da=m===pt,ps=wt?void 0:function(){return s.onOptionHover(pt)},gs=wt?void 0:function(){return s.selectOption(pt)},Pi="".concat(s.getElementId("option"),"-").concat(Qe),vr={id:Pi,onClick:gs,onMouseMove:ps,onMouseOver:ps,tabIndex:-1,role:"option","aria-selected":s.isAppleDevice?void 0:Ni};return T.createElement(p,Se({},f,{innerProps:vr,data:pt,isDisabled:wt,isSelected:Ni,key:Pi,label:ei,type:Ve,value:ca,isFocused:da,innerRef:da?s.getFocusedOptionRef:void 0}),s.formatOptionLabel(ze.data,"menu"))},ot;if(this.hasOptions())ot=this.getCategorizedOptions().map(function(Z){if(Z.type==="group"){var ze=Z.data,Qe=Z.options,Ve=Z.index,pt="".concat(s.getElementId("group"),"-").concat(Ve),wt="".concat(pt,"-heading");return T.createElement(a,Se({},f,{key:pt,data:ze,options:Qe,Heading:o,headingProps:{id:wt,data:Z.data},label:s.formatGroupLabel(Z.data)}),Z.options.map(function(Ni){return _e(Ni,"".concat(Ve,"-").concat(Ni.index))}))}else if(Z.type==="option")return _e(Z,"".concat(Z.index))});else if(w){var G=x({inputValue:b});if(G===null)return null;ot=T.createElement(c,f,G)}else{var re=Xe({inputValue:b});if(re===null)return null;ot=T.createElement(d,f,re)}var se={minMenuHeight:v,maxMenuHeight:C,menuPlacement:N,menuPosition:W,menuShouldScrollIntoView:Ee},we=T.createElement(aR,Se({},f,se),function(Z){var ze=Z.ref,Qe=Z.placerProps,Ve=Qe.placement,pt=Qe.maxHeight;return T.createElement(l,Se({},f,se,{innerRef:ze,innerProps:{onMouseDown:s.onMenuMouseDown,onMouseMove:s.onMenuMouseMove},isLoading:w,placement:Ve}),T.createElement(FF,{captureEnabled:y,onTopArrive:je,onBottomArrive:qe,lockEnabled:me},function(wt){return T.createElement(h,Se({},f,{innerRef:function(ei){s.getMenuListRef(ei),wt(ei)},innerProps:{role:"listbox","aria-multiselectable":f.isMulti,id:s.getElementId("listbox")},isLoading:w,maxHeight:pt,focusedOption:m}),ot)}))});return Y||W==="fixed"?T.createElement(u,Se({},f,{appendTo:Y,controlElement:this.controlRef,menuPlacement:N,menuPosition:W}),we):we}},{key:"renderFormField",value:function(){var s=this,n=this.props,a=n.delimiter,o=n.isDisabled,l=n.isMulti,h=n.name,u=n.required,c=this.state.selectValue;if(u&&!this.hasValue()&&!o)return T.createElement(DF,{name:h,onFocus:this.onValueInputFocus});if(!(!h||o))if(l)if(a){var d=c.map(function(m){return s.getOptionValue(m)}).join(a);return T.createElement("input",{name:h,type:"hidden",value:d})}else{var p=c.length>0?c.map(function(m,S){return T.createElement("input",{key:"i-".concat(S),name:h,type:"hidden",value:s.getOptionValue(m)})}):T.createElement("input",{name:h,type:"hidden",value:""});return T.createElement("div",null,p)}else{var f=c[0]?this.getOptionValue(c[0]):"";return T.createElement("input",{name:h,type:"hidden",value:f})}}},{key:"renderLiveRegion",value:function(){var s=this.commonProps,n=this.state,a=n.ariaSelection,o=n.focusedOption,l=n.focusedValue,h=n.isFocused,u=n.selectValue,c=this.getFocusableOptions();return T.createElement(kF,Se({},s,{id:this.getElementId("live-region"),ariaSelection:a,focusedOption:o,focusedValue:l,isFocused:h,selectValue:u,focusableOptions:c,isAppleDevice:this.isAppleDevice}))}},{key:"render",value:function(){var s=this.getComponents(),n=s.Control,a=s.IndicatorsContainer,o=s.SelectContainer,l=s.ValueContainer,h=this.props,u=h.className,c=h.id,d=h.isDisabled,p=h.menuIsOpen,f=this.state.isFocused,m=this.commonProps=this.getCommonProps();return T.createElement(o,Se({},m,{className:u,innerProps:{id:c,onKeyDown:this.onKeyDown},isDisabled:d,isFocused:f}),this.renderLiveRegion(),T.createElement(n,Se({},m,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:d,isFocused:f,menuIsOpen:p}),T.createElement(l,Se({},m,{isDisabled:d}),this.renderPlaceholderOrValue(),this.renderInput()),T.createElement(a,Se({},m,{isDisabled:d}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(s,n){var a=n.prevProps,o=n.clearFocusValueOnUpdate,l=n.inputIsHiddenAfterUpdate,h=n.ariaSelection,u=n.isFocused,c=n.prevWasFocused,d=n.instancePrefix,p=s.options,f=s.value,m=s.menuIsOpen,S=s.inputValue,y=s.isMulti,b=J0(f),w={};if(a&&(f!==a.value||p!==a.options||m!==a.menuIsOpen||S!==a.inputValue)){var x=m?ZF(s,b):[],v=m?f1(eu(s,b),"".concat(d,"-option")):[],C=o?eI(n,b):null,P=tI(n,x),N=jd(v,P);w={selectValue:b,focusedOption:P,focusedOptionId:N,focusableOptionsWithIds:v,focusedValue:C,clearFocusValueOnUpdate:!1}}var W=l!=null&&s!==a?{inputIsHidden:l,inputIsHiddenAfterUpdate:void 0}:{},Y=h,me=u&&c;return u&&!me&&(Y={value:kh(y,b,b[0]||null),options:b,action:"initial-input-focus"},me=!c),(h==null?void 0:h.action)==="initial-input-focus"&&(Y=null),ye(ye(ye({},w),W),{},{prevProps:s,ariaSelection:Y,prevWasFocused:me})}}]),t}(T.Component);sx.defaultProps=JF;var rI=T.forwardRef(function(i,e){var t=yL(i);return T.createElement(sx,Se({ref:e},t))}),Pm=rI;function tu({id:i,value:e,values:t,styles:r,components:s,autoFocus:n,placeholder:a,onChange:o,getLabel:l}){const h=d=>{o(d.value)},u=T.useMemo(()=>t.map(d=>({label:l?l(d):d,value:d})),[t,l]),c=T.useMemo(()=>u.find(d=>d.value===e),[u,e]);return k.jsx(Pm,{inputId:i,autoFocus:n,placeholder:a,value:c,options:u,styles:r,components:s,onChange:h})}const xh=i=>({...i,fontSize:"1em",color:"#ffffff"}),Em={input:xh,singleValue:xh,menuList:i=>({...xh(i),backgroundColor:"#181818"}),placeholder:xh,control:i=>({...i,borderWidth:"0px",boxShadow:"none",padding:"3px 6px",borderRadius:"6px",backgroundColor:"#ffffff10",":hover":{backgroundColor:"#ffffff30"},":focus":{backgroundColor:"#ffffff50"}}),option:(i,{isSelected:e,isFocused:t})=>({...i,backgroundColor:e?"#ffffff40":t?"#ffffff30":"transparent",":active":{backgroundColor:"#ffffff30"}}),menu:i=>({...i,minWidth:"60px"})},Mm={IndicatorSeparator:()=>null};function Fp(i){return{label:i,value:i}}const sI=({id:i,value:e,data:t,onChange:r})=>{const s=o=>{r(o.map(({value:l})=>l))},n=T.useMemo(()=>((t==null?void 0:t.values)??[]).map(Fp),[t==null?void 0:t.values]),a=T.useMemo(()=>(e??[]).map(Fp),[e]);return k.jsx(Pm,{isMulti:!0,inputId:i,value:a,options:n,styles:Em,components:Mm,onChange:s})},nI=({id:i,value:e,data:t,onChange:r})=>{const s=o=>{r(o.value)},n=T.useMemo(()=>((t==null?void 0:t.values)??[]).map(Fp),[t==null?void 0:t.values]),a=T.useMemo(()=>n.find(o=>o.value===e),[n,e]);return k.jsx(Pm,{inputId:i,value:a,options:n,styles:Em,components:Mm,onChange:s})};function Hi(){const{progressionId:i}=yM();return Zt(e=>ai.selectors.getProgression(e,i))}const aI={CHROMATIC_APPROACH:!0,CHORD_TONE_ONLY:!0},oI={values:Object.keys(aI)},lI={values:["1","2","4"]},hI=()=>{var a;const i=wr(),e=Hi();function t(o){Te(e)||i(ai.actions.updateProgression({progression:o}))}const r=o=>{t({...e,name:o})},s=o=>{t({...e,noteCount:parseInt(o)})},n=o=>{t({...e,tags:o})};return k.jsxs(k.Fragment,{children:[k.jsx(zd,{name:"Progression name",description:"Name of your progression, helps you identify and find it later.",Editor:uL,onChange:r,value:(e==null?void 0:e.name)??""}),k.jsx(zd,{name:"Tags",description:"Your global prefferences regarding how chords transition in this progression. Can be changed per chord.",Editor:sI,data:oI,onChange:n,value:(e==null?void 0:e.tags)??[]}),k.jsx(zd,{name:"Notes in a bar",description:"Preferred amount of notes in a bar.",Editor:nI,data:lI,onChange:s,value:((a=e==null?void 0:e.noteCount)==null?void 0:a.toString())??""})]})},uI=M`
  display: flex;
  flex-direction: column;
  padding: 14px;
  pointer-events: auto;
`,cI=M`
  font-size: 1em;
  color: #ffffff;
  margin-bottom: 2px;
  pointer-events: auto;
`,dI=M`
  font-size: 0.8em;
  margin-bottom: 10px;
  color: #ffffffaa;
`,fI=M`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,pI=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 10px;
`,gI=M`
  background-color: #ffffffaa;
  flex: 1 1 1px;
`,mI=M`
  width: 110px;
`,yI=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 6px;
`,ga=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border: none;
  color: #ffffffdd;
  padding: 8px 16px;
  gap: 6px;
  cursor: pointer;
  font-size: 1em;
  border-radius: 6px;
  background-color: transparent;
  background-color: #ffffff10;
  &:hover {
    color: #fff;
    background-color: #ffffff20;
  }
  &:disabled {
    background-color: transparent;
    color: #ffffff50;
    cursor: not-allowed;
  }
`,bI=M`
  display: flex;
  flex-direction: row;
`,wI=M`
  flex: 1;
  display: flex;
  flex-direction: row;
  gap: 10px;
`,SI=M`
  border-color: #ffffff66;
  margin: 20px 0px;
`,vI=()=>{const i=wr(),e=Hi(),t=e==null?void 0:e.tuning;function r(c){i(ai.actions.updateProgression({progression:{...e,tuning:c}}))}const s=c=>d=>{r(t.map((p,f)=>f===c?d:p))},n=c=>()=>{r(x2(t,c))},a=c=>()=>{r(_2(t,c))},o=c=>()=>{r(B2(t,c))},l=()=>{r([...t,"B0"])},h=()=>{r(d2)},u=()=>{r(f2)};return k.jsxs("div",{className:uI,children:[k.jsx("label",{className:cI,children:"Tuning"}),k.jsx("span",{className:dI,children:"You can change the tuning here to the exact tuning you are using."}),k.jsx("div",{className:fI,children:t.map((c,d)=>{const p=k2(6,18,d/t.length),f=p/2;return k.jsxs("div",{className:pI,children:[k.jsx("div",{className:mI,children:k.jsx(tu,{value:c,values:zv,onChange:s(d),components:Mm,styles:Em})}),k.jsx("div",{className:gI,style:{borderRadius:f,height:p}}),k.jsxs("div",{className:yI,children:[k.jsx("button",{className:ga,disabled:d===0,onClick:n(d),children:k.jsx(XM,{})}),k.jsx("button",{className:ga,disabled:d===t.length-1,onClick:a(d),children:k.jsx($M,{})}),k.jsx("button",{className:ga,onClick:o(d),children:k.jsx(km,{})})]})]},`${c}-${d}`)})}),k.jsx("hr",{className:SI}),k.jsxs("div",{className:bI,children:[k.jsxs("div",{className:wI,children:[k.jsxs("button",{className:ga,onClick:h,children:[k.jsx(Du,{})," E A D G"]}),k.jsxs("button",{className:ga,onClick:u,children:[k.jsx(Du,{})," B E A D G"]})]}),k.jsxs("button",{className:ga,onClick:l,children:[k.jsx(Uc,{})," Add String"]})]})]})},Ul={score:i=>`/${i}/score`,editor:i=>`/${i}/editor`,home:()=>"/"},kI=M`
  display: flex;
  flex-direction: column;
  padding: 14px;
  pointer-events: auto;
`,xI=M`
  font-size: 1em;
  color: #ffffff;
  margin-bottom: 2px;
  pointer-events: auto;
`,BI=M`
  font-size: 0.8em;
  margin-bottom: 10px;
  color: #ffffffaa;
`,_I=M`
  display: flex;
  flex-direction: row;
`,TI=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border: none;
  color: #ffffffdd;
  padding: 8px 16px;
  gap: 6px;
  cursor: pointer;
  font-size: 1em;
  border-radius: 6px;
  background-color: transparent;
  background-color: #ff000050;
  &:hover {
    color: #fff;
    background-color: #ff000060;
  }
  &:disabled {
    background-color: transparent;
    color: #ffffff50;
    cursor: not-allowed;
  }
`,CI=()=>{const i=wr(),e=Hi(),t=Gc(),r=()=>{Te(e)||(i(ai.actions.deleteProgression({progressionId:e.id})),t(Ul.home()))};return k.jsxs("div",{className:kI,children:[k.jsx("label",{className:xI,children:"Delete chord progression"}),k.jsx("span",{className:BI,children:"Pressing this button will permanently delete this chord progression."}),k.jsx("div",{className:_I,children:k.jsxs("button",{className:TI,onClick:r,children:[k.jsx(Gl,{}),"Permanently delete progression"]})})]})},NI=M`
  border-top-left-radius: 14px;
  border-bottom-left-radius: 14px;
  background-color: #ffffff10;
  min-width: 200px;
`,PI=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  font-size: 1.4em;
  font-weight: bold;
  color: #ffffff;
  gap: 10px;
  padding: 14px 18px;
`,EI=M`
  position: relative;
  top: 1px;
`,MI=M`
  overflow-x: auto;
  display: flex;
  flex-direction: column;
  padding: 14px 0px;
`,LI=M`
  display: flex;
  align-items: center;
  color: #ffffffcc;
  font-size: 1.2em;
  gap: 10px;
  padding: 10px 18px;
  cursor: pointer;
  &:hover {
    color: #ffffff;
    background-color: #ffffff10;
  }
`,RI=M`
  background-color: #ffffff20;
  color: #ffffff;
  &:hover {
    color: #ffffff;
    background-color: #ffffff20;
  }
`,FI=M`
  flex: 1;
  min-width: 400px;
`,II=M`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
`,OI=M`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  font-size: 1.4em;
  font-weight: bold;
  color: #ffffff;
  padding: 14px;
`,DI=M`
  font-size: 1.4em;
  color: #ffffff;
  cursor: pointer;
`,AI=M`
  width: 600px;
  height: 600px;
`,g1=[{id:cs(),name:"Preferences",Icon:Tk,Component:hI},{id:cs(),name:"Tuning",Icon:Du,Component:vI},{id:cs(),name:"Danger Zone",Icon:Ck,Component:CI}],VI=({onClose:i})=>{const[e,t]=T.useState(g1[0]);return k.jsxs(Pk,{onBackdropClick:i,children:[k.jsxs("div",{className:NI,children:[k.jsxs("header",{className:PI,children:[k.jsx(qM,{className:EI})," Settings"]}),k.jsx("div",{className:MI,children:g1.map(r=>{const{id:s,name:n,Icon:a}=r,o=ea(LI,s===e.id?RI:null),l=()=>t(r);return k.jsxs("div",{className:o,onClick:l,children:[k.jsx(a,{})," ",n]},s)})})]}),k.jsxs("div",{className:FI,children:[k.jsxs("header",{className:OI,children:[k.jsxs("div",{className:II,children:[k.jsx(e.Icon,{})," ",e.name]}),k.jsx(km,{className:DI,onClick:i})]}),k.jsx("div",{className:AI,children:k.jsx(e.Component,{onClose:i})})]})]})};var As={},$c={};Object.defineProperty($c,"__esModule",{value:!0});$c.PopoverPortal=void 0;var HI=T,WI=yc,zI=function(i){var e=i.container,t=i.element,r=i.scoutElement,s=i.children;return(0,HI.useLayoutEffect)(function(){return e.appendChild(t),e.appendChild(r),function(){e.removeChild(t),e.removeChild(r)}},[e,t,r]),(0,WI.createPortal)(s,t)};$c.PopoverPortal=zI;var Xc={};(function(i){var e=Ms&&Ms.__assign||function(){return e=Object.assign||function(l){for(var h,u=1,c=arguments.length;u<c;u++){h=arguments[u];for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(l[d]=h[d])}return l},e.apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0}),i.getNudgedPopoverRect=i.getNewPopoverRect=i.popoverRectForPosition=i.createContainer=i.rectsAreEqual=i.createRect=i.EMPTY_RECT=void 0,i.EMPTY_RECT={top:0,left:0,right:0,bottom:0,width:0,height:0};var t=function(l){var h=l.top,u=l.left,c=l.width,d=l.height;return{top:h,left:u,width:c,height:d,right:u+c,bottom:h+d}};i.createRect=t;var r=function(l,h){return l===h||(l==null?void 0:l.bottom)===(h==null?void 0:h.bottom)&&(l==null?void 0:l.height)===(h==null?void 0:h.height)&&(l==null?void 0:l.left)===(h==null?void 0:h.left)&&(l==null?void 0:l.right)===(h==null?void 0:h.right)&&(l==null?void 0:l.top)===(h==null?void 0:h.top)&&(l==null?void 0:l.width)===(h==null?void 0:h.width)};i.rectsAreEqual=r;var s=function(l){var h=l.containerStyle,u=l.containerClassName,c=l.id,d=window.document.createElement("div");return d.id=c,u&&(d.className=u),Object.assign(d.style,h),d};i.createContainer=s;var n=function(l,h,u,c,d){var p=h.left+h.width/2,f=h.top+h.height/2,m=u.width,S=u.height,y,b;switch(l){case"left":y=f-S/2,b=h.left-c-m,d==="start"&&(y=h.top),d==="end"&&(y=h.bottom-S);break;case"bottom":y=h.bottom+c,b=p-m/2,d==="start"&&(b=h.left),d==="end"&&(b=h.right-m);break;case"right":y=f-S/2,b=h.right+c,d==="start"&&(y=h.top),d==="end"&&(y=h.bottom-S);break;default:y=h.top-S-c,b=p-m/2,d==="start"&&(b=h.left),d==="end"&&(b=h.right-m);break}return(0,i.createRect)({left:b,top:y,width:m,height:S})};i.popoverRectForPosition=n;var a=function(l,h){var u=l.position,c=l.align,d=l.childRect,p=l.popoverRect,f=l.boundaryRect,m=l.padding,S=l.reposition,y=(0,i.popoverRectForPosition)(u,d,p,m,c),b=S&&(u==="top"&&y.top<f.top+h||u==="left"&&y.left<f.left+h||u==="right"&&y.right>f.right-h||u==="bottom"&&y.bottom>f.bottom-h);return{rect:y,boundaryViolation:b}};i.getNewPopoverRect=a;var o=function(l,h,u){var c=h.top+u,d=h.left+u,p=h.right-u,f=h.bottom-u,m=l.top<c?c:l.top;m=m+l.height>f?f-l.height:m;var S=l.left<d?d:l.left;return S=S+l.width>p?p-l.width:S,(0,i.createRect)(e(e({},l),{top:m,left:S}))};i.getNudgedPopoverRect=o})(Xc);var jc={},qc={};Object.defineProperty(qc,"__esModule",{value:!0});qc.useElementRef=void 0;var m1=T,GI=Xc,UI=function(i){var e=i.containerClassName,t=i.containerStyle,r=i.id,s=(0,m1.useRef)(),n=(0,m1.useMemo)(function(){return(0,GI.createContainer)({containerStyle:t,containerClassName:e,id:r})},[e,t,r]);return s.current=n,s};qc.useElementRef=UI;Object.defineProperty(jc,"__esModule",{value:!0});jc.usePopover=void 0;var YI=T,ma=Xc,y1=qc,$I={position:"fixed",overflow:"visible",top:"0px",left:"0px"},XI={position:"fixed",top:"0px",left:"0px",width:"0px",height:"0px",visibility:"hidden"},jI=function(i){var e=i.isOpen,t=i.childRef,r=i.positions,s=i.containerClassName,n=i.parentElement,a=i.transform,o=i.transformMode,l=i.align,h=i.padding,u=i.reposition,c=i.boundaryInset,d=i.boundaryElement,p=i.onPositionPopover,f=(0,y1.useElementRef)({id:"react-tiny-popover-scout",containerStyle:XI}),m=(0,y1.useElementRef)({id:"react-tiny-popover-container",containerClassName:s,containerStyle:$I}),S=(0,YI.useCallback)(function(y){var b,w,x=y===void 0?{}:y,v=x.positionIndex,C=v===void 0?0:v,P=x.parentRect,N=P===void 0?n.getBoundingClientRect():P,W=x.childRect,Y=W===void 0?(b=t==null?void 0:t.current)===null||b===void 0?void 0:b.getBoundingClientRect():W,me=x.scoutRect,Ee=me===void 0?(w=f==null?void 0:f.current)===null||w===void 0?void 0:w.getBoundingClientRect():me,Xe=x.popoverRect,je=Xe===void 0?m.current.getBoundingClientRect():Xe,qe=x.boundaryRect,_e=qe===void 0?d===n?N:d.getBoundingClientRect():qe;if(!(!Y||!N||!e)){if(a&&o==="absolute"){var ot=typeof a=="function"?a({childRect:Y,popoverRect:je,parentRect:N,boundaryRect:_e,padding:h,align:l,nudgedTop:0,nudgedLeft:0,boundaryInset:c,violations:ma.EMPTY_RECT,hasViolations:!1}):a,G=ot.top,re=ot.left,se=Math.round(N.left+re-Ee.left),we=Math.round(N.top+G-Ee.top);m.current.style.transform="translate(".concat(se,"px, ").concat(we,"px)"),p({childRect:Y,popoverRect:(0,ma.createRect)({left:se,top:we,width:je.width,height:je.height}),parentRect:N,boundaryRect:_e,padding:h,align:l,transform:{top:G,left:re},nudgedTop:0,nudgedLeft:0,boundaryInset:c,violations:ma.EMPTY_RECT,hasViolations:!1});return}var Z=C===r.length,ze=Z?r[0]:r[C],Qe=(0,ma.getNewPopoverRect)({childRect:Y,popoverRect:je,boundaryRect:_e,position:ze,align:l,padding:h,reposition:u},c),Ve=Qe.rect,pt=Qe.boundaryViolation;if(pt&&u&&!Z){S({positionIndex:C+1,childRect:Y,popoverRect:je,parentRect:N,boundaryRect:_e});return}var wt=Ve.top,Ni=Ve.left,ei=Ve.width,ca=Ve.height,da=u&&!Z,ps=(0,ma.getNudgedPopoverRect)(Ve,_e,c),gs=ps.left,Pi=ps.top,vr=wt,Wi=Ni;da&&(vr=Pi,Wi=gs),vr=Math.round(vr-Ee.top),Wi=Math.round(Wi-Ee.left),m.current.style.transform="translate(".concat(Wi,"px, ").concat(vr,"px)");var vi={top:_e.top+c-vr,left:_e.left+c-Wi,right:Wi+ei-_e.right+c,bottom:vr+ca-_e.bottom+c},Xs={childRect:Y,popoverRect:(0,ma.createRect)({left:Wi,top:vr,width:ei,height:ca}),parentRect:N,boundaryRect:_e,position:ze,align:l,padding:h,nudgedTop:Pi-wt,nudgedLeft:gs-Ni,boundaryInset:c,violations:{top:vi.top<=0?0:vi.top,left:vi.left<=0?0:vi.left,right:vi.right<=0?0:vi.right,bottom:vi.bottom<=0?0:vi.bottom},hasViolations:vi.top>0||vi.left>0||vi.right>0||vi.bottom>0};if(a){p(Xs);var Kl=typeof a=="function"?a(Xs):a,ms=Kl.top,Ke=Kl.left;m.current.style.transform="translate(".concat(Math.round(Wi+(Ke??0)),"px, ").concat(Math.round(vr+(ms??0)),"px)"),Xs.nudgedLeft+=Ke??0,Xs.nudgedTop+=ms??0,Xs.transform={top:ms,left:Ke}}p(Xs)}},[n,t,f,m,d,e,a,o,r,l,h,u,c,p]);return{positionPopover:S,popoverRef:m,scoutRef:f}};jc.usePopover=jI;var Qc={};Object.defineProperty(Qc,"__esModule",{value:!0});Qc.useMemoizedArray=void 0;var b1=T,qI=function(i){var e=(0,b1.useRef)(i),t=(0,b1.useMemo)(function(){if(e.current===i)return e.current;if(e.current.length!==i.length)return e.current=i,i;for(var r=0;r<i.length;r+=1)if(i[r]!==e.current[r])return e.current=i,i;return e.current},[i]);return t};Qc.useMemoizedArray=qI;var Yl={},Ip=Ms&&Ms.__assign||function(){return Ip=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},Ip.apply(this,arguments)};Object.defineProperty(Yl,"__esModule",{value:!0});Yl.useArrowContainer=void 0;var w1=T,QI=function(i){var e=i.childRect,t=i.popoverRect,r=i.position,s=i.arrowSize,n=i.arrowColor,a=(0,w1.useMemo)(function(){return{padding:s}},[s]),o=(0,w1.useMemo)(function(){return Ip({position:"absolute"},function(){var l=s*2,h=e.top-t.top+e.height/2-l/2,u=e.left-t.left+e.width/2-l/2,c=s,d=t.width-s,p=t.height-s;switch(u=u<c?c:u,u=u+l>d?d-l:u,h=h<c?c:h,h=h+l>p?p-l:h,h=Number.isNaN(h)?0:h,u=Number.isNaN(u)?0:u,r){case"right":return{borderTop:"".concat(s,"px solid transparent"),borderBottom:"".concat(s,"px solid transparent"),borderRight:"".concat(s,"px solid ").concat(n),left:0,top:h};case"left":return{borderTop:"".concat(s,"px solid transparent"),borderBottom:"".concat(s,"px solid transparent"),borderLeft:"".concat(s,"px solid ").concat(n),right:0,top:h};case"bottom":return{borderLeft:"".concat(s,"px solid transparent"),borderRight:"".concat(s,"px solid transparent"),borderBottom:"".concat(s,"px solid ").concat(n),top:0,left:u};case"top":return{borderLeft:"".concat(s,"px solid transparent"),borderRight:"".concat(s,"px solid transparent"),borderTop:"".concat(s,"px solid ").concat(n),bottom:0,left:u};default:return{display:"hidden"}}}())},[n,s,e.height,e.left,e.top,e.width,t.height,t.left,t.top,t.width,r]);return{arrowContainerStyle:a,arrowStyle:o}};Yl.useArrowContainer=QI;var Kc={},La=Ms&&Ms.__assign||function(){return La=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},La.apply(this,arguments)};Object.defineProperty(Kc,"__esModule",{value:!0});Kc.ArrowContainer=void 0;var S1=k,v1=T,KI=Yl,JI=function(i){var e=i.childRect,t=i.popoverRect,r=i.position,s=i.arrowColor,n=i.arrowSize,a=i.arrowClassName,o=i.arrowStyle,l=i.className,h=i.children,u=i.style,c=(0,KI.useArrowContainer)({childRect:e,popoverRect:t,position:r,arrowColor:s,arrowSize:n}),d=c.arrowContainerStyle,p=c.arrowStyle,f=(0,v1.useMemo)(function(){return La(La({},d),u)},[d,u]),m=(0,v1.useMemo)(function(){return La(La({},p),o)},[p,o]);return(0,S1.jsxs)("div",{className:l,style:f,children:[(0,S1.jsx)("div",{style:m,className:a}),h]})};Kc.ArrowContainer=JI;(function(i){var e=Ms&&Ms.__assign||function(){return e=Object.assign||function(d){for(var p,f=1,m=arguments.length;f<m;f++){p=arguments[f];for(var S in p)Object.prototype.hasOwnProperty.call(p,S)&&(d[S]=p[S])}return d},e.apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0}),i.Popover=i.usePopover=i.ArrowContainer=i.useArrowContainer=void 0;var t=k,r=T,s=$c,n=Xc,a=jc;Object.defineProperty(i,"usePopover",{enumerable:!0,get:function(){return a.usePopover}});var o=Qc,l=Yl;Object.defineProperty(i,"useArrowContainer",{enumerable:!0,get:function(){return l.useArrowContainer}});var h=Kc;Object.defineProperty(i,"ArrowContainer",{enumerable:!0,get:function(){return h.ArrowContainer}});var u=["top","left","right","bottom"],c=(0,r.forwardRef)(function(d,p){var f=d.isOpen,m=d.children,S=d.content,y=d.positions,b=y===void 0?u:y,w=d.align,x=w===void 0?"center":w,v=d.padding,C=v===void 0?0:v,P=d.reposition,N=P===void 0?!0:P,W=d.parentElement,Y=W===void 0?window.document.body:W,me=d.boundaryElement,Ee=me===void 0?Y:me,Xe=d.containerClassName,je=d.containerStyle,qe=d.transform,_e=d.transformMode,ot=_e===void 0?"absolute":_e,G=d.boundaryInset,re=G===void 0?0:G,se=d.onClickOutside,we=d.clickOutsideCapture,Z=we===void 0?!1:we,ze=(0,o.useMemoizedArray)(Array.isArray(b)?b:[b]),Qe=(0,r.useRef)(!1),Ve=(0,r.useRef)(),pt=(0,r.useRef)(N),wt=(0,r.useRef)(),Ni=(0,r.useState)({align:x,nudgedLeft:0,nudgedTop:0,position:ze[0],padding:C,childRect:n.EMPTY_RECT,popoverRect:n.EMPTY_RECT,parentRect:n.EMPTY_RECT,boundaryRect:n.EMPTY_RECT,boundaryInset:re,violations:n.EMPTY_RECT,hasViolations:!1}),ei=Ni[0],ca=Ni[1],da=(0,r.useCallback)(function(Ke){return ca(Ke)},[]),ps=(0,a.usePopover)({isOpen:f,childRef:wt,containerClassName:Xe,parentElement:Y,boundaryElement:Ee,transform:qe,transformMode:ot,positions:ze,align:x,padding:C,boundaryInset:re,reposition:N,onPositionPopover:da}),gs=ps.positionPopover,Pi=ps.popoverRef,vr=ps.scoutRef;(0,r.useLayoutEffect)(function(){var Ke=!0,js=function(){var Nn,od;if(f&&Ke){var Zm=(Nn=wt==null?void 0:wt.current)===null||Nn===void 0?void 0:Nn.getBoundingClientRect(),ld=(od=Pi==null?void 0:Pi.current)===null||od===void 0?void 0:od.getBoundingClientRect();Zm!=null&&ld!=null&&(!(0,n.rectsAreEqual)(Zm,ei.childRect)||ld.width!==ei.popoverRect.width||ld.height!==ei.popoverRect.height||ei.padding!==C||ei.align!==x||ze!==Ve.current||N!==pt.current)&&gs(),ze!==Ve.current&&(Ve.current=ze),N!==pt.current&&(pt.current=N),Ke&&window.requestAnimationFrame(js)}Qe.current=f};return window.requestAnimationFrame(js),function(){Ke=!1}},[x,f,C,Pi,ei.align,ei.childRect,ei.padding,ei.popoverRect.height,ei.popoverRect.width,gs,ze,N]),(0,r.useEffect)(function(){var Ke=Pi.current;return Object.assign(Ke.style,je),function(){Object.keys(je??{}).forEach(function(js){return delete Ke.style[js]})}},[je,f,Pi]);var Wi=(0,r.useCallback)(function(Ke){var js,Nn;f&&!(!((js=Pi.current)===null||js===void 0)&&js.contains(Ke.target))&&!(!((Nn=wt.current)===null||Nn===void 0)&&Nn.contains(Ke.target))&&(se==null||se(Ke))},[f,se,Pi]),vi=(0,r.useCallback)(function(){wt.current&&window.requestAnimationFrame(function(){return gs()})},[gs]);(0,r.useEffect)(function(){var Ke=Y.ownerDocument.body;return Ke.addEventListener("click",Wi,Z),Ke.addEventListener("contextmenu",Wi,Z),Ke.addEventListener("resize",vi),function(){Ke.removeEventListener("click",Wi,Z),Ke.removeEventListener("contextmenu",Wi,Z),Ke.removeEventListener("resize",vi)}},[Z,Wi,vi,Y]);var Xs=(0,r.useCallback)(function(Ke){wt.current=Ke,p!=null&&(typeof p=="object"?p.current=Ke:typeof p=="function"&&p(Ke))},[p]),Kl=function(){return(0,r.cloneElement)(m,{ref:Xs})},ms=function(){return f?(0,t.jsx)(s.PopoverPortal,{element:Pi.current,scoutElement:vr.current,container:Y,children:typeof S=="function"?S(ei):S}):null};return(0,t.jsxs)(t.Fragment,{children:[Kl(),ms()]})});i.Popover=(0,r.forwardRef)(function(d,p){return typeof window>"u"?d.children:(0,t.jsx)(c,e({},d,{ref:p}))})})(As);const ZI=M`
  width: 100%;
  height: 300px;
  padding-bottom: 30px;
  overflow: auto;
  display: flex;
  flex-direction: column;
`,eO=M`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 40px 14px;
  align-items: center;
  justify-content: flex-start;
  color: #ffffff99;
`,tO=M`
  font-size: 3em;
`,iO=M`
  font-size: 0.9em;
  text-align: center;
`,rO=M`
  display: block;
  padding-left: 14px;
  padding-right: 14px;
  margin: 14px;
  width: calc(100% - (14px * 2));
  background-color: #ffffff15;
  border: none;
  border-radius: 18px;
  height: 36px;
  font-size: 1em;
  color: #ffffff;
  outline: none;
  &:focus {
    outline: none;
    border: none;
    background-color: #ffffff30;
  }
`,sO=M`
  text-transform: uppercase;
  font-size: 0.8em;
  font-weight: bold;
  padding: 4px 10px;
  color: #ffffff99;
  background-color: #ffffff10;
`,k1=M`
  padding: 6px 10px;
  color: #ffffff;
  font-size: 1em;
  cursor: pointer;
  &:hover {
    background-color: #ffffff25;
  }
`,nO=M`
  height: 40px;
  border-radius: 20px;
  margin: 20px 10px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  align-self: center;
  justify-self: flex-end;
  border: none;
  color: #ffffffdd;
  padding: 0px 20px;
  gap: 6px;
  cursor: pointer;
  font-size: 1em;
  background-color: #ffffff20;
  &:hover {
    color: #fff;
    background-color: #ffffff30;
  }
  &:disabled {
    background-color: transparent;
    color: #ffffff50;
    cursor: not-allowed;
  }
`;function Lm({categories:i,noHitsLabel:e,canCreate:t,canSearch:r,createLabel:s,getChildren:n,getCategoryKey:a,getCategoryLabel:o,getCategoryIcon:l,getItemKey:h,getItemLabel:u,getItemIcon:c,getHyperLink:d,onItemClick:p,onCreate:f,matches:m}){const[S,y]=T.useState(""),b=v=>y(v.target.value),w=v=>()=>p(v),x=T.useMemo(()=>{const v=[];for(let C of i){const P=n(C).filter(N=>m(N,S));P.length>0&&v.push([C,P])}return v},[i,n,S,m]);return k.jsxs(k.Fragment,{children:[r&&k.jsx("input",{type:"text",className:rO,placeholder:"Search...",value:S,onChange:b}),k.jsxs("div",{className:ZI,children:[x.length===0&&k.jsxs("div",{className:eO,children:[k.jsx(YM,{className:tO}),k.jsx("span",{className:iO,children:e})]}),x.map(([v,C])=>{const P=Te(l)?null:l(v);return k.jsxs(T.Fragment,{children:[k.jsxs("div",{className:sO,children:[P&&k.jsx(P,{}),o(v)]}),C.map(N=>{const W=Te(c)?null:c(N),Y=h(N),me=u(N),Ee=w(N);if(Te(d))return k.jsxs("div",{className:k1,onClick:Ee,children:[W&&k.jsx(W,{}),me]},Y);const Xe=d(N);return k.jsxs("a",{className:k1,href:Xe,onClick:Ee,children:[W&&k.jsx(W,{}),me]},Y)})]},a(v))}),t&&k.jsxs("button",{className:nO,onClick:f,children:[k.jsx(Uc,{})," ",s]})]})]})}M`
  width: 100%;
  height: 300px;
  padding-bottom: 30px;
  overflow: auto;
`;M`
  padding: 6px 10px;
  color: #ffffff;
  font-size: 1em;
  cursor: pointer;
  &:hover {
    background-color: #ffffff35;
  }
`;M`
  background-color: #ffffff30;
  &:hover {
    background-color: #ffffff30;
  }
`;const aO=i=>i,oO=i=>"progressions",lO=i=>"Your progressions",hO=i=>i.id,uO=i=>i.name,cO=(i,e)=>i.name.toLowerCase().includes(e.toLowerCase()),dO="No progressions found! Please create one!",fO=i=>`#/${i.id}/editor`,pO=({setOpen:i,add:e})=>{const t=Zt(ai.selectors.getProgressions),r=()=>i(!1),s=()=>{i(!1),e()};return k.jsx(Lm,{categories:[t],canCreate:!0,canSearch:!0,createLabel:"Create progression",onCreate:s,onItemClick:r,getChildren:aO,getCategoryKey:oO,getCategoryLabel:lO,getItemKey:hO,getItemLabel:uO,getHyperLink:fO,matches:cO,noHitsLabel:dO})};var nx={exports:{}};(function(i){(function(e){let t;function r(u,c){const d=u.charCodeAt(c);if(isNaN(d))throw new RangeError("Index "+c+' out of range for string "'+u+'"; please open an issue at https://github.com/Trott/slug/issues/new');if(d<55296||d>57343)return[u.charAt(c),c];if(d>=55296&&d<=56319){if(u.length<=c+1)return[" ",c];const f=u.charCodeAt(c+1);return f<56320||f>57343?[" ",c]:[u.charAt(c)+u.charAt(c+1),c+1]}if(c===0)return[" ",c];const p=u.charCodeAt(c-1);if(p<55296||p>56319)return[" ",c];throw new Error('String "'+u+'" reaches code believed to be unreachable; please open an issue at https://github.com/Trott/slug/issues/new')}typeof window<"u"?window.btoa?t=function(u){return btoa(unescape(encodeURIComponent(u)))}:t=function(u){const c=unescape(encodeURIComponent(u+""));let d="";for(let p,f,m=0,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.charAt(m|0)||(S="=",m%1);d+=S.charAt(63&p>>8-m%1*8)){if(f=c.charCodeAt(m+=3/4),f>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");p=p<<8|f}return d}:t=function(u){return Buffer.from(u).toString("base64")};function s(u,c){let d=o(u,c);if((c&&c.fallback!==void 0?c.fallback:s.defaults.fallback)===!0&&d===""){let f="";for(let m=0;m<u.length;m++){const S=r(u,m);m=S[1],f+=S[0]}d=o(t(f),c)}return d}const n={bg:{Й:"Y",й:"y",X:"H",x:"h",Ц:"Ts",ц:"ts",Щ:"Sht",щ:"sht",Ъ:"A",ъ:"a",Ь:"Y",ь:"y"},de:{Ä:"AE",ä:"ae",Ö:"OE",ö:"oe",Ü:"UE",ü:"ue"},sr:{đ:"dj",Đ:"DJ"},uk:{И:"Y",и:"y",Й:"Y",й:"y",Ц:"Ts",ц:"ts",Х:"Kh",х:"kh",Щ:"Shch",щ:"shch",Г:"H",г:"h"}};let a={};function o(u,c){if(typeof u!="string")throw new Error("slug() requires a string argument, received "+typeof u);typeof c=="string"&&(c={replacement:c}),c=c?Object.assign({},c):{},c.mode=c.mode||s.defaults.mode;const d=s.defaults.modes[c.mode],p=["replacement","multicharmap","charmap","remove","lower","trim"];for(let b,w=0,x=p.length;w<x;w++)b=p[w],c[b]=b in c?c[b]:d[b];const f=n[c.locale]||a;let m=[];for(const b in c.multicharmap){if(!Object.prototype.hasOwnProperty.call(c.multicharmap,b))continue;const w=b.length;m.indexOf(w)===-1&&m.push(w)}m=m.sort(function(b,w){return w-b});const S=c.mode==="rfc3986"?/[^\w\s\-.~]/:/[^A-Za-z0-9\s]/;let y="";for(let b,w=0,x=u.length;w<x;w++){b=u[w];let v=!1;for(let C=0;C<m.length;C++){const P=m[C],N=u.substr(w,P);if(c.multicharmap[N]){w+=P-1,b=c.multicharmap[N],v=!0;break}}v||(f[b]?b=f[b]:c.charmap[b]?b=c.charmap[b].replace(c.replacement," "):b.includes(c.replacement)?b=b.replace(c.replacement," "):b=b.replace(S,"")),y+=b}return c.remove&&(y=y.replace(c.remove,"")),c.trim&&(y=y.trim()),y=y.replace(/\s+/g,c.replacement),c.lower&&(y=y.toLowerCase()),y}const l={फ़:"Fi",ग़:"Ghi",ख़:"Khi",क़:"Qi",ड़:"ugDha",ढ़:"ugDhha",य़:"Yi",ज़:"Za",בִי:"i",בֵ:"e",בֵי:"e",בֶ:"e",בַ:"a",בָ:"a",בֹ:"o",וֹ:"o",בֻ:"u",וּ:"u",בּ:"b",כּ:"k",ךּ:"k",פּ:"p",שׁ:"sh",שׂ:"s",בְ:"e",חֱ:"e",חֲ:"a",חֳ:"o",בִ:"i"},h={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ő:"O",Ø:"O",Ō:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ű:"U",Ý:"Y",Þ:"TH",ß:"ss",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ő:"o",ø:"o",ō:"o",Œ:"OE",œ:"oe",ù:"u",ú:"u",û:"u",ü:"u",ű:"u",ý:"y",þ:"th",ÿ:"y","ẞ":"SS",α:"a",β:"b",γ:"g",δ:"d",ε:"e",ζ:"z",η:"h",θ:"th",ι:"i",κ:"k",λ:"l",μ:"m",ν:"n",ξ:"3",ο:"o",π:"p",ρ:"r",σ:"s",τ:"t",υ:"y",φ:"f",χ:"x",ψ:"ps",ω:"w",ά:"a",έ:"e",ί:"i",ό:"o",ύ:"y",ή:"h",ώ:"w",ς:"s",ϊ:"i",ΰ:"y",ϋ:"y",ΐ:"i",Α:"A",Β:"B",Γ:"G",Δ:"D",Ε:"E",Ζ:"Z",Η:"H",Θ:"Th",Ι:"I",Κ:"K",Λ:"L",Μ:"M",Ν:"N",Ξ:"3",Ο:"O",Π:"P",Ρ:"R",Σ:"S",Τ:"T",Υ:"Y",Φ:"F",Χ:"X",Ψ:"PS",Ω:"W",Ά:"A",Έ:"E",Ί:"I",Ό:"O",Ύ:"Y",Ή:"H",Ώ:"W",Ϊ:"I",Ϋ:"Y",ş:"s",Ş:"S",ı:"i",İ:"I",ğ:"g",Ğ:"G",а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"j",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"h",ц:"c",ч:"ch",ш:"sh",щ:"sh",ъ:"u",ы:"y",ь:"",э:"e",ю:"yu",я:"ya",А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"Yo",Ж:"Zh",З:"Z",И:"I",Й:"J",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"H",Ц:"C",Ч:"Ch",Ш:"Sh",Щ:"Sh",Ъ:"U",Ы:"Y",Ь:"",Э:"E",Ю:"Yu",Я:"Ya",Є:"Ye",І:"I",Ї:"Yi",Ґ:"G",є:"ye",і:"i",ї:"yi",ґ:"g",č:"c",ď:"d",ě:"e",ň:"n",ř:"r",š:"s",ť:"t",ů:"u",ž:"z",Č:"C",Ď:"D",Ě:"E",Ň:"N",Ř:"R",Š:"S",Ť:"T",Ů:"U",Ž:"Z",ľ:"l",ĺ:"l",ŕ:"r",Ľ:"L",Ĺ:"L",Ŕ:"R",ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ś:"S",Ź:"Z",Ż:"Z",ā:"a",ē:"e",ģ:"g",ī:"i",ķ:"k",ļ:"l",ņ:"n",ū:"u",Ā:"A",Ē:"E",Ģ:"G",Ī:"I",Ķ:"K",Ļ:"L",Ņ:"N",Ū:"U",أ:"a",إ:"i",ب:"b",ت:"t",ث:"th",ج:"g",ح:"h",خ:"kh",د:"d",ذ:"th",ر:"r",ز:"z",س:"s",ش:"sh",ص:"s",ض:"d",ط:"t",ظ:"th",ع:"aa",غ:"gh",ف:"f",ق:"k",ك:"k",ل:"l",م:"m",ن:"n",ه:"h",و:"o",ي:"y",ء:"aa",ة:"a",آ:"a",ا:"a",پ:"p",ژ:"zh",گ:"g",چ:"ch",ک:"k",ی:"i",ė:"e",į:"i",ų:"u",Ė:"E",Į:"I",Ų:"U",ț:"t",Ț:"T",ţ:"t",Ţ:"T",ș:"s",Ș:"S",ă:"a",Ă:"A",Ạ:"A",Ả:"A",Ầ:"A",Ấ:"A",Ậ:"A",Ẩ:"A",Ẫ:"A",Ằ:"A",Ắ:"A",Ặ:"A",Ẳ:"A",Ẵ:"A",Ẹ:"E",Ẻ:"E",Ẽ:"E",Ề:"E",Ế:"E",Ệ:"E",Ể:"E",Ễ:"E",Ị:"I",Ỉ:"I",Ĩ:"I",Ọ:"O",Ỏ:"O",Ồ:"O",Ố:"O",Ộ:"O",Ổ:"O",Ỗ:"O",Ơ:"O",Ờ:"O",Ớ:"O",Ợ:"O",Ở:"O",Ỡ:"O",Ụ:"U",Ủ:"U",Ũ:"U",Ư:"U",Ừ:"U",Ứ:"U",Ự:"U",Ử:"U",Ữ:"U",Ỳ:"Y",Ỵ:"Y",Ỷ:"Y",Ỹ:"Y",Đ:"D",ạ:"a",ả:"a",ầ:"a",ấ:"a",ậ:"a",ẩ:"a",ẫ:"a",ằ:"a",ắ:"a",ặ:"a",ẳ:"a",ẵ:"a",ẹ:"e",ẻ:"e",ẽ:"e",ề:"e",ế:"e",ệ:"e",ể:"e",ễ:"e",ị:"i",ỉ:"i",ĩ:"i",ọ:"o",ỏ:"o",ồ:"o",ố:"o",ộ:"o",ổ:"o",ỗ:"o",ơ:"o",ờ:"o",ớ:"o",ợ:"o",ở:"o",ỡ:"o",ụ:"u",ủ:"u",ũ:"u",ư:"u",ừ:"u",ứ:"u",ự:"u",ử:"u",ữ:"u",ỳ:"y",ỵ:"y",ỷ:"y",ỹ:"y",đ:"d",Ә:"AE",ә:"ae",Ғ:"GH",ғ:"gh",Қ:"KH",қ:"kh",Ң:"NG",ң:"ng",Ү:"UE",ү:"ue",Ұ:"U",ұ:"u",Һ:"H",һ:"h",Ө:"OE",ө:"oe",ђ:"dj",ј:"j",љ:"lj",њ:"nj",ћ:"c",џ:"dz",Ђ:"Dj",Ј:"j",Љ:"Lj",Њ:"Nj",Ћ:"C",Џ:"Dz",ǌ:"nj",ǉ:"lj",ǋ:"NJ",ǈ:"LJ",अ:"a",आ:"aa",ए:"e",ई:"ii",ऍ:"ei",ऎ:"ae",ऐ:"ai",इ:"i",ओ:"o",ऑ:"oi",ऒ:"oii",ऊ:"uu",औ:"ou",उ:"u",ब:"B",भ:"Bha",च:"Ca",छ:"Chha",ड:"Da",ढ:"Dha",फ:"Fa",ग:"Ga",घ:"Gha",ग़:"Ghi",ह:"Ha",ज:"Ja",झ:"Jha",क:"Ka",ख:"Kha",ख़:"Khi",ल:"L",ळ:"Li",ऌ:"Li",ऴ:"Lii",ॡ:"Lii",म:"Ma",न:"Na",ङ:"Na",ञ:"Nia",ण:"Nae",ऩ:"Ni",ॐ:"oms",प:"Pa",क़:"Qi",र:"Ra",ऋ:"Ri",ॠ:"Ri",ऱ:"Ri",स:"Sa",श:"Sha",ष:"Shha",ट:"Ta",त:"Ta",ठ:"Tha",द:"Tha",थ:"Tha",ध:"Thha",ड़:"ugDha",ढ़:"ugDhha",व:"Va",य:"Ya",य़:"Yi",ज़:"Za",ə:"e",Ə:"E",ა:"a",ბ:"b",გ:"g",დ:"d",ე:"e",ვ:"v",ზ:"z",თ:"t",ი:"i",კ:"k",ლ:"l",მ:"m",ნ:"n",ო:"o",პ:"p",ჟ:"zh",რ:"r",ს:"s",ტ:"t",უ:"u",ფ:"p",ქ:"k",ღ:"gh",ყ:"q",შ:"sh",ჩ:"ch",ც:"ts",ძ:"dz",წ:"ts",ჭ:"ch",ხ:"kh",ჯ:"j",ჰ:"h",ב:"v",גּ:"g",ג:"g",ד:"d",דּ:"d",ה:"h",ו:"v",ז:"z",ח:"h",ט:"t",י:"y",כ:"kh",ך:"kh",ל:"l",מ:"m",ם:"m",נ:"n",ן:"n",ס:"s",פ:"f",ף:"f",ץ:"ts",צ:"ts",ק:"k",ר:"r",תּ:"t",ת:"t"};s.charmap=Object.assign({},h),s.multicharmap=Object.assign({},l),s.defaults={charmap:s.charmap,mode:"pretty",modes:{rfc3986:{replacement:"-",remove:null,lower:!0,charmap:s.charmap,multicharmap:s.multicharmap,trim:!0},pretty:{replacement:"-",remove:null,lower:!0,charmap:s.charmap,multicharmap:s.multicharmap,trim:!0}},multicharmap:s.multicharmap,fallback:!0},s.reset=function(){s.defaults.modes.rfc3986.charmap=s.defaults.modes.pretty.charmap=s.charmap=s.defaults.charmap=Object.assign({},h),s.defaults.modes.rfc3986.multicharmap=s.defaults.modes.pretty.multicharmap=s.multicharmap=s.defaults.multicharmap=Object.assign({},l),a=""},s.extend=function(u){const c=Object.keys(u),d={},p={};for(let f=0;f<c.length;f++)c[f].length>1?d[c[f]]=u[c[f]]:p[c[f]]=u[c[f]];Object.assign(s.charmap,p),Object.assign(s.multicharmap,d)},s.setLocale=function(u){a=n[u]||{}},i.exports?i.exports=s:e.slug=s})(Ms)})(nx);var gO=nx.exports;const mO=Eb(gO);function ya(i,e,t){if(t.has(i))return t.get(i);const r=`${e}-${cs()}`;return t.set(i,r),r}function yO(i,e){const{progressions:t}=i;let r=mO(e,{replacement:"-"});return lm(r,new Set(Object.keys(t)))}function Ga(i,e,t){const r=yO(i,t),s=new Map,n=Object.fromEntries(Object.entries(e.chords).map(([l,h])=>[ya(l,r,s),{...h,id:ya(l,r,s)}])),a=Object.fromEntries(Object.entries(e.bars).map(([l,h])=>[ya(l,r,s),{...h,id:ya(l,r,s),chords:h.chords.map(u=>ya(u,r,s))}])),o={...e.progression,id:r,name:t,bars:e.progression.bars.map(l=>ya(l,r,s))};return{chords:n,bars:a,progression:o}}const ax={chords:{"autumn-leaves-WynJlNt8uWXZHY3-hi7iS":{id:"autumn-leaves-WynJlNt8uWXZHY3-hi7iS",name:"C",type:"MINOR-SEVENTH",root:"C2"},"autumn-leaves-BwFMZMaEpBYzsOYSa0Fm4":{id:"autumn-leaves-BwFMZMaEpBYzsOYSa0Fm4",name:"F",type:"DOMINANT-SEVENTH",root:"F1"},"autumn-leaves-YqBdIrbfsgrqpjwHj1JFM":{id:"autumn-leaves-YqBdIrbfsgrqpjwHj1JFM",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1"},"autumn-leaves-LlCIgBXskn2TZ6luigGMC":{id:"autumn-leaves-LlCIgBXskn2TZ6luigGMC",name:"Eb",type:"MAJOR-SEVENTH",root:"Eb2"},"autumn-leaves-J_NCngYrP8KhNp6DmPcYf":{id:"autumn-leaves-J_NCngYrP8KhNp6DmPcYf",name:"A",type:"DIMINISHED",root:"A1"},"autumn-leaves-cNJXyKyfY6aqI_9S6qYxS":{id:"autumn-leaves-cNJXyKyfY6aqI_9S6qYxS",name:"D",type:"DOMINANT-SEVENTH",root:"D2"},"autumn-leaves-FsLYg7HRZqeDtT8b29Mny":{id:"autumn-leaves-FsLYg7HRZqeDtT8b29Mny",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-ZaauCuq85UEvbd230d7gj":{id:"autumn-leaves-ZaauCuq85UEvbd230d7gj",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-dRkE4J3S_8ObYbCsMx7RL":{id:"autumn-leaves-dRkE4J3S_8ObYbCsMx7RL",name:"C",type:"MINOR-SEVENTH",root:"C2"},"autumn-leaves-3iO4Q67KSFOG50yCCan4x":{id:"autumn-leaves-3iO4Q67KSFOG50yCCan4x",name:"F",type:"DOMINANT-SEVENTH",root:"F1"},"autumn-leaves-K6a3Wu5YlgVcaIvcUb9F0":{id:"autumn-leaves-K6a3Wu5YlgVcaIvcUb9F0",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1"},"autumn-leaves-gQ_xFsLVI6HqTT9HffJqR":{id:"autumn-leaves-gQ_xFsLVI6HqTT9HffJqR",name:"Eb",type:"MAJOR-SEVENTH",root:"Eb2"},"autumn-leaves-1xpkVv5EZNNutDlnX2Bny":{id:"autumn-leaves-1xpkVv5EZNNutDlnX2Bny",name:"A",type:"DIMINISHED",root:"A1"},"autumn-leaves-mpw15D6iAttKKyEw8Qa1-":{id:"autumn-leaves-mpw15D6iAttKKyEw8Qa1-",name:"D",type:"DOMINANT-SEVENTH",root:"D2"},"autumn-leaves-qyi81JkkN-k4nsbBXCBx0":{id:"autumn-leaves-qyi81JkkN-k4nsbBXCBx0",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-Rf8Ez4hc_U_dszUVlSywg":{id:"autumn-leaves-Rf8Ez4hc_U_dszUVlSywg",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-40k-VrFgNqGiEIrOVU0ax":{id:"autumn-leaves-40k-VrFgNqGiEIrOVU0ax",name:"A",type:"DIMINISHED",root:"A1"},"autumn-leaves-9PPfqlZFiZsXGaM-u1xlp":{id:"autumn-leaves-9PPfqlZFiZsXGaM-u1xlp",name:"D",type:"DOMINANT-SEVENTH",root:"D2"},"autumn-leaves-YFgf3DTSFgh8Lr8q7LYrT":{id:"autumn-leaves-YFgf3DTSFgh8Lr8q7LYrT",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-oiDpTPEzuh5nHQmte7X6B":{id:"autumn-leaves-oiDpTPEzuh5nHQmte7X6B",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-8cmAdQhs7pGiN11KDboBv":{id:"autumn-leaves-8cmAdQhs7pGiN11KDboBv",name:"C",type:"MINOR-SEVENTH",root:"C2"},"autumn-leaves-tjrZ5uBy2mEVAwGloUbsJ":{id:"autumn-leaves-tjrZ5uBy2mEVAwGloUbsJ",name:"F",type:"DOMINANT-SEVENTH",root:"F1"},"autumn-leaves-f-ZeS7wI7dST2Fm7_bw_N":{id:"autumn-leaves-f-ZeS7wI7dST2Fm7_bw_N",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1"},"autumn-leaves-F8VBXZXX_rBlGCAkRW7EP":{id:"autumn-leaves-F8VBXZXX_rBlGCAkRW7EP",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1"},"autumn-leaves-effjevDHeQ36K8qFuYPwL":{id:"autumn-leaves-effjevDHeQ36K8qFuYPwL",name:"A",type:"DIMINISHED",root:"A1",tags:[]},"autumn-leaves-cFN-jCVFFaJ1tvLBXvfeG":{id:"autumn-leaves-cFN-jCVFFaJ1tvLBXvfeG",name:"D",type:"DOMINANT-SEVENTH",root:"D2",tags:[]},"autumn-leaves-G6QtKyHVU5ehRxgf5oj_7":{id:"autumn-leaves-G6QtKyHVU5ehRxgf5oj_7",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-3Zrf90Kuua30rM8E_EfzT":{id:"autumn-leaves-3Zrf90Kuua30rM8E_EfzT",name:"Gb",type:"DOMINANT-SEVENTH",root:"Gb1"},"autumn-leaves-QkPGwJGblQPjo7AyYGKGy":{id:"autumn-leaves-QkPGwJGblQPjo7AyYGKGy",name:"F",type:"MINOR-SEVENTH",root:"F1"},"autumn-leaves-a15hE4um-x6X1bFPgSbBE":{id:"autumn-leaves-a15hE4um-x6X1bFPgSbBE",name:"E",type:"DOMINANT-SEVENTH",root:"E1"},"autumn-leaves-ckJY4f0T-s-7g1sDIW_oA":{id:"autumn-leaves-ckJY4f0T-s-7g1sDIW_oA",name:"Eb",type:"MAJOR-SEVENTH",root:"Eb2"},"autumn-leaves-ZsjDW5DwOyaA9UrpBjXoh":{id:"autumn-leaves-ZsjDW5DwOyaA9UrpBjXoh",name:"D",type:"DOMINANT-SEVENTH",root:"D2"},"autumn-leaves-C12vP7f_lCaXVY-mEzI-s":{id:"autumn-leaves-C12vP7f_lCaXVY-mEzI-s",name:"G",type:"MINOR-SEVENTH",root:"G1"},"autumn-leaves-GRCQSDP0r3yP3Bf6I9e7w":{id:"autumn-leaves-GRCQSDP0r3yP3Bf6I9e7w",name:"G",type:"MINOR-SEVENTH",root:"G1"}},bars:{"autumn-leaves-NaQlXYlN5QSWu1hStya9J":{id:"autumn-leaves-NaQlXYlN5QSWu1hStya9J",chords:["autumn-leaves-WynJlNt8uWXZHY3-hi7iS"]},"autumn-leaves-O1pZeKZKtjC8mEqqwbgKw":{id:"autumn-leaves-O1pZeKZKtjC8mEqqwbgKw",chords:["autumn-leaves-BwFMZMaEpBYzsOYSa0Fm4"]},"autumn-leaves-yqqX7iy-b0tMQlzI5OwF5":{id:"autumn-leaves-yqqX7iy-b0tMQlzI5OwF5",chords:["autumn-leaves-YqBdIrbfsgrqpjwHj1JFM"]},"autumn-leaves-kGiyy4LIBr3Ci1-k5J6tJ":{id:"autumn-leaves-kGiyy4LIBr3Ci1-k5J6tJ",chords:["autumn-leaves-LlCIgBXskn2TZ6luigGMC"]},"autumn-leaves-c-edLmaCKL_sSOffK-uuP":{id:"autumn-leaves-c-edLmaCKL_sSOffK-uuP",chords:["autumn-leaves-J_NCngYrP8KhNp6DmPcYf"]},"autumn-leaves-36y9WYGi0RVKFSXv4kFzb":{id:"autumn-leaves-36y9WYGi0RVKFSXv4kFzb",chords:["autumn-leaves-cNJXyKyfY6aqI_9S6qYxS"]},"autumn-leaves-dPZHIqZPJUZq4fJSdBSwu":{id:"autumn-leaves-dPZHIqZPJUZq4fJSdBSwu",chords:["autumn-leaves-FsLYg7HRZqeDtT8b29Mny"]},"autumn-leaves-_2Ph4nghcMhdf6516Ga4X":{id:"autumn-leaves-_2Ph4nghcMhdf6516Ga4X",chords:["autumn-leaves-ZaauCuq85UEvbd230d7gj"]},"autumn-leaves-eB4pvFAjiIcwf8hoOtKz_":{id:"autumn-leaves-eB4pvFAjiIcwf8hoOtKz_",chords:["autumn-leaves-dRkE4J3S_8ObYbCsMx7RL"]},"autumn-leaves-LfCu2KDQ08DV7xGniPbi5":{id:"autumn-leaves-LfCu2KDQ08DV7xGniPbi5",chords:["autumn-leaves-3iO4Q67KSFOG50yCCan4x"]},"autumn-leaves-qSG-juLXYtNMVqDremMYj":{id:"autumn-leaves-qSG-juLXYtNMVqDremMYj",chords:["autumn-leaves-K6a3Wu5YlgVcaIvcUb9F0"]},"autumn-leaves-26uLw3lXFZ-2G0nvrlL9M":{id:"autumn-leaves-26uLw3lXFZ-2G0nvrlL9M",chords:["autumn-leaves-gQ_xFsLVI6HqTT9HffJqR"]},"autumn-leaves-6eQWvsY3FmghX-_oW3U3_":{id:"autumn-leaves-6eQWvsY3FmghX-_oW3U3_",chords:["autumn-leaves-1xpkVv5EZNNutDlnX2Bny"]},"autumn-leaves-XYCZ8b7nh1mz9y4JKgXvA":{id:"autumn-leaves-XYCZ8b7nh1mz9y4JKgXvA",chords:["autumn-leaves-mpw15D6iAttKKyEw8Qa1-"]},"autumn-leaves-PKNLUJJ-WpBeZbNkyczy5":{id:"autumn-leaves-PKNLUJJ-WpBeZbNkyczy5",chords:["autumn-leaves-qyi81JkkN-k4nsbBXCBx0"]},"autumn-leaves-uafIkj2X9SlN6-FJI36NF":{id:"autumn-leaves-uafIkj2X9SlN6-FJI36NF",chords:["autumn-leaves-Rf8Ez4hc_U_dszUVlSywg"]},"autumn-leaves-5CmaG7eqhNg_ryalk3eZG":{id:"autumn-leaves-5CmaG7eqhNg_ryalk3eZG",chords:["autumn-leaves-40k-VrFgNqGiEIrOVU0ax"]},"autumn-leaves-6t-Xi39YaWS0K6pn6_SKR":{id:"autumn-leaves-6t-Xi39YaWS0K6pn6_SKR",chords:["autumn-leaves-9PPfqlZFiZsXGaM-u1xlp"]},"autumn-leaves-bXar2XIDi1RbZ4pBHkNpB":{id:"autumn-leaves-bXar2XIDi1RbZ4pBHkNpB",chords:["autumn-leaves-YFgf3DTSFgh8Lr8q7LYrT"]},"autumn-leaves-Y38TUPVE37nQpKNZW2e21":{id:"autumn-leaves-Y38TUPVE37nQpKNZW2e21",chords:["autumn-leaves-oiDpTPEzuh5nHQmte7X6B"]},"autumn-leaves-W8VlN0iFXfmHfOQIQITVb":{id:"autumn-leaves-W8VlN0iFXfmHfOQIQITVb",chords:["autumn-leaves-8cmAdQhs7pGiN11KDboBv"]},"autumn-leaves-vHmxvrDbPY2jzCoUcvo87":{id:"autumn-leaves-vHmxvrDbPY2jzCoUcvo87",chords:["autumn-leaves-tjrZ5uBy2mEVAwGloUbsJ"]},"autumn-leaves-5SzcqUzmlWQ56tWDleDbB":{id:"autumn-leaves-5SzcqUzmlWQ56tWDleDbB",chords:["autumn-leaves-f-ZeS7wI7dST2Fm7_bw_N"]},"autumn-leaves-uzWqFGDhH2jPQs88P74kJ":{id:"autumn-leaves-uzWqFGDhH2jPQs88P74kJ",chords:["autumn-leaves-F8VBXZXX_rBlGCAkRW7EP"]},"autumn-leaves-Kap35mmRG4x0RWnZNFUQW":{id:"autumn-leaves-Kap35mmRG4x0RWnZNFUQW",chords:["autumn-leaves-effjevDHeQ36K8qFuYPwL"]},"autumn-leaves-UhPK5TDwfT1_NpV_GXbkK":{id:"autumn-leaves-UhPK5TDwfT1_NpV_GXbkK",chords:["autumn-leaves-cFN-jCVFFaJ1tvLBXvfeG"]},"autumn-leaves-ccH0UrtLGRG8SuYPaOlRE":{id:"autumn-leaves-ccH0UrtLGRG8SuYPaOlRE",chords:["autumn-leaves-G6QtKyHVU5ehRxgf5oj_7","autumn-leaves-3Zrf90Kuua30rM8E_EfzT"]},"autumn-leaves-hdHzOndlMCRrsUw6a1ABD":{id:"autumn-leaves-hdHzOndlMCRrsUw6a1ABD",chords:["autumn-leaves-QkPGwJGblQPjo7AyYGKGy","autumn-leaves-a15hE4um-x6X1bFPgSbBE"]},"autumn-leaves-IbqPf74lCMzYsi0yPTGfQ":{id:"autumn-leaves-IbqPf74lCMzYsi0yPTGfQ",chords:["autumn-leaves-ckJY4f0T-s-7g1sDIW_oA"]},"autumn-leaves-ecqsI5gOFdndYCOhe37cv":{id:"autumn-leaves-ecqsI5gOFdndYCOhe37cv",chords:["autumn-leaves-ZsjDW5DwOyaA9UrpBjXoh"]},"autumn-leaves-Ys-6hzl3MiBOtbkIVvOQZ":{id:"autumn-leaves-Ys-6hzl3MiBOtbkIVvOQZ",chords:["autumn-leaves-C12vP7f_lCaXVY-mEzI-s"]},"autumn-leaves-A8cm6k6RNTFmtEusuG1kF":{id:"autumn-leaves-A8cm6k6RNTFmtEusuG1kF",chords:["autumn-leaves-GRCQSDP0r3yP3Bf6I9e7w"]}},progression:{id:"autumn-leaves-zm2PzAVfrCCUZC0hQwmNv",tuning:["G2","D2","A1","E1"],noteCount:4,name:"Autumn Leaves Template",bars:["autumn-leaves-NaQlXYlN5QSWu1hStya9J","autumn-leaves-O1pZeKZKtjC8mEqqwbgKw","autumn-leaves-yqqX7iy-b0tMQlzI5OwF5","autumn-leaves-kGiyy4LIBr3Ci1-k5J6tJ","autumn-leaves-c-edLmaCKL_sSOffK-uuP","autumn-leaves-36y9WYGi0RVKFSXv4kFzb","autumn-leaves-dPZHIqZPJUZq4fJSdBSwu","autumn-leaves-_2Ph4nghcMhdf6516Ga4X","autumn-leaves-eB4pvFAjiIcwf8hoOtKz_","autumn-leaves-LfCu2KDQ08DV7xGniPbi5","autumn-leaves-qSG-juLXYtNMVqDremMYj","autumn-leaves-26uLw3lXFZ-2G0nvrlL9M","autumn-leaves-6eQWvsY3FmghX-_oW3U3_","autumn-leaves-XYCZ8b7nh1mz9y4JKgXvA","autumn-leaves-PKNLUJJ-WpBeZbNkyczy5","autumn-leaves-uafIkj2X9SlN6-FJI36NF","autumn-leaves-5CmaG7eqhNg_ryalk3eZG","autumn-leaves-6t-Xi39YaWS0K6pn6_SKR","autumn-leaves-bXar2XIDi1RbZ4pBHkNpB","autumn-leaves-Y38TUPVE37nQpKNZW2e21","autumn-leaves-W8VlN0iFXfmHfOQIQITVb","autumn-leaves-vHmxvrDbPY2jzCoUcvo87","autumn-leaves-5SzcqUzmlWQ56tWDleDbB","autumn-leaves-uzWqFGDhH2jPQs88P74kJ","autumn-leaves-Kap35mmRG4x0RWnZNFUQW","autumn-leaves-UhPK5TDwfT1_NpV_GXbkK","autumn-leaves-ccH0UrtLGRG8SuYPaOlRE","autumn-leaves-hdHzOndlMCRrsUw6a1ABD","autumn-leaves-IbqPf74lCMzYsi0yPTGfQ","autumn-leaves-ecqsI5gOFdndYCOhe37cv","autumn-leaves-Ys-6hzl3MiBOtbkIVvOQZ","autumn-leaves-A8cm6k6RNTFmtEusuG1kF"]}},ox={chords:{},bars:{},progression:{id:"empty",noteCount:4,tuning:["G2","D2","A1","E1"],name:"Empty",bars:[]}},lx={bars:{"pop-song-1-qIuAuo4aDQTTyIsA53Z_W":{id:"pop-song-1-qIuAuo4aDQTTyIsA53Z_W",chords:["pop-song-1-Vc1EG-eJ3wij-9JW7PjxG"]},"pop-song-1-wwsQ3tv9MzT0nLUCBGgR0":{id:"pop-song-1-wwsQ3tv9MzT0nLUCBGgR0",chords:["pop-song-1-WrOV-fgVqkTHpt9Iog2yl"]},"pop-song-1-3Jwlu0zFQmG2ENVrpl8qd":{id:"pop-song-1-3Jwlu0zFQmG2ENVrpl8qd",chords:["pop-song-1-HI-jhF8fLeMhrRXKVki7L"]},"pop-song-1-W-SSNMqoQD1LTd5Jn-baB":{id:"pop-song-1-W-SSNMqoQD1LTd5Jn-baB",chords:["pop-song-1-52oysKexbC7_5iF5AxojP"]},"pop-song-1-bsd-4rT_TXIrmqCnYm6Ak":{id:"pop-song-1-bsd-4rT_TXIrmqCnYm6Ak",chords:["pop-song-1-tx3sm7AbC2hNS1MZWtUC5"]},"pop-song-1-FcnYwOhKE0GNX5YDkuEXN":{id:"pop-song-1-FcnYwOhKE0GNX5YDkuEXN",chords:["pop-song-1-ZxCv93wUscP--vBZHPjEV"]},"pop-song-1-iRHsHGV2npfhzr68yep5a":{id:"pop-song-1-iRHsHGV2npfhzr68yep5a",chords:["pop-song-1-FO53MOhldkWVcN4jlNqV4"]},"pop-song-1-4LBUq6dLnSlkMgDCxS4aA":{id:"pop-song-1-4LBUq6dLnSlkMgDCxS4aA",chords:["pop-song-1-ZgtwVfKbDlj8gM3kYAX34"]},"pop-song-1-oxUyFReSLrUIEqLC15u4C":{id:"pop-song-1-oxUyFReSLrUIEqLC15u4C",chords:["pop-song-1-QPAU8BhhPNSJvHkScyxn7"]},"pop-song-1-OF9c_o_3N5Wi0Oclinw9Z":{id:"pop-song-1-OF9c_o_3N5Wi0Oclinw9Z",chords:["pop-song-1-za-8KKoFlXRM45JsXfF8z"]},"pop-song-1-rLdJcPNDGlny8bxhGI5Qa":{id:"pop-song-1-rLdJcPNDGlny8bxhGI5Qa",chords:["pop-song-1-XmVx_9gon8phtLiCNRKeM"]},"pop-song-1-zuixJBYrkGXz7hI1E6Ph2":{id:"pop-song-1-zuixJBYrkGXz7hI1E6Ph2",chords:["pop-song-1-kyDxtERtc8--7QKK-NyEt"]},"pop-song-1-B6aQy2tGdC78W-sHc815m":{id:"pop-song-1-B6aQy2tGdC78W-sHc815m",chords:["pop-song-1-bCqghYtFzSRFLnLdVHwUX"]},"pop-song-1-ScBDcKxqhn0jbFT-invVn":{id:"pop-song-1-ScBDcKxqhn0jbFT-invVn",chords:["pop-song-1-tboQuB0IlPzZ5uWA0x1CE"]},"pop-song-1-nz17rtg7GMuCuaKgEsW4y":{id:"pop-song-1-nz17rtg7GMuCuaKgEsW4y",chords:["pop-song-1-K1jOwYelDFOQN5WS0lNRq"]},"pop-song-1-NYyMzVmSC7fXGyKNq9TTX":{id:"pop-song-1-NYyMzVmSC7fXGyKNq9TTX",chords:["pop-song-1-av4OOISO7XWhgnOkwVV3V"]},"pop-song-1-nXqM5TPgJz6VFBul5q2Wx":{id:"pop-song-1-nXqM5TPgJz6VFBul5q2Wx",chords:["pop-song-1-jGgPEtYXrQnqTYSkqVJrL"]},"pop-song-1-Pg1wYW84STb9j_xQXrL6-":{id:"pop-song-1-Pg1wYW84STb9j_xQXrL6-",chords:["pop-song-1-mywDqyxlDOK3B7Ka4ZIpo"]},"pop-song-1-bQm5vDpHpLWViR4ztp9EK":{id:"pop-song-1-bQm5vDpHpLWViR4ztp9EK",chords:["pop-song-1-zhK-IGeCp24sdfvMG70of"]},"pop-song-1-2-PZAKLTZgk-dzL-Ez3td":{id:"pop-song-1-2-PZAKLTZgk-dzL-Ez3td",chords:["pop-song-1-PC8rXli91ouFRXH3XldO1"]},"pop-song-1-TG9zZ-0gXJcXTwvSFp26e":{id:"pop-song-1-TG9zZ-0gXJcXTwvSFp26e",chords:["pop-song-1-gIYBkBOlcdm7ZAmS_BG96"]},"pop-song-1-u4XgX5NQBqx2MAe00CdSL":{id:"pop-song-1-u4XgX5NQBqx2MAe00CdSL",chords:["pop-song-1-NxDkVyx5AdBVz0CuicKZ4"]},"pop-song-1-ZJlFJ2PNiwZ4GY7BGLwuw":{id:"pop-song-1-ZJlFJ2PNiwZ4GY7BGLwuw",chords:["pop-song-1-ndyDpwx5k0OqWbd9J1oEA"]},"pop-song-1-2InaOI02hK6I90wh8iw0_":{id:"pop-song-1-2InaOI02hK6I90wh8iw0_",chords:["pop-song-1-DG3BGPpSacy0iN6YfR4zZ"]},"pop-song-1-7gbzo4eAfbTHT47v4THHk":{id:"pop-song-1-7gbzo4eAfbTHT47v4THHk",chords:["pop-song-1-dY9HY0rgj7sk_udwQIDUI"]},"pop-song-1-ISKyguTKV6Ly5Va_oaIad":{id:"pop-song-1-ISKyguTKV6Ly5Va_oaIad",chords:["pop-song-1-Un5ZSxXktuR_PVKEtsfzd"]},"pop-song-1-Gr0yPOo0Fuz-wGQIRsDUs":{id:"pop-song-1-Gr0yPOo0Fuz-wGQIRsDUs",chords:["pop-song-1-yjCwalMCOa3g2ESTjzod-","pop-song-1-F7xXlZy_xDJ7Iz4Soxykc"]},"pop-song-1-XqMQl2h2jUG0tRd-JeQDF":{id:"pop-song-1-XqMQl2h2jUG0tRd-JeQDF",chords:["pop-song-1-6rUDc4PL7OUENHE0885vS","pop-song-1-ZAob4SrtAo1ETURvb92aU"]},"pop-song-1-lpBMzQ_hrl_pT1wWF-fwo":{id:"pop-song-1-lpBMzQ_hrl_pT1wWF-fwo",chords:["pop-song-1-TOJTLviVSapIo3xOiQhE2"]},"pop-song-1-_aikcR2m2czBqQGFbAUPF":{id:"pop-song-1-_aikcR2m2czBqQGFbAUPF",chords:["pop-song-1-htwvbqfLNMfHdV5IwxnQT"]},"pop-song-1-D8vjsDpoQJyW-MjFbueHD":{id:"pop-song-1-D8vjsDpoQJyW-MjFbueHD",chords:["pop-song-1-NtLDHPLQbBDta70vWrV6Y"]},"pop-song-1-Qc31CQqJYmSOpzd99oErs":{id:"pop-song-1-Qc31CQqJYmSOpzd99oErs",chords:["pop-song-1-vqrKpw3N4TNtqEhszM08H"]},I6eeyXIMunCx8sf7vN9ns:{id:"I6eeyXIMunCx8sf7vN9ns",chords:["Z5vsASB1VftNHM619jwoR"]},"Y8prv9H-PgYQ3_l_YmDNu":{id:"Y8prv9H-PgYQ3_l_YmDNu",chords:["qT_uLfkOeEK5jlWjhljIH"]},CJVoKXLBbEMDt0Q9mGoYw:{id:"CJVoKXLBbEMDt0Q9mGoYw",chords:["CNJk27V9yL9p4Fstrkz0A"]},oZ7fH8GzFA55U6V4Rt_RP:{id:"oZ7fH8GzFA55U6V4Rt_RP",chords:["vAkCIfINp9vJcmqdCqltG"]},"2wIxsAhovD21C0CcV9M6I":{id:"2wIxsAhovD21C0CcV9M6I",chords:["zjBUtk7s9FuMfLdPc9Wsq"]},"KVXMSLmk16hD-AWT3IHPa":{id:"KVXMSLmk16hD-AWT3IHPa",chords:["nEPJKVx0rxrFXnYUW7nTf"]},aIANv9TSnW3sop0mYmnMJ:{id:"aIANv9TSnW3sop0mYmnMJ",chords:["_OxY6GxGEbvuDIenQpuNk"]},kInEsg3rC489M9E6MHRZW:{id:"kInEsg3rC489M9E6MHRZW",chords:["wjGaAPDgunpWO6Qar0B7W"]},fiKKVm4pPowxlsFwaa2yL:{id:"fiKKVm4pPowxlsFwaa2yL",chords:["jle98VDKu2SuLZZlUAul1"]},"7D-PwW_OdU6X_ZkifaM4E":{id:"7D-PwW_OdU6X_ZkifaM4E",chords:["I4IgvFRWj65GcAjy70xVy"]},"8pW5mBtRvne7DqZeNKg51":{id:"8pW5mBtRvne7DqZeNKg51",chords:["zJAxqcSnwl7XLrnF1PhlO"]},"7MHRGE0hSM8KPNdL5ogZT":{id:"7MHRGE0hSM8KPNdL5ogZT",chords:["glly4WY89nbNVxUiZS1L5"]},"lh492YRPr1_3-X1W_mJkE":{id:"lh492YRPr1_3-X1W_mJkE",chords:["yDkF9XpcbKi17othzHAtU"]},"dy-Pe9Kor5sYut2YqZZnq":{id:"dy-Pe9Kor5sYut2YqZZnq",chords:["5cr_VRnxxrUh2fp7JtI0q"]},AVobrClqosfmFICzH4XJb:{id:"AVobrClqosfmFICzH4XJb",chords:["ejSvbgqz4n3cm9stavm9D"]},"imT9nu-fnX012riKPlOzU":{id:"imT9nu-fnX012riKPlOzU",chords:["8ASsz6KpPWRow-Np80jlw"]},FsPyvn908XbeiMHZ2dwYW:{id:"FsPyvn908XbeiMHZ2dwYW",chords:["UOpwzhbGvIRBlupONeZez"]},"1JuD0Shgvmcei9a5awVlU":{id:"1JuD0Shgvmcei9a5awVlU",chords:["ks_fADjB0VROjEpIGI9SD"]},"uAJHw6OHhl8KUl-756EEZ":{id:"uAJHw6OHhl8KUl-756EEZ",chords:["ZjWOywKMoESBn7rFzBu68"]},egbLaSaQrp9pz92v7F3yb:{id:"egbLaSaQrp9pz92v7F3yb",chords:["nme6br7Zr_3CwoXnK6yMw"]},NpklWphie8nVyO23_Y6sc:{id:"NpklWphie8nVyO23_Y6sc",chords:["KkGbGqsjZuwVvwhWrzsF1"]},lmqyAakOy2FYpPJ5iUtll:{id:"lmqyAakOy2FYpPJ5iUtll",chords:["W0oh7HnRNCkAUU6ALNW3w"]},zwcSoX_FKO0RNIot7PWCG:{id:"zwcSoX_FKO0RNIot7PWCG",chords:["6FBISXQ0BcPyuvWUnPQxU"]},"yluFxCrXTEm-YpQDi_qX3":{id:"yluFxCrXTEm-YpQDi_qX3",chords:["-xJHytcdXXLqYFFxXosOg"]}},chords:{"pop-song-1-Vc1EG-eJ3wij-9JW7PjxG":{id:"pop-song-1-Vc1EG-eJ3wij-9JW7PjxG",name:"C",type:"MINOR-SEVENTH",root:"C2",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-WrOV-fgVqkTHpt9Iog2yl":{id:"pop-song-1-WrOV-fgVqkTHpt9Iog2yl",name:"F",type:"DOMINANT-SEVENTH",root:"F1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-HI-jhF8fLeMhrRXKVki7L":{id:"pop-song-1-HI-jhF8fLeMhrRXKVki7L",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-52oysKexbC7_5iF5AxojP":{id:"pop-song-1-52oysKexbC7_5iF5AxojP",name:"Eb",type:"MAJOR-SEVENTH",root:"Eb2",transitionId:"S?;T?;C,R->C,T,D->C,F,U->N,R+1;"},"pop-song-1-tx3sm7AbC2hNS1MZWtUC5":{id:"pop-song-1-tx3sm7AbC2hNS1MZWtUC5",name:"A",type:"DIMINISHED",root:"A1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-ZxCv93wUscP--vBZHPjEV":{id:"pop-song-1-ZxCv93wUscP--vBZHPjEV",name:"D",type:"DOMINANT-SEVENTH",root:"D2",transitionId:"S?;T?;C,R->C,T,D->C,F,U->N,R-1;"},"pop-song-1-FO53MOhldkWVcN4jlNqV4":{id:"pop-song-1-FO53MOhldkWVcN4jlNqV4",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-ZgtwVfKbDlj8gM3kYAX34":{id:"pop-song-1-ZgtwVfKbDlj8gM3kYAX34",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-QPAU8BhhPNSJvHkScyxn7":{id:"pop-song-1-QPAU8BhhPNSJvHkScyxn7",name:"C",type:"MINOR-SEVENTH",root:"C2",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-za-8KKoFlXRM45JsXfF8z":{id:"pop-song-1-za-8KKoFlXRM45JsXfF8z",name:"F",type:"DOMINANT-SEVENTH",root:"F1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-XmVx_9gon8phtLiCNRKeM":{id:"pop-song-1-XmVx_9gon8phtLiCNRKeM",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1",transitionId:"S?;T?;C,R->C,T,U->C,F,D->N,R+1;"},"pop-song-1-kyDxtERtc8--7QKK-NyEt":{id:"pop-song-1-kyDxtERtc8--7QKK-NyEt",name:"Eb",type:"MAJOR-SEVENTH",root:"Eb2",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-bCqghYtFzSRFLnLdVHwUX":{id:"pop-song-1-bCqghYtFzSRFLnLdVHwUX",name:"A",type:"DIMINISHED",root:"A1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-tboQuB0IlPzZ5uWA0x1CE":{id:"pop-song-1-tboQuB0IlPzZ5uWA0x1CE",name:"D",type:"DOMINANT-SEVENTH",root:"D2",transitionId:"S?;T?;C,R->C,T,D->C,F,U->N,R-1;"},"pop-song-1-K1jOwYelDFOQN5WS0lNRq":{id:"pop-song-1-K1jOwYelDFOQN5WS0lNRq",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-av4OOISO7XWhgnOkwVV3V":{id:"pop-song-1-av4OOISO7XWhgnOkwVV3V",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-jGgPEtYXrQnqTYSkqVJrL":{id:"pop-song-1-jGgPEtYXrQnqTYSkqVJrL",name:"A",type:"DIMINISHED",root:"A1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-mywDqyxlDOK3B7Ka4ZIpo":{id:"pop-song-1-mywDqyxlDOK3B7Ka4ZIpo",name:"D",type:"DOMINANT-SEVENTH",root:"D2",transitionId:"S?;T?;C,R->C,T,U->C,F,D->N,R-1;"},"pop-song-1-zhK-IGeCp24sdfvMG70of":{id:"pop-song-1-zhK-IGeCp24sdfvMG70of",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-PC8rXli91ouFRXH3XldO1":{id:"pop-song-1-PC8rXli91ouFRXH3XldO1",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-gIYBkBOlcdm7ZAmS_BG96":{id:"pop-song-1-gIYBkBOlcdm7ZAmS_BG96",name:"C",type:"MINOR-SEVENTH",root:"C2",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-NxDkVyx5AdBVz0CuicKZ4":{id:"pop-song-1-NxDkVyx5AdBVz0CuicKZ4",name:"F",type:"DOMINANT-SEVENTH",root:"F1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-ndyDpwx5k0OqWbd9J1oEA":{id:"pop-song-1-ndyDpwx5k0OqWbd9J1oEA",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-DG3BGPpSacy0iN6YfR4zZ":{id:"pop-song-1-DG3BGPpSacy0iN6YfR4zZ",name:"Bb",type:"MAJOR-SEVENTH",root:"Bb1",transitionId:"S?;T?;C,R->C,T,U->C,F,D->N,R-1;"},"pop-song-1-dY9HY0rgj7sk_udwQIDUI":{id:"pop-song-1-dY9HY0rgj7sk_udwQIDUI",name:"A",type:"DIMINISHED",root:"A1",tags:[],transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-Un5ZSxXktuR_PVKEtsfzd":{id:"pop-song-1-Un5ZSxXktuR_PVKEtsfzd",name:"D",type:"DOMINANT-SEVENTH",root:"D2",tags:[],transitionId:"S?;T?;C,R->C,T,D->C,F,D->N,R+1;"},"pop-song-1-yjCwalMCOa3g2ESTjzod-":{id:"pop-song-1-yjCwalMCOa3g2ESTjzod-",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-F7xXlZy_xDJ7Iz4Soxykc":{id:"pop-song-1-F7xXlZy_xDJ7Iz4Soxykc",name:"Gb",type:"DOMINANT-SEVENTH",root:"Gb1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-6rUDc4PL7OUENHE0885vS":{id:"pop-song-1-6rUDc4PL7OUENHE0885vS",name:"F",type:"MINOR-SEVENTH",root:"F1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-ZAob4SrtAo1ETURvb92aU":{id:"pop-song-1-ZAob4SrtAo1ETURvb92aU",name:"E",type:"DOMINANT-SEVENTH",root:"E1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R-1;"},"pop-song-1-TOJTLviVSapIo3xOiQhE2":{id:"pop-song-1-TOJTLviVSapIo3xOiQhE2",name:"Eb",type:"MAJOR-SEVENTH",root:"Eb2",transitionId:"S?;T?;C,R->C,T,D->C,F,U->N,R+1;"},"pop-song-1-htwvbqfLNMfHdV5IwxnQT":{id:"pop-song-1-htwvbqfLNMfHdV5IwxnQT",name:"D",type:"DOMINANT-SEVENTH",root:"D2",transitionId:"S?;T?;C,R->C,T,D->C,F,U->N,R-1;"},"pop-song-1-NtLDHPLQbBDta70vWrV6Y":{id:"pop-song-1-NtLDHPLQbBDta70vWrV6Y",name:"G",type:"MINOR-SEVENTH",root:"G1",transitionId:"S?;T?;C,R->C,T,U->C,F,U->N,R+1;"},"pop-song-1-vqrKpw3N4TNtqEhszM08H":{id:"pop-song-1-vqrKpw3N4TNtqEhszM08H",name:"G",type:"MINOR-SEVENTH",root:"G1"},Z5vsASB1VftNHM619jwoR:{id:"Z5vsASB1VftNHM619jwoR",name:"A",type:"MINOR",root:"A1"},qT_uLfkOeEK5jlWjhljIH:{id:"qT_uLfkOeEK5jlWjhljIH",name:"A",type:"MINOR",root:"A1"},CNJk27V9yL9p4Fstrkz0A:{id:"CNJk27V9yL9p4Fstrkz0A",name:"A",type:"MINOR",root:"A1"},vAkCIfINp9vJcmqdCqltG:{id:"vAkCIfINp9vJcmqdCqltG",name:"A",type:"MINOR",root:"A1"},zjBUtk7s9FuMfLdPc9Wsq:{id:"zjBUtk7s9FuMfLdPc9Wsq",name:"D",type:"MINOR",root:"D2"},nEPJKVx0rxrFXnYUW7nTf:{id:"nEPJKVx0rxrFXnYUW7nTf",name:"D",type:"MINOR",root:"D2"},_OxY6GxGEbvuDIenQpuNk:{id:"_OxY6GxGEbvuDIenQpuNk",name:"A",type:"MINOR",root:"A1"},wjGaAPDgunpWO6Qar0B7W:{id:"wjGaAPDgunpWO6Qar0B7W",name:"A",type:"MINOR",root:"A1"},jle98VDKu2SuLZZlUAul1:{id:"jle98VDKu2SuLZZlUAul1",name:"E",type:"MINOR",root:"E1"},I4IgvFRWj65GcAjy70xVy:{id:"I4IgvFRWj65GcAjy70xVy",name:"D",type:"MINOR",root:"D2"},zJAxqcSnwl7XLrnF1PhlO:{id:"zJAxqcSnwl7XLrnF1PhlO",name:"A",type:"MINOR",root:"A1"},glly4WY89nbNVxUiZS1L5:{id:"glly4WY89nbNVxUiZS1L5",name:"E",type:"DOMINANT-SEVENTH",root:"E1"},"8ASsz6KpPWRow-Np80jlw":{id:"8ASsz6KpPWRow-Np80jlw",name:"A",type:"MINOR",root:"A1"},UOpwzhbGvIRBlupONeZez:{id:"UOpwzhbGvIRBlupONeZez",name:"D",type:"MINOR",root:"D2"},ks_fADjB0VROjEpIGI9SD:{id:"ks_fADjB0VROjEpIGI9SD",name:"D",type:"MINOR",root:"D2"},ZjWOywKMoESBn7rFzBu68:{id:"ZjWOywKMoESBn7rFzBu68",name:"A",type:"MINOR",root:"A1"},nme6br7Zr_3CwoXnK6yMw:{id:"nme6br7Zr_3CwoXnK6yMw",name:"A",type:"MINOR",root:"A1"},KkGbGqsjZuwVvwhWrzsF1:{id:"KkGbGqsjZuwVvwhWrzsF1",name:"E",type:"MINOR",root:"E1"},W0oh7HnRNCkAUU6ALNW3w:{id:"W0oh7HnRNCkAUU6ALNW3w",name:"D",type:"MINOR",root:"D2"},"-xJHytcdXXLqYFFxXosOg":{id:"-xJHytcdXXLqYFFxXosOg",name:"E",type:"DOMINANT-SEVENTH",root:"E1"},"6FBISXQ0BcPyuvWUnPQxU":{id:"6FBISXQ0BcPyuvWUnPQxU",name:"A",type:"MINOR",root:"A1"},yDkF9XpcbKi17othzHAtU:{id:"yDkF9XpcbKi17othzHAtU",name:"A",type:"MINOR",root:"A1"},"5cr_VRnxxrUh2fp7JtI0q":{id:"5cr_VRnxxrUh2fp7JtI0q",name:"A",type:"MINOR",root:"A1"},ejSvbgqz4n3cm9stavm9D:{id:"ejSvbgqz4n3cm9stavm9D",name:"A",type:"MINOR",root:"A1"}},progression:{id:"am-blues-V-71I_mwXUn606roHVWrY",noteCount:4,tuning:["G2","D2","A1","E1"],name:"A Minor blues",bars:["lh492YRPr1_3-X1W_mJkE","dy-Pe9Kor5sYut2YqZZnq","AVobrClqosfmFICzH4XJb","imT9nu-fnX012riKPlOzU","FsPyvn908XbeiMHZ2dwYW","1JuD0Shgvmcei9a5awVlU","uAJHw6OHhl8KUl-756EEZ","egbLaSaQrp9pz92v7F3yb","NpklWphie8nVyO23_Y6sc","lmqyAakOy2FYpPJ5iUtll","zwcSoX_FKO0RNIot7PWCG","yluFxCrXTEm-YpQDi_qX3"]}},bO=M`
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px;
`,wO=M`
  font-size: 1.6em;
  color: #ffffff;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
`,SO=M`
  font-size: 1.4em;
  color: #ffffff;
  cursor: pointer;
`,vO=M`
  display: flex;
  flex-direction: row;
  gap: 20px;
`,kO=M`
  display: flex;
  flex-direction: column;
  align-items: center;
  border-radius: 10px;
  flex: 1;
  width: 300px;
  background-color: #ffffff10;
  gap: 16px;
  padding: 16px;
  cursor: pointer;
  color: #ffffffcc;
  &:hover {
    background-color: #ffffff30;
    color: #ffffff;
  }
`,xO=M`
  outline: 2px solid #ffffff50;
  background-color: #ffffff30;
  color: #ffffff;
  &:hover {
    outline: 2px solid #ffffff50;
    background-color: #ffffff30;
    color: #ffffff;
  }
`,BO=M`
  font-size: 6em;
`,_O=M`
  font-size: 1.6em;
`,TO=M`
  font-size: 1em;
  text-align: center;
`,CO=M`
  display: flex;
  flex-direction: row;
  gap: 14px;
`,NO=M`
  border-radius: 6px;
  background-color: #ffffff10;
  flex: 1;
  color: #ffffff;
  border: none;
  outline: none;
  padding: 10px 14px;
  font-size: 1em;
  &:hover {
    background-color: #ffffff30;
  }

  &:focus {
    background-color: #ffffff50;
  }
`,PO=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border: none;
  color: #ffffffdd;
  padding: 8px 16px;
  gap: 6px;
  cursor: pointer;
  font-size: 1em;
  border-radius: 6px;
  background-color: transparent;
  background-color: #ffffff10;
  &:hover {
    color: #fff;
    background-color: #ffffff20;
  }
  &:disabled {
    background-color: transparent;
    color: #ffffff50;
    cursor: not-allowed;
  }
`,EO=[{name:"From scratch",Icon:_k,description:"Create your own progression from scratch.",factory:(i,e)=>Ga(e,ox,i)},{name:"A Minor Blues",Icon:wl,description:"Simple minor blues progression, focusing on i, iv and v chords.",factory:(i,e)=>Ga(e,lx,i)},{name:"Autumn Leaves",Icon:wl,description:"Autumn Leaves in G minor. For practicing both the major and minor ii V I",factory:(i,e)=>Ga(e,ax,i)}],hx=({onClose:i,canClose:e})=>{const[t,r]=T.useState(""),[s,n]=T.useState(),[a,o]=T.useState(!0),l=Zt(f=>f),h=Gc(),u=Zt(ai.selectors.getProgressions),c=T.useMemo(()=>{const f=Te(s)?"Progression":s.name;return lm(f,new Set(u.map(({name:m})=>m))," ")},[s,u]),d=wr(),p=()=>{if(Te(s))return;const f=s.factory(a?c:t,l);d({type:"global/createProgressionFromTemplate",payload:{template:f}}),h(Ul.editor(f.progression.id)),e&&i()};return k.jsx(Pk,{onBackdropClick:i,children:k.jsxs("div",{className:bO,children:[k.jsxs("header",{className:wO,children:[k.jsx("span",{children:"New progression"}),e&&k.jsx(km,{className:SO,onClick:i})]}),k.jsx("div",{className:vO,children:EO.map(f=>{const m=ea(kO,f===s?xO:null);return k.jsxs("div",{className:m,onClick:()=>n(f),children:[k.jsx("header",{className:_O,children:f.name}),k.jsx(f.Icon,{className:BO}),k.jsx("div",{className:TO,children:f.description})]},f.name)})}),k.jsxs("div",{className:CO,children:[k.jsx("input",{type:"text",className:NO,value:a?c:t,onChange:f=>{r(f.target.value),o(!1)},onBlur:()=>{t.length===0&&o(!0)}}),k.jsxs("button",{type:"button",className:PO,disabled:Te(s),onClick:p,children:[k.jsx(Uc,{})," Create"]})]})]})})},MO=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  position: relative;
  background-color: #ffffff20;
  height: 70px;
  width: 100%;
  padding: 0px 50px;
`,x1=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
`,Bh=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border: none;
  color: #ffffffdd;
  padding: 8px 16px;
  gap: 6px;
  cursor: pointer;
  font-size: 1em;
  border-radius: 6px;
  background-color: transparent;
  &:hover {
    color: #fff;
    background-color: #ffffff20;
  }
  &:disabled {
    background-color: transparent;
    color: #ffffff50;
    cursor: not-allowed;
  }
`,_h=M`
  font-size: 1.2em;
`,LO=M`
  background-color: #181818;
  border-radius: 12px;
  width: 280px;
  height: 340px;
  overflow: hidden;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 12px;
`,RO=()=>{const[i,e]=T.useState(!1),[t,r]=T.useState(!1),[s,n]=T.useState(!1),a=Hi(),{canAutoFillTransitions:o,canClearTransitions:l}=Zt(b=>Nk(b,a.id)),h=wr(),u=()=>{const b={type:"global/fillTransitions",payload:{progressionId:a==null?void 0:a.id}};h(b)},c=()=>{const b={type:"global/clearTransitions",payload:{progressionId:a==null?void 0:a.id}};h(b)},d=()=>e(!0),p=()=>e(!1),f=()=>r(!0),m=()=>r(!1),S=()=>n(!0),y=()=>n(!1);return k.jsxs(k.Fragment,{children:[i&&k.jsx(VI,{onClose:p}),s&&k.jsx(hx,{onClose:y,canClose:!0}),k.jsxs("div",{className:MO,children:[k.jsxs("div",{className:x1,children:[k.jsx(As.Popover,{isOpen:t,onClickOutside:m,clickOutsideCapture:!0,positions:["bottom","right","left"],content:({position:b,childRect:w,popoverRect:x})=>k.jsx(As.ArrowContainer,{position:b,childRect:w,popoverRect:x,arrowColor:"#181818",arrowSize:10,children:k.jsx("div",{className:LO,children:k.jsx(pO,{setOpen:r,add:S})})}),children:k.jsxs("button",{className:Bh,onClick:f,children:[k.jsx(KM,{className:_h}),(a==null?void 0:a.name)??""]})}),k.jsxs("button",{className:Bh,disabled:!o,onClick:u,children:[k.jsx(VM,{className:_h}),"Fill transitions"]}),k.jsxs("button",{className:Bh,disabled:!l,onClick:c,children:[k.jsx(Gl,{className:_h}),"Clear transitions"]})]}),k.jsx("div",{className:x1,children:k.jsxs("button",{disabled:Te(a==null?void 0:a.id),className:Bh,onClick:d,children:[k.jsx(Tk,{className:_h}),"Settings"]})})]})]})};function FO(i){const e=new Set;return i.forEach(t=>{w2.forEach(r=>{const s=er(t,r),n=Za.enharmonic(s);e.add(s).add(n)})}),Array.from(e)}const IO=Object.keys(Wv),OO=Object.keys(Gv),DO=i=>Gv[i],AO=M`
  display: flex;
  flex-direction: row;
`,Th=i=>({...i,fontSize:"1.2em",color:"#ffffff"}),Yu={input:Th,singleValue:Th,menuList:i=>({...Th(i),backgroundColor:"#181818"}),placeholder:Th,control:i=>({...i,borderWidth:"0px",boxShadow:"none",backgroundColor:"transparent"}),option:(i,{isSelected:e,isFocused:t})=>({...i,backgroundColor:e?"#ffffff40":t?"#ffffff30":"transparent",":active":{backgroundColor:"#ffffff30"}})},VO={...Yu,menu:i=>({...i,minWidth:"60px"})},HO={...Yu,menu:i=>({...i,minWidth:"180px"})},WO={...Yu,control:(i,e)=>({...Yu.control(i,e),":before":{color:"#fff",content:'"/"'}}),menu:i=>({...i,minWidth:"60px"})},qd={DropdownIndicator:()=>null,IndicatorSeparator:()=>null},zO=({chord:i,onChange:e})=>{const t=`${i.id}-input`,r=Hi(),s=T.useMemo(()=>FO(r==null?void 0:r.tuning),[r==null?void 0:r.tuning]),n=T.useMemo(()=>E0(i.name,s).sort(),[s,i.name]),a=h=>{const u=E0(h,s);e({...i,name:h,root:u[u.length-1]})},o=h=>{e({...i,type:h})},l=h=>{e({...i,root:h})};return T.useEffect(()=>{var h;(h=document.getElementById(t))==null||h.focus()},[]),k.jsxs("div",{className:AO,children:[k.jsx(tu,{id:t,value:i.name,values:IO,placeholder:"Note",styles:VO,components:qd,autoFocus:!0,onChange:a}),k.jsx(tu,{value:i.type,values:OO,placeholder:"Type",components:qd,styles:HO,onChange:o,getLabel:DO}),k.jsx(tu,{value:i.root,components:qd,values:n,placeholder:"Root",styles:WO,onChange:l})]})};function ux(i,e,t,r){const s=ai.selectors.getProgression(i,e),n=ur.selectors.getBar(i,t),a=Wt.selectors.getChord(i,r);if(Te(s)||Te(n)||Te(a))return;const o=n.chords.indexOf(a.id);if(o<0)return;const l=n.chords[o+1];if(!Te(l))return Wt.selectors.getChord(i,l);const h=s.bars.indexOf(n.id);if(h<0)return;const u=s.bars[h+1];if(Te(u))return;const c=ur.selectors.getBar(i,u);if(!(Te(c)||c.chords.length===0))return Wt.selectors.getChord(i,c.chords[0])}function GO(i,e){const t=[];for(let r=0;r<i.length;r+=1){const s=i[r],n=s.transitions.filter(e);n.length>0&&t.push({...s,transitions:n})}return t}const UO=i=>i.transitions,YO=i=>i.id,$O=i=>i.name,XO=i=>i.id,jO=i=>i.name,qO=(i,e)=>i.name.toLowerCase().includes(e.toLowerCase()),QO="No transitions found! Consider changing the root notes, your preferences, or search criteria",KO=({setOpen:i,chordId:e,barId:t})=>{const r=Hi(),s=Zt(u=>Wt.selectors.getChord(u,e)),n=r.tuning,a=Zt(u=>ux(u,r.id,t,e)),o=T.useMemo(()=>GO(Vv,u=>Yv(s,a,n,u)),[s,a,n]),l=wr(),h=({id:u})=>{l(Wt.actions.updateChord({chord:{id:e,transitionId:u}})),i(!1)};return k.jsx(Lm,{categories:o,canSearch:!0,canCreate:!1,onItemClick:h,getChildren:UO,getCategoryKey:YO,getCategoryLabel:$O,getItemKey:XO,getItemLabel:jO,matches:qO,noHitsLabel:QO})};function cx(i,e){T.useEffect(()=>{if(e){const t=r=>{r.key==="Escape"&&i()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}return()=>{}},[e])}const JO=M`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
`,B1=M`
  color: #ffffffdd;
  border-radius: 6px;
  cursor: pointer;
  transition: box-shadow 0.2s ease, background-color 0.2s ease;
  user-select: none;
  overflow: hidden;
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: center;
  border: none;
  background-color: #ffffff30;
  &:hover {
    background-color: #ffffff40;
    box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
  }
  &:focus {
    outline: none;
    background-color: #ffffff40;
  }
`,ZO=M`
  color: #fff;
  cursor: pointer;
  position: relative;
  display: inline;
  top: 3px;
`,e3=M`
  border-top-left-radius: 6px;
  border-bottom-left-radius: 6px;
  padding: 4px 10px;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  font-size: 1.2em;
  border: none;
  color: #fff;
  background-color: transparent;
  cursor: pointer;
  &:hover {
    background-color: #ffffff40;
  }
  &:focus {
    outline: none;
    background-color: #ffffff40;
  }
`,t3=M`
  border-top-right-radius: 6px;
  border-bottom-right-radius: 6px;
  flex-shrink: 0;
  padding: 4px 10px;
  display: flex;
  flex-direction: row;
  border: none;
  align-items: center;
  justify-content: center;
  background-color: transparent;
  color: #fff;
  cursor: pointer;
  &:focus {
    outline: none;
    background-color: #ffffff40;
  }
  &:hover {
    background-color: #ffffff40;
  }
`,i3=M`
  position: relative;
  top: -1px;
  font-size: 1em;
  flex-shrink: 0;
`,r3=M`
  text-overflow: ellipsis;
  white-space: nowrap;
  padding: 4px 10px;
  font-size: 1.2em;
`,s3=M`
  background-color: #181818;
  border-radius: 12px;
  width: 280px;
  height: 340px;
  overflow: hidden;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 12px;
`,n3=({chordId:i,barId:e})=>{const[t,r]=T.useState(!1),s=Zt(u=>Wt.selectors.getChord(u,i)),n=s!=null&&s.transitionId?am[s.transitionId]:void 0,a=wr(),o=()=>r(!1),l=()=>r(!t),h=()=>{a(Wt.actions.updateChord({chord:{id:i,transitionId:void 0}})),o()};return cx(o,t),k.jsx(As.Popover,{isOpen:t,onClickOutside:o,clickOutsideCapture:!0,positions:["bottom","right","left"],content:({position:u,childRect:c,popoverRect:d})=>k.jsx(As.ArrowContainer,{position:u,childRect:c,popoverRect:d,arrowColor:"#181818",arrowSize:10,children:k.jsx("div",{className:s3,children:k.jsx(KO,{isOpen:t,setOpen:r,barId:e,chordId:i})})}),children:k.jsxs("div",{className:JO,children:[Te(n)&&k.jsx("button",{className:B1,onClick:l,children:k.jsxs("div",{className:r3,children:[k.jsx(Bk,{className:ZO})," Walk"]})}),!Te(n)&&k.jsxs("div",{className:B1,children:[k.jsx("button",{className:e3,onClick:l,children:n.name}),k.jsx("button",{className:t3,onClick:h,children:k.jsx(Gl,{className:i3})})]})]})})};function $u(i){if(!i)return"Missing";const e=`${i.name}${hm(i.type)}`,[t]=fl(i.root);return i.name!==t?`${e}/${i.root}`:e}const a3=["#387BA8","#7A5265","#37A347","#A37F37","#6B37A3","#6C654B","#A3377A","#A36137","#A3A337","#37A391","#A34537","#29357A"].reduce((i,e,t)=>((p2[t]??[]).forEach(s=>{i[s]=e}),i),{}),o3=[[1,2,4]],l3=i=>i,h3=i=>"counts",u3=i=>"Select note count",c3=i=>i.toString(),d3=i=>`${i} Notes`,f3=(i,e)=>!0,p3=({setOpen:i,chordId:e})=>{const t=wr(),r=s=>{t(Wt.actions.updateChord({chord:{id:e,noteCount:s}})),i(!1)};return k.jsx(Lm,{categories:o3,canSearch:!1,canCreate:!1,onItemClick:r,getChildren:l3,getCategoryKey:h3,getCategoryLabel:u3,getItemKey:c3,getItemLabel:d3,matches:f3,noHitsLabel:""})},g3=M`
  cursor: pointer;
  color: #ffffffbb;
  &:hover {
    color: #ffffff;
  }
`,m3=M`
  background-color: #181818;
  border-radius: 12px;
  width: 280px;
  height: 140px;
  overflow: hidden;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 12px;
`,y3=({chordId:i})=>{const[e,t]=T.useState(!1),r=()=>t(!1),s=()=>t(!0),n=Hi(),a=Zt(l=>Wt.selectors.getChord(l,i)),o=(a==null?void 0:a.noteCount)??(n==null?void 0:n.noteCount);return k.jsx(As.Popover,{isOpen:e,onClickOutside:r,clickOutsideCapture:!0,positions:["bottom","right","left"],content:({position:l,childRect:h,popoverRect:u})=>k.jsx(As.ArrowContainer,{position:l,childRect:h,popoverRect:u,arrowColor:"#181818",arrowSize:10,children:k.jsx("div",{className:m3,children:k.jsx(p3,{setOpen:t,chordId:i})})}),children:k.jsxs("span",{className:g3,onClick:s,children:[o," Notes"]})})},_1=M`
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  border-radius: 10px;
  height: 138px;
  padding: 12px 14px 8px 14px;
`,b3=M`
  display: flex;
  width: 100%;
  justify-content: space-between;
  flex-direction: row;
`,w3=M`
  position: relative;
  top: -10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
`,T1=M`
  font-weight: bold;
  color: #ffffffde;
  padding: 0px 15px;
  font-size: 2em;
  text-align: center;
  text-shadow: 0px 0px 0px transparent;
  transition: text-shadow 0.2s ease, color 0.2s ease;
  user-select: none;
  cursor: pointer;
  &:hover {
    color: #ffffffff;
    text-shadow: 0px 6px 8px #00000040;
  }
`,S3=M`
  cursor: pointer;
  color: #ffffffbb;
  &:hover {
    color: #ffffff;
  }
`,v3=M`
  background-color: #181818;
  border-radius: 12px;
  padding: 8px;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 12px;
`,k3=({barId:i,chordId:e})=>{const t=Hi(),r=Zt(y=>Wt.selectors.getChord(y,e)),s=Zt(y=>ux(y,t==null?void 0:t.id,i,e)),n=wr(),[a,o]=T.useState(!1),[l,h]=T.useState(!1),u=()=>o(!a),c=()=>o(!1),d=y=>{n(Wt.actions.updateChord({chord:y}))},p=()=>{n(ur.actions.removeChords({barId:i,chordIds:[e]})),n(Wt.actions.deleteChord({chordId:e}))},f=()=>h(!0),m=()=>h(!1),S=r!=null&&r.name?a3[r==null?void 0:r.name]:"transparent";return cx(c,a),Te(r)?k.jsx("div",{className:_1,style:{background:S},children:k.jsx("div",{className:T1,children:$u(r)})}):k.jsxs("div",{className:_1,style:{background:S},onMouseEnter:f,onMouseLeave:m,children:[k.jsxs("div",{className:b3,children:[k.jsx(Gl,{className:S3,style:{visibility:l?"visible":"hidden"},onClick:p}),k.jsx(y3,{chordId:e})]}),k.jsxs("div",{className:w3,children:[k.jsx(As.Popover,{isOpen:a,onClickOutside:c,clickOutsideCapture:!0,positions:["bottom","top","right","left"],content:({position:y,childRect:b,popoverRect:w})=>k.jsx(As.ArrowContainer,{position:y,childRect:b,popoverRect:w,arrowColor:"#181818",arrowSize:10,children:k.jsx("div",{className:v3,children:k.jsx(zO,{chord:r,onChange:d})})}),children:k.jsx("div",{onClick:u,className:T1,children:k.jsx("span",{children:$u(r)})})}),s!==void 0?k.jsx(n3,{barId:i,chordId:e}):null]})]})};function x3(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 19H5c-1 0-2-1-2-2V7c0-1 1-2 2-2h3"},child:[]},{tag:"path",attr:{d:"M16 5h3c1 0 2 1 2 2v10c0 1-1 2-2 2h-3"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"4",y2:"20"},child:[]}]})(i)}const C1=M`
  display: flex;
  flex-direction: column;
  gap: 0px;
  border-radius: 10px;
  background-color: #ffffff30;
  transition: box-shadow 0.2s ease, background-color 0.2s ease;
  box-shadow: none;
  height: 183px;
  &:hover {
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px,
      rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
    background-color: #ffffff35;
  }
`,N1=M`
  display: flex;
  flex: 1;
  flex-direction: row;
  gap: 10px;
  padding: 10px 10px 0px 10px;
  position: relative;
`,P1=M`
  display: flex;
  padding: 6px 10px;
  align-items: center;
  justify-content: space-between;
  color: #fff;
  font-size: 1em;
`,B3=M`
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  top: 60px;
  right: 10px;
  bottom: 50px;
  border-radius: 10px;
  width: 40px;
  /* background: linear-gradient(90deg, #00000000 0%, #00000030 100%); ; */
`,_3=M`
  font-weight: bold;
  color: #ffffffaa;
  padding: 0px 15px;
  font-size: 2em;
  text-align: center;
  transition: color 0.2s ease, border-color 0.2s ease,
    background-color 0.2s ease;
  display: flex;
  flex: 1;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  gap: 10px;
  padding: 14px;
  border: 2px dashed #ffffff30;
  background-color: #ffffff15;
  cursor: pointer;
  &:hover {
    color: #ffffffcc;
    background: #ffffff25;
    border-color: #ffffff60;
  }
`,T3=M`
  color: #fff;
  font-size: 1.8em;
  cursor: pointer;
`,C3=M``,N3=M`
  color: #ffffffbb;
  cursor: pointer;
  &:hover {
    color: #ffffff;
  }
`,P3=({barId:i,count:e})=>{const[t,r]=T.useState(!1),[s,n]=T.useState(!1),a=Zt(y=>ur.selectors.getBar(y,i)),o=Hi(),l=Zt(y=>{var w;if(((w=a==null?void 0:a.chords)==null?void 0:w.length)!==1)return;const b=a==null?void 0:a.chords[0];return Wt.selectors.getChord(y,b)}),h=wr(),u=()=>{const y=(a==null?void 0:a.chords)??[];h(ai.actions.removeBars({progressionId:o==null?void 0:o.id,barIds:[i]})),h(ur.actions.deleteBar({barId:i})),h(Wt.actions.deleteChords({chordIds:y}))},c=()=>{if(l)return;const y={id:cs(),name:"C",type:"MAJOR",root:"C2"};h(Wt.actions.createChord({chord:y})),h(ur.actions.addChords({barId:i,chordIds:[y.id]}))},d=()=>{if(!l)return;const y={...l,id:cs(),transitionId:void 0};h(Wt.actions.createChord({chord:y})),h(ur.actions.addChords({barId:i,chordIds:[y.id]}))},p=()=>r(!0),f=()=>r(!1),m=()=>n(!0),S=()=>n(!1);return a?k.jsxs("div",{className:C1,onMouseEnter:p,onMouseLeave:f,children:[k.jsxs("div",{className:N1,onMouseEnter:m,onMouseLeave:S,children:[a.chords.map((y,b)=>k.jsx(k3,{barId:i,chordId:y},b)),a.chords.length===1&&s?k.jsx("div",{className:B3,children:k.jsx(x3,{className:T3,onClick:d})}):null,a.chords.length===0?k.jsxs("div",{className:_3,onClick:c,children:[k.jsx(xk,{className:C3})," Chord"]}):null]}),k.jsxs("div",{className:P1,children:[k.jsxs("span",{children:["＃",e]}),t?k.jsx(Gl,{className:N3,onClick:u}):null]})]}):k.jsxs("div",{className:C1,children:[k.jsxs("div",{className:N1,children:['Bar "',i,`" doesn't exist!`]}),k.jsxs("div",{className:P1,children:["＃",e]})]})},E3=M`
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  border-radius: 10px;
  border: 2px dashed #ffffff30;
  background: transparent;
  height: 170px;
  overflow: hidden;
  transition: border-color 0.2s ease, background-color 0.2s ease;
  cursor: pointer;
  &:hover {
    background: #ffffff10;
    border-color: #ffffff60;
  }
`,M3=M`
  font-weight: bold;
  color: #ffffffaa;
  font-size: 2em;
  text-align: center;
  transition: color 0.2s ease;
  display: flex;
  flex: 1;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  gap: 10px;
  margin: 10px;
  padding: 14px;
  width: 100%;
  height: 100%;
  &:hover {
    color: #ffffffcc;
  }
`,L3=M``,R3=()=>{const i=Hi(),e=wr(),t=()=>{const r={id:cs(),chords:[]};e(ur.actions.createBar({bar:r})),e(ai.actions.addBars({progressionId:i==null?void 0:i.id,barIds:[r.id]}))};return k.jsx("div",{className:E3,onClick:t,children:k.jsxs("div",{className:M3,children:[k.jsx(xk,{className:L3})," Bar"]})})},F3=M`
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-auto-rows: 1fr;
  gap: 16px;
  padding: 22px 60px;
  overflow: auto;
  max-height: calc(100vh - 100px - 70px);
  & * {
    overflow: hidden;
  }
`,I3=()=>{const i=Hi();return Te(i)?null:k.jsxs("div",{className:F3,children:[i.bars.map((e,t)=>k.jsx(P3,{barId:e,count:t+1},e)),k.jsx(R3,{})]})},O3=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 6px;
  margin-right: 60px;
  &:hover,
  &:active,
  &:visited {
    text-decoration: none;
  }
`,D3=M`
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
`,A3=M`
  color: #fff;
  font-size: 3.4em;
`,V3=M`
  color: #fff;
  font-size: 2.4em;
  font-weight: bold;
  line-height: 90%;
  margin: 0px;
`,H3=M`
  color: #ffffff99;
  font-size: 0.8em;
  line-height: 90%;
  font-weight: normal;
`,W3=()=>k.jsxs("a",{className:O3,href:"#/",children:[k.jsx(Bk,{className:A3}),k.jsxs("span",{className:D3,children:[k.jsx("h1",{className:V3,children:"Stick"}),k.jsx("h2",{className:H3,children:"helps you walk."})]})]}),z3=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  height: 100px;
  width: 100%;
  padding: 14px 50px;
`,Rm=({children:i})=>k.jsxs("div",{className:z3,children:[k.jsx(W3,{}),i]}),G3=M`
  display: flex;
  flex-direction: row;
  gap: 16px;
`,E1=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 8px;
  border-radius: 10px;
  padding: 8px 16px;
  color: #ddd;
  font-size: 1.4em;
  background: transparent;
  transition: color 0.2s ease, background-color 0.2s ease;
  cursor: pointer;
  text-decoration: none;
  &:hover {
    background: #ffffff30;
    color: #fff;
  }

  * {
    &:hover,
    &:active,
    &:visited {
      text-decoration: none !important;
    }
  }

  &:hover,
  &:active,
  &:visited {
    text-decoration: none !important;
  }
`,U3=M`
  background: #ffffff30;
  color: #fff;
`,Y3=[{icon:JM,label:"Editor",path:"editor"},{icon:Du,label:"Score",path:"score"}],dx=()=>{const{pathname:i}=vm(),e=Hi();return k.jsx("div",{className:G3,children:Y3.map(({path:t,icon:r,label:s})=>{const n=Ul[t](e.id),a=i===n?ea(E1,U3):E1;return k.jsxs("a",{href:`#${n}`,className:a,children:[k.jsx(r,{})," ",s]},t)})})},$3=()=>{const i=Hi(),e=Zt(ai.selectors.getProgressions),t=e.length===0,r=Gc();return T.useEffect(()=>{Te(i==null?void 0:i.id)&&e.length>0&&r(Ul.editor(e[0].id))},[e,i==null?void 0:i.id]),k.jsxs(k.Fragment,{children:[k.jsx(Rm,{children:k.jsx(dx,{})}),k.jsx(RO,{}),t&&k.jsx(hx,{canClose:!1,onClose:()=>{}}),!Te(i==null?void 0:i.id)&&k.jsx(I3,{})]})};var Es;(function(i){i[i.Page=0]="Page",i[i.Horizontal=1]="Horizontal"})(Es||(Es={}));var Ui;(function(i){i[i.Default=0]="Default",i[i.ScoreTab=1]="ScoreTab",i[i.Score=2]="Score",i[i.Tab=3]="Tab",i[i.TabMixed=4]="TabMixed"})(Ui||(Ui={}));class Bs{static getValue(e){return Bs._values||(Bs._values=new Map),e=e.toLowerCase().replaceAll(" ",""),Bs._values.has(e)?Bs._values.get(e):0}static isPiano(e){return e<=7||e>=16&&e<=23}static isGuitar(e){return e>=24&&e<=39||e===105||e===43}}Bs._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);class co{init(e,t){this.data=e,this.settings=t}}var Ut;(function(i){i[i.General=0]="General",i[i.Format=1]="Format",i[i.AlphaTex=2]="AlphaTex"})(Ut||(Ut={}));class Yt extends Error{constructor(e,t="",r){super(t??"",{cause:r}),this.type=e,this.inner=r??null,Object.setPrototypeOf(this,Yt.prototype)}}class tt extends Yt{constructor(e=null,t=null){super(Ut.Format,e??"Unsupported format"),this.inner=t,Object.setPrototypeOf(this,tt.prototype)}}var Et;(function(i){i[i.None=0]="None",i[i.Normal=1]="Normal",i[i.Heavy=2]="Heavy"})(Et||(Et={}));var Dt;(function(i){i[i.Tempo=0]="Tempo",i[i.Volume=1]="Volume",i[i.Instrument=2]="Instrument",i[i.Balance=3]="Balance"})(Dt||(Dt={}));class ii{constructor(){this.isLinear=!1,this.type=Dt.Tempo,this.value=0,this.ratioPosition=0,this.text=""}static buildTempoAutomation(e,t,r,s){(s<1||s>5)&&(s=2);let n=new Float32Array([1,.5,1,1.5,2,3]),a=new ii;return a.type=Dt.Tempo,a.isLinear=e,a.ratioPosition=t,a.value=r*n[s],a}static buildInstrumentAutomation(e,t,r){let s=new ii;return s.type=Dt.Instrument,s.isLinear=e,s.ratioPosition=t,s.value=r,s}}var ae;(function(i){i[i.Neutral=0]="Neutral",i[i.C3=1]="C3",i[i.C4=2]="C4",i[i.F4=3]="F4",i[i.G2=4]="G2"})(ae||(ae={}));var Le;(function(i){i[i._15ma=0]="_15ma",i[i._8va=1]="_8va",i[i.Regular=2]="Regular",i[i._8vb=3]="_8vb",i[i._15mb=4]="_15mb"})(Le||(Le={}));var fr;(function(i){i[i.None=0]="None",i[i.Simple=1]="Simple",i[i.FirstOfDouble=2]="FirstOfDouble",i[i.SecondOfDouble=3]="SecondOfDouble"})(fr||(fr={}));class Gs{constructor(){this.id=Gs._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=ae.G2,this.clefOttava=Le.Regular,this.voices=[],this.simileMark=fr.None,this.isMultiVoice=!1,this.displayScale=1,this.displayWidth=-1}get masterBar(){return this.staff.track.score.masterBars[this.index]}get isEmpty(){for(let e=0,t=this.voices.length;e<t;e++)if(!this.voices[e].isEmpty)return!1;return!0}addVoice(e){e.bar=this,e.index=this.voices.length,this.voices.push(e)}finish(e,t=null){this.isMultiVoice=!1;for(let r=0,s=this.voices.length;r<s;r++){let n=this.voices[r];n.finish(e,t),r>0&&!n.isEmpty&&(this.isMultiVoice=!0)}}calculateDuration(){let e=0;for(let t of this.voices){let r=t.calculateDuration();r>e&&(e=r)}return e}}Gs._globalBarId=0;class oe{static ticksToMillis(e,t){return e*(6e4/(t*oe.QuarterTime))|0}static millisToTicks(e,t){return e/(6e4/(t*oe.QuarterTime))|0}static toTicks(e){return oe.valueToTicks(e)}static valueToTicks(e){let t=e;return t<0&&(t=1/-t),oe.QuarterTime*(4/t)|0}static applyDot(e,t){return t?e+(e/4|0)*3:e+(e/2|0)}static applyTuplet(e,t,r){return e*r/t|0}static removeTuplet(e,t,r){return e*t/r|0}static dynamicToVelocity(e){return oe.MinVelocity+e*oe.VelocityIncrement}}oe.QuarterTime=960;oe.MinVelocity=15;oe.VelocityIncrement=16;class V{constructor(e=0,t=0){this.offset=e,this.value=t}}V.MaxPosition=60;V.MaxValue=12;var De;(function(i){i[i.Default=0]="Default",i[i.Gradual=1]="Gradual",i[i.Fast=2]="Fast"})(De||(De={}));var X;(function(i){i[i.None=0]="None",i[i.Custom=1]="Custom",i[i.Bend=2]="Bend",i[i.Release=3]="Release",i[i.BendRelease=4]="BendRelease",i[i.Hold=5]="Hold",i[i.Prebend=6]="Prebend",i[i.PrebendBend=7]="PrebendBend",i[i.PrebendRelease=8]="PrebendRelease"})(X||(X={}));var Ye;(function(i){i[i.None=0]="None",i[i.BrushUp=1]="BrushUp",i[i.BrushDown=2]="BrushDown",i[i.ArpeggioUp=3]="ArpeggioUp",i[i.ArpeggioDown=4]="ArpeggioDown"})(Ye||(Ye={}));var Ii;(function(i){i[i.None=0]="None",i[i.Crescendo=1]="Crescendo",i[i.Decrescendo=2]="Decrescendo"})(Ii||(Ii={}));var B;(function(i){i[i.QuadrupleWhole=-4]="QuadrupleWhole",i[i.DoubleWhole=-2]="DoubleWhole",i[i.Whole=1]="Whole",i[i.Half=2]="Half",i[i.Quarter=4]="Quarter",i[i.Eighth=8]="Eighth",i[i.Sixteenth=16]="Sixteenth",i[i.ThirtySecond=32]="ThirtySecond",i[i.SixtyFourth=64]="SixtyFourth",i[i.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",i[i.TwoHundredFiftySixth=256]="TwoHundredFiftySixth"})(B||(B={}));var pe;(function(i){i[i.PPP=0]="PPP",i[i.PP=1]="PP",i[i.P=2]="P",i[i.MP=3]="MP",i[i.MF=4]="MF",i[i.F=5]="F",i[i.FF=6]="FF",i[i.FFF=7]="FFF"})(pe||(pe={}));var K;(function(i){i[i.None=0]="None",i[i.OnBeat=1]="OnBeat",i[i.BeforeBeat=2]="BeforeBeat",i[i.BendGrace=3]="BendGrace"})(K||(K={}));var ne;(function(i){i[i.Unknown=-2]="Unknown",i[i.NoOrDead=-1]="NoOrDead",i[i.Thumb=0]="Thumb",i[i.IndexFinger=1]="IndexFinger",i[i.MiddleFinger=2]="MiddleFinger",i[i.AnnularFinger=3]="AnnularFinger",i[i.LittleFinger=4]="LittleFinger"})(ne||(ne={}));var q;(function(i){i[i.None=0]="None",i[i.Natural=1]="Natural",i[i.Artificial=2]="Artificial",i[i.Pinch=3]="Pinch",i[i.Tap=4]="Tap",i[i.Semi=5]="Semi",i[i.Feedback=6]="Feedback"})(q||(q={}));var kt;(function(i){i[i.Default=0]="Default",i[i.ForceNone=1]="ForceNone",i[i.ForceNatural=2]="ForceNatural",i[i.ForceSharp=3]="ForceSharp",i[i.ForceDoubleSharp=4]="ForceDoubleSharp",i[i.ForceFlat=5]="ForceFlat",i[i.ForceDoubleFlat=6]="ForceDoubleFlat"})(kt||(kt={}));var zt;(function(i){i[i.None=0]="None",i[i.IntoFromBelow=1]="IntoFromBelow",i[i.IntoFromAbove=2]="IntoFromAbove"})(zt||(zt={}));var he;(function(i){i[i.None=0]="None",i[i.Shift=1]="Shift",i[i.Legato=2]="Legato",i[i.OutUp=3]="OutUp",i[i.OutDown=4]="OutDown",i[i.PickSlideDown=5]="PickSlideDown",i[i.PickSlideUp=6]="PickSlideUp"})(he||(he={}));var Pe;(function(i){i[i.None=0]="None",i[i.Slight=1]="Slight",i[i.Wide=2]="Wide"})(Pe||(Pe={}));var _s;(function(i){i[i.Hidden=0]="Hidden",i[i.ShowWithBeams=1]="ShowWithBeams",i[i.ShowWithBars=2]="ShowWithBars"})(_s||(_s={}));var jr;(function(i){i[i.ScoreDefault=0]="ScoreDefault",i[i.ScoreForcePiano=1]="ScoreForcePiano",i[i.SingleNoteEffectBand=2]="SingleNoteEffectBand",i[i.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano"})(jr||(jr={}));var Ot;(function(i){i[i.GuitarPro=0]="GuitarPro",i[i.SongBook=1]="SongBook"})(Ot||(Ot={}));var te;(function(i){i[i.ScoreTitle=0]="ScoreTitle",i[i.ScoreSubTitle=1]="ScoreSubTitle",i[i.ScoreArtist=2]="ScoreArtist",i[i.ScoreAlbum=3]="ScoreAlbum",i[i.ScoreWords=4]="ScoreWords",i[i.ScoreMusic=5]="ScoreMusic",i[i.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",i[i.ScoreCopyright=7]="ScoreCopyright",i[i.GuitarTuning=8]="GuitarTuning",i[i.TrackNames=9]="TrackNames",i[i.ChordDiagrams=10]="ChordDiagrams",i[i.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",i[i.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",i[i.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",i[i.EffectAlternateEndings=14]="EffectAlternateEndings",i[i.EffectCapo=15]="EffectCapo",i[i.EffectChordNames=16]="EffectChordNames",i[i.EffectCrescendo=17]="EffectCrescendo",i[i.EffectDynamics=18]="EffectDynamics",i[i.EffectFadeIn=19]="EffectFadeIn",i[i.EffectFermata=20]="EffectFermata",i[i.EffectFingering=21]="EffectFingering",i[i.EffectHarmonics=22]="EffectHarmonics",i[i.EffectLetRing=23]="EffectLetRing",i[i.EffectLyrics=24]="EffectLyrics",i[i.EffectMarker=25]="EffectMarker",i[i.EffectOttavia=26]="EffectOttavia",i[i.EffectPalmMute=27]="EffectPalmMute",i[i.EffectPickSlide=28]="EffectPickSlide",i[i.EffectPickStroke=29]="EffectPickStroke",i[i.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",i[i.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",i[i.EffectTap=32]="EffectTap",i[i.EffectTempo=33]="EffectTempo",i[i.EffectText=34]="EffectText",i[i.EffectTrill=35]="EffectTrill",i[i.EffectTripletFeel=36]="EffectTripletFeel",i[i.EffectWhammyBar=37]="EffectWhammyBar",i[i.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",i[i.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",i[i.EffectLeftHandTap=40]="EffectLeftHandTap"})(te||(te={}));class Sl{constructor(){this.notationMode=Ot.GuitarPro,this.fingeringMode=jr.ScoreDefault,this.elements=new Map,this.rhythmMode=_s.Hidden,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}isNotationElementVisible(e){return this.elements.has(e)?this.elements.get(e):Sl.defaultElements.has(e)?Sl.defaultElements.get(e):!0}}Sl.defaultElements=new Map([[te.ZerosOnDiveWhammys,!1]]);class fx{constructor(e){this._value=void 0,this._factory=e}get value(){return this._value===void 0&&(this._value=this._factory()),this._value}}var Hr;(function(i){i[i.None=0]="None",i[i.Debug=1]="Debug",i[i.Info=2]="Info",i[i.Warning=3]="Warning",i[i.Error=4]="Error"})(Hr||(Hr={}));class On{static format(e,t){return`[AlphaTab][${e}] ${t}`}debug(e,t,...r){console.debug(On.format(e,t),...r)}warning(e,t,...r){console.warn(On.format(e,t),...r)}info(e,t,...r){console.info(On.format(e,t),...r)}error(e,t,...r){console.error(On.format(e,t),...r)}}On.logLevel=Hr.Info;class L{static shouldLog(e){return L.logLevel!==Hr.None&&e>=L.logLevel}static debug(e,t,...r){L.shouldLog(Hr.Debug)&&L.log.debug(e,t,...r)}static warning(e,t,...r){L.shouldLog(Hr.Warning)&&L.log.warning(e,t,...r)}static info(e,t,...r){L.shouldLog(Hr.Info)&&L.log.info(e,t,...r)}static error(e,t,...r){L.shouldLog(Hr.Error)&&L.log.error(e,t,...r)}}L.logLevel=Hr.Info;L.log=new On;class X3{constructor(){this.note=null,this.noteValue=0,this.octave=0}get realValue(){return this.octave*12+this.noteValue}}class $e{static getIndex(e){let t=0;return e<0?t:Math.log2(e)|0}static keySignatureIsFlat(e){return e<0}static keySignatureIsNatural(e){return e===0}static keySignatureIsSharp(e){return e>0}static applyPitchOffsets(e,t){for(let r=0;r<t.tracks.length;r++){if(r<e.notation.displayTranspositionPitches.length)for(let s of t.tracks[r].staves)s.displayTranspositionPitch=-e.notation.displayTranspositionPitches[r];if(r<e.notation.transpositionPitches.length)for(let s of t.tracks[r].staves)s.transpositionPitch=-e.notation.transpositionPitches[r]}}static fingerToString(e,t,r,s){if(e.notation.fingeringMode===jr.ScoreForcePiano||e.notation.fingeringMode===jr.SingleNoteEffectBandForcePiano||Bs.isPiano(t.voice.bar.staff.track.playbackInfo.program))switch(r){case ne.Unknown:case ne.NoOrDead:return null;case ne.Thumb:return"1";case ne.IndexFinger:return"2";case ne.MiddleFinger:return"3";case ne.AnnularFinger:return"4";case ne.LittleFinger:return"5";default:return null}if(s)switch(r){case ne.Unknown:case ne.NoOrDead:return"0";case ne.Thumb:return"T";case ne.IndexFinger:return"1";case ne.MiddleFinger:return"2";case ne.AnnularFinger:return"3";case ne.LittleFinger:return"4";default:return null}switch(r){case ne.Unknown:case ne.NoOrDead:return null;case ne.Thumb:return"p";case ne.IndexFinger:return"i";case ne.MiddleFinger:return"m";case ne.AnnularFinger:return"a";case ne.LittleFinger:return"c";default:return null}}static isTuning(e){return!!$e.parseTuning(e)}static parseTuning(e){let t="",r="";for(let n=0;n<e.length;n++){let a=e.charCodeAt(n);if(a>=48&&a<=57){if(!t)return null;r+=String.fromCharCode(a)}else if(a>=65&&a<=90||a>=97&&a<=122||a===35)t+=String.fromCharCode(a);else return null}if(!r||!t)return null;let s=new X3;return s.octave=parseInt(r)+1,s.note=t.toLowerCase(),s.noteValue=$e.getToneForText(s.note),s}static getTuningForText(e){let t=$e.parseTuning(e);return t?t.realValue:-1}static getToneForText(e){switch(e.toLowerCase()){case"c":return 0;case"c#":case"db":return 1;case"d":return 2;case"d#":case"eb":return 3;case"e":return 4;case"f":return 5;case"f#":case"gb":return 6;case"g":return 7;case"g#":case"ab":return 8;case"a":return 9;case"a#":case"bb":return 10;case"b":return 11;default:return 0}}static newGuid(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)}static isAlmostEqualTo(e,t){return Math.abs(e-t)<1e-5}static toHexString(e,t=0){let r="",s="0123456789ABCDEF";do r=String.fromCharCode(s.charCodeAt(e&15))+r,e=e>>4;while(e>0);for(;r.length<t;)r="0"+r;return r}}var Jt;(function(i){i[i.None=0]="None",i[i.Up=1]="Up",i[i.Down=2]="Down"})(Jt||(Jt={}));var g;(function(i){i[i.None=-1]="None",i[i.GClef=57424]="GClef",i[i.CClef=57436]="CClef",i[i.FClef=57442]="FClef",i[i.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",i[i.SixStringTabClef=57453]="SixStringTabClef",i[i.FourStringTabClef=57454]="FourStringTabClef",i[i.TimeSig0=57472]="TimeSig0",i[i.TimeSig1=57473]="TimeSig1",i[i.TimeSig2=57474]="TimeSig2",i[i.TimeSig3=57475]="TimeSig3",i[i.TimeSig4=57476]="TimeSig4",i[i.TimeSig5=57477]="TimeSig5",i[i.TimeSig6=57478]="TimeSig6",i[i.TimeSig7=57479]="TimeSig7",i[i.TimeSig8=57480]="TimeSig8",i[i.TimeSig9=57481]="TimeSig9",i[i.TimeSigCommon=57482]="TimeSigCommon",i[i.TimeSigCutCommon=57483]="TimeSigCutCommon",i[i.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",i[i.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",i[i.NoteheadWhole=57506]="NoteheadWhole",i[i.NoteheadHalf=57507]="NoteheadHalf",i[i.NoteheadBlack=57508]="NoteheadBlack",i[i.NoteheadNull=57509]="NoteheadNull",i[i.NoteheadXOrnate=57514]="NoteheadXOrnate",i[i.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",i[i.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",i[i.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",i[i.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",i[i.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",i[i.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",i[i.NoteheadCircleX=57523]="NoteheadCircleX",i[i.NoteheadXWhole=57511]="NoteheadXWhole",i[i.NoteheadXHalf=57512]="NoteheadXHalf",i[i.NoteheadXBlack=57513]="NoteheadXBlack",i[i.NoteheadParenthesis=57550]="NoteheadParenthesis",i[i.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",i[i.NoteheadCircleSlash=57591]="NoteheadCircleSlash",i[i.NoteheadHeavyX=57592]="NoteheadHeavyX",i[i.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",i[i.NoteheadSlashVerticalEnds=57600]="NoteheadSlashVerticalEnds",i[i.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",i[i.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",i[i.NoteQuarterUp=57813]="NoteQuarterUp",i[i.NoteEighthUp=57815]="NoteEighthUp",i[i.Tremolo3=57890]="Tremolo3",i[i.Tremolo2=57889]="Tremolo2",i[i.Tremolo1=57888]="Tremolo1",i[i.FlagEighthUp=57920]="FlagEighthUp",i[i.FlagEighthDown=57921]="FlagEighthDown",i[i.FlagSixteenthUp=57922]="FlagSixteenthUp",i[i.FlagSixteenthDown=57923]="FlagSixteenthDown",i[i.FlagThirtySecondUp=57924]="FlagThirtySecondUp",i[i.FlagThirtySecondDown=57925]="FlagThirtySecondDown",i[i.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",i[i.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",i[i.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",i[i.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",i[i.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",i[i.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",i[i.AccidentalFlat=57952]="AccidentalFlat",i[i.AccidentalNatural=57953]="AccidentalNatural",i[i.AccidentalSharp=57954]="AccidentalSharp",i[i.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",i[i.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",i[i.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",i[i.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",i[i.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",i[i.ArticAccentAbove=58528]="ArticAccentAbove",i[i.ArticStaccatoAbove=58530]="ArticStaccatoAbove",i[i.ArticMarcatoAbove=58540]="ArticMarcatoAbove",i[i.FermataAbove=58560]="FermataAbove",i[i.FermataShortAbove=58564]="FermataShortAbove",i[i.FermataLongAbove=58566]="FermataLongAbove",i[i.RestLonga=58593]="RestLonga",i[i.RestDoubleWhole=58594]="RestDoubleWhole",i[i.RestWhole=58595]="RestWhole",i[i.RestHalf=58596]="RestHalf",i[i.RestQuarter=58597]="RestQuarter",i[i.RestEighth=58598]="RestEighth",i[i.RestSixteenth=58599]="RestSixteenth",i[i.RestThirtySecond=58600]="RestThirtySecond",i[i.RestSixtyFourth=58601]="RestSixtyFourth",i[i.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",i[i.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",i[i.Repeat1Bar=58624]="Repeat1Bar",i[i.Repeat2Bars=58625]="Repeat2Bars",i[i.Ottava=58640]="Ottava",i[i.OttavaAlta=58641]="OttavaAlta",i[i.OttavaBassaVb=58652]="OttavaBassaVb",i[i.Quindicesima=58644]="Quindicesima",i[i.QuindicesimaAlta=58645]="QuindicesimaAlta",i[i.DynamicPPP=58666]="DynamicPPP",i[i.DynamicPP=58667]="DynamicPP",i[i.DynamicPiano=58656]="DynamicPiano",i[i.DynamicMP=58668]="DynamicMP",i[i.DynamicMF=58669]="DynamicMF",i[i.DynamicForte=58658]="DynamicForte",i[i.DynamicFF=58671]="DynamicFF",i[i.DynamicFFF=58672]="DynamicFFF",i[i.OrnamentTrill=58726]="OrnamentTrill",i[i.StringsDownBow=58896]="StringsDownBow",i[i.StringsUpBow=58898]="StringsUpBow",i[i.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",i[i.GuitarString0=59443]="GuitarString0",i[i.GuitarString1=59444]="GuitarString1",i[i.GuitarString2=59445]="GuitarString2",i[i.GuitarString3=59446]="GuitarString3",i[i.GuitarString4=59447]="GuitarString4",i[i.GuitarString5=59448]="GuitarString5",i[i.GuitarString6=59449]="GuitarString6",i[i.GuitarString7=59450]="GuitarString7",i[i.GuitarString8=59451]="GuitarString8",i[i.GuitarString9=59452]="GuitarString9",i[i.GuitarGolpe=59458]="GuitarGolpe",i[i.FretboardX=59481]="FretboardX",i[i.FretboardO=59482]="FretboardO",i[i.WiggleTrill=60068]="WiggleTrill",i[i.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",i[i.OctaveBaselineM=60565]="OctaveBaselineM",i[i.OctaveBaselineB=60563]="OctaveBaselineB"})(g||(g={}));var Q;(function(i){i[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"})(Q||(Q={}));var le;(function(i){i[i.Top=0]="Top",i[i.Middle=1]="Middle",i[i.Bottom=2]="Bottom"})(le||(le={}));class Jc{constructor(e,t){this.width=e,this.height=t}}class z{constructor(e="",t=0,r=0,s=g.None,n=g.None,a=g.None,o=g.None,l=le.Middle){this.elementType=e,this.outputMidiNumber=r,this.staffLine=t,this.noteHeadDefault=s,this.noteHeadHalf=n!==g.None?n:s,this.noteHeadWhole=a!==g.None?a:s,this.techniqueSymbol=o,this.techniqueSymbolPlacement=l}getSymbol(e){switch(e){case B.Whole:return this.noteHeadWhole;case B.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class xt{static articulationFromElementVariation(e,t){return e<xt.gp6ElementAndVariationToArticulation.length?(t>=xt.gp6ElementAndVariationToArticulation.length&&(t=0),xt.gp6ElementAndVariationToArticulation[e][t]):38}static getArticulation(e){const t=e.percussionArticulation,r=e.beat.voice.bar.staff.track.percussionArticulations;return t<r.length?r[t]:xt.getArticulationByValue(t)}static getElementAndVariation(e){const t=xt.getArticulation(e);if(!t)return[-1,-1];for(let r=0;r<xt.gp6ElementAndVariationToArticulation.length;r++){const s=xt.gp6ElementAndVariationToArticulation[r];for(let n=0;n<s.length;n++){const a=xt.getArticulationByValue(s[n]);if((a==null?void 0:a.outputMidiNumber)===t.outputMidiNumber)return[r,n]}}return[-1,-1]}static getArticulationByValue(e){return xt.instrumentArticulations.has(e)?xt.instrumentArticulations.get(e):null}}xt.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]];xt.instrumentArticulations=new Map([[38,new z("snare",3,38,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[37,new z("snare",3,37,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[91,new z("snare",3,38,g.NoteheadDiamondWhite,g.NoteheadDiamondWhite,g.NoteheadDiamondWhite)],[42,new z("hiHat",-1,42,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[92,new z("hiHat",-1,46,g.NoteheadCircleSlash,g.NoteheadCircleSlash,g.NoteheadCircleSlash)],[46,new z("hiHat",-1,46,g.NoteheadCircleX,g.NoteheadCircleX,g.NoteheadCircleX)],[44,new z("hiHat",9,44,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[35,new z("kickDrum",8,35,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[36,new z("kickDrum",7,36,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[50,new z("tom",1,50,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[48,new z("tom",2,48,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[47,new z("tom",4,47,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[45,new z("tom",5,45,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[43,new z("tom",6,43,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[93,new z("ride",0,51,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.PictEdgeOfCymbal,le.Bottom)],[51,new z("ride",0,51,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[53,new z("ride",0,53,g.NoteheadDiamondWhite,g.NoteheadDiamondWhite,g.NoteheadDiamondWhite)],[94,new z("ride",0,51,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.ArticStaccatoAbove,le.Top)],[55,new z("splash",-2,55,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[95,new z("splash",-2,55,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.ArticStaccatoAbove,le.Bottom)],[52,new z("china",-3,52,g.NoteheadHeavyXHat,g.NoteheadHeavyXHat,g.NoteheadHeavyXHat)],[96,new z("china",-3,52,g.NoteheadHeavyXHat,g.NoteheadHeavyXHat,g.NoteheadHeavyXHat)],[49,new z("crash",-2,49,g.NoteheadHeavyX,g.NoteheadHeavyX,g.NoteheadHeavyX)],[97,new z("crash",-2,49,g.NoteheadHeavyX,g.NoteheadHeavyX,g.NoteheadHeavyX,g.ArticStaccatoAbove,le.Bottom)],[57,new z("crash",-1,57,g.NoteheadHeavyX,g.NoteheadHeavyX,g.NoteheadHeavyX)],[98,new z("crash",-1,57,g.NoteheadHeavyX,g.NoteheadHeavyX,g.NoteheadHeavyX,g.ArticStaccatoAbove,le.Bottom)],[99,new z("cowbell",1,56,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpHalf,g.NoteheadTriangleUpWhole)],[100,new z("cowbell",1,56,g.NoteheadXBlack,g.NoteheadXHalf,g.NoteheadXWhole)],[56,new z("cowbell",0,56,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpHalf,g.NoteheadTriangleUpWhole)],[101,new z("cowbell",0,56,g.NoteheadXBlack,g.NoteheadXHalf,g.NoteheadXWhole)],[102,new z("cowbell",-1,56,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpHalf,g.NoteheadTriangleUpWhole)],[103,new z("cowbell",-1,56,g.NoteheadXBlack,g.NoteheadXHalf,g.NoteheadXWhole)],[77,new z("woodblock",-9,77,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack)],[76,new z("woodblock",-10,76,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack)],[60,new z("bongo",-4,60,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[104,new z("bongo",-5,60,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.NoteheadParenthesis,le.Middle)],[105,new z("bongo",-6,60,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[61,new z("bongo",-7,61,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[106,new z("bongo",-8,61,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.NoteheadParenthesis,le.Middle)],[107,new z("bongo",-16,61,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[66,new z("timbale",10,66,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[65,new z("timbale",9,65,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[68,new z("agogo",12,68,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[67,new z("agogo",11,67,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[64,new z("conga",17,64,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[108,new z("conga",16,64,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[109,new z("conga",15,64,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.NoteheadParenthesis,le.Middle)],[63,new z("conga",14,63,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[110,new z("conga",13,63,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[62,new z("conga",19,62,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.NoteheadParenthesis,le.Middle)],[72,new z("whistle",-11,72,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[71,new z("whistle",-17,71,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[73,new z("guiro",38,73,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[74,new z("guiro",37,74,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[86,new z("surdo",36,86,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[87,new z("surdo",35,87,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadParenthesis,le.Middle)],[54,new z("tambourine",3,54,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack)],[111,new z("tambourine",2,54,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.StringsUpBow,le.Bottom)],[112,new z("tambourine",1,54,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.NoteheadTriangleUpBlack,g.StringsDownBow,le.Bottom)],[113,new z("tambourine",-7,54,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[79,new z("cuica",30,79,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[78,new z("cuica",29,78,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[58,new z("vibraslap",28,58,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[81,new z("triangle",27,81,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[80,new z("triangle",26,80,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadParenthesis,le.Middle)],[114,new z("grancassa",25,43,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[115,new z("piatti",18,49,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[116,new z("piatti",24,49,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[69,new z("cabasa",23,69,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[117,new z("cabasa",22,69,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.StringsUpBow,le.Bottom)],[85,new z("castanets",21,85,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[75,new z("claves",20,75,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[70,new z("maraca",-12,70,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[118,new z("maraca",-13,70,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.StringsUpBow,le.Bottom)],[119,new z("maraca",-14,70,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[120,new z("maraca",-15,70,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.StringsUpBow,le.Bottom)],[82,new z("shaker",-23,54,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[122,new z("shaker",-24,54,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.StringsUpBow,le.Bottom)],[84,new z("bellTree",-18,53,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[123,new z("bellTree",-19,53,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole,g.StringsUpBow,le.Bottom)],[83,new z("jingleBell",-20,53,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[124,new z("unpitched",-21,62,g.NoteheadNull,g.NoteheadNull,g.NoteheadNull,g.GuitarGolpe,le.Top)],[125,new z("unpitched",-22,62,g.NoteheadNull,g.NoteheadNull,g.NoteheadNull,g.GuitarGolpe,le.Bottom)],[39,new z("handClap",3,39,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[40,new z("snare",3,40,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[31,new z("snare",3,40,g.NoteheadSlashedBlack2,g.NoteheadSlashedBlack2,g.NoteheadSlashedBlack2)],[41,new z("tom",5,41,g.NoteheadBlack,g.NoteheadHalf,g.NoteheadWhole)],[59,new z("ride",2,59,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.PictEdgeOfCymbal,le.Bottom)],[126,new z("ride",2,59,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[127,new z("ride",2,59,g.NoteheadDiamondWhite,g.NoteheadDiamondWhite,g.NoteheadDiamondWhite)],[29,new z("ride",2,59,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack,g.ArticStaccatoAbove,le.Top)],[30,new z("crash",-3,49,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[33,new z("snare",3,37,g.NoteheadXBlack,g.NoteheadXBlack,g.NoteheadXBlack)],[34,new z("snare",3,38,g.NoteheadBlack,g.NoteheadBlack,g.NoteheadBlack)]]);xt.instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);class ba{constructor(){this.tieDestinationNoteId=-1,this.tieOriginNoteId=-1,this.slurDestinationNoteId=-1,this.slurOriginNoteId=-1,this.hammerPullDestinationNoteId=-1,this.hammerPullOriginNoteId=-1}}class ct{constructor(){this.id=ct.GlobalNoteId++,this.index=0,this.accentuated=Et.None,this.bendType=X.None,this.bendStyle=De.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=null,this.maxBendPoint=null,this.fret=-1,this.string=-1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=q.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=zt.None,this.slideOutType=he.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=Pe.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=ne.Unknown,this.rightHandFinger=ne.Unknown,this.isFingering=!1,this.trillValue=-1,this.trillSpeed=B.ThirtySecond,this.durationPercent=1,this.accidentalMode=kt.Default,this.dynamics=pe.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this._noteIdBag=null}get hasBend(){return this.bendPoints!==null&&this.bendType!==X.None}get isStringed(){return this.string>=0}get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?xt.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?xt.getElementAndVariation(this)[1]:-1}get isHammerPullDestination(){return!!this.hammerPullOrigin}get isSlurOrigin(){return!!this.slurDestination}get isHarmonic(){return this.harmonicType!==q.None}get isTieOrigin(){return this.tieDestination!==null}get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get stringTuning(){return this.beat.voice.bar.staff.capo+ct.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(e,t){return e.tuning.length>0?e.tuning[e.tuning.length-(t-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(e,t){const r=e?this.beat.voice.bar.staff.transpositionPitch:0;if(t){let s=this.calculateRealValue(e,!1);return this.isStringed&&(this.harmonicType===q.Natural?s=this.harmonicPitch+this.stringTuning-r:s+=this.harmonicPitch),s}else return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-r:this.isPiano?this.octave*12+this.tone-r:0}get harmonicPitch(){if(this.harmonicType===q.None||!this.isStringed)return 0;let e=this.harmonicValue;return $e.isAlmostEqualTo(e,2.4)?36:$e.isAlmostEqualTo(e,2.7)?34:e<3?0:e<=3.5?31:e<=4?28:e<=5?24:e<=6?34:e<=7?19:e<=8.5?36:e<=9?28:e<=10?34:e<=11?0:e<=12?12:e<14?0:e<=15?34:e<=16?28:e<=17?36:e<=18?0:e<=19?19:e<=21?0:e<=22?36:e<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let e=this.realValue;switch(this.harmonicType!==q.Natural&&this.harmonicType!==q.None&&(e-=this.harmonicPitch),this.beat.ottava){case Le._15ma:e-=24;break;case Le._8va:e-=12;break;case Le.Regular:break;case Le._8vb:e+=12;break;case Le._15mb:e+=24;break}switch(this.beat.voice.bar.clefOttava){case Le._15ma:e-=24;break;case Le._8va:e-=12;break;case Le.Regular:break;case Le._8vb:e+=12;break;case Le._15mb:e+=24;break}return e-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!==0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!==0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!==0:this.beat.isContinuedWhammy?this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!==0:!1}addBendPoint(e){let t=this.bendPoints;t===null&&(t=[],this.bendPoints=t),t.push(e),(!this.maxBendPoint||e.value>this.maxBendPoint.value)&&(this.maxBendPoint=e),this.bendType===X.None&&(this.bendType=X.Custom)}finish(e,t=null){let r=new fx(()=>ct.nextNoteOnSameLine(this)),s=e&&e.notation.notationMode===Ot.SongBook;if(this.isTieDestination&&(this.chain(t),s&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(!r.value||!r.value.isLetRing?this.letRingDestination=this:this.letRingDestination=r.value,s&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(!r.value||!r.value.isPalmMute?this.palmMuteDestination=this:this.palmMuteDestination=r.value),this.isHammerPullOrigin){let o=ct.findHammerPullDestination(this);o?(this.hammerPullDestination=o,o.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case he.Shift:case he.Legato:this.slideTarget=r.value,this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=he.None;break}let n=null;this.isHammerPullOrigin&&this.hammerPullDestination?n=this.hammerPullDestination:this.slideOutType===he.Legato&&this.slideTarget&&(n=this.slideTarget),n&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===Jt.None?(this.effectSlurOrigin.effectSlurDestination=n,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=n,this.effectSlurDestination.effectSlurOrigin=this));const a=this.bendPoints;if(a!=null&&a.length>0&&this.bendType===X.Custom){let o=this.isTieDestination&&this.tieOrigin.hasBend;if(this.isContinuedBend=o,a.length===4){let l=a[0],h=a[1],u=a[2],c=a[3];h.value===u.value?c.value>l.value?h.value>c.value?this.bendType=X.BendRelease:!o&&l.value>0?(this.bendType=X.PrebendBend,a.splice(2,1),a.splice(1,1)):(this.bendType=X.Bend,a.splice(2,1),a.splice(1,1)):c.value<l.value?o?(this.bendType=X.Release,a.splice(2,1),a.splice(1,1)):(this.bendType=X.PrebendRelease,a.splice(2,1),a.splice(1,1)):h.value>l.value?this.bendType=X.BendRelease:l.value>0&&!o?(this.bendType=X.Prebend,a.splice(2,1),a.splice(1,1)):(this.bendType=X.Hold,a.splice(2,1),a.splice(1,1)):L.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(a.length===2){let l=a[0],h=a[1];h.value>l.value?!o&&l.value>0?this.bendType=X.PrebendBend:this.bendType=X.Bend:h.value<l.value?o?this.bendType=X.Release:this.bendType=X.PrebendRelease:l.value>0&&!o?this.bendType=X.Prebend:this.bendType=X.Hold}}else(a===null||a.length===0)&&(this.bendType=X.None);this.initialBendValue>0&&(this.accidentalMode=kt.Default)}static nextNoteOnSameLine(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+ct.MaxOffsetForSameLineSearch;){let r=t.getNoteOnString(e.string);if(r)return r;t=t.nextBeat}return null}static findHammerPullDestination(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+ct.MaxOffsetForSameLineSearch;){let r=t.getNoteOnString(e.string);if(r)return r;for(let s=e.string;s>0;s--)if(r=t.getNoteOnString(s),r){if(r.isLeftHandTapped)return r;break}for(let s=e.string;s<=e.beat.voice.bar.staff.tuning.length;s++)if(r=t.getNoteOnString(s),r){if(r.isLeftHandTapped)return r;break}t=t.nextBeat}return null}static findTieOrigin(e){let t=e.beat.previousBeat;for(;t&&t.voice.bar.index>=e.beat.voice.bar.index-ct.MaxOffsetForSameLineSearch;){if(e.isStringed){let r=t.getNoteOnString(e.string);if(r)return r}else if(e.octave===-1&&e.tone===-1){if(e.index<t.notes.length)return t.notes[e.index]}else{let r=t.getNoteWithRealValue(e.realValue);if(r)return r}t=t.previousBeat}return null}chain(e=null){if(e!==null)if(this._noteIdBag!==null){let t;e.has(ct.NoteIdLookupKey)?t=e.get(ct.NoteIdLookupKey):(t=new Map,e.set(ct.NoteIdLookupKey,t)),(this._noteIdBag.hammerPullDestinationNoteId!==-1||this._noteIdBag.tieDestinationNoteId!==-1||this._noteIdBag.slurDestinationNoteId!==-1)&&t.set(this.id,this),this._noteIdBag.hammerPullOriginNoteId!==-1&&(this.hammerPullOrigin=t.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),this._noteIdBag.tieOriginNoteId!==-1&&(this.tieOrigin=t.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),this._noteIdBag.slurOriginNoteId!==-1&&(this.slurOrigin=t.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),this._noteIdBag=null}else{if(!this.isTieDestination&&this.tieOrigin===null)return;let t=this.tieOrigin??ct.findTieOrigin(this);t?(t.tieDestination=this,this.tieOrigin=t,this.fret=t.fret,this.octave=t.octave,this.tone=t.tone,t.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(e){this.tieDestination!==null&&e.set("tiedestinationnoteid",this.tieDestination.id),this.tieOrigin!==null&&e.set("tieoriginnoteid",this.tieOrigin.id),this.slurDestination!==null&&e.set("slurdestinationnoteid",this.slurDestination.id),this.slurOrigin!==null&&e.set("sluroriginnoteid",this.slurOrigin.id),this.hammerPullOrigin!==null&&e.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),this.hammerPullDestination!==null&&e.set("hammerpulldestinationnoteid",this.hammerPullDestination.id)}setProperty(e,t){switch(e){case"tiedestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new ba),this._noteIdBag.tieDestinationNoteId=t,!0;case"tieoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new ba),this._noteIdBag.tieOriginNoteId=t,!0;case"slurdestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new ba),this._noteIdBag.slurDestinationNoteId=t,!0;case"sluroriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new ba),this._noteIdBag.slurOriginNoteId=t,!0;case"hammerpulloriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new ba),this._noteIdBag.hammerPullOriginNoteId=t,!0;case"hammerpulldestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new ba),this._noteIdBag.hammerPullDestinationNoteId=t,!0}return!1}}ct.GlobalNoteId=0;ct.MaxOffsetForSameLineSearch=3;ct.NoteIdLookupKey="NoteIdLookup";class qt{constructor(e){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=e}check(e){if(this.beats.length===0)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==K.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{let t=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(let r of qt.AllTicks)if(this.totalDuration===r*t){this.isFull=!0;break}}return!0}}qt.HalfTicks=1920;qt.QuarterTicks=960;qt.EighthTicks=480;qt.SixteenthTicks=240;qt.ThirtySecondTicks=120;qt.SixtyFourthTicks=60;qt.OneHundredTwentyEighthTicks=30;qt.TwoHundredFiftySixthTicks=15;qt.AllTicks=[qt.HalfTicks,qt.QuarterTicks,qt.EighthTicks,qt.SixteenthTicks,qt.ThirtySecondTicks,qt.SixtyFourthTicks,qt.OneHundredTwentyEighthTicks,qt.TwoHundredFiftySixthTicks];var Me;(function(i){i[i.None=0]="None",i[i.Custom=1]="Custom",i[i.Dive=2]="Dive",i[i.Dip=3]="Dip",i[i.Hold=4]="Hold",i[i.Predive=5]="Predive",i[i.PrediveDive=6]="PrediveDive"})(Me||(Me={}));class px{static clone(e){const t=new V;return t.offset=e.offset,t.value=e.value,t}}class gx{static clone(e){const t=new ct;if(t.index=e.index,t.accentuated=e.accentuated,t.bendType=e.bendType,t.bendStyle=e.bendStyle,t.isContinuedBend=e.isContinuedBend,e.bendPoints){t.bendPoints=[];for(const r of e.bendPoints)t.addBendPoint(px.clone(r))}return t.fret=e.fret,t.string=e.string,t.octave=e.octave,t.tone=e.tone,t.percussionArticulation=e.percussionArticulation,t.isVisible=e.isVisible,t.isLeftHandTapped=e.isLeftHandTapped,t.isHammerPullOrigin=e.isHammerPullOrigin,t.isSlurDestination=e.isSlurDestination,t.harmonicType=e.harmonicType,t.harmonicValue=e.harmonicValue,t.isGhost=e.isGhost,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.isDead=e.isDead,t.isStaccato=e.isStaccato,t.slideInType=e.slideInType,t.slideOutType=e.slideOutType,t.vibrato=e.vibrato,t.isTieDestination=e.isTieDestination,t.leftHandFinger=e.leftHandFinger,t.rightHandFinger=e.rightHandFinger,t.isFingering=e.isFingering,t.trillValue=e.trillValue,t.trillSpeed=e.trillSpeed,t.durationPercent=e.durationPercent,t.accidentalMode=e.accidentalMode,t.dynamics=e.dynamics,t}}class j3{static clone(e){const t=new ii;return t.isLinear=e.isLinear,t.type=e.type,t.value=e.value,t.ratioPosition=e.ratioPosition,t.text=e.text,t}}class Fm{static clone(e){const t=new si;t.index=e.index,t.notes=[];for(const r of e.notes)t.addNote(gx.clone(r));t.isEmpty=e.isEmpty,t.whammyStyle=e.whammyStyle,t.ottava=e.ottava,t.isLegatoOrigin=e.isLegatoOrigin,t.duration=e.duration,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.automations=[];for(const r of e.automations)t.automations.push(j3.clone(r));if(t.dots=e.dots,t.fadeIn=e.fadeIn,t.lyrics=e.lyrics?e.lyrics.slice():null,t.hasRasgueado=e.hasRasgueado,t.pop=e.pop,t.slap=e.slap,t.tap=e.tap,t.text=e.text,t.brushType=e.brushType,t.brushDuration=e.brushDuration,t.tupletDenominator=e.tupletDenominator,t.tupletNumerator=e.tupletNumerator,t.isContinuedWhammy=e.isContinuedWhammy,t.whammyBarType=e.whammyBarType,e.whammyBarPoints){t.whammyBarPoints=[];for(const r of e.whammyBarPoints)t.addWhammyBarPoint(px.clone(r))}return t.vibrato=e.vibrato,t.chordId=e.chordId,t.graceType=e.graceType,t.pickStroke=e.pickStroke,t.tremoloSpeed=e.tremoloSpeed,t.crescendo=e.crescendo,t.displayStart=e.displayStart,t.playbackStart=e.playbackStart,t.displayDuration=e.displayDuration,t.playbackDuration=e.playbackDuration,t.dynamics=e.dynamics,t.invertBeamDirection=e.invertBeamDirection,t.preferredBeamDirection=e.preferredBeamDirection,t.isEffectSlurOrigin=e.isEffectSlurOrigin,t.beamingMode=e.beamingMode,t}}class Op{constructor(){this.beats=[],this.id="empty",this.isComplete=!1}addBeat(e){e.graceIndex=this.beats.length,e.graceGroup=this,this.beats.push(e)}finish(){this.beats.length>0&&(this.id=this.beats[0].absoluteDisplayStart+"_"+this.beats[0].voice.index)}}var Wr;(function(i){i[i.Auto=0]="Auto",i[i.ForceSplitToNext=1]="ForceSplitToNext",i[i.ForceMergeWithNext=2]="ForceMergeWithNext"})(Wr||(Wr={}));class si{constructor(){this.id=si._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=De.Default,this.ottava=Le.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=B.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fadeIn=!1,this.lyrics=null,this.hasRasgueado=!1,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.brushType=Ye.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=Me.None,this.whammyBarPoints=null,this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=Pe.None,this.chordId=null,this.graceType=K.None,this.graceGroup=null,this.graceIndex=-1,this.pickStroke=Jt.None,this.tremoloSpeed=null,this.crescendo=Ii.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.dynamics=pe.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=Wr.Auto}get isLastOfVoice(){return this.index===this.voice.beats.length-1}get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}get isRest(){return this.isEmpty||this.notes.length===0}get isFullBarRest(){return this.isRest&&this.voice.beats.length===1&&this.duration===B.Whole}get hasTuplet(){return!(this.tupletDenominator===-1&&this.tupletNumerator===-1)&&!(this.tupletDenominator===1&&this.tupletNumerator===1)}get hasWhammyBar(){return this.whammyBarPoints!==null&&this.whammyBarType!==Me.None}get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}get isTremolo(){return!!this.tremoloSpeed}get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}get isEffectSlurDestination(){return!!this.effectSlurOrigin}addWhammyBarPoint(e){let t=this.whammyBarPoints;t===null&&(t=[],this.whammyBarPoints=t),t.push(e),(!this.maxWhammyPoint||e.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=e),(!this.minWhammyPoint||e.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=e),this.whammyBarType===Me.None&&(this.whammyBarType=Me.Custom)}removeWhammyBarPoint(e){const t=this.whammyBarPoints;if(t===null||e<0||e>=t.length)return;t.splice(e,1);let r=t[e];if(r===this.maxWhammyPoint){this.maxWhammyPoint=null;for(let s of t)(!this.maxWhammyPoint||s.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=s)}if(r===this.minWhammyPoint){this.minWhammyPoint=null;for(let s of t)(!this.minWhammyPoint||s.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=s)}}addNote(e){e.beat=this,e.index=this.notes.length,this.notes.push(e),e.isStringed&&this.noteStringLookup.set(e.string,e)}removeNote(e){let t=this.notes.indexOf(e);t>=0&&(this.notes.splice(t,1),e.isStringed&&this.noteStringLookup.delete(e.string))}getAutomation(e){for(let t=0,r=this.automations.length;t<r;t++){let s=this.automations[t];if(s.type===e)return s}return null}getNoteOnString(e){return this.noteStringLookup.has(e)?this.noteStringLookup.get(e):null}calculateDuration(){if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let e=oe.toTicks(this.duration);return this.dots===2?e=oe.applyDot(e,!0):this.dots===1&&(e=oe.applyDot(e,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(e=oe.applyTuplet(e,this.tupletNumerator,this.tupletDenominator)),e}updateDurations(){let e=this.calculateDuration();switch(this.playbackDuration=e,this.graceType){case K.BeforeBeat:case K.OnBeat:switch(this.duration){case B.Sixteenth:this.playbackDuration=oe.toTicks(B.SixtyFourth);break;case B.ThirtySecond:this.playbackDuration=oe.toTicks(B.OneHundredTwentyEighth);break;default:this.playbackDuration=oe.toTicks(B.ThirtySecond);break}this.displayDuration=0;break;case K.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=e;let t=this.previousBeat;t&&t.graceType===K.BendGrace&&(this.playbackDuration=t.playbackDuration);break}}finishTuplet(){let e=this.previousBeat,t=e?e.tupletGroup:null;(this.hasTuplet||this.graceType!==K.None&&t)&&((!e||!t||!t.check(this))&&(t=new qt(this.voice),t.check(this)),this.tupletGroup=t)}finish(e,t=null){switch(this.getAutomation(Dt.Instrument)===null&&this.index===0&&this.voice.index===0&&this.voice.bar.index===0&&this.voice.bar.staff.index===0&&this.automations.push(ii.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case K.OnBeat:case K.BeforeBeat:let h=this.graceGroup.beats.length;h===1?this.duration=B.Eighth:h===2?this.duration=B.Sixteenth:this.duration=B.ThirtySecond;break}let r=e?e.notation.notationMode:Ot.GuitarPro,s=this.text==="grad"||this.text==="grad.";s&&r===Ot.SongBook&&(this.text="");let n=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let a=0,o=!1;for(let h=0,u=this.notes.length;h<u;h++){let c=this.notes[h];if(c.dynamics=this.dynamics,c.finish(e,t),c.isLetRing&&(this.isLetRing=!0),c.isPalmMute&&(this.isPalmMute=!0),r===Ot.SongBook&&c.hasBend&&this.graceType!==K.BendGrace){if(!c.isTieOrigin)switch(c.bendType){case X.Bend:case X.PrebendRelease:case X.PrebendBend:n=!0;break}s||c.bendStyle===De.Gradual?(s=!0,c.bendStyle=De.Gradual,n=!1):c.bendStyle=De.Fast}c.isVisible&&(a++,(!this.minNote||c.realValue<this.minNote.realValue)&&(this.minNote=c),(!this.maxNote||c.realValue>this.maxNote.realValue)&&(this.maxNote=c),(!this.minStringNote||c.string<this.minStringNote.string)&&(this.minStringNote=c),(!this.maxStringNote||c.string>this.maxStringNote.string)&&(this.maxStringNote=c),c.hasEffectSlur&&(o=!0))}if(o&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&a===0&&(this.isEmpty=!0),!this.isRest&&(!this.isLetRing||!this.isPalmMute)){let h=this.previousBeat;for(;h&&h.isRest;)this.isLetRing||(h.isLetRing=!1),this.isPalmMute||(h.isPalmMute=!1),h=h.previousBeat}else this.isRest&&this.previousBeat&&e&&e.notation.notationMode===Ot.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));const l=this.whammyBarPoints;if(l!==null&&l.length>0&&this.whammyBarType===Me.Custom){r===Ot.SongBook&&(this.whammyStyle=s?De.Gradual:De.Fast);let h=!!this.previousBeat&&this.previousBeat.hasWhammyBar;if(this.isContinuedWhammy=h,l.length===4){let u=l[0],c=l[1],d=l[2],p=l[3];c.value===d.value&&(u.value<c.value&&c.value<p.value||u.value>c.value&&c.value>p.value?(u.value!==0&&!h?this.whammyBarType=Me.PrediveDive:this.whammyBarType=Me.Dive,l.splice(2,1),l.splice(1,1)):u.value>c.value&&c.value<p.value||u.value<c.value&&c.value>p.value?(this.whammyBarType=Me.Dip,(c.offset===d.offset||r===Ot.SongBook)&&l.splice(2,1)):u.value===c.value&&c.value===p.value&&(u.value!==0&&!h?this.whammyBarType=Me.Predive:this.whammyBarType=Me.Hold,l.splice(2,1),l.splice(1,1)))}}if(this.updateDurations(),n){let h=Fm.clone(this);h.id=si._globalBeatId++,h.pickStroke=Jt.None;for(let u=0,c=h.notes.length;u<c;u++){let d=h.notes[u],p=this.notes[u];if(d.bendType=X.None,d.maxBendPoint=null,d.bendPoints=null,d.bendStyle=De.Default,d.id=ct.GlobalNoteId++,p.isTieOrigin&&(d.tieDestination=p.tieDestination,p.tieDestination.tieOrigin=d),p.isTieDestination&&(d.tieOrigin=p.tieOrigin?p.tieOrigin:null,p.tieOrigin.tieDestination=d),p.hasBend&&p.isTieOrigin){let f=ct.findTieOrigin(p);if(f&&f.hasBend){d.bendType=X.Hold;let m=p.bendPoints[p.bendPoints.length-1];d.addBendPoint(new V(0,m.value)),d.addBendPoint(new V(V.MaxPosition,m.value))}}d.isTieDestination=!0}this.graceType=K.BendGrace,this.graceGroup=new Op,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,h),h.graceGroup=new Op,h.graceGroup.addBeat(this),h.graceGroup.isComplete=!0,h.graceGroup.finish()}}isBefore(e){return this.voice.bar.index<e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index<e.index}isAfter(e){return this.voice.bar.index>e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index>e.index}hasNoteOnString(e){return this.noteStringLookup.has(e)}getNoteWithRealValue(e){return this.noteValueLookup.has(e)?this.noteValueLookup.get(e):null}chain(e=null){for(const t of this.notes)this.noteValueLookup.set(t.realValue,t),t.chain(e)}}si._globalBeatId=0;class Sn{constructor(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}var Rt;(function(i){i[i.Cb=-7]="Cb",i[i.Gb=-6]="Gb",i[i.Db=-5]="Db",i[i.Ab=-4]="Ab",i[i.Eb=-3]="Eb",i[i.Bb=-2]="Bb",i[i.F=-1]="F",i[i.C=0]="C",i[i.G=1]="G",i[i.D=2]="D",i[i.A=3]="A",i[i.E=4]="E",i[i.B=5]="B",i[i.FSharp=6]="FSharp",i[i.CSharp=7]="CSharp"})(Rt||(Rt={}));var oi;(function(i){i[i.IgnoreSpaces=0]="IgnoreSpaces",i[i.Begin=1]="Begin",i[i.Text=2]="Text",i[i.Comment=3]="Comment",i[i.Dash=4]="Dash"})(oi||(oi={}));class Ct{constructor(){this.startBar=0,this.text=""}finish(e=!1){this.chunks=[],this.parse(this.text,0,this.chunks,e)}parse(e,t,r,s){if(!e)return;let n=oi.Begin,a=oi.Begin,o=!1,l=0;for(;t<e.length;){let h=e.charCodeAt(t);switch(n){case oi.IgnoreSpaces:switch(h){case Ct.CharCodeLF:case Ct.CharCodeCR:case Ct.CharCodeTab:break;case Ct.CharCodeSpace:if(!o){n=a;continue}break;default:o=!1,n=a;continue}break;case oi.Begin:switch(h){case Ct.CharCodeBrackedOpen:n=oi.Comment;break;default:l=t,n=oi.Text;continue}break;case oi.Comment:switch(h){case Ct.CharCodeBrackedClose:n=oi.Begin;break}break;case oi.Text:switch(h){case Ct.CharCodeDash:n=oi.Dash;break;case Ct.CharCodeCR:case Ct.CharCodeLF:case Ct.CharCodeSpace:let u=e.substr(l,t-l);this.addChunk(u,s),n=oi.IgnoreSpaces,a=oi.Begin;break}break;case oi.Dash:switch(h){case Ct.CharCodeDash:break;default:let u=e.substr(l,t-l);this.addChunk(u,s),o=!0,n=oi.IgnoreSpaces,a=oi.Begin;continue}break}t+=1}n===oi.Text&&t!==l&&this.addChunk(e.substr(l,t-l),s)}addChunk(e,t){e=this.prepareChunk(e),(!t||e.length>0&&e!=="-")&&this.chunks.push(e)}prepareChunk(e){let t=e.split("+").join(" "),r=t.length;for(;r>0&&t.charAt(r-1)==="_";)r--;return r!==t.length?t.substr(0,r):t}}Ct.CharCodeLF=10;Ct.CharCodeTab=9;Ct.CharCodeCR=13;Ct.CharCodeSpace=32;Ct.CharCodeBrackedClose=93;Ct.CharCodeBrackedOpen=91;Ct.CharCodeDash=45;var vn;(function(i){i[i.Major=0]="Major",i[i.Minor=1]="Minor"})(vn||(vn={}));var fe;(function(i){i[i.NoTripletFeel=0]="NoTripletFeel",i[i.Triplet16th=1]="Triplet16th",i[i.Triplet8th=2]="Triplet8th",i[i.Dotted16th=3]="Dotted16th",i[i.Dotted8th=4]="Dotted8th",i[i.Scottish16th=5]="Scottish16th",i[i.Scottish8th=6]="Scottish8th"})(fe||(fe={}));class Vs{constructor(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.keySignature=Rt.C,this.keySignatureType=vn.Major,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.tripletFeel=fe.NoTripletFeel,this.section=null,this.tempoAutomation=null,this.fermata=null,this.start=0,this.isAnacrusis=!1,this.displayScale=1,this.displayWidth=-1}get isRepeatEnd(){return this.repeatCount>0}get isSectionStart(){return!!this.section}calculateDuration(e=!0){if(this.isAnacrusis&&e){let t=0;for(let r of this.score.tracks)for(let s of r.staves){let n=this.index<s.bars.length?s.bars[this.index].calculateDuration():0;n>t&&(t=n)}return t}return this.timeSignatureNumerator*oe.valueToTicks(this.timeSignatureDenominator)}addFermata(e,t){let r=this.fermata;r===null&&(r=new Map,this.fermata=r),r.set(e,t)}getFermata(e){const t=this.fermata;return t===null?null:t.has(e.playbackStart)?t.get(e.playbackStart):null}}Vs.MaxAlternateEndings=8;class q3{constructor(){this.hideDynamics=!1}}class M1{constructor(){this.masterBars=[],this.opening=null,this.closings=[],this.isClosed=!1}get openings(){const e=this.opening;return e?[e]:[]}get isOpened(){var e;return((e=this.opening)==null?void 0:e.isRepeatStart)===!0}addMasterBar(e){this.opening===null&&(this.opening=e),this.masterBars.push(e),e.repeatGroup=this,e.isRepeatEnd&&(this.closings.push(e),this.isClosed=!0)}}let ha=class{constructor(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.defaultSystemsLayout=3,this.systemsLayout=[],this.stylesheet=new q3}rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const e of this.masterBars)this.addMasterBarToRepeatGroups(e)}addMasterBar(e){e.score=this,e.index=this.masterBars.length,this.masterBars.length!==0&&(e.previousMasterBar=this.masterBars[this.masterBars.length-1],e.previousMasterBar.nextMasterBar=e,e.start=e.previousMasterBar.start+(e.previousMasterBar.isAnacrusis?0:e.previousMasterBar.calculateDuration())),this.addMasterBarToRepeatGroups(e),this.masterBars.push(e)}addMasterBarToRepeatGroups(e){var t;e.isRepeatStart?((t=this._currentRepeatGroup)!=null&&t.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new M1,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new M1,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(e),e.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(e){e.score=this,e.index=this.tracks.length,this.tracks.push(e)}finish(e){const t=new Map;for(let r=0,s=this.tracks.length;r<s;r++)this.tracks[r].finish(e,t)}};class Zc{constructor(){this.marker="",this.text=""}}class Tt extends Yt{constructor(e){super(Ut.Format,e),Object.setPrototypeOf(this,Tt.prototype)}}class Oe{constructor(e,t,r,s=255){this.raw=0,this.raw=(s&255)<<24|(e&255)<<16|(t&255)<<8|r&255,this.updateRgba()}updateRgba(){this.a===255?this.rgba="#"+$e.toHexString(this.r,2)+$e.toHexString(this.g,2)+$e.toHexString(this.b,2):this.rgba=`rgba(${this.r},${this.g},${this.b},${this.a/255})`}get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return this.raw&255}static random(e=100){return new Oe(Math.random()*255|0,Math.random()*255|0,Math.random()*255|0,e)}static fromJson(e){if(e instanceof Oe)return e;switch(typeof e){case"number":{const t=new Oe(0,0,0,0);return t.raw=e,t.updateRgba(),t}case"string":{const t=e;if(t.startsWith("#")){if(t.length===4)return new Oe(parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17);if(t.length===5)return new Oe(parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17,parseInt(t[4],16)*17);if(t.length===7)return new Oe(parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16));if(t.length===9)return new Oe(parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16),parseInt(t.substring(7,9),16))}else if(t.startsWith("rgba")||t.startsWith("rgb")){const r=t.indexOf("("),s=t.lastIndexOf(")");if(r===-1||s===-1)throw new Tt("No values specified for rgb/rgba function");const n=t.substring(r+1,s).split(",");if(n.length===3)return new Oe(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]));if(n.length===4)return new Oe(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseFloat(n[3])*255)}return null}}throw new Tt("Unsupported format for color")}static toJson(e){return e.raw}}Oe.BlackRgb="#000000";class mx{constructor(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}}class O{static getTextForTuning(e,t){let r=O.getTextPartsForTuning(e);return t?r.join(""):r[0]}static getTextPartsForTuning(e,t=-1){let r=e/12|0,s=e%12;return[["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][s],(r+t).toString()]}static getDefaultTuningFor(e){return O._defaultTunings.has(e)?O._defaultTunings.get(e):null}static getPresetsFor(e){switch(e){case 7:return O._sevenStrings;case 6:return O._sixStrings;case 5:return O._fiveStrings;case 4:return O._fourStrings}return[]}static initialize(){O._defaultTunings.set(7,new O("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),O._sevenStrings.push(O._defaultTunings.get(7)),O._defaultTunings.set(6,new O("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),O._sixStrings.push(O._defaultTunings.get(6)),O._sixStrings.push(new O("Guitar Tune down ½ step",[63,58,54,49,44,39],!1)),O._sixStrings.push(new O("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),O._sixStrings.push(new O("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),O._sixStrings.push(new O("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),O._sixStrings.push(new O("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),O._sixStrings.push(new O("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),O._sixStrings.push(new O("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),O._sixStrings.push(new O("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),O._sixStrings.push(new O("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),O._sixStrings.push(new O("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),O._sixStrings.push(new O("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),O._sixStrings.push(new O("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),O._sixStrings.push(new O("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),O._sixStrings.push(new O("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),O._sixStrings.push(new O("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),O._sixStrings.push(new O("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),O._sixStrings.push(new O("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),O._sixStrings.push(new O("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),O._sixStrings.push(new O("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),O._sixStrings.push(new O("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),O._sixStrings.push(new O("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),O._sixStrings.push(new O("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),O._sixStrings.push(new O("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),O._sixStrings.push(new O("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),O._sixStrings.push(new O("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),O._sixStrings.push(new O("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),O._sixStrings.push(new O("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),O._sixStrings.push(new O("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),O._sixStrings.push(new O("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),O._sixStrings.push(new O("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),O._defaultTunings.set(5,new O("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),O._fiveStrings.push(O._defaultTunings.get(5)),O._fiveStrings.push(new O("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),O._fiveStrings.push(new O("Banjo Open D Tuning",[62,57,54,50,69],!1)),O._fiveStrings.push(new O("Banjo Open G Tuning",[62,59,55,50,67],!1)),O._fiveStrings.push(new O("Banjo G Minor Tuning",[62,58,55,50,67],!1)),O._fiveStrings.push(new O("Banjo G Modal Tuning",[62,57,55,50,67],!1)),O._defaultTunings.set(4,new O("Bass Standard Tuning",[43,38,33,28],!0)),O._fourStrings.push(O._defaultTunings.get(4)),O._fourStrings.push(new O("Bass Tune down ½ step",[42,37,32,27],!1)),O._fourStrings.push(new O("Bass Tune down 1 step",[41,36,31,26],!1)),O._fourStrings.push(new O("Bass Tune down 2 step",[39,34,29,24],!1)),O._fourStrings.push(new O("Bass Dropped D Tuning",[43,38,33,26],!1)),O._fourStrings.push(new O("Ukulele C Tuning",[45,40,36,43],!1)),O._fourStrings.push(new O("Ukulele G Tuning",[52,47,43,38],!1)),O._fourStrings.push(new O("Mandolin Standard Tuning",[64,57,50,43],!1)),O._fourStrings.push(new O("Mandolin or Violin Tuning",[76,69,62,55],!1)),O._fourStrings.push(new O("Viola Tuning",[69,62,55,48],!1)),O._fourStrings.push(new O("Cello Tuning",[57,50,43,36],!1))}static findTuning(e){let t=O.getPresetsFor(e.length);for(let r=0,s=t.length;r<s;r++){let n=t[r],a=!0;for(let o=0,l=e.length;o<l;o++)if(e[o]!==n.tunings[o]){a=!1;break}if(a)return n}return null}constructor(e="",t=null,r=!1){this.isStandard=r,this.name=e,this.tunings=t??[]}finish(){const e=O.findTuning(this.tunings);e&&(this.name=e.name,this.isStandard=e.isStandard),this.name=this.name.trim()}}O._sevenStrings=[];O._sixStrings=[];O._fiveStrings=[];O._fourStrings=[];O._defaultTunings=new Map;O.defaultAccidentals=["","#","","#","","","#","","#","","#",""];O.defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"];O.initialize();class yx{constructor(){this.index=0,this.bars=[],this.chords=null,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.stringTuning=new O("",[],!1),this.showSlash=!1,this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=5}get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}finish(e,t=null){this.stringTuning.finish();for(let r=0,s=this.bars.length;r<s;r++)this.bars[r].finish(e,t)}addChord(e,t){t.staff=this;let r=this.chords;r===null&&(r=new Map,this.chords=r),r.set(e,t)}hasChord(e){var t;return((t=this.chords)==null?void 0:t.has(e))??!1}getChord(e){var t;return((t=this.chords)==null?void 0:t.get(e))??null}addBar(e){let t=this.bars;e.staff=this,e.index=t.length,t.length>0&&(e.previousBar=t[t.length-1],e.previousBar.nextBar=e),t.push(e)}}class ds{constructor(){this.index=0,this.staves=[],this.playbackInfo=new mx,this.color=new Oe(200,0,0,255),this.name="",this.isVisibleOnMultiTrack=!0,this.shortName="",this.defaultSystemsLayout=3,this.systemsLayout=[],this.percussionArticulations=[]}ensureStaveCount(e){for(;this.staves.length<e;)this.addStaff(new yx)}addStaff(e){e.index=this.staves.length,e.track=this,this.staves.push(e)}finish(e,t=null){this.shortName||(this.shortName=this.name,this.shortName.length>ds.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,ds.ShortNameMaxLength)));for(let r=0,s=this.staves.length;r<s;r++)this.staves[r].finish(e,t)}applyLyrics(e){for(let r of e)r.finish();let t=this.staves[0];for(let r=0;r<e.length;r++){let s=e[r];if(s.startBar>=0&&s.startBar<t.bars.length){let n=t.bars[s.startBar].voices[0].beats[0];for(let a=0;a<s.chunks.length&&n;a++){for(;n&&(n.isEmpty||n.isRest);)n=n.nextBeat;n&&(n.lyrics||(n.lyrics=new Array(e.length),n.lyrics.fill("")),n.lyrics[r]=s.chunks[a],n=n.nextBeat)}}}}}ds.ShortNameMaxLength=10;let fs=class bx{constructor(){this.id=bx._globalBarId++,this.index=0,this.beats=[],this.isEmpty=!0}insertBeat(e,t){t.nextBeat=e.nextBeat,t.nextBeat&&(t.nextBeat.previousBeat=t),t.previousBeat=e,t.voice=this,e.nextBeat=t,this.beats.splice(e.index+1,0,t)}addBeat(e){e.voice=this,e.index=this.beats.length,this.beats.push(e),e.isEmpty||(this.isEmpty=!1)}chain(e,t=null){if(this.bar){if(e.index<this.beats.length-1)e.nextBeat=this.beats[e.index+1],e.nextBeat.previousBeat=e;else if(e.isLastOfVoice&&e.voice.bar.nextBar){let r=this.bar.nextBar.voices[this.index];r.beats.length>0&&(e.nextBeat=r.beats[0]),e.nextBeat.previousBeat=e}e.chain(t)}}addGraceBeat(e){if(this.beats.length===0){this.addBeat(e);return}let t=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(e),this.addBeat(t),this.isEmpty=!1}getBeatAtPlaybackStart(e){return this._beatLookup.has(e)?this._beatLookup.get(e):null}finish(e,t=null){this._beatLookup=new Map;let r=null;for(let a=0;a<this.beats.length;a++){let o=this.beats[a];o.index=a,this.chain(o,t),o.graceType===K.None?(o.graceGroup=r,r&&(r.isComplete=!0),r=null):(r||(r=new Op),r.addBeat(o))}let s=0,n=0;for(let a=0;a<this.beats.length;a++){let o=this.beats[a];if(o.index=a,o.finish(e,t),o.graceType===K.None){if(o.graceGroup){const l=o.graceGroup.beats[0],h=o.graceGroup.beats[o.graceGroup.beats.length-1];if(l.graceType!==K.BendGrace){let u=h.playbackStart+h.playbackDuration-l.playbackStart;switch(l.graceType){case K.BeforeBeat:l.previousBeat?(l.previousBeat.playbackDuration-=u,l.previousBeat.voice==this?n=l.previousBeat.playbackStart+l.previousBeat.playbackDuration:n=-u):n=-u;for(const c of o.graceGroup.beats)this._beatLookup.delete(c.playbackStart),c.playbackStart=n,this._beatLookup.set(c.playbackStart,o),n+=c.playbackDuration;break;case K.OnBeat:o.playbackDuration-=u,h.voice===this?n=h.playbackStart+h.playbackDuration:n=-u;break}}}o.displayStart=s,o.playbackStart=n,o.fermata?this.bar.masterBar.addFermata(o.playbackStart,o.fermata):o.fermata=this.bar.masterBar.getFermata(o),this._beatLookup.set(o.playbackStart,o)}else o.displayStart=s,o.playbackStart=n;o.finishTuplet(),o.graceGroup&&o.graceGroup.finish(),s+=o.displayDuration,n+=o.playbackDuration}}calculateDuration(){if(this.isEmpty||this.beats.length===0)return 0;let e=this.beats[this.beats.length-1],t=this.beats[0];return e.playbackStart+e.playbackDuration-t.playbackStart}};fs._globalBarId=0;class de{static float64ToBytes(e){return de._dataView.setFloat64(0,e,!0),this._conversionByteArray}static bytesToFloat64(e){throw de._conversionByteArray.set(e,0),de._dataView.getFloat64(0,!0)}static uint16ToInt16(e){return de._dataView.setUint16(0,e,!0),de._dataView.getInt16(0,!0)}static int16ToUint32(e){return de._dataView.setInt16(0,e,!0),de._dataView.getUint32(0,!0)}static int32ToUint16(e){return de._dataView.setInt32(0,e,!0),de._dataView.getUint16(0,!0)}static int32ToInt16(e){return de._dataView.setInt32(0,e,!0),de._dataView.getInt16(0,!0)}static int32ToUint32(e){return de._dataView.setInt32(0,e,!0),de._dataView.getUint32(0,!0)}static uint8ToInt8(e){return de._dataView.setUint8(0,e),de._dataView.getInt8(0)}}de._conversionBuffer=new ArrayBuffer(8);de._conversionByteArray=new Uint8Array(de._conversionBuffer);de._dataView=new DataView(de._conversionBuffer);class E{static readInt32BE(e){let t=e.readByte(),r=e.readByte(),s=e.readByte(),n=e.readByte();return t<<24|r<<16|s<<8|n}static readInt32LE(e){let t=e.readByte(),r=e.readByte(),s=e.readByte();return e.readByte()<<24|s<<16|r<<8|t}static readUInt32LE(e){let t=e.readByte(),r=e.readByte(),s=e.readByte();return e.readByte()<<24|s<<16|r<<8|t}static decodeUInt32LE(e,t){let r=e[t],s=e[t+1],n=e[t+2];return e[t+3]<<24|n<<16|s<<8|r}static readUInt16LE(e){let t=e.readByte(),r=e.readByte();return de.int32ToUint16(r<<8|t)}static readInt16LE(e){let t=e.readByte(),r=e.readByte();return de.int32ToInt16(r<<8|t)}static readUInt32BE(e){let t=e.readByte(),r=e.readByte(),s=e.readByte(),n=e.readByte();return de.int32ToUint32(t<<24|r<<16|s<<8|n)}static readUInt16BE(e){let t=e.readByte(),r=e.readByte();return de.int32ToInt16(t<<8|r)}static readInt16BE(e){let t=e.readByte(),r=e.readByte();return de.int32ToInt16(t<<8|r)}static readByteArray(e,t){let r=new Uint8Array(t);return e.read(r,0,t),r}static read8BitChars(e,t){let r=new Uint8Array(t);return e.read(r,0,r.length),E.toString(r,"utf-8")}static read8BitString(e){let t="",r=e.readByte();for(;r!==0;)t+=String.fromCharCode(r),r=e.readByte();return t}static read8BitStringLength(e,t){let r="",s=-1;for(let a=0;a<t;a++){let o=e.readByte();o===0&&s===-1&&(s=a),r+=String.fromCharCode(o)}let n=r;return s>=0?n.substr(0,s):n}static readSInt8(e){let t=e.readByte();return((t&255)>>7)*-256+(t&255)}static readInt24(e,t){let r=e[t]|e[t+1]<<8|e[t+2]<<16;return(r&8388608)===8388608&&(r=r|255<<24),r}static readInt16(e,t){return de.int32ToInt16(e[t]|e[t+1]<<8)}static toString(e,t){let r=E.detectEncoding(e);return r&&(t=r),t||(t="utf-8"),new TextDecoder(t).decode(e.buffer)}static detectEncoding(e){return e.length>2&&e[0]===254&&e[1]===255?"utf-16be":e.length>2&&e[0]===255&&e[1]===254?"utf-16le":e.length>4&&e[0]===0&&e[1]===0&&e[2]===254&&e[3]===255?"utf-32be":e.length>4&&e[0]===255&&e[1]===254&&e[2]===0&&e[3]===0?"utf-32le":null}static stringToBytes(e){return new TextEncoder().encode(e)}static writeInt32BE(e,t){e.writeByte(t>>24&255),e.writeByte(t>>16&255),e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeInt32LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255),e.writeByte(t>>16&255),e.writeByte(t>>24&255)}static writeUInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16BE(e,t){e.writeByte(t>>8&255),e.writeByte(t>>0&255)}}class Gt{constructor(){this.length=0,this.position=0}get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return Gt.withCapacity(0)}static withCapacity(e){let t=new Gt;return t._buffer=new Uint8Array(e),t}static fromBuffer(e){let t=new Gt;return t._buffer=e,t.length=e.length,t}static fromString(e){let t=E.stringToBytes(e);return Gt.fromBuffer(t)}reset(){this.position=0}skip(e){this.position+=e}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(e,t,r){let s=this.length-this.position;return s>r&&(s=r),s<=0?0:(e.set(this._buffer.subarray(this.position,this.position+s),t),this.position+=s,s)}writeByte(e){let t=this.position+1;this.ensureCapacity(t),this._buffer[this.position]=e&255,t>this.length&&(this.length=t),this.position=t}write(e,t,r){let s=this.position+r;this.ensureCapacity(s);let n=Math.min(r,e.length-t);this._buffer.set(e.subarray(t,t+n),this.position),s>this.length&&(this.length=s),this.position=s}ensureCapacity(e){if(e>this._buffer.length){let t=e;t<256&&(t=256),t<this._buffer.length*2&&(t=this._buffer.length*2);let r=new Uint8Array(t);this.length>0&&r.set(this._buffer.subarray(0,0+this.length),0),this._buffer=r}}readAll(){return this.toArray()}toArray(){let e=new Uint8Array(this.length);return e.set(this._buffer.subarray(0,0+this.length),0),e}copyTo(e){e.write(this._buffer,0,this.length)}}var _;(function(i){i[i.No=0]="No",i[i.Eof=1]="Eof",i[i.Number=2]="Number",i[i.DoubleDot=3]="DoubleDot",i[i.Dot=4]="Dot",i[i.String=5]="String",i[i.Tuning=6]="Tuning",i[i.LParensis=7]="LParensis",i[i.RParensis=8]="RParensis",i[i.LBrace=9]="LBrace",i[i.RBrace=10]="RBrace",i[i.Pipe=11]="Pipe",i[i.MetaCommand=12]="MetaCommand",i[i.Multiply=13]="Multiply",i[i.LowerThan=14]="LowerThan"})(_||(_={}));class Gn extends Yt{constructor(e,t,r,s,n,a,o,l=null){super(Ut.AlphaTex,e),this.position=t,this.line=r,this.col=s,this.nonTerm=n??"",this.expected=a??_.No,this.symbol=o??_.No,this.symbolData=l,Object.setPrototypeOf(this,Gn.prototype)}static symbolError(e,t,r,s,n,a,o=null){let l=`MalFormed AlphaTex: @${e} (line ${t}, col ${r}): Error on block ${s}`;return n!==a?(l+=`, expected a ${_[n]} found a ${_[a]}`,o!==null&&(l+=`: '${o}'`)):l+=`, invalid value: '${o}'`,new Gn(l,e,t,r,s,n,a,o)}static errorMessage(e,t,r,s){return e=`MalFormed AlphaTex: @${t} (line ${r}, col ${s}): ${e}`,new Gn(e,t,r,s,null,null,null,null)}}class li extends co{constructor(){super(),this._trackChannel=0,this._input="",this._ch=li.Eof,this._curChPos=0,this._line=1,this._col=0,this._lastValidSpot=[0,1,0],this._sy=_.No,this._syData="",this._allowNegatives=!1,this._allowFloat=!1,this._allowTuning=!1,this._currentDuration=B.QuadrupleWhole,this._currentDynamics=pe.PPP,this._currentTuplet=0,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._percussionArticulationNames=new Map,this.logErrors=!1}get name(){return"AlphaTex"}initFromString(e,t){this.data=Gt.empty(),this._input=e,this.settings=t}readScore(){try{if(this.data.length>0&&(this._input=E.toString(this.data.readAll(),this.settings.importer.encoding)),this._allowTuning=!0,this._lyrics=new Map,this.createDefaultScore(),this._curChPos=0,this._line=1,this._col=0,this.saveValidSpot(),this._currentDuration=B.Quarter,this._currentDynamics=pe.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===_.LowerThan)throw new tt("Unknown start sign '<' (meant to import as XML?)");if(this._sy===_.Eof)throw new tt("Unexpected end of file");const e=this.metaData(),t=this.bars();if(!e&&!t)throw new tt("No alphaTex data found");this.consolidate(),this._score.finish(this.settings),this._score.rebuildRepeatGroups();for(const[r,s]of this._lyrics)this._score.tracks[r].applyLyrics(s);return this._score}catch(e){throw e instanceof Gn?new tt(e.message,e):e}}consolidate(){for(let e of this._score.tracks)for(let t of e.staves)for(;t.bars.length<this._score.masterBars.length;){let r=this.newBar(t),s=new si;s.isEmpty=!0,r.voices[0].addBeat(s)}}error(e,t,r=!0){let s,n=!1;r?(s=this._sy,(s===_.String||s===_.Number||s===_.MetaCommand)&&(n=!0)):s=t;let a=Gn.symbolError(this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2],e,t,s,n?this._syData:null);throw this.logErrors&&L.error(this.name,a.message),a}errorMessage(e){let t=Gn.errorMessage(e,this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2]);throw this.logErrors&&L.error(this.name,t.message),t}createDefaultScore(){this._score=new ha,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()}newTrack(){this._currentTrack=new ds,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++,this._currentStaff=this._currentTrack.staves[0],this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=O.getDefaultTuningFor(6).tunings,this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=pe.F}parseClefFromString(e){switch(e.toLowerCase()){case"g2":case"treble":return ae.G2;case"f4":case"bass":return ae.F4;case"c3":case"tenor":return ae.C3;case"c4":case"alto":return ae.C4;case"n":case"neutral":return ae.Neutral;default:return ae.G2}}parseClefFromInt(e){switch(e){case 43:return ae.G2;case 65:return ae.F4;case 48:return ae.C3;case 60:return ae.C4;default:return ae.G2}}parseTripletFeelFromString(e){switch(e.toLowerCase()){case"no":case"none":return fe.NoTripletFeel;case"t16":case"triplet-16th":return fe.Triplet16th;case"t8":case"triplet-8th":return fe.Triplet8th;case"d16":case"dotted-16th":return fe.Dotted16th;case"d8":case"dotted-8th":return fe.Dotted8th;case"s16":case"scottish-16th":return fe.Scottish16th;case"s8":case"scottish-8th":return fe.Scottish8th;default:return fe.NoTripletFeel}}parseTripletFeelFromInt(e){switch(e){case 0:return fe.NoTripletFeel;case 1:return fe.Triplet16th;case 2:return fe.Triplet8th;case 3:return fe.Dotted16th;case 4:return fe.Dotted8th;case 5:return fe.Scottish16th;case 6:return fe.Scottish8th;default:return fe.NoTripletFeel}}parseKeySignature(e){switch(e.toLowerCase()){case"cb":case"cbmajor":return Rt.Cb;case"gb":case"gbmajor":case"d#minor":return Rt.Gb;case"db":case"dbmajor":case"bbminor":return Rt.Db;case"ab":case"abmajor":case"fminor":return Rt.Ab;case"eb":case"ebmajor":case"cminor":return Rt.Eb;case"bb":case"bbmajor":case"gminor":return Rt.Bb;case"f":case"fmajor":case"dminor":return Rt.F;case"c":case"cmajor":case"aminor":return Rt.C;case"g":case"gmajor":case"eminor":return Rt.G;case"d":case"dmajor":case"bminor":return Rt.D;case"a":case"amajor":case"f#minor":return Rt.A;case"e":case"emajor":case"c#minor":return Rt.E;case"b":case"bmajor":case"g#minor":return Rt.B;case"f#":case"f#major":case"ebminor":return Rt.FSharp;case"c#":case"c#major":return Rt.CSharp;default:return Rt.C}}nextChar(){return this._curChPos<this._input.length?(this._ch=this._input.charCodeAt(this._curChPos++),this._ch===10?(this._line++,this._col=0):this._col++):this._ch=li.Eof,this._ch}saveValidSpot(){this._lastValidSpot=[this._curChPos,this._line,this._col]}newSy(){for(this.saveValidSpot(),this._sy=_.No;this._sy===_.No;)if(this._ch===li.Eof)this._sy=_.Eof;else if(li.isWhiteSpace(this._ch))this._ch=this.nextChar(),this.saveValidSpot();else if(this._ch===47){if(this._ch=this.nextChar(),this._ch===47)for(;this._ch!==13&&this._ch!==10&&this._ch!==li.Eof;)this._ch=this.nextChar();else if(this._ch===42)for(;this._ch!==li.Eof;)if(this._ch===42){if(this._ch=this.nextChar(),this._ch===47){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("comment",_.String,!1);this.saveValidSpot()}else if(this._ch===34||this._ch===39){let e=this._ch;this._ch=this.nextChar();let t="";for(this._sy=_.String;this._ch!==e&&this._ch!==li.Eof;)t+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._ch===li.Eof&&this.errorMessage("String opened but never closed"),this._syData=t,this._ch=this.nextChar()}else if(this._ch===45)this._allowNegatives?(this._sy=_.Number,this._syData=this.readNumber()):(this._sy=_.String,this._syData=this.readName());else if(this._ch===46)this._sy=_.Dot,this._ch=this.nextChar();else if(this._ch===58)this._sy=_.DoubleDot,this._ch=this.nextChar();else if(this._ch===40)this._sy=_.LParensis,this._ch=this.nextChar();else if(this._ch===92)this._ch=this.nextChar(),this._sy=_.MetaCommand,this._syData=this.readName();else if(this._ch===41)this._sy=_.RParensis,this._ch=this.nextChar();else if(this._ch===123)this._sy=_.LBrace,this._ch=this.nextChar();else if(this._ch===125)this._sy=_.RBrace,this._ch=this.nextChar();else if(this._ch===124)this._sy=_.Pipe,this._ch=this.nextChar();else if(this._ch===42)this._sy=_.Multiply,this._ch=this.nextChar();else if(this._ch===60)this._sy=_.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch))this._sy=_.Number,this._syData=this.readNumber();else if(li.isNameLetter(this._ch)){let e=this.readName(),t=this._allowTuning?$e.parseTuning(e):null;t?(this._sy=_.Tuning,this._syData=t):(this._sy=_.String,this._syData=e)}else this.error("symbol",_.String,!1);return this._sy}static isNameLetter(e){return!li.isTerminal(e)&&(33<=e&&e<=47||58<=e&&e<=126||128<=e)}static isTerminal(e){return e===46||e===123||e===125||e===91||e===93||e===40||e===41||e===124||e===39||e===34||e===92}static isWhiteSpace(e){return e===9||e===10||e===11||e===13||e===32}isDigit(e){return e>=48&&e<=57||this._allowNegatives&&e===45||this._allowFloat&&e===46}readName(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(li.isNameLetter(this._ch)||this.isDigit(this._ch));return e}readNumber(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(this.isDigit(this._ch));return this._allowFloat?parseFloat(e):parseInt(e)}metaData(){let e=!1,t=!0;for(;this._sy===_.MetaCommand&&t;){let r=this._syData.toLowerCase();switch(r){case"title":case"subtitle":case"artist":case"album":case"words":case"music":case"copyright":this._sy=this.newSy(),this._sy!==_.String&&this.error(r,_.String,!0);let s=this._syData;switch(r){case"title":this._score.title=s;break;case"subtitle":this._score.subTitle=s;break;case"artist":this._score.artist=s;break;case"album":this._score.album=s;break;case"words":this._score.words=s;break;case"music":this._score.music=s;break;case"copyright":this._score.copyright=s;break}this._sy=this.newSy(),e=!0;break;case"tempo":this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy===_.Number?this._score.tempo=this._syData:this.error("tempo",_.Number,!0),this._sy=this.newSy(),e=!0;break;default:this.handleStaffMeta()?e=!0:e?this.error("metaDataTags",_.String,!1):t=!1;break}}return e?(this._sy!==_.Dot&&this.error("song",_.Dot,!0),this._sy=this.newSy()):this._sy===_.Dot&&(this._sy=this.newSy()),e}handleStaffMeta(){var e;switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===_.Number?this._currentStaff.capo=this._syData:this.error("capo",_.Number,!0),this._sy=this.newSy(),!0;case"tuning":this._sy=this.newSy();let t=this._currentStaff.tuning.length;switch(this._staffHasExplicitTuning=!0,this._staffTuningApplied=!1,this._sy){case _.String:let o=this._syData.toLowerCase();o==="piano"||o==="none"||o==="voice"?(this._currentStaff.stringTuning.tunings=[],this._currentStaff.displayTranspositionPitch=0):this.error("tuning",_.Tuning,!0),this._sy=this.newSy();break;case _.Tuning:let l=[];do{let h=this._syData;l.push(h.realValue),this._sy=this.newSy()}while(this._sy===_.Tuning);this._currentStaff.stringTuning.tunings=l;break;default:this.error("tuning",_.Tuning,!0);break}return t!==this._currentStaff.tuning.length&&(((e=this._currentStaff.chords)==null?void 0:e.size)??0)>0&&this.errorMessage("Tuning must be defined before any chord"),!0;case"instrument":if(this._sy=this.newSy(),this._staffTuningApplied=!1,this._sy===_.Number){let o=this._syData;o>=0&&o<=127?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",_.Number,!1)}else if(this._sy===_.String){let o=this._syData.toLowerCase();if(o==="percussion"){for(const l of this._currentTrack.staves)this.applyPercussionStaff(l);this._currentTrack.playbackInfo.primaryChannel=9,this._currentTrack.playbackInfo.secondaryChannel=9}else this._currentTrack.playbackInfo.program=Bs.getValue(o)}else this.error("instrument",_.Number,!0);return this._sy=this.newSy(),!0;case"lyrics":this._sy=this.newSy();let r=new Ct;return r.startBar=0,r.text="",this._sy===_.Number&&(r.startBar=this._syData,this._sy=this.newSy()),this._sy===_.String?(r.text=this._syData,this._sy=this.newSy()):this.error("lyrics",_.String,!0),this._lyrics.get(this._currentTrack.index).push(r),!0;case"chord":this._sy=this.newSy();let s=new Sn;this.chordProperties(s),this._sy===_.String?(s.name=this._syData,this._sy=this.newSy()):this.error("chord-name",_.String,!0);for(let o=0;o<this._currentStaff.tuning.length;o++)this._sy===_.Number?s.strings.push(this._syData):this._sy===_.String&&this._syData.toLowerCase()==="x"&&s.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(this.getChordId(this._currentStaff,s.name),s),!0;case"articulation":this._sy=this.newSy();let n="";if(this._sy===_.String?(n=this._syData,this._sy=this.newSy()):this.error("articulation-name",_.String,!0),n==="defaults"){for(const[o,l]of xt.instrumentArticulationNames)this._percussionArticulationNames.set(o.toLowerCase(),l),this._percussionArticulationNames.set(li.toArticulationId(o),l);return!0}let a=0;return this._sy===_.Number?(a=this._syData,this._sy=this.newSy()):this.error("articulation-number",_.Number,!0),xt.instrumentArticulations.has(a)||this.errorMessage(`Unknown articulation ${a}. Refer to https://www.alphatab.net/docs/alphatex/percussion for available ids`),this._percussionArticulationNames.set(n.toLowerCase(),a),!0;default:return!1}}static toArticulationId(e){return e.replace(new RegExp("[^a-zA-Z0-9]","g"),"").toLowerCase()}applyPercussionStaff(e){e.isPercussion=!0,e.showTablature=!1}chordProperties(e){if(this._sy===_.LBrace){for(this._sy=this.newSy();this._sy===_.String;)switch(this._syData.toLowerCase()){case"firstfret":switch(this._sy=this.newSy(),this._sy){case _.Number:e.firstFret=this._syData;break;default:this.error("chord-firstfret",_.Number,!0);break}this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case _.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case _.Number:e.showDiagram=this._syData!==0;break;default:this.error("chord-showdiagram",_.String,!0);break}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case _.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case _.Number:e.showFingering=this._syData!==0;break;default:this.error("chord-showfingering",_.String,!0);break}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case _.String:e.showName=this._syData.toLowerCase()!=="false";break;case _.Number:e.showName=this._syData!==0;break;default:this.error("chord-showname",_.String,!0);break}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===_.Number;)e.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",_.String,!1);break}this._sy!==_.RBrace&&this.error("chord-properties",_.RBrace,!0),this._sy=this.newSy()}}bars(){let e=this.bar();for(;this._sy!==_.Eof;)if(this._sy===_.Pipe)this._sy=this.newSy(),this.bar();else if(this._sy===_.MetaCommand)this.bar();else break;return e}trackStaffMeta(){if(this._sy!==_.MetaCommand)return!1;if(this._syData.toLowerCase()==="track"&&(this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===_.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===_.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy())),this._sy===_.MetaCommand&&this._syData.toLowerCase()==="staff"){if(this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0){this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1);const e=this._currentStaff.isPercussion;this._currentStaff=this._currentTrack.staves[this._currentTrack.staves.length-1],e&&this.applyPercussionStaff(this._currentStaff),this._currentDynamics=pe.F}this.staffProperties()}return!0}staffProperties(){if(this._sy!==_.LBrace)return;this._sy=this.newSy();let e=!1,t=!1,r=!1;for(;this._sy===_.String;)switch(this._syData.toLowerCase()){case"score":e=!0,this._sy=this.newSy();break;case"tabs":t=!0,this._sy=this.newSy();break;case"slash":r=!0,this._sy=this.newSy();break;default:this.error("staff-properties",_.String,!1);break}(e||t||r)&&(this._currentStaff.showStandardNotation=e,this._currentStaff.showTablature=t,this._currentStaff.showSlash=r),this._sy!==_.RBrace&&this.error("staff-properties",_.RBrace,!0),this._sy=this.newSy()}bar(){const e=this.trackStaffMeta();let t=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){let a=new Vs;this._score.addMasterBar(a),a.index>0&&(a.keySignature=a.previousMasterBar.keySignature,a.keySignatureType=a.previousMasterBar.keySignatureType,a.timeSignatureDenominator=a.previousMasterBar.timeSignatureDenominator,a.timeSignatureNumerator=a.previousMasterBar.timeSignatureNumerator,a.tripletFeel=a.previousMasterBar.tripletFeel)}const r=this.barMeta(t);if(!this._staffTuningApplied&&!this._staffHasExplicitTuning){const a=this._currentTrack.playbackInfo.program;this._currentStaff.displayTranspositionPitch=0,this._currentStaff.stringTuning.tunings=[],a==15||a>=24&&a<=31?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=O.getDefaultTuningFor(6).tunings):a>=32&&a<=39?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=[43,38,33,28]):a==40||a==44||a==45||a==48||a==49||a==50||a==51?this._currentStaff.stringTuning.tunings=[52,57,50,43]:a==41?this._currentStaff.stringTuning.tunings=[57,50,43,36]:a==42?this._currentStaff.stringTuning.tunings=[45,38,31,24]:a==43?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=[43,38,33,28]):a==105?this._currentStaff.stringTuning.tunings=[50,47,43,38,55]:a==106?this._currentStaff.stringTuning.tunings=[57,52,45]:a==107?this._currentStaff.stringTuning.tunings=[52,45,38,31]:a==110&&(this._currentStaff.stringTuning.tunings=[64,57,50,43]),this._staffTuningApplied=!0}let s=!1,n=t.voices[0];for(;this._sy!==_.Pipe&&this._sy!==_.Eof&&this.beat(n);)s=!0;if(n.beats.length===0){let a=new si;a.isEmpty=!0,n.addBeat(a)}return e||r||s}newBar(e){let t=new Gs;e.addBar(t),t.index>0&&(t.clef=t.previousBar.clef);let r=new fs;return t.addVoice(r),t}beat(e){this.beatDuration();let t=new si;if(e.addBeat(t),this._allowTuning=!this._currentStaff.isPercussion,this._sy===_.LParensis){for(this._sy=this.newSy(),this.note(t);this._sy!==_.RParensis&&this._sy!==_.Eof&&(this._allowTuning=!this._currentStaff.isPercussion,!!this.note(t)););this._sy!==_.RParensis&&this.error("note-list",_.RParensis,!0),this._sy=this.newSy()}else if(this._sy===_.String&&this._syData.toLowerCase()==="r")this._sy=this.newSy();else if(!this.note(t))return e.beats.splice(e.beats.length-1,1),!1;this._sy===_.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==_.Number&&this.error("duration",_.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),t.duration=this._currentDuration,t.dynamics=this._currentDynamics,this._currentTuplet!==1&&!t.hasTuplet&&li.applyTuplet(t,this._currentTuplet);let r=1;this._sy===_.Multiply&&(this._sy=this.newSy(),this._sy!==_.Number?this.error("multiplier",_.Number,!0):r=this._syData,this._sy=this.newSy()),this.beatEffects(t);for(let s=0;s<r-1;s++)e.addBeat(Fm.clone(t));return!0}beatDuration(){if(this._sy===_.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==_.Number&&this.error("duration",_.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===_.LBrace)){for(this._sy=this.newSy();this._sy===_.String;)switch(this._syData.toLowerCase()){case"tu":this._sy=this.newSy(),this._sy!==_.Number&&this.error("duration-tuplet",_.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy();break;default:this.error("beat-duration",_.String,!1);break}this._sy!==_.RBrace&&this.error("beat-duration",_.RBrace,!0),this._sy=this.newSy()}}beatEffects(e){if(this._sy===_.LBrace){for(this._sy=this.newSy();this._sy===_.String;)this.applyBeatEffect(e)||this.error("beat-effects",_.String,!1);this._sy!==_.RBrace&&this.error("beat-effects",_.RBrace,!0),this._sy=this.newSy()}}applyBeatEffect(e){let t=this._syData.toLowerCase();if(t==="f")e.fadeIn=!0;else if(t==="v")e.vibrato=Pe.Slight;else if(t==="s")e.slap=!0;else if(t==="p")e.pop=!0;else if(t==="tt")e.tap=!0;else if(t==="dd")e.dots=2;else if(t==="d")e.dots=1;else if(t==="su")e.pickStroke=Jt.Up;else if(t==="sd")e.pickStroke=Jt.Down;else if(t==="tu"){if(this._sy=this.newSy(),this._sy!==_.Number)return this.error("tuplet",_.Number,!0),!1;li.applyTuplet(e,this._syData)}else if(t==="tb"||t==="tbe"){let r=t==="tbe";for(this._sy=this.newSy(),this._sy!==_.LParensis&&this.error("tremolobar-effect",_.LParensis,!0),this._allowNegatives=!0,this._sy=this.newSy();this._sy!==_.RParensis&&this._sy!==_.Eof;){let s=0,n=0;r?(this._sy!==_.Number&&this.error("tremolobar-effect",_.Number,!0),s=this._syData,this._sy=this.newSy(),this._sy!==_.Number&&this.error("tremolobar-effect",_.Number,!0),n=this._syData):(this._sy!==_.Number&&this.error("tremolobar-effect",_.Number,!0),s=0,n=this._syData),e.addWhammyBarPoint(new V(s,n)),this._sy=this.newSy()}if(e.whammyBarPoints!=null){for(;e.whammyBarPoints.length>60;)e.removeWhammyBarPoint(e.whammyBarPoints.length-1);if(r)e.whammyBarPoints.sort((s,n)=>s.offset-n.offset);else{let s=e.whammyBarPoints.length,n=60/s|0,a=0;for(;a<s;)e.whammyBarPoints[a].offset=Math.min(60,a*n),a++}}this._allowNegatives=!1,this._sy!==_.RParensis&&this.error("tremolobar-effect",_.RParensis,!0)}else if(t==="bu"||t==="bd"||t==="au"||t==="ad"){switch(t){case"bu":e.brushType=Ye.BrushUp;break;case"bd":e.brushType=Ye.BrushDown;break;case"au":e.brushType=Ye.ArpeggioUp;break;case"ad":e.brushType=Ye.ArpeggioDown;break}return this._sy=this.newSy(),this._sy===_.Number?(e.brushDuration=this._syData,this._sy=this.newSy(),!0):(e.updateDurations(),t==="bu"||t==="bd"?e.brushDuration=e.playbackDuration/4/e.notes.length:(t==="au"||t==="ad")&&(e.brushDuration=e.playbackDuration/e.notes.length),!0)}else if(t==="ch"){this._sy=this.newSy();let r=this._syData,s=this.getChordId(this._currentStaff,r);if(!this._currentStaff.hasChord(s)){let n=new Sn;n.showDiagram=!1,n.name=r,this._currentStaff.addChord(s,n)}e.chordId=s}else{if(t==="gr")return this._sy=this.newSy(),this._syData.toLowerCase()==="ob"?(e.graceType=K.OnBeat,this._sy=this.newSy()):this._syData.toLowerCase()==="b"?(e.graceType=K.BendGrace,this._sy=this.newSy()):e.graceType=K.BeforeBeat,!0;if(t==="dy"){switch(this._sy=this.newSy(),this._syData.toLowerCase()){case"ppp":e.dynamics=pe.PPP;break;case"pp":e.dynamics=pe.PP;break;case"p":e.dynamics=pe.P;break;case"mp":e.dynamics=pe.MP;break;case"mf":e.dynamics=pe.MF;break;case"f":e.dynamics=pe.F;break;case"ff":e.dynamics=pe.FF;break;case"fff":e.dynamics=pe.FFF;break}this._currentDynamics=e.dynamics}else if(t==="cre")e.crescendo=Ii.Crescendo;else if(t==="dec")e.crescendo=Ii.Decrescendo;else if(t==="tp"){if(this._sy=this.newSy(),e.tremoloSpeed=B.Eighth,this._sy===_.Number){switch(this._syData){case 8:e.tremoloSpeed=B.Eighth;break;case 16:e.tremoloSpeed=B.Sixteenth;break;case 32:e.tremoloSpeed=B.ThirtySecond;break;default:e.tremoloSpeed=B.Eighth;break}this._sy=this.newSy()}return!0}else return!1}return this._sy=this.newSy(),!0}getChordId(e,t){return t.toLowerCase()+e.index+e.track.index}static applyTuplet(e,t){switch(t){case 3:e.tupletNumerator=3,e.tupletDenominator=2;break;case 5:e.tupletNumerator=5,e.tupletDenominator=4;break;case 6:e.tupletNumerator=6,e.tupletDenominator=4;break;case 7:e.tupletNumerator=7,e.tupletDenominator=4;break;case 9:e.tupletNumerator=9,e.tupletDenominator=8;break;case 10:e.tupletNumerator=10,e.tupletDenominator=8;break;case 11:e.tupletNumerator=11,e.tupletDenominator=8;break;case 12:e.tupletNumerator=12,e.tupletDenominator=8;break;default:e.tupletNumerator=1,e.tupletDenominator=1;break}}isNoteText(e){return e==="x"||e==="-"||e==="r"}note(e){let t=!1,r=!1,s=-1,n=-1,a=-1;switch(this._sy){case _.Number:s=this._syData,this._currentStaff.isPercussion&&!xt.instrumentArticulations.has(s)&&this.errorMessage(`Unknown percussion articulation ${s}`);break;case _.String:if(this._currentStaff.isPercussion){const c=this._syData.toLowerCase();this._percussionArticulationNames.has(c)?s=this._percussionArticulationNames.get(c):this.errorMessage(`Unknown percussion articulation '${this._syData}'`)}else t=this._syData==="x",r=this._syData==="-",r||t?s=0:this.error("note-fret",_.Number,!0);break;case _.Tuning:let u=this._syData;n=u.octave,a=u.noteValue;break;default:return!1}this._sy=this.newSy();let o=n===-1&&this._currentStaff.tuning.length>0&&!this._currentStaff.isPercussion,l=-1;o&&(this._sy!==_.Dot&&this.error("note",_.Dot,!0),this._sy=this.newSy(),this._sy!==_.Number&&this.error("note-string",_.Number,!0),l=this._syData,(l<1||l>this._currentStaff.tuning.length)&&this.error("note-string",_.Number,!1),this._sy=this.newSy());let h=new ct;return o?(h.string=this._currentStaff.tuning.length-(l-1),h.isDead=t,h.isTieDestination=r,r||(h.fret=s)):this._currentStaff.isPercussion?h.percussionArticulation=s:(h.octave=n,h.tone=a,h.isTieDestination=r),e.addNote(h),this.noteEffects(h),!0}noteEffects(e){if(this._sy===_.LBrace){for(this._sy=this.newSy();this._sy===_.String;){let t=this._syData.toLowerCase();if(t==="b"||t==="be"){let r=t==="be";for(this._sy=this.newSy(),this._sy!==_.LParensis&&this.error("bend-effect",_.LParensis,!0),this._sy=this.newSy();this._sy!==_.RParensis&&this._sy!==_.Eof;){let n=0,a=0;r?(this._sy!==_.Number&&this.error("bend-effect-value",_.Number,!0),n=this._syData,this._sy=this.newSy(),this._sy!==_.Number&&this.error("bend-effect-value",_.Number,!0),a=this._syData):(this._sy!==_.Number&&this.error("bend-effect-value",_.Number,!0),a=this._syData),e.addBendPoint(new V(n,a)),this._sy=this.newSy()}const s=e.bendPoints;if(s!=null){for(;s.length>60;)s.splice(s.length-1,1);if(r)s.sort((n,a)=>n.offset-a.offset);else{let n=s.length,a=60/(n-1)|0,o=0;for(;o<n;)s[o].offset=Math.min(60,o*a),o++}}this._sy!==_.RParensis&&this.error("bend-effect",_.RParensis,!0),this._sy=this.newSy()}else if(t==="nh")e.harmonicType=q.Natural,this._sy=this.newSy();else if(t==="ah")e.harmonicType=q.Artificial,this._sy=this.newSy();else if(t==="th")e.harmonicType=q.Tap,this._sy=this.newSy();else if(t==="ph")e.harmonicType=q.Pinch,this._sy=this.newSy();else if(t==="sh")e.harmonicType=q.Semi,this._sy=this.newSy();else if(t==="tr"){this._sy=this.newSy(),this._sy!==_.Number&&this.error("trill-effect",_.Number,!0);let r=this._syData;this._sy=this.newSy();let s=B.Sixteenth;if(this._sy===_.Number){switch(this._syData){case 16:s=B.Sixteenth;break;case 32:s=B.ThirtySecond;break;case 64:s=B.SixtyFourth;break;default:s=B.Sixteenth;break}this._sy=this.newSy()}e.trillValue=r+e.stringTuning,e.trillSpeed=s}else if(t==="v")this._sy=this.newSy(),e.vibrato=Pe.Slight;else if(t==="sl")this._sy=this.newSy(),e.slideOutType=he.Legato;else if(t==="ss")this._sy=this.newSy(),e.slideOutType=he.Shift;else if(t==="sib")this._sy=this.newSy(),e.slideInType=zt.IntoFromBelow;else if(t==="sia")this._sy=this.newSy(),e.slideInType=zt.IntoFromAbove;else if(t==="sou")this._sy=this.newSy(),e.slideOutType=he.OutUp;else if(t==="sod")this._sy=this.newSy(),e.slideOutType=he.OutDown;else if(t==="psd")this._sy=this.newSy(),e.slideOutType=he.PickSlideDown;else if(t==="psu")this._sy=this.newSy(),e.slideOutType=he.PickSlideUp;else if(t==="h")this._sy=this.newSy(),e.isHammerPullOrigin=!0;else if(t==="lht")this._sy=this.newSy(),e.isLeftHandTapped=!0;else if(t==="g")this._sy=this.newSy(),e.isGhost=!0;else if(t==="ac")this._sy=this.newSy(),e.accentuated=Et.Normal;else if(t==="hac")this._sy=this.newSy(),e.accentuated=Et.Heavy;else if(t==="pm")this._sy=this.newSy(),e.isPalmMute=!0;else if(t==="st")this._sy=this.newSy(),e.isStaccato=!0;else if(t==="lr")this._sy=this.newSy(),e.isLetRing=!0;else if(t==="x")this._sy=this.newSy(),e.fret=0,e.isDead=!0;else if(t==="-"||t==="t")this._sy=this.newSy(),e.isTieDestination=!0;else if(t==="lf"){this._sy=this.newSy();let r=ne.Thumb;this._sy===_.Number&&(r=this.toFinger(this._syData),this._sy=this.newSy()),e.leftHandFinger=r}else if(t==="rf"){this._sy=this.newSy();let r=ne.Thumb;this._sy===_.Number&&(r=this.toFinger(this._syData),this._sy=this.newSy()),e.rightHandFinger=r}else this.applyBeatEffect(e.beat)||this.error(t,_.String,!1)}this._sy!==_.RBrace&&this.error("note-effect",_.RBrace,!1),this._sy=this.newSy()}}toFinger(e){switch(e){case 1:return ne.Thumb;case 2:return ne.IndexFinger;case 3:return ne.MiddleFinger;case 4:return ne.AnnularFinger;case 5:return ne.LittleFinger}return ne.Thumb}parseDuration(e){switch(e){case-4:return B.QuadrupleWhole;case-2:return B.DoubleWhole;case 1:return B.Whole;case 2:return B.Half;case 4:return B.Quarter;case 8:return B.Eighth;case 16:return B.Sixteenth;case 32:return B.ThirtySecond;case 64:return B.SixtyFourth;case 128:return B.OneHundredTwentyEighth;case 256:return B.TwoHundredFiftySixth;default:return B.Quarter}}barMeta(e){let t=!1,r=e.masterBar;for(;this._sy===_.MetaCommand;){t=!0;let s=this._syData.toLowerCase();if(s==="ts")this._sy=this.newSy(),this._sy!==_.Number&&this.error("timesignature-numerator",_.Number,!0),r.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==_.Number&&this.error("timesignature-denominator",_.Number,!0),r.timeSignatureDenominator=this._syData,this._sy=this.newSy();else if(s==="ro")r.isRepeatStart=!0,this._sy=this.newSy();else if(s==="rc")this._sy=this.newSy(),this._sy!==_.Number&&this.error("repeatclose",_.Number,!0),this._syData>2048&&this.error("repeatclose",_.Number,!1),r.repeatCount=this._syData,this._sy=this.newSy();else if(s==="ae")if(this._sy=this.newSy(),this._sy===_.LParensis){for(this._sy=this.newSy(),this._sy!==_.Number&&this.error("alternateending",_.Number,!0),this.applyAlternateEnding(r);this._sy===_.Number;)this.applyAlternateEnding(r);this._sy!==_.RParensis&&this.error("alternateending-list",_.RParensis,!0),this._sy=this.newSy()}else this._sy!==_.Number&&this.error("alternateending",_.Number,!0),this.applyAlternateEnding(r);else if(s==="ks")this._sy=this.newSy(),this._sy!==_.String&&this.error("keysignature",_.String,!0),r.keySignature=this.parseKeySignature(this._syData),this._sy=this.newSy();else if(s==="clef"){switch(this._sy=this.newSy(),this._sy){case _.String:e.clef=this.parseClefFromString(this._syData);break;case _.Number:e.clef=this.parseClefFromInt(this._syData);break;case _.Tuning:let n=this._syData;e.clef=this.parseClefFromInt(n.realValue);break;default:this.error("clef",_.String,!0);break}this._sy=this.newSy()}else if(s==="tempo"){this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==_.Number&&this.error("tempo",_.Number,!0);let n=new ii;n.isLinear=!1,n.type=Dt.Tempo,n.value=this._syData,r.tempoAutomation=n,this._sy=this.newSy()}else if(s==="section"){this._sy=this.newSy(),this._sy!==_.String&&this.error("section",_.String,!0);let n=this._syData;this._sy=this.newSy();let a="";this._sy===_.String&&!this.isNoteText(this._syData.toLowerCase())&&(a=n,n=this._syData,this._sy=this.newSy());let o=new Zc;o.marker=a,o.text=n,r.section=o}else if(s==="tf"){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case _.String:r.tripletFeel=this.parseTripletFeelFromString(this._syData);break;case _.Number:r.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",_.String,!0);break}this._sy=this.newSy()}else s==="ac"?(r.isAnacrusis=!0,this._sy=this.newSy()):e.index===0?this.handleStaffMeta()||this.error("measure-effects",_.String,!1):this.error("measure-effects",_.String,!1)}if(r.index===0&&!r.tempoAutomation){let s=new ii;s.isLinear=!1,s.type=Dt.Tempo,s.value=this._score.tempo,r.tempoAutomation=s}return t}applyAlternateEnding(e){let t=this._syData;t<1&&this.error("alternateending",_.Number,!0),e.alternateEndings|=1<<t-1,this._sy=this.newSy()}}li.Eof=0;class rs extends co{get name(){return"Guitar Pro 3-5"}constructor(){super(),this._versionNumber=0,this._globalTripletFeel=fe.NoTripletFeel,this._lyricsTrack=0,this._lyrics=[],this._barCount=0,this._trackCount=0,this._playbackInfos=[],this._beatTextChunksByTrack=new Map}readScore(){return this.readVersion(),this._score=new ha,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=Ne.gpReadBool(this.data)?fe.Triplet8th:fe.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=E.readInt32LE(this.data),this._versionNumber>=510&&Ne.gpReadBool(this.data),E.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.data.skip(38),this.data.skip(4)),this._barCount=E.readInt32LE(this.data),this._trackCount=E.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0&&(this._score.masterBars[0].tempoAutomation=ii.buildTempoAutomation(!1,0,this._score.tempo,2),this._score.masterBars[0].tempoAutomation.text=this._score.tempoLabel),this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}readVersion(){let e=Ne.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!e.startsWith(rs.VersionString))throw new tt("Unsupported format");e=e.substr(rs.VersionString.length+1);let t=e.indexOf(".");this._versionNumber=100*parseInt(e.substr(0,t))+parseInt(e.substr(t+1)),L.debug(this.name,"Guitar Pro version "+e+" detected")}readScoreInformation(){var r;this._score.title=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding);let e=E.readInt32LE(this.data),t="";for(let s=0;s<e;s++)s>0&&(t+=`\r
`),t+=(r=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding))==null?void 0:r.toString();this._score.notices=t}readLyrics(){this._lyrics=[],this._lyricsTrack=E.readInt32LE(this.data)-1;for(let e=0;e<5;e++){let t=new Ct;t.startBar=E.readInt32LE(this.data)-1,t.text=Ne.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(t)}}readPageSetup(){this.data.skip(30);for(let e=0;e<10;e++)Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];for(let e=0;e<64;e++){let t=new mx;t.primaryChannel=e,t.secondaryChannel=e,t.program=E.readInt32LE(this.data),t.volume=this.data.readByte(),t.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(t)}}readMasterBars(){for(let e=0;e<this._barCount;e++)this.readMasterBar()}readMasterBar(){let e=null;this._score.masterBars.length>0&&(e=this._score.masterBars[this._score.masterBars.length-1]);let t=new Vs,r=this.data.readByte();if(r&1?t.timeSignatureNumerator=this.data.readByte():e&&(t.timeSignatureNumerator=e.timeSignatureNumerator),r&2?t.timeSignatureDenominator=this.data.readByte():e&&(t.timeSignatureDenominator=e.timeSignatureDenominator),t.isRepeatStart=(r&4)!==0,r&8&&(t.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),r&16&&this._versionNumber<500){let s=e,n=0;for(;s&&!(s.isRepeatEnd&&s!==e||s.isRepeatStart);)n=n|s.alternateEndings,s=s.previousMasterBar;let a=0,o=this.data.readByte();for(let l=0;l<8;l++){let h=1<<l;o>l&&!(n&h)&&(a=a|h)}t.alternateEndings=a}if(r&32){let s=new Zc;s.text=Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding),s.marker="",Ne.gpReadColor(this.data,!1),t.section=s}if(r&64?(t.keySignature=E.readSInt8(this.data),t.keySignatureType=this.data.readByte()):e&&(t.keySignature=e.keySignature,t.keySignatureType=e.keySignatureType),this._versionNumber>=500&&r&3&&this.data.skip(4),this._versionNumber>=500&&(t.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:t.tripletFeel=fe.Triplet8th;break;case 2:t.tripletFeel=fe.Triplet16th;break}this.data.readByte()}else t.tripletFeel=this._globalTripletFeel;t.isDoubleBar=(r&128)!==0,this._score.addMasterBar(t)}readTracks(){for(let e=0;e<this._trackCount;e++)this.readTrack()}readTrack(){let e=new ds;e.ensureStaveCount(1),this._score.addTrack(e);let t=e.staves[0],r=this.data.readByte();e.name=Ne.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),r&1&&(t.isPercussion=!0),this._versionNumber>=500&&(e.isVisibleOnMultiTrack=(r&8)!==0);let s=E.readInt32LE(this.data),n=[];for(let h=0;h<7;h++){let u=E.readInt32LE(this.data);s>h&&n.push(u)}t.stringTuning.tunings=n;let a=E.readInt32LE(this.data),o=E.readInt32LE(this.data)-1,l=E.readInt32LE(this.data)-1;if(this.data.skip(4),o>=0&&o<this._playbackInfos.length){let h=this._playbackInfos[o];h.port=a,h.isSolo=(r&16)!==0,h.isMute=(r&32)!==0,h.secondaryChannel=l,Bs.isGuitar(h.program)&&(t.displayTranspositionPitch=-12),e.playbackInfo=h}t.capo=E.readInt32LE(this.data),e.color=Ne.gpReadColor(this.data,!1),this._versionNumber>=500&&(this.data.readByte(),this.data.readByte(),this.data.skip(43)),this._versionNumber>=510&&(this.data.skip(4),Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding))}readBars(){for(let e=0;e<this._barCount;e++)for(let t=0;t<this._trackCount;t++)this.readBar(this._score.tracks[t])}readBar(e){let t=new Gs,r=e.staves[0];r.isPercussion&&(t.clef=ae.Neutral),r.addBar(t);let s=1;this._versionNumber>=500&&(this.data.readByte(),s=2);for(let n=0;n<s;n++)this.readVoice(e,t)}readVoice(e,t){let r=E.readInt32LE(this.data);if(r===0)return;let s=new fs;t.addVoice(s);for(let n=0;n<r;n++)this.readBeat(e,t,s)}readBeat(e,t,r){let s=new si,n=this.data.readByte();if(n&1&&(s.dots=1),n&64){let u=this.data.readByte();s.isEmpty=(u&2)===0}switch(r.addBeat(s),E.readSInt8(this.data)){case-2:s.duration=B.Whole;break;case-1:s.duration=B.Half;break;case 0:s.duration=B.Quarter;break;case 1:s.duration=B.Eighth;break;case 2:s.duration=B.Sixteenth;break;case 3:s.duration=B.ThirtySecond;break;case 4:s.duration=B.SixtyFourth;break;default:s.duration=B.Quarter;break}if(n&32)switch(s.tupletNumerator=E.readInt32LE(this.data),s.tupletNumerator){case 1:s.tupletDenominator=1;break;case 3:s.tupletDenominator=2;break;case 5:case 6:case 7:s.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:s.tupletDenominator=8;break;case 2:case 4:case 8:break;default:s.tupletNumerator=1,s.tupletDenominator=1;break}n&2&&this.readChord(s);let o=this.settings.importer.beatTextAsLyrics&&e.index!==this._lyricsTrack;if(n&4){const u=Ne.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(o){const c=new Ct;c.text=u.trim(),c.finish(!0);const d=[];for(let p=c.chunks.length-1;p>=0;p--)d.push(c.chunks[p]);this._beatTextChunksByTrack.set(e.index,d)}else s.text=u}let l=q.None;n&8&&(l=this.readBeatEffects(s)),n&16&&this.readMixTableChange(s);let h=this.data.readByte();for(let u=6;u>=0;u--)if(h&1<<u&&6-u<t.staff.tuning.length){const c=this.readNote(e,t,r,s,6-u);l!==q.None&&(c.harmonicType=l,c.harmonicType===q.Natural&&(c.harmonicValue=this.deltaFretToHarmonicValue(c.fret)))}this._versionNumber>=500&&(this.data.readByte(),this.data.readByte()&8&&this.data.readByte()),o&&!s.isRest&&this._beatTextChunksByTrack.has(e.index)&&this._beatTextChunksByTrack.get(e.index).length>0&&(s.lyrics=[this._beatTextChunksByTrack.get(e.index).pop()])}readChord(e){let t=new Sn,r=$e.newGuid();if(this._versionNumber>=500){this.data.skip(17),t.name=Ne.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=E.readInt32LE(this.data);for(let a=0;a<7;a++){let o=E.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}let s=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let a=0;a<s;a++)t.barreFrets.push(n[a]);this.data.skip(26)}else if(this.data.readByte()!==0)if(this._versionNumber>=400){this.data.skip(16),t.name=Ne.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=E.readInt32LE(this.data);for(let a=0;a<7;a++){let o=E.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}let s=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let a=0;a<s;a++)t.barreFrets.push(n[a]);this.data.skip(26)}else{this.data.skip(25),t.name=Ne.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),t.firstFret=E.readInt32LE(this.data);for(let s=0;s<6;s++){let n=E.readInt32LE(this.data);s<e.voice.bar.staff.tuning.length&&t.strings.push(n)}this.data.skip(36)}else{let s=this._versionNumber>=406?7:6;if(t.name=Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding),t.firstFret=E.readInt32LE(this.data),t.firstFret>0)for(let n=0;n<s;n++){let a=E.readInt32LE(this.data);n<e.voice.bar.staff.tuning.length&&t.strings.push(a)}}t.name&&(e.chordId=r,e.voice.bar.staff.addChord(e.chordId,t))}readBeatEffects(e){let t=this.data.readByte(),r=0;if(this._versionNumber>=400&&(r=this.data.readByte()),e.fadeIn=(t&16)!==0,(this._versionNumber<400&&t&1||t&2)&&(e.vibrato=Pe.Slight),e.hasRasgueado=(r&1)!==0,t&32&&this._versionNumber>=400)switch(E.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}else if(t&32){switch(E.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}this.data.skip(4)}if(r&4&&this.readTremoloBarEffect(e),t&64){let s=0,n=0;this._versionNumber<500?(n=this.data.readByte(),s=this.data.readByte()):(s=this.data.readByte(),n=this.data.readByte()),s>0?(e.brushType=Ye.BrushUp,e.brushDuration=rs.toStrokeValue(s)):n>0&&(e.brushType=Ye.BrushDown,e.brushDuration=rs.toStrokeValue(n))}if(r&2)switch(E.readSInt8(this.data)){case 0:e.pickStroke=Jt.None;break;case 1:e.pickStroke=Jt.Up;break;case 2:e.pickStroke=Jt.Down;break}if(this._versionNumber<400){if(t&4)return q.Natural;if(t&8)return q.Artificial}return q.None}readTremoloBarEffect(e){this.data.readByte(),E.readInt32LE(this.data);let t=E.readInt32LE(this.data);if(t>0)for(let r=0;r<t;r++){let s=new V(0,0);s.offset=E.readInt32LE(this.data),s.value=E.readInt32LE(this.data)/rs.BendStep|0,Ne.gpReadBool(this.data),e.addWhammyBarPoint(s)}}static toStrokeValue(e){switch(e){case 1:return 30;case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}readMixTableChange(e){let t=new Q3;t.instrument=E.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),t.volume=E.readSInt8(this.data),t.balance=E.readSInt8(this.data);let r=E.readSInt8(this.data),s=E.readSInt8(this.data),n=E.readSInt8(this.data),a=E.readSInt8(this.data);if(this._versionNumber>=500&&(t.tempoName=Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.tempo=E.readInt32LE(this.data),t.volume>=0&&this.data.readByte(),t.balance>=0&&this.data.readByte(),r>=0&&this.data.readByte(),s>=0&&this.data.readByte(),n>=0&&this.data.readByte(),a>=0&&this.data.readByte(),t.tempo>=0&&(t.duration=E.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500&&this.data.readByte(),this._versionNumber>=510&&(Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ne.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.volume>=0){let o=new ii;o.isLinear=!0,o.type=Dt.Volume,o.value=t.volume,e.automations.push(o)}if(t.balance>=0){let o=new ii;o.isLinear=!0,o.type=Dt.Balance,o.value=t.balance,e.automations.push(o)}if(t.instrument>=0){let o=new ii;o.isLinear=!0,o.type=Dt.Instrument,o.value=t.instrument,e.automations.push(o)}if(t.tempo>=0){let o=new ii;o.isLinear=!0,o.type=Dt.Tempo,o.value=t.tempo,e.automations.push(o),e.voice.bar.masterBar.tempoAutomation=o}}readNote(e,t,r,s,n){let a=new ct;a.string=t.staff.tuning.length-n;let o=this.data.readByte();if(o&2?a.accentuated=Et.Heavy:o&64&&(a.accentuated=Et.Normal),a.isGhost=(o&4)!==0,o&32){let h=this.data.readByte();h===3?a.isDead=!0:h===2&&(a.isTieDestination=!0)}if(o&1&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),o&16){let h=E.readSInt8(this.data);a.dynamics=this.toDynamicValue(h),s.dynamics=a.dynamics}o&32&&(a.fret=E.readSInt8(this.data)),o&128&&(a.leftHandFinger=E.readSInt8(this.data),a.rightHandFinger=E.readSInt8(this.data),a.isFingering=!0);let l=!1;if(this._versionNumber>=500&&(o&1&&(a.durationPercent=Ne.gpReadDouble(this.data)),l=(this.data.readByte()&2)!==0),s.addNote(a),o&8&&this.readNoteEffects(e,r,s,a),t.staff.isPercussion&&(a.percussionArticulation=a.fret,a.string=-1,a.fret=-1),l){const h=O.defaultAccidentals[a.realValueWithoutHarmonic%12];h==="#"?a.accidentalMode=kt.ForceFlat:h==="b"&&(a.accidentalMode=kt.ForceSharp)}return a}toDynamicValue(e){switch(e){case 1:return pe.PPP;case 2:return pe.PP;case 3:return pe.P;case 4:return pe.MP;case 5:return pe.MF;case 6:return pe.F;case 7:return pe.FF;case 8:return pe.FFF;default:return pe.F}}readNoteEffects(e,t,r,s){let n=this.data.readByte(),a=0;this._versionNumber>=400&&(a=this.data.readByte()),n&1&&this.readBend(s),n&16&&this.readGrace(t,s),a&4&&this.readTremoloPicking(r),a&8?this.readSlide(s):this._versionNumber<400&&n&4&&(s.slideOutType=he.Shift),a&16&&this.readArtificialHarmonic(s),a&32&&this.readTrill(s),s.isLetRing=(n&8)!==0,s.isHammerPullOrigin=(n&2)!==0,a&64&&(s.vibrato=Pe.Slight),s.isPalmMute=(a&2)!==0,s.isStaccato=(a&1)!==0}readBend(e){this.data.readByte(),E.readInt32LE(this.data);let t=E.readInt32LE(this.data);if(t>0)for(let r=0;r<t;r++){let s=new V(0,0);s.offset=E.readInt32LE(this.data),s.value=E.readInt32LE(this.data)/rs.BendStep|0,Ne.gpReadBool(this.data),e.addBendPoint(s)}}readGrace(e,t){let r=new si,s=new ct;switch(s.string=t.string,s.fret=E.readSInt8(this.data),r.duration=B.ThirtySecond,r.dynamics=this.toDynamicValue(E.readSInt8(this.data)),E.readSInt8(this.data)){case 0:break;case 1:s.slideOutType=he.Legato,s.slideTarget=t;break;case 2:break;case 3:s.isHammerPullOrigin=!0;break}if(s.dynamics=r.dynamics,this.data.skip(1),this._versionNumber<500)r.graceType=K.BeforeBeat;else{let a=this.data.readByte();s.isDead=(a&1)!==0,r.graceType=a&2?K.OnBeat:K.BeforeBeat}e.addGraceBeat(r),r.addNote(s)}readTremoloPicking(e){switch(this.data.readByte()){case 1:e.tremoloSpeed=B.Eighth;break;case 2:e.tremoloSpeed=B.Sixteenth;break;case 3:e.tremoloSpeed=B.ThirtySecond;break}}readSlide(e){if(this._versionNumber>=500){let t=E.readSInt8(this.data);t&1?e.slideOutType=he.Shift:t&2?e.slideOutType=he.Legato:t&4?e.slideOutType=he.OutDown:t&8&&(e.slideOutType=he.OutUp),t&16?e.slideInType=zt.IntoFromBelow:t&32&&(e.slideInType=zt.IntoFromAbove)}else switch(E.readSInt8(this.data)){case 1:e.slideOutType=he.Shift;break;case 2:e.slideOutType=he.Legato;break;case 3:e.slideOutType=he.OutDown;break;case 4:e.slideOutType=he.OutUp;break;case-1:e.slideInType=zt.IntoFromBelow;break;case-2:e.slideInType=zt.IntoFromAbove;break}}readArtificialHarmonic(e){let t=this.data.readByte();if(this._versionNumber>=500)switch(t){case 1:e.harmonicType=q.Natural,e.harmonicValue=this.deltaFretToHarmonicValue(e.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),e.harmonicType=q.Artificial;break;case 3:e.harmonicType=q.Tap,e.harmonicValue=this.deltaFretToHarmonicValue(this.data.readByte());break;case 4:e.harmonicType=q.Pinch,e.harmonicValue=12;break;case 5:e.harmonicType=q.Semi,e.harmonicValue=12;break}else if(this._versionNumber>=400)switch(t){case 1:e.harmonicType=q.Natural;break;case 3:e.harmonicType=q.Tap;break;case 4:e.harmonicType=q.Pinch;break;case 5:e.harmonicType=q.Semi;break;case 15:e.harmonicType=q.Artificial;break;case 17:e.harmonicType=q.Artificial;break;case 22:e.harmonicType=q.Artificial;break}}deltaFretToHarmonicValue(e){switch(e){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return e;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}readTrill(e){switch(e.trillValue=this.data.readByte()+e.stringTuning,this.data.readByte()){case 1:e.trillSpeed=B.Sixteenth;break;case 2:e.trillSpeed=B.ThirtySecond;break;case 3:e.trillSpeed=B.SixtyFourth;break}}}rs.VersionString="FICHIER GUITAR PRO ";rs.BendStep=25;class Ne{static gpReadDouble(e){let t=new Uint8Array(8);return e.read(t,0,t.length),new Float64Array(t.buffer)[0]}static gpReadFloat(e){let t=new Uint8Array(4);return t[3]=e.readByte(),t[2]=e.readByte(),t[2]=e.readByte(),t[1]=e.readByte(),new Float32Array(t.buffer)[0]}static gpReadColor(e,t=!1){let r=e.readByte(),s=e.readByte(),n=e.readByte(),a=255;return t?a=e.readByte():e.skip(1),new Oe(r,s,n,a)}static gpReadBool(e){return e.readByte()!==0}static gpReadStringIntUnused(e,t){return e.skip(4),Ne.gpReadString(e,e.readByte(),t)}static gpReadStringInt(e,t){return Ne.gpReadString(e,E.readInt32LE(e),t)}static gpReadStringIntByte(e,t){let r=E.readInt32LE(e)-1;return e.readByte(),Ne.gpReadString(e,r,t)}static gpReadString(e,t,r){let s=new Uint8Array(t);return e.read(s,0,s.length),E.toString(s,r)}static gpWriteString(e,t){const r=E.stringToBytes(t);e.writeByte(t.length),e.write(r,0,r.length)}static gpReadStringByteLength(e,t,r){let s=e.readByte(),n=Ne.gpReadString(e,s,r);return s<t&&e.skip(t-s),n}}class Q3{constructor(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1}}class Ti{constructor(){this.x=0,this.y=0,this.w=0,this.h=0}}var Rr;(function(i){i[i.Boolean=0]="Boolean",i[i.Integer=1]="Integer",i[i.Float=2]="Float",i[i.String=3]="String",i[i.Point=4]="Point",i[i.Size=5]="Size",i[i.Rectangle=6]="Rectangle",i[i.Color=7]="Color"})(Rr||(Rr={}));class ed{constructor(e){this.raw=new Map;let t=Gt.fromBuffer(e),r=E.readInt32BE(t);for(let s=0;s<r;s++){let n=Ne.gpReadString(t,t.readByte(),"utf-8");switch(t.readByte()){case Rr.Boolean:let o=t.readByte()===1;this.addValue(n,o);break;case Rr.Integer:let l=E.readInt32BE(t);this.addValue(n,l);break;case Rr.Float:let h=Ne.gpReadFloat(t);this.addValue(n,h);break;case Rr.String:let u=Ne.gpReadString(t,E.readInt16BE(t),"utf-8");this.addValue(n,u);break;case Rr.Point:let c=E.readInt32BE(t),d=E.readInt32BE(t);this.addValue(n,new V(c,d));break;case Rr.Size:let p=E.readInt32BE(t),f=E.readInt32BE(t);this.addValue(n,new V(p,f));break;case Rr.Rectangle:let m=new Ti;m.x=E.readInt32BE(t),m.y=E.readInt32BE(t),m.w=E.readInt32BE(t),m.h=E.readInt32BE(t),this.addValue(n,m);break;case Rr.Color:let S=Ne.gpReadColor(t,!0);this.addValue(n,S);break}}}apply(e){for(const[t,r]of this.raw)switch(t){case"StandardNotation/hideDynamics":e.stylesheet.hideDynamics=r;break}}addValue(e,t){this.raw.set(e,t)}static writeForScore(e){const t=Gt.withCapacity(128);return E.writeInt32BE(t,1),ed.writeBooleanEntry(t,"StandardNotation/hideDynamics",e.stylesheet.hideDynamics),t.toArray()}static writeBooleanEntry(e,t,r){Ne.gpWriteString(e,t),e.writeByte(Rr.Boolean),e.writeByte(r?1:0)}}var Yr;(function(i){i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long"})(Yr||(Yr={}));class Im{constructor(){this.type=Yr.Short,this.length=0}}var R;(function(i){i[i.None=0]="None",i[i.Element=1]="Element",i[i.Text=2]="Text",i[i.CDATA=3]="CDATA",i[i.Document=4]="Document",i[i.DocumentType=5]="DocumentType"})(R||(R={}));class Ar{constructor(){this.nodeType=R.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}addChild(e){this.childNodes.push(e),this.firstChild=e,(e.nodeType===R.Element||e.nodeType===R.CDATA)&&(this.firstElement=e)}getAttribute(e){return this.attributes.has(e)?this.attributes.get(e):""}getElementsByTagName(e,t=!1){let r=[];return this.searchElementsByTagName(this.childNodes,r,e,t),r}searchElementsByTagName(e,t,r,s=!1){for(let n of e)n&&n.nodeType===R.Element&&n.localName===r&&t.push(n),s&&this.searchElementsByTagName(n.childNodes,t,r,!0)}findChildElement(e){for(let t of this.childNodes)if(t&&t.nodeType===R.Element&&t.localName===e)return t;return null}addElement(e){const t=new Ar;return t.nodeType=R.Element,t.localName=e,this.addChild(t),t}get innerText(){var e;if(this.nodeType===R.Element||this.nodeType===R.Document){if(this.firstElement&&this.firstElement.nodeType===R.CDATA)return this.firstElement.innerText;let t="";for(let s of this.childNodes)t+=(e=s.innerText)==null?void 0:e.toString();return t.trim()}return this.value??""}set innerText(e){const t=new Ar;t.nodeType=R.Text,t.value=e,this.childNodes=[t]}setCData(e){const t=new Ar;t.nodeType=R.CDATA,t.value=e,this.childNodes=[t]}}class Ei extends Yt{constructor(e,t,r){super(Ut.Format,e),this.pos=0,this.xml=t,this.pos=r,Object.setPrototypeOf(this,Ei.prototype)}}var ie;(function(i){i[i.IgnoreSpaces=0]="IgnoreSpaces",i[i.Begin=1]="Begin",i[i.BeginNode=2]="BeginNode",i[i.TagName=3]="TagName",i[i.Body=4]="Body",i[i.AttribName=5]="AttribName",i[i.Equals=6]="Equals",i[i.AttvalBegin=7]="AttvalBegin",i[i.AttribVal=8]="AttribVal",i[i.Childs=9]="Childs",i[i.Close=10]="Close",i[i.WaitEnd=11]="WaitEnd",i[i.WaitEndRet=12]="WaitEndRet",i[i.Pcdata=13]="Pcdata",i[i.Header=14]="Header",i[i.Comment=15]="Comment",i[i.Doctype=16]="Doctype",i[i.Cdata=17]="Cdata",i[i.Escape=18]="Escape"})(ie||(ie={}));class ${static parse(e,t,r){let s=e.charCodeAt(t),n=ie.Begin,a=ie.Begin,o=0,l="",h=ie.Begin,u=null,c=null,d=0,p=0;for(;t<e.length;){switch(s=e.charCodeAt(t),n){case ie.IgnoreSpaces:switch(s){case $.CharCodeLF:case $.CharCodeCR:case $.CharCodeTab:case $.CharCodeSpace:break;default:n=a;continue}break;case ie.Begin:switch(s){case $.CharCodeLowerThan:n=ie.IgnoreSpaces,a=ie.BeginNode;break;default:o=t,n=ie.Pcdata;continue}break;case ie.Pcdata:if(s===$.CharCodeLowerThan){l+=e.substr(o,t-o);let f=new Ar;f.nodeType=R.Text,f.value=l,l="",r.addChild(f),n=ie.IgnoreSpaces,a=ie.BeginNode}else s===$.CharCodeAmp&&(l+=e.substr(o,t-o),n=ie.Escape,h=ie.Pcdata,o=t+1);break;case ie.Cdata:if(s===$.CharCodeBrackedClose&&e.charCodeAt(t+1)===$.CharCodeBrackedClose&&e.charCodeAt(t+2)===$.CharCodeGreaterThan){let f=new Ar;f.nodeType=R.CDATA,f.value=e.substr(o,t-o),r.addChild(f),t+=2,n=ie.Begin}break;case ie.BeginNode:switch(s){case $.CharCodeExclamation:if(e.charCodeAt(t+1)===$.CharCodeBrackedOpen){if(t+=2,e.substr(t,6).toUpperCase()!=="CDATA[")throw new Ei("Expected <![CDATA[",e,t);t+=5,n=ie.Cdata,o=t+1}else if(e.charCodeAt(t+1)===$.CharCodeUpperD||e.charCodeAt(t+1)===$.CharCodeLowerD){if(e.substr(t+2,6).toUpperCase()!=="OCTYPE")throw new Ei("Expected <!DOCTYPE",e,t);t+=8,n=ie.Doctype,o=t+1}else{if(e.charCodeAt(t+1)!==$.CharCodeMinus||e.charCodeAt(t+2)!==$.CharCodeMinus)throw new Ei("Expected <!--",e,t);t+=2,n=ie.Comment,o=t+1}break;case $.CharCodeQuestion:n=ie.Header,o=t;break;case $.CharCodeSlash:if(!r)throw new Ei("Expected node name",e,t);o=t+1,n=ie.IgnoreSpaces,a=ie.Close;break;default:n=ie.TagName,o=t;continue}break;case ie.TagName:if(!$.isValidChar(s)){if(t===o)throw new Ei("Expected node name",e,t);u=new Ar,u.nodeType=R.Element,u.localName=e.substr(o,t-o),r.addChild(u),n=ie.IgnoreSpaces,a=ie.Body;continue}break;case ie.Body:switch(s){case $.CharCodeSlash:n=ie.WaitEnd;break;case $.CharCodeGreaterThan:n=ie.Childs;break;default:n=ie.AttribName,o=t;continue}break;case ie.AttribName:if(!$.isValidChar(s)){if(o===t)throw new Ei("Expected attribute name",e,t);if(c=e.substr(o,t-o),u.attributes.has(c))throw new Ei(`Duplicate attribute [${c}]`,e,t);n=ie.IgnoreSpaces,a=ie.Equals;continue}break;case ie.Equals:switch(s){case $.CharCodeEquals:n=ie.IgnoreSpaces,a=ie.AttvalBegin;break;default:throw new Ei("Expected =",e,t)}break;case ie.AttvalBegin:switch(s){case $.CharCodeDoubleQuote:case $.CharCodeSingleQuote:l="",n=ie.AttribVal,o=t+1,p=s;break}break;case ie.AttribVal:switch(s){case $.CharCodeAmp:l+=e.substr(o,t-o),n=ie.Escape,h=ie.AttribVal,o=t+1;break;default:if(s===p){l+=e.substr(o,t-o);let f=l;l="",u.attributes.set(c,f),n=ie.IgnoreSpaces,a=ie.Body}break}break;case ie.Childs:t=$.parse(e,t,u),o=t,n=ie.Begin;break;case ie.WaitEnd:switch(s){case $.CharCodeGreaterThan:n=ie.Begin;break;default:throw new Ei("Expected >",e,t)}break;case ie.WaitEndRet:switch(s){case $.CharCodeGreaterThan:return t;default:throw new Ei("Expected >",e,t)}case ie.Close:if(!$.isValidChar(s)){if(o===t)throw new Ei("Expected node name",e,t);if(e.substr(o,t-o)!==r.localName)throw new Ei("Expected </"+r.localName+">",e,t);n=ie.IgnoreSpaces,a=ie.WaitEndRet;continue}break;case ie.Comment:s===$.CharCodeMinus&&e.charCodeAt(t+1)===$.CharCodeMinus&&e.charCodeAt(t+2)===$.CharCodeGreaterThan&&(t+=2,n=ie.Begin);break;case ie.Doctype:if(s===$.CharCodeBrackedOpen)d++;else if(s===$.CharCodeBrackedClose)d--;else if(s===$.CharCodeGreaterThan&&d===0){let f=new Ar;f.nodeType=R.DocumentType,f.value=e.substr(o,t-o),r.addChild(f),n=ie.Begin}break;case ie.Header:s===$.CharCodeQuestion&&e.charCodeAt(t+1)===$.CharCodeGreaterThan&&(t++,n=ie.Begin);break;case ie.Escape:if(s===$.CharCodeSemi){let f=e.substr(o,t-o);if(f.charCodeAt(0)===$.CharCodeSharp){let m=f.charCodeAt(1)===$.CharCodeLowerX?parseInt("0"+f.substr(1,f.length-1)):parseInt(f.substr(1,f.length-1));l+=String.fromCharCode(m)}else $.Escapes.has(f)?l+=$.Escapes.get(f):l+=("&"+f+";").toString();o=t+1,n=h}else!$.isValidChar(s)&&s!==$.CharCodeSharp&&(l+="&",l+=e.substr(o,t-o),t--,o=t+1,n=h);break}t++}if(n===ie.Begin&&(o=t,n=ie.Pcdata),n===ie.Pcdata){if(t!==o){l+=e.substr(o,t-o);let f=new Ar;f.nodeType=R.Text,f.value=l,r.addChild(f)}return t}if(n===ie.Escape&&h===ie.Pcdata){l+="&",l+=e.substr(o,t-o);let f=new Ar;return f.nodeType=R.Text,f.value=l,r.addChild(f),t}throw new Ei("Unexpected end",e,t)}static isValidChar(e){return e>=$.CharCodeLowerA&&e<=$.CharCodeLowerZ||e>=$.CharCodeUpperA&&e<=$.CharCodeUpperZ||e>=$.CharCode0&&e<=$.CharCode9||e===$.CharCodeColon||e===$.CharCodeDot||e===$.CharCodeUnderscore||e===$.CharCodeMinus}}$.CharCodeLF=10;$.CharCodeTab=9;$.CharCodeCR=13;$.CharCodeSpace=32;$.CharCodeLowerThan=60;$.CharCodeAmp=38;$.CharCodeBrackedClose=93;$.CharCodeBrackedOpen=91;$.CharCodeGreaterThan=62;$.CharCodeExclamation=33;$.CharCodeUpperD=68;$.CharCodeLowerD=100;$.CharCodeMinus=45;$.CharCodeQuestion=63;$.CharCodeSlash=47;$.CharCodeEquals=61;$.CharCodeDoubleQuote=34;$.CharCodeSingleQuote=39;$.CharCodeSharp=35;$.CharCodeLowerX=120;$.CharCodeLowerA=97;$.CharCodeLowerZ=122;$.CharCodeUpperA=65;$.CharCodeUpperZ=90;$.CharCode0=48;$.CharCode9=57;$.CharCodeColon=58;$.CharCodeDot=46;$.CharCodeUnderscore=95;$.CharCodeSemi=59;$.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);class Om{static write(e,t,r){const s=new Om(t,r);return s.writeNode(e),s.toString()}constructor(e,t){this._result=[],this._indention=e,this._xmlHeader=t,this._currentIndention="",this._isStartOfLine=!0}writeNode(e){switch(e.nodeType){case R.None:break;case R.Element:this._result.length>0&&this.writeLine(),this.write(`<${e.localName}`);for(const[t,r]of e.attributes)this.write(` ${t}="`),this.writeAttributeValue(r),this.write('"');if(e.childNodes.length===0)this.write("/>");else{if(this.write(">"),e.childNodes.length===1&&!e.firstElement)this.writeNode(e.childNodes[0]);else{this.indent();for(const t of e.childNodes)t.nodeType===R.Element&&this.writeNode(t);this.unindend(),this.writeLine()}this.write(`</${e.localName}>`)}break;case R.Text:e.value&&this.write(e.value);break;case R.CDATA:e.value!==null&&this.write(`<![CDATA[${e.value}]]>`);break;case R.Document:this._xmlHeader&&this.write('<?xml version="1.0" encoding="utf-8"?>');for(const t of e.childNodes)this.writeNode(t);break;case R.DocumentType:this.write(`<!DOCTYPE ${e.value}>`);break}}unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}indent(){this._currentIndention+=this._indention}writeAttributeValue(e){for(let t=0;t<e.length;t++){const r=e.charAt(t);switch(r){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(r);break}}}write(e){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(e),this._isStartOfLine=!1}writeLine(e=null){e&&this.write(e),this._indention.length>0&&!this._isStartOfLine&&(this._result.push(`
`),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class Xu extends Ar{constructor(){super(),this.nodeType=R.Document}parse(e){$.parse(e,0,this)}toString(){return this.toFormattedString()}toFormattedString(e="",t=!1){return Om.write(this,e,t)}}var D;(function(i){i[i.Up=0]="Up",i[i.Down=1]="Down"})(D||(D={}));class K3{constructor(){this.id="",this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=B.Quarter}}class J3{constructor(){this.name="",this.path="",this.role="",this.program=0}get uniqueId(){return this.path+";"+this.name+";"+this.role}}class _r{constructor(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1}parseXml(e,t){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;let r=new Xu;try{r.parse(e)}catch(s){throw new tt("Could not parse XML",s)}if(this.parseDom(r),this.buildModel(),this.score.finish(t),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[s,n]of this._lyricsByTrack)this._tracksById.get(s).applyLyrics(n)}parseDom(e){let t=e.firstElement;if(t)if(t.localName==="GPIF"){this.score=new ha;for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Score":this.parseScoreNode(r);break;case"MasterTrack":this.parseMasterTrackNode(r);break;case"Tracks":this.parseTracksNode(r);break;case"MasterBars":this.parseMasterBarsNode(r);break;case"Bars":this.parseBars(r);break;case"Voices":this.parseVoices(r);break;case"Beats":this.parseBeats(r);break;case"Notes":this.parseNotes(r);break;case"Rhythms":this.parseRhythms(r);break}}else throw new tt("Root node of XML was not GPIF")}parseScoreNode(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Title":this.score.title=t.firstChild.innerText;break;case"SubTitle":this.score.subTitle=t.firstChild.innerText;break;case"Artist":this.score.artist=t.firstChild.innerText;break;case"Album":this.score.album=t.firstChild.innerText;break;case"Words":this.score.words=t.firstChild.innerText;break;case"Music":this.score.music=t.firstChild.innerText;break;case"WordsAndMusic":if(t.firstChild&&t.firstChild.innerText!==""){let r=t.firstChild.innerText;r&&!this.score.words&&(this.score.words=r),r&&!this.score.music&&(this.score.music=r)}break;case"Copyright":this.score.copyright=t.firstChild.innerText;break;case"Tabber":this.score.tab=t.firstChild.innerText;break;case"Instructions":this.score.instructions=t.firstChild.innerText;break;case"Notices":this.score.notices=t.firstChild.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=parseInt(t.innerText);break;case"ScoreSystemsLayout":this.score.systemsLayout=t.innerText.split(" ").map(r=>parseInt(r));break}}parseMasterTrackNode(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Automations":this.parseAutomations(t,this._masterTrackAutomations,null);break;case"Tracks":this._tracksMapping=t.innerText.split(" ");break;case"Anacrusis":this._hasAnacrusis=!0;break}}parseAutomations(e,t,r){for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Automation":this.parseAutomation(s,t,r);break}}parseAutomation(e,t,r){let s=null,n=!1,a=-1,o=0,l=0,h=null,u=0,c=null;for(let p of e.childNodes)if(p.nodeType===R.Element)switch(p.localName){case"Type":s=p.innerText;break;case"Linear":n=p.innerText.toLowerCase()==="true";break;case"Bar":a=parseInt(p.innerText);break;case"Position":o=parseFloat(p.innerText);break;case"Value":if(p.firstElement&&p.firstElement.nodeType===R.CDATA)h=p.innerText;else{let f=p.innerText.split(" ");f.length===1?(l=parseFloat(f[0]),u=1):(l=parseFloat(f[0]),u=parseInt(f[1]))}break;case"Text":c=p.innerText;break}if(!s)return;let d=null;switch(s){case"Tempo":d=ii.buildTempoAutomation(n,o,l,u);break;case"Sound":h&&r&&r.has(h)&&(d=ii.buildInstrumentAutomation(n,o,r.get(h).program));break}d&&(c&&(d.text=c),a>=0&&(t.has(a)||t.set(a,[]),t.get(a).push(d)))}parseTracksNode(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Track":this.parseTrack(t);break}}parseTrack(e){this._articulationByName=new Map;let t=new ds;t.ensureStaveCount(1);let r=t.staves[0];r.showStandardNotation=!0;let s=e.getAttribute("id");for(let n of e.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"Name":t.name=n.innerText;break;case"Color":let a=n.innerText.split(" ");if(a.length>=3){let h=parseInt(a[0]),u=parseInt(a[1]),c=parseInt(a[2]);t.color=new Oe(h,u,c,255)}break;case"Instrument":let o=n.getAttribute("ref");(o.endsWith("-gs")||o.endsWith("GrandStaff"))&&(t.ensureStaveCount(2),t.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(t,n);break;case"NotationPatch":this.parseNotationPatch(t,n);break;case"ShortName":t.shortName=n.innerText;break;case"SystemsDefautLayout":t.defaultSystemsLayout=parseInt(n.innerText);break;case"SystemsLayout":t.systemsLayout=n.innerText.split(" ").map(h=>parseInt(h));break;case"Lyrics":this.parseLyrics(s,n);break;case"Properties":this.parseTrackProperties(t,n);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(t,n);break;case"Sounds":this.parseSounds(s,t,n);break;case"PlaybackState":let l=n.innerText;t.playbackInfo.isSolo=l==="Solo",t.playbackInfo.isMute=l==="Mute";break;case"PartSounding":this.parsePartSounding(t,n);break;case"Staves":this.parseStaves(t,n);break;case"Transpose":this.parseTranspose(t,n);break;case"RSE":this.parseRSE(t,n);break;case"Automations":this.parseTrackAutomations(s,n);break}this._tracksById.set(s,t)}parseTrackAutomations(e,t){const r=new Map;this._automationsPerTrackIdAndBarIndex.set(e,r),this.parseAutomations(t,r,this._soundsByTrack.get(e))}parseNotationPatch(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"LineCount":const s=parseInt(r.innerText);for(let n of e.staves)n.standardNotationLineCount=s;break;case"Elements":this.parseElements(e,r);break}}parseInstrumentSet(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Type":switch(r.innerText){case"drumKit":for(let n of e.staves)n.isPercussion=!0;break}if(r.innerText==="drumKit")for(let n of e.staves)n.isPercussion=!0;break;case"Elements":this.parseElements(e,r);break;case"LineCount":const s=parseInt(r.innerText);for(let n of e.staves)n.standardNotationLineCount=s;break}}parseElements(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Element":this.parseElement(e,r);break}}parseElement(e,t){const r=t.findChildElement("Type"),s=r?r.innerText:"";for(let n of t.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"Name":case"Articulations":this.parseArticulations(e,n,s);break}}parseArticulations(e,t,r){for(let s of t.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Articulation":this.parseArticulation(e,s,r);break}}parseArticulation(e,t,r){const s=new z;s.outputMidiNumber=-1,s.elementType=r;let n="";for(let a of t.childNodes)if(a.nodeType===R.Element){const o=a.innerText;switch(a.localName){case"Name":n=a.innerText;break;case"OutputMidiNumber":o.length>0&&(s.outputMidiNumber=parseInt(o));break;case"TechniqueSymbol":s.techniqueSymbol=this.parseTechniqueSymbol(o);break;case"TechniquePlacement":switch(o){case"outside":s.techniqueSymbolPlacement=le.Bottom;break;case"inside":s.techniqueSymbolPlacement=le.Middle;break;case"above":s.techniqueSymbolPlacement=le.Bottom;break;case"below":s.techniqueSymbolPlacement=le.Top;break}break;case"Noteheads":const l=o.split(" ");l.length>=1&&(s.noteHeadDefault=this.parseNoteHead(l[0])),l.length>=2&&(s.noteHeadHalf=this.parseNoteHead(l[1])),l.length>=3&&(s.noteHeadWhole=this.parseNoteHead(l[2])),s.noteHeadHalf==g.None&&(s.noteHeadHalf=s.noteHeadDefault),s.noteHeadWhole==g.None&&(s.noteHeadWhole=s.noteHeadDefault);break;case"StaffLine":o.length>0&&(s.staffLine=parseInt(o));break}}s.outputMidiNumber!==-1?(e.percussionArticulations.push(s),n.length>0&&this._articulationByName.set(n,s)):n.length>0&&this._articulationByName.has(n)&&(this._articulationByName.get(n).staffLine=s.staffLine)}parseTechniqueSymbol(e){switch(e){case"pictEdgeOfCymbal":return g.PictEdgeOfCymbal;case"articStaccatoAbove":return g.ArticStaccatoAbove;case"noteheadParenthesis":return g.NoteheadParenthesis;case"stringsUpBow":return g.StringsUpBow;case"stringsDownBow":return g.StringsDownBow;case"guitarGolpe":return g.GuitarGolpe;default:return g.None}}parseNoteHead(e){switch(e){case"noteheadDoubleWholeSquare":return g.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return g.NoteheadDoubleWhole;case"noteheadWhole":return g.NoteheadWhole;case"noteheadHalf":return g.NoteheadHalf;case"noteheadBlack":return g.NoteheadBlack;case"noteheadNull":return g.NoteheadNull;case"noteheadXOrnate":return g.NoteheadXOrnate;case"noteheadTriangleUpWhole":return g.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return g.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return g.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return g.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return g.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return g.NoteheadDiamondWhiteWide;case"noteheadCircleX":return g.NoteheadCircleX;case"noteheadXWhole":return g.NoteheadXWhole;case"noteheadXHalf":return g.NoteheadXHalf;case"noteheadXBlack":return g.NoteheadXBlack;case"noteheadParenthesis":return g.NoteheadParenthesis;case"noteheadSlashedBlack2":return g.NoteheadSlashedBlack2;case"noteheadCircleSlash":return g.NoteheadCircleSlash;case"noteheadHeavyX":return g.NoteheadHeavyX;case"noteheadHeavyXHat":return g.NoteheadHeavyXHat;default:return L.warning("GPIF","Unknown notehead symbol",e),g.None}}parseStaves(e,t){let r=0;for(let s of t.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Staff":e.ensureStaveCount(r+1);let n=e.staves[r];this.parseStaff(n,s),r++;break}}parseStaff(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Properties":this.parseStaffProperties(e,r);break}}parseStaffProperties(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Property":this.parseStaffProperty(e,r);break}}parseStaffProperty(e,t){switch(t.getAttribute("name")){case"Tuning":for(let n of t.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"Pitches":let a=t.findChildElement("Pitches").innerText.split(" "),o=new Array(a.length);for(let l=0;l<o.length;l++)o[o.length-1-l]=parseInt(a[l]);e.stringTuning.tunings=o;break;case"Label":e.stringTuning.name=n.innerText;break}e.isPercussion||(e.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForStaff(e,t);break;case"CapoFret":let s=parseInt(t.findChildElement("Fret").innerText);e.capo=s;break}}parseLyrics(e,t){let r=[];for(let s of t.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Line":r.push(this.parseLyricsLine(s));break}this._lyricsByTrack.set(e,r)}parseLyricsLine(e){let t=new Ct;for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Offset":t.startBar=parseInt(r.innerText);break;case"Text":t.text=r.innerText;break}return t}parseDiagramCollectionForTrack(e,t){let r=t.findChildElement("Items");for(let s of r.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Item":this.parseDiagramItemForTrack(e,s);break}}parseDiagramCollectionForStaff(e,t){let r=t.findChildElement("Items");for(let s of r.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Item":this.parseDiagramItemForStaff(e,s);break}}parseDiagramItemForTrack(e,t){let r=new Sn,s=t.getAttribute("id");for(let n of e.staves)n.addChord(s,r);this.parseDiagramItemForChord(r,t)}parseDiagramItemForStaff(e,t){let r=new Sn,s=t.getAttribute("id");e.addChord(s,r),this.parseDiagramItemForChord(r,t)}parseDiagramItemForChord(e,t){e.name=t.getAttribute("name");let r=t.findChildElement("Diagram");if(!r){e.showDiagram=!1,e.showFingering=!1;return}let s=parseInt(r.getAttribute("stringCount")),n=parseInt(r.getAttribute("baseFret"));e.firstFret=n+1;for(let a=0;a<s;a++)e.strings.push(-1);for(let a of r.childNodes)if(a.nodeType===R.Element)switch(a.localName){case"Fret":let o=parseInt(a.getAttribute("string"));e.strings[s-o-1]=n+parseInt(a.getAttribute("fret"));break;case"Fingering":let l=new Map;for(let h of a.childNodes)if(h.nodeType===R.Element)switch(h.localName){case"Position":let u=ne.Unknown,c=n+parseInt(h.getAttribute("fret"));switch(h.getAttribute("finger")){case"Index":u=ne.IndexFinger;break;case"Middle":u=ne.MiddleFinger;break;case"Rank":u=ne.AnnularFinger;break;case"Pinky":u=ne.LittleFinger;break;case"Thumb":u=ne.Thumb;break}u!==ne.Unknown&&(l.has(u)?e.barreFrets.push(c):l.set(u,!0));break}break;case"Property":switch(a.getAttribute("name")){case"ShowName":e.showName=a.getAttribute("value")==="true";break;case"ShowDiagram":e.showDiagram=a.getAttribute("value")==="true";break;case"ShowFingering":e.showFingering=a.getAttribute("value")==="true";break}break}}parseTrackProperties(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Property":this.parseTrackProperty(e,r);break}}parseTrackProperty(e,t){switch(t.getAttribute("name")){case"Tuning":let s=t.findChildElement("Pitches").innerText.split(" "),n=new Array(s.length);for(let o=0;o<n.length;o++)n[n.length-1-o]=parseInt(s[o]);for(let o of e.staves)o.stringTuning.tunings=n,o.showStandardNotation=!0,o.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForTrack(e,t);break;case"CapoFret":let a=parseInt(t.findChildElement("Fret").innerText);for(let o of e.staves)o.capo=a;break}}parseGeneralMidi(e,t){for(let s of t.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Program":e.playbackInfo.program=parseInt(s.innerText);break;case"Port":e.playbackInfo.port=parseInt(s.innerText);break;case"PrimaryChannel":e.playbackInfo.primaryChannel=parseInt(s.innerText);break;case"SecondaryChannel":e.playbackInfo.secondaryChannel=parseInt(s.innerText);break}if(t.getAttribute("table")==="Percussion")for(let s of e.staves)s.isPercussion=!0}parseSounds(e,t,r){for(let s of r.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Sound":this.parseSound(e,t,s);break}}parseSound(e,t,r){const s=new J3;for(let n of r.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"Name":s.name=n.innerText;break;case"Path":s.path=n.innerText;break;case"Role":s.role=n.innerText;break;case"MIDI":this.parseSoundMidi(s,n);break}(s.role==="Factory"||t.playbackInfo.program===0)&&(t.playbackInfo.program=s.program),this._soundsByTrack.has(e)||this._soundsByTrack.set(e,new Map),this._soundsByTrack.get(e).set(s.uniqueId,s)}parseSoundMidi(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Program":e.program=parseInt(r.innerText);break}}parsePartSounding(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"TranspositionPitch":for(let s of e.staves)s.displayTranspositionPitch=parseInt(r.innerText);break}}parseTranspose(e,t){let r=0,s=0;for(let n of t.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"Chromatic":s=parseInt(n.innerText);break;case"Octave":r=parseInt(n.innerText);break}for(let n of e.staves)n.displayTranspositionPitch=r*12+s}parseRSE(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"ChannelStrip":this.parseChannelStrip(e,r);break}}parseChannelStrip(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Parameters":this.parseChannelStripParameters(e,r);break}}parseChannelStripParameters(e,t){if(t.firstChild&&t.firstChild.value){let r=t.firstChild.value.split(" ");r.length>=12&&(e.playbackInfo.balance=Math.floor(parseFloat(r[11])*16),e.playbackInfo.volume=Math.floor(parseFloat(r[12])*16))}}parseMasterBarsNode(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"MasterBar":this.parseMasterBar(t);break}}parseMasterBar(e){let t=new Vs;this._masterBars.length===0&&this._hasAnacrusis&&(t.isAnacrusis=!0);for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Time":let s=r.innerText.split("/");t.timeSignatureNumerator=parseInt(s[0]),t.timeSignatureDenominator=parseInt(s[1]);break;case"DoubleBar":t.isDoubleBar=!0;break;case"Section":t.section=new Zc,t.section.marker=r.findChildElement("Letter").innerText,t.section.text=r.findChildElement("Text").innerText;break;case"Repeat":r.getAttribute("start").toLowerCase()==="true"&&(t.isRepeatStart=!0),r.getAttribute("end").toLowerCase()==="true"&&r.getAttribute("count")&&(t.repeatCount=parseInt(r.getAttribute("count")));break;case"AlternateEndings":let n=r.innerText.split(" "),a=0;for(let l=0;l<n.length;l++)a=a|1<<-1+parseInt(n[l]);t.alternateEndings=a;break;case"Bars":this._barsOfMasterBar.push(r.innerText.split(" "));break;case"TripletFeel":switch(r.innerText){case"NoTripletFeel":t.tripletFeel=fe.NoTripletFeel;break;case"Triplet8th":t.tripletFeel=fe.Triplet8th;break;case"Triplet16th":t.tripletFeel=fe.Triplet16th;break;case"Dotted8th":t.tripletFeel=fe.Dotted8th;break;case"Dotted16th":t.tripletFeel=fe.Dotted16th;break;case"Scottish8th":t.tripletFeel=fe.Scottish8th;break;case"Scottish16th":t.tripletFeel=fe.Scottish16th;break}break;case"Key":t.keySignature=parseInt(r.findChildElement("AccidentalCount").innerText);let o=r.findChildElement("Mode");if(o)switch(o.innerText.toLowerCase()){case"major":t.keySignatureType=vn.Major;break;case"minor":t.keySignatureType=vn.Minor;break}break;case"Fermatas":this.parseFermatas(t,r);break;case"XProperties":this.parseMasterBarXProperties(r,t);break}this._masterBars.push(t)}parseFermatas(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Fermata":this.parseFermata(e,r);break}}parseFermata(e,t){let r=0,s=new Im;for(let n of t.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"Type":switch(n.innerText){case"Short":s.type=Yr.Short;break;case"Medium":s.type=Yr.Medium;break;case"Long":s.type=Yr.Long;break}break;case"Length":s.length=parseFloat(n.innerText);break;case"Offset":let a=n.innerText.split("/");if(a.length===2){let o=parseInt(a[0]),l=parseInt(a[1]);r=o/l*oe.QuarterTime|0}break}e.addFermata(r,s)}parseBars(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Bar":this.parseBar(t);break}}parseBar(e){let t=new Gs,r=e.getAttribute("id");for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Voices":this._voicesOfBar.set(r,s.innerText.split(" "));break;case"Clef":switch(s.innerText){case"Neutral":t.clef=ae.Neutral;break;case"G2":t.clef=ae.G2;break;case"F4":t.clef=ae.F4;break;case"C4":t.clef=ae.C4;break;case"C3":t.clef=ae.C3;break}break;case"Ottavia":switch(s.innerText){case"8va":t.clefOttava=Le._8va;break;case"15ma":t.clefOttava=Le._15ma;break;case"8vb":t.clefOttava=Le._8vb;break;case"15mb":t.clefOttava=Le._15mb;break}break;case"SimileMark":switch(s.innerText){case"Simple":t.simileMark=fr.Simple;break;case"FirstOfDouble":t.simileMark=fr.FirstOfDouble;break;case"SecondOfDouble":t.simileMark=fr.SecondOfDouble;break}break;case"XProperties":this.parseBarXProperties(s,t);break}this._barsById.set(r,t)}parseVoices(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Voice":this.parseVoice(t);break}}parseVoice(e){let t=new fs,r=e.getAttribute("id");for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Beats":this._beatsOfVoice.set(r,s.innerText.split(" "));break}this._voiceById.set(r,t)}parseBeats(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Beat":this.parseBeat(t);break}}parseBeat(e){let t=new si,r=e.getAttribute("id");for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Notes":this._notesOfBeat.set(r,s.innerText.split(" "));break;case"Rhythm":this._rhythmOfBeat.set(r,s.getAttribute("ref"));break;case"Fadding":s.innerText==="FadeIn"&&(t.fadeIn=!0);break;case"Tremolo":switch(s.innerText){case"1/2":t.tremoloSpeed=B.Eighth;break;case"1/4":t.tremoloSpeed=B.Sixteenth;break;case"1/8":t.tremoloSpeed=B.ThirtySecond;break}break;case"Chord":t.chordId=s.innerText;break;case"Hairpin":switch(s.innerText){case"Crescendo":t.crescendo=Ii.Crescendo;break;case"Decrescendo":t.crescendo=Ii.Decrescendo;break}break;case"Arpeggio":s.innerText==="Up"?t.brushType=Ye.ArpeggioUp:t.brushType=Ye.ArpeggioDown;break;case"Properties":this.parseBeatProperties(s,t);break;case"XProperties":this.parseBeatXProperties(s,t);break;case"FreeText":t.text=s.innerText;break;case"TransposedPitchStemOrientation":switch(s.innerText){case"Upward":t.preferredBeamDirection=D.Up;break;case"Downward":t.preferredBeamDirection=D.Down;break}break;case"Dynamic":switch(s.innerText){case"PPP":t.dynamics=pe.PPP;break;case"PP":t.dynamics=pe.PP;break;case"P":t.dynamics=pe.P;break;case"MP":t.dynamics=pe.MP;break;case"MF":t.dynamics=pe.MF;break;case"F":t.dynamics=pe.F;break;case"FF":t.dynamics=pe.FF;break;case"FFF":t.dynamics=pe.FFF;break}break;case"GraceNotes":switch(s.innerText){case"OnBeat":t.graceType=K.OnBeat;break;case"BeforeBeat":t.graceType=K.BeforeBeat;break}break;case"Legato":s.getAttribute("origin")==="true"&&(t.isLegatoOrigin=!0);break;case"Whammy":let n=new V(0,0);n.value=this.toBendValue(parseFloat(s.getAttribute("originValue"))),n.offset=this.toBendOffset(parseFloat(s.getAttribute("originOffset"))),t.addWhammyBarPoint(n);let a=new V(0,0);a.value=this.toBendValue(parseFloat(s.getAttribute("middleValue"))),a.offset=this.toBendOffset(parseFloat(s.getAttribute("middleOffset1"))),t.addWhammyBarPoint(a);let o=new V(0,0);o.value=this.toBendValue(parseFloat(s.getAttribute("middleValue"))),o.offset=this.toBendOffset(parseFloat(s.getAttribute("middleOffset2"))),t.addWhammyBarPoint(o);let l=new V(0,0);l.value=this.toBendValue(parseFloat(s.getAttribute("destinationValue"))),l.offset=this.toBendOffset(parseFloat(s.getAttribute("destinationOffset"))),t.addWhammyBarPoint(l);break;case"Ottavia":switch(s.innerText){case"8va":t.ottava=Le._8va;break;case"8vb":t.ottava=Le._8vb;break;case"15ma":t.ottava=Le._15ma;break;case"15mb":t.ottava=Le._15mb;break}break;case"Lyrics":t.lyrics=this.parseBeatLyrics(s),this._skipApplyLyrics=!0;break}this._beatById.set(r,t)}parseBeatLyrics(e){const t=[];for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"Line":t.push(r.innerText);break}return t}parseBeatXProperties(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"XProperty":let s=r.getAttribute("id"),n=0;switch(s){case"1124204545":n=parseInt(r.findChildElement("Int").innerText),t.invertBeamDirection=n===1;break;case"687935489":n=parseInt(r.findChildElement("Int").innerText),t.brushDuration=n;break}break}}parseBarXProperties(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"XProperty":switch(r.getAttribute("id")){case"1124139520":const n=r.findChildElement("Double")??r.findChildElement("Float");t.displayScale=parseFloat(n.innerText);break}break}}parseMasterBarXProperties(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"XProperty":switch(r.getAttribute("id")){case"1124073984":t.displayScale=parseFloat(r.findChildElement("Double").innerText);break}break}}parseBeatProperties(e,t){let r=!1,s=null,n=null,a=null,o=null,l=null;for(let h of e.childNodes)if(h.nodeType===R.Element)switch(h.localName){case"Property":switch(h.getAttribute("name")){case"Brush":h.findChildElement("Direction").innerText==="Up"?t.brushType=Ye.BrushUp:t.brushType=Ye.BrushDown;break;case"PickStroke":h.findChildElement("Direction").innerText==="Up"?t.pickStroke=Jt.Up:t.pickStroke=Jt.Down;break;case"Slapped":h.findChildElement("Enable")&&(t.slap=!0);break;case"Popped":h.findChildElement("Enable")&&(t.pop=!0);break;case"VibratoWTremBar":switch(h.findChildElement("Strength").innerText){case"Wide":t.vibrato=Pe.Wide;break;case"Slight":t.vibrato=Pe.Slight;break}break;case"WhammyBar":r=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":s||(s=new V(0,0)),s.value=this.toBendValue(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarOriginOffset":s||(s=new V(0,0)),s.offset=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarMiddleValue":n=this.toBendValue(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset1":a=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset2":o=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarDestinationValue":l||(l=new V(V.MaxPosition,0)),l.value=this.toBendValue(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarDestinationOffset":l||(l=new V(0,0)),l.offset=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break}break}r&&(s||(s=new V(0,0)),l||(l=new V(V.MaxPosition,0)),t.addWhammyBarPoint(s),a&&n&&t.addWhammyBarPoint(new V(a,n)),o&&n&&t.addWhammyBarPoint(new V(o,n)),!a&&!o&&n&&t.addWhammyBarPoint(new V(V.MaxPosition/2|0,n)),t.addWhammyBarPoint(l))}parseNotes(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Note":this.parseNote(t);break}}parseNote(e){let t=new ct,r=e.getAttribute("id");for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Properties":this.parseNoteProperties(s,t,r);break;case"AntiAccent":s.innerText.toLowerCase()==="normal"&&(t.isGhost=!0);break;case"LetRing":t.isLetRing=!0;break;case"Trill":t.trillValue=parseInt(s.innerText),t.trillSpeed=B.Sixteenth;break;case"Accent":let n=parseInt(s.innerText);n&1&&(t.isStaccato=!0),n&4&&(t.accentuated=Et.Heavy),n&8&&(t.accentuated=Et.Normal);break;case"Tie":s.getAttribute("destination").toLowerCase()==="true"&&(t.isTieDestination=!0);break;case"Vibrato":switch(s.innerText){case"Slight":t.vibrato=Pe.Slight;break;case"Wide":t.vibrato=Pe.Wide;break}break;case"LeftFingering":switch(t.isFingering=!0,s.innerText){case"P":t.leftHandFinger=ne.Thumb;break;case"I":t.leftHandFinger=ne.IndexFinger;break;case"M":t.leftHandFinger=ne.MiddleFinger;break;case"A":t.leftHandFinger=ne.AnnularFinger;break;case"C":t.leftHandFinger=ne.LittleFinger;break}break;case"RightFingering":switch(t.isFingering=!0,s.innerText){case"P":t.rightHandFinger=ne.Thumb;break;case"I":t.rightHandFinger=ne.IndexFinger;break;case"M":t.rightHandFinger=ne.MiddleFinger;break;case"A":t.rightHandFinger=ne.AnnularFinger;break;case"C":t.rightHandFinger=ne.LittleFinger;break}break;case"InstrumentArticulation":t.percussionArticulation=parseInt(s.innerText);break}this._noteById.set(r,t)}parseNoteProperties(e,t,r){let s=!1,n=null,a=null,o=null,l=null,h=null,u=-1,c=-1;for(let d of e.childNodes)if(d.nodeType===R.Element)switch(d.localName){case"Property":switch(d.getAttribute("name")){case"String":t.string=parseInt(d.findChildElement("String").innerText)+1;break;case"Fret":t.fret=parseInt(d.findChildElement("Fret").innerText);break;case"Element":u=parseInt(d.findChildElement("Element").innerText);break;case"Variation":c=parseInt(d.findChildElement("Variation").innerText);break;case"Tapped":this._tappedNotes.set(r,!0);break;case"HarmonicType":let f=d.findChildElement("HType");if(f)switch(f.innerText){case"NoHarmonic":t.harmonicType=q.None;break;case"Natural":t.harmonicType=q.Natural;break;case"Artificial":t.harmonicType=q.Artificial;break;case"Pinch":t.harmonicType=q.Pinch;break;case"Tap":t.harmonicType=q.Tap;break;case"Semi":t.harmonicType=q.Semi;break;case"Feedback":t.harmonicType=q.Feedback;break}break;case"HarmonicFret":let m=d.findChildElement("HFret");m&&(t.harmonicValue=parseFloat(m.innerText));break;case"Muted":d.findChildElement("Enable")&&(t.isDead=!0);break;case"PalmMuted":d.findChildElement("Enable")&&(t.isPalmMute=!0);break;case"Octave":t.octave=parseInt(d.findChildElement("Number").innerText),t.tone===-1&&(t.tone=0);break;case"Tone":t.tone=parseInt(d.findChildElement("Step").innerText);break;case"ConcertPitch":this.parseConcertPitch(d,t);break;case"Bended":s=!0;break;case"BendOriginValue":n||(n=new V(0,0)),n.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendOriginOffset":n||(n=new V(0,0)),n.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleValue":a=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset1":o=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset2":l=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationValue":h||(h=new V(V.MaxPosition,0)),h.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationOffset":h||(h=new V(0,0)),h.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"HopoOrigin":d.findChildElement("Enable")&&(t.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":t.isLeftHandTapped=!0;break;case"Slide":let S=parseInt(d.findChildElement("Flags").innerText);S&1?t.slideOutType=he.Shift:S&2?t.slideOutType=he.Legato:S&4?t.slideOutType=he.OutDown:S&8&&(t.slideOutType=he.OutUp),S&16?t.slideInType=zt.IntoFromBelow:S&32&&(t.slideInType=zt.IntoFromAbove),S&64?t.slideOutType=he.PickSlideDown:S&128&&(t.slideOutType=he.PickSlideUp);break}break}s&&(n||(n=new V(0,0)),h||(h=new V(V.MaxPosition,0)),t.addBendPoint(n),o&&a&&t.addBendPoint(new V(o,a)),l&&a&&t.addBendPoint(new V(l,a)),!o&&!l&&a&&t.addBendPoint(new V(V.MaxPosition/2|0,a)),t.addBendPoint(h)),u!==-1&&c!==-1&&(t.percussionArticulation=xt.articulationFromElementVariation(u,c))}parseConcertPitch(e,t){const r=e.findChildElement("Pitch");if(r){for(let s of r.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"Accidental":switch(s.innerText){case"x":t.accidentalMode=kt.ForceDoubleSharp;break;case"#":t.accidentalMode=kt.ForceSharp;break;case"b":t.accidentalMode=kt.ForceFlat;break;case"bb":t.accidentalMode=kt.ForceDoubleFlat;break}break}}}toBendValue(e){return e*_r.BendPointValueFactor|0}toBendOffset(e){return e*_r.BendPointPositionFactor}parseRhythms(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"Rhythm":this.parseRhythm(t);break}}parseRhythm(e){let t=new K3,r=e.getAttribute("id");t.id=r;for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"NoteValue":switch(s.innerText){case"Long":t.value=B.QuadrupleWhole;break;case"DoubleWhole":t.value=B.DoubleWhole;break;case"Whole":t.value=B.Whole;break;case"Half":t.value=B.Half;break;case"Quarter":t.value=B.Quarter;break;case"Eighth":t.value=B.Eighth;break;case"16th":t.value=B.Sixteenth;break;case"32nd":t.value=B.ThirtySecond;break;case"64th":t.value=B.SixtyFourth;break;case"128th":t.value=B.OneHundredTwentyEighth;break;case"256th":t.value=B.TwoHundredFiftySixth;break}break;case"PrimaryTuplet":t.tupletNumerator=parseInt(s.getAttribute("num")),t.tupletDenominator=parseInt(s.getAttribute("den"));break;case"AugmentationDot":t.dots=parseInt(s.getAttribute("count"));break}this._rhythmById.set(r,t)}buildModel(){for(let e=0,t=this._masterBars.length;e<t;e++){let r=this._masterBars[e];this.score.addMasterBar(r)}for(let e of this._tracksMapping){if(!e)continue;let t=this._tracksById.get(e);this.score.addTrack(t)}for(let e of this._barsOfMasterBar){let t=0;for(let r=0,s=0;r<e.length&&s<this.score.tracks.length;r++){let n=e[r];if(n!==_r.InvalidId){let a=this._barsById.get(n),o=this.score.tracks[s],l=o.staves[t];if(l.addBar(a),this._voicesOfBar.has(n))for(let h of this._voicesOfBar.get(n))if(h!==_r.InvalidId){let u=this._voiceById.get(h);if(a.addVoice(u),this._beatsOfVoice.has(h)){for(let c of this._beatsOfVoice.get(h))if(c!==_r.InvalidId){let d=Fm.clone(this._beatById.get(c));u.addBeat(d);let p=this._rhythmOfBeat.get(c),f=this._rhythmById.get(p);if(d.duration=f.value,d.dots=f.dots,d.tupletNumerator=f.tupletNumerator,d.tupletDenominator=f.tupletDenominator,this._notesOfBeat.has(c)){for(let m of this._notesOfBeat.get(c))if(m!==_r.InvalidId){const S=gx.clone(this._noteById.get(m));l.isPercussion?(S.fret=-1,S.string=-1):S.percussionArticulation=-1,d.addNote(S),this._tappedNotes.has(m)&&(d.tap=!0)}}}}}else{let u=new fs;a.addVoice(u);let c=new si;c.isEmpty=!0,c.duration=B.Quarter,u.addBeat(c)}t===o.staves.length-1?(s++,t=0):t++}else s++}}for(let e of this._tracksMapping){if(!e)continue;let t=this._tracksById.get(e),r=!1;for(const s of t.staves)if(s.isPercussion){r=!0;break}if(r||(t.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(e)){const s=this._automationsPerTrackIdAndBarIndex.get(e);for(const[n,a]of s)if(t.staves.length>0&&n<t.staves[0].bars.length){const o=t.staves[0].bars[n];if(o.voices.length>0&&o.voices[0].beats.length>0){const l=o.voices[0].beats[0];for(const h of a)l.automations.push(h)}}}}for(const[e,t]of this._masterTrackAutomations){let r=this.score.masterBars[e];for(let s=0,n=t.length;s<n;s++){let a=t[s];a.type===Dt.Tempo&&(e===0&&(this.score.tempo=a.value|0,a.text&&(this.score.tempoLabel=a.text)),r.tempoAutomation=a)}}}}_r.InvalidId="-1";_r.BendPointPositionFactor=V.MaxPosition/100;_r.BendPointValueFactor=1/25;class Qd{constructor(){this.isMultiRest=!1,this.trackViewGroups=[]}}class L1{constructor(){this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1}}class wx{apply(e){if(this.scoreViews.length>0){let t=0;for(let r of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const s=e.tracks[t];for(const n of s.staves)n.showTablature=r.showTablature,n.showStandardNotation=r.showStandardNotation,n.showSlash=r.showSlash}t++}}}constructor(e){this.scoreViews=[];let t=Gt.fromBuffer(e);const r=E.readInt32BE(t);for(let s=0;s<r;s++){const n=new Qd;this.scoreViews.push(n),n.isMultiRest=Ne.gpReadBool(t);const a=E.readInt32BE(t);for(let o=0;o<a;o++){let l=t.readByte();l===0&&(l=1);let h=new L1;h.showStandardNotation=(l&1)!==0,h.showTablature=(l&2)!==0,h.showSlash=(l&4)!==0,n.trackViewGroups.push(h)}}}static writeForScore(e){const t=Gt.withCapacity(128),r=[new Qd];for(const s of e.tracks){const n=new L1;n.showStandardNotation=s.staves[0].showStandardNotation,n.showTablature=s.staves[0].showTablature,n.showSlash=s.staves[0].showSlash,r[0].trackViewGroups.push(n);const a=new Qd;a.trackViewGroups.push(n),r.push(a)}E.writeInt32BE(t,r.length);for(const s of r){t.writeByte(s.isMultiRest?1:0),E.writeInt32BE(t,s.trackViewGroups.length);for(const n of s.trackViewGroups){let a=0;n.showStandardNotation&&(a=a|1),n.showTablature&&(a=a|2),n.showSlash&&(a=a|4),t.writeByte(a)}}return E.writeInt32BE(t,1),t.toArray()}}class Dm{}class iu extends Dm{constructor(e){super(),this.n=e}}class Ln extends Dm{constructor(e,t){super(),this.left=e,this.right=t}}class Dp extends Dm{constructor(e,t){super(),this.n=e,this.table=t}}class Xt{static make(e,t,r,s){let n=[],a=[];if(s>32)throw new Tt("Invalid huffman");for(let h=0;h<s;h++)n.push(0),a.push(0);for(let h=0;h<r;h++){let u=e[h+t];if(u>=s)throw new Tt("Invalid huffman");n[u]++}let o=0;for(let h=1;h<s-1;h++)o=o+n[h]<<1,a[h]=o;let l=new Map;for(let h=0;h<r;h++){let u=e[h+t];if(u!==0){let c=a[u-1];a[u-1]=c+1,l.set(c<<5|u,h)}}return Xt.treeCompress(new Ln(Xt.treeMake(l,s,0,1),Xt.treeMake(l,s,1,1)))}static treeMake(e,t,r,s){if(s>t)throw new Tt("Invalid huffman");let n=r<<5|s;return e.has(n)?new iu(e.get(n)):(r=r<<1,s+=1,new Ln(Xt.treeMake(e,t,r,s),Xt.treeMake(e,t,r|1,s)))}static treeCompress(e){let t=Xt.treeDepth(e);if(t===0)return e;if(t===1){if(e instanceof Ln)return new Ln(Xt.treeCompress(e.left),Xt.treeCompress(e.right));throw new Tt("assert")}let r=1<<t,s=[];for(let n=0;n<r;n++)s.push(new iu(-1));return Xt.treeWalk(s,0,0,t,e),new Dp(t,s)}static treeWalk(e,t,r,s,n){n instanceof Ln&&s>0?(Xt.treeWalk(e,t,r+1,s-1,n.left),Xt.treeWalk(e,t|1<<r,r+1,s-1,n.right)):e[t]=Xt.treeCompress(n)}static treeDepth(e){if(e instanceof iu)return 0;if(e instanceof Dp)throw new Tt("assert");if(e instanceof Ln){let t=Xt.treeDepth(e.left),r=Xt.treeDepth(e.right);return 1+(t<r?t:r)}return 0}}var St;(function(i){i[i.Head=0]="Head",i[i.Block=1]="Block",i[i.CData=2]="CData",i[i.Flat=3]="Flat",i[i.Crc=4]="Crc",i[i.Dist=5]="Dist",i[i.DistOne=6]="DistOne",i[i.Done=7]="Done"})(St||(St={}));class Or{constructor(){this.buffer=new Uint8Array(Or.BufferSize),this.pos=0}slide(){let e=new Uint8Array(Or.BufferSize);this.pos-=Or.Size,e.set(this.buffer.subarray(Or.Size,Or.Size+this.pos),0),this.buffer=e}addBytes(e,t,r){this.pos+r>Or.BufferSize&&this.slide(),this.buffer.set(e.subarray(t,t+r),this.pos),this.pos+=r}addByte(e){this.pos===Or.BufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}Or.Size=32768;Or.BufferSize=65536;class mi{static buildFixedHuffman(){let e=[];for(let t=0;t<288;t++)e.push(t<=143?8:t<=255?9:t<=279?7:8);return Xt.make(e,0,288,10)}constructor(e){this._nbits=0,this._bits=0,this._state=St.Block,this._isFinal=!1,this._huffman=mi._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new Or,this._input=e;for(let t=0;t<19;t++)this._lengths.push(-1)}readBytes(e,t,r){if(this._needed=r,this._outpos=t,this._output=e,r>0)for(;this.inflateLoop(););return r-this._needed}inflateLoop(){switch(this._state){case St.Head:let e=this._input.readByte();if((e&15)!==8)throw new Tt("Invalid data");let r=this._input.readByte(),s=(r&32)!==0;if(((e<<8)+r)%31!==0)throw new Tt("Invalid data");if(s)throw new Tt("Unsupported dictionary");return this._state=St.Block,!0;case St.Crc:return this._state=St.Done,!0;case St.Done:return!1;case St.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=E.readUInt16LE(this._input),E.readUInt16LE(this._input)!==65535-this._len)throw new Tt("Invalid data");this._state=St.Flat;let o=this.inflateLoop();return this.resetBits(),o;case 1:return this._huffman=mi._fixedHuffman,this._huffdist=null,this._state=St.CData,!0;case 2:let l=this.getBits(5)+257,h=this.getBits(5)+1,u=this.getBits(4)+4;for(let d=0;d<u;d++)this._lengths[mi.CodeLengthsPos[d]]=this.getBits(3);for(let d=u;d<19;d++)this._lengths[mi.CodeLengthsPos[d]]=0;this._huffman=Xt.make(this._lengths,0,19,8);let c=[];for(let d=0;d<l+h;d++)c.push(0);return this.inflateLengths(c,l+h),this._huffdist=Xt.make(c,l,h,16),this._huffman=Xt.make(c,0,l,16),this._state=St.CData,!0;default:throw new Tt("Invalid data")}case St.Flat:{let a=this._len<this._needed?this._len:this._needed,o=E.readByteArray(this._input,a);return this._len-=a,this.addBytes(o,0,a),this._len===0&&(this._state=this._isFinal?St.Crc:St.Block),this._needed>0}case St.DistOne:{let a=this._len<this._needed?this._len:this._needed;return this.addDistOne(a),this._len-=a,this._len===0&&(this._state=St.CData),this._needed>0}case St.Dist:for(;this._len>0&&this._needed>0;){let a=this._len<this._dist?this._len:this._dist,o=this._needed<a?this._needed:a;this.addDist(this._dist,o),this._len-=o}return this._len===0&&(this._state=St.CData),this._needed>0;case St.CData:let n=this.applyHuffman(this._huffman);if(n<256)return this.addByte(n),this._needed>0;if(n===256)return this._state=this._isFinal?St.Crc:St.Block,!0;{n=n-257&255;let a=mi.LenExtraBitsTbl[n];if(a===-1)throw new Tt("Invalid data");this._len=mi.LenBaseValTbl[n]+this.getBits(a);let o=this._huffdist,l=o?this.applyHuffman(o):this.getRevBits(5);if(a=mi.DistExtraBitsTbl[l],a===-1)throw new Tt("Invalid data");if(this._dist=mi.DistBaseValTbl[l]+this.getBits(a),this._dist>this._window.available())throw new Tt("Invalid data");return this._state=this._dist===1?St.DistOne:St.Dist,!0}}return!1}addDistOne(e){let t=this._window.getLastChar();for(let r=0;r<e;r++)this.addByte(t)}addByte(e){this._window.addByte(e),this._output[this._outpos]=e,this._needed--,this._outpos++}addDist(e,t){this.addBytes(this._window.buffer,this._window.pos-e,t)}getBit(){this._nbits===0&&(this._nbits=8,this._bits=this._input.readByte());let e=(this._bits&1)===1;return this._nbits--,this._bits=this._bits>>1,e}getBits(e){for(;this._nbits<e;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;let t=this._bits&(1<<e)-1;return this._nbits-=e,this._bits=this._bits>>e,t}getRevBits(e){return e===0?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)}resetBits(){this._bits=0,this._nbits=0}addBytes(e,t,r){this._window.addBytes(e,t,r),this._output.set(e.subarray(t,t+r),this._outpos),this._needed-=r,this._outpos+=r}inflateLengths(e,t){let r=0,s=0;for(;r<t;){let n=this.applyHuffman(this._huffman);switch(n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:s=n,e[r]=n,r++;break;case 16:let a=r+3+this.getBits(2);if(a>t)throw new Tt("Invalid data");for(;r<a;)e[r]=s,r++;break;case 17:if(r+=3+this.getBits(3),r>t)throw new Tt("Invalid data");break;case 18:if(r+=11+this.getBits(7),r>t)throw new Tt("Invalid data");break;default:throw new Tt("Invalid data")}}}applyHuffman(e){if(e instanceof iu)return e.n;if(e instanceof Ln)return this.applyHuffman(this.getBit()?e.right:e.left);if(e instanceof Dp)return this.applyHuffman(e.table[this.getBits(e.n)]);throw new Tt("Invalid data")}}mi.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];mi.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];mi.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1];mi.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];mi.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];mi._fixedHuffman=mi.buildFixedHuffman();class Ts{constructor(e,t){this.fullName=e;let r=e.lastIndexOf("/");this.fileName=r===-1||r===e.length-1?this.fullName:e.substr(r+1),this.data=t}}Ts.OptionalDataDescriptorSignature=134695760;Ts.CompressionMethodDeflate=8;Ts.LocalFileHeaderSignature=67324752;Ts.CentralFileHeaderSignature=33639248;Ts.EndOfCentralDirSignature=101010256;class Am{constructor(e){this._readable=e}read(){let e=[];for(;;){let t=this.readEntry();if(!t)break;e.push(t)}return e}readEntry(){let e=this._readable;if(E.readInt32LE(e)!==Ts.LocalFileHeaderSignature)return null;E.readUInt16LE(e);let r=E.readUInt16LE(e),s=E.readUInt16LE(e),n=s!==0;if(n&&s!==Ts.CompressionMethodDeflate)return null;E.readInt16LE(this._readable),E.readInt16LE(this._readable),E.readInt32LE(e),E.readInt32LE(e);let a=E.readInt32LE(e),o=E.readInt16LE(e),l=E.readInt16LE(e),h=E.toString(E.readByteArray(e,o),"utf-8");e.skip(l);let u;if(n){let c=Gt.empty(),d=new mi(this._readable),p=new Uint8Array(65536);for(;;){let f=d.readBytes(p,0,p.length);if(c.write(p,0,f),f<p.length)break}u=c.toArray()}else u=E.readByteArray(this._readable,a);return r&8&&(E.readInt32LE(this._readable)===Ts.OptionalDataDescriptorSignature&&E.readInt32LE(this._readable),E.readInt32LE(this._readable),E.readInt32LE(this._readable)),new Ts(h,u)}}class Z3{constructor(){this.trackViewGroups=[]}}class e4{constructor(){this.isVisible=!1}}var Ap;(function(i){i[i.PageVertical=0]="PageVertical",i[i.PageGrid=1]="PageGrid",i[i.PageParchment=2]="PageParchment",i[i.ScreenVertical=3]="ScreenVertical",i[i.ScreenHorizontal=4]="ScreenHorizontal",i[i.PageHorizontal=5]="PageHorizontal"})(Ap||(Ap={}));class Sx{constructor(e,t){this.zoomLevel=4,this.view=Ap.PageVertical,this.muiltiVoiceCursor=!1,this.scoreViews=[];const r=Gt.fromBuffer(t);this.zoomLevel=E.readInt32BE(r),this.view=r.readByte(),this.muiltiVoiceCursor=r.readByte()!=0;const s=e.scoreViews.length;for(let n=0;n<s;n++){const a=new Z3;this.scoreViews.push(a);const o=e.scoreViews[n];for(let l=0;l<o.trackViewGroups.length;l++){const h=new e4;h.isVisible=r.readByte()!=0,a.trackViewGroups.push(h)}}}apply(e){if(this.scoreViews.length>0){let t=0;for(let r of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const s=e.tracks[t];s.isVisibleOnMultiTrack=r.isVisible}t++}}}static writeForScore(e){const t=Gt.withCapacity(128);E.writeInt32BE(t,4),t.writeByte(0);const r=e.tracks.length>0&&e.tracks[0].staves[0].bars[0].isMultiVoice;t.writeByte(r?255:0);for(const s of e.tracks)t.writeByte(s.isVisibleOnMultiTrack?255:0);for(const s of e.tracks)t.writeByte(255);return t.toArray()}}class t4 extends co{get name(){return"Guitar Pro 7-8"}constructor(){super()}readScore(){L.debug(this.name,"Loading ZIP entries");let e=new Am(this.data),t;try{t=e.read()}catch(u){throw new tt("No Zip archive",u)}L.debug(this.name,"Zip entries loaded");let r=null,s=null,n=null,a=null;for(let u of t)switch(u.fileName){case"score.gpif":r=E.toString(u.data,this.settings.importer.encoding);break;case"BinaryStylesheet":s=u.data;break;case"PartConfiguration":n=u.data;break;case"LayoutConfiguration":a=u.data;break}if(!r)throw new tt("No score.gpif found in zip archive");L.debug(this.name,"Start Parsing score.gpif");let o=new _r;o.parseXml(r,this.settings),L.debug(this.name,"score.gpif parsed");let l=o.score;s&&(L.debug(this.name,"Start Parsing BinaryStylesheet"),new ed(s).apply(l),L.debug(this.name,"BinaryStylesheet parsed"));let h=null;return n&&(L.debug(this.name,"Start Parsing Part Configuration"),h=new wx(n),h.apply(l),L.debug(this.name,"Part Configuration parsed")),a&&h!=null&&(L.debug(this.name,"Start Parsing Layout Configuration"),new Sx(h,a).apply(l),L.debug(this.name,"Layout Configuration parsed")),l}}class vl extends Yt{constructor(){super(Ut.Format,"Unexpected end of data within reader"),Object.setPrototypeOf(this,vl.prototype)}}class kl{constructor(e){this._currentByte=0,this._position=kl.ByteSize,this._source=e}readByte(){return this.readBits(8)}readBytes(e){const t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=this.readByte()&255;return t}readBits(e){let t=0,r=e-1;for(;r>=0;)t=t|this.readBit()<<r,r--;return t}readBitsReversed(e){let t=0;for(let r=0;r<e;r++)t=t|this.readBit()<<r;return t}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),this._currentByte===-1)throw new vl;this._position=0}const e=this._currentByte>>kl.ByteSize-this._position-1&1;return this._position++,e}readAll(){let e=Gt.empty();try{for(;;)e.writeByte(this.readByte()&255)}catch(t){if(!(t instanceof vl))throw t}return e.toArray()}}kl.ByteSize=8;class i4{constructor(){this.fileName="",this.fileSize=0,this.data=null}}class Vm{constructor(){this.files=[],this.files=[],this.fileFilter=e=>!0}load(e){let t=new kl(e);this.readBlock(t)}readHeader(e){return this.getString(e.readBytes(4),0,4)}decompress(e,t=!1){let r=Gt.empty(),s,n=this.getInteger(e.readBytes(4),0);try{for(;r.length<n;)if(e.readBits(1)===1){let c=e.readBits(4),d=e.readBitsReversed(c),p=e.readBitsReversed(c),f=r.length-d,m=Math.min(d,p);s=r.getBuffer(),r.write(s,f,m)}else{let c=e.readBitsReversed(2);for(let d=0;d<c;d++)r.writeByte(e.readByte())}}catch(u){if(!(u instanceof vl))throw u}s=r.getBuffer();let a=t?4:0,o=r.length-a,l=new Uint8Array(o),h=o;return l.set(s.subarray(a,a+h),0),l}readBlock(e){let t=this.readHeader(e);if(t==="BCFZ")this.readUncompressedBlock(this.decompress(e,!0));else if(t==="BCFS")this.readUncompressedBlock(e.readAll());else throw new tt("Unsupported format")}readUncompressedBlock(e){let t=4096,r=t;for(;r+3<e.length;){if(this.getInteger(e,r)===2){let n=new i4;n.fileName=this.getString(e,r+4,127),n.fileSize=this.getInteger(e,r+140);let a=!this.fileFilter||this.fileFilter(n.fileName);a&&this.files.push(n);let o=r+148,l=0,h=0,u=a?Gt.withCapacity(n.fileSize):null;for(;l=this.getInteger(e,o+4*h++),l!==0;)r=l*t,a&&u.write(e,r,t);if(a){n.data=new Uint8Array(Math.min(n.fileSize,u.length));let c=u.toArray();n.data.set(c.subarray(0,0+n.data.length),0)}}r+=t}}getString(e,t,r){let s="";for(let n=0;n<r;n++){let a=e[t+n]&255;if(a===0)break;s+=String.fromCharCode(a)}return s}getInteger(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}}Vm.HeaderBcFs="BCFS";Vm.HeaderBcFz="BCFZ";class r4 extends co{get name(){return"Guitar Pro 6"}constructor(){super()}readScore(){L.debug(this.name,"Loading GPX filesystem");let e=new Vm;e.fileFilter=h=>h.endsWith("score.gpif")||h.endsWith("BinaryStylesheet")||h.endsWith("PartConfiguration")||h.endsWith("LayoutConfiguration"),e.load(this.data),L.debug(this.name,"GPX filesystem loaded");let t=null,r=null,s=null,n=null;for(let h of e.files)switch(h.fileName){case"score.gpif":t=E.toString(h.data,this.settings.importer.encoding);break;case"BinaryStylesheet":r=h.data;break;case"PartConfiguration":s=h.data;break;case"LayoutConfiguration":n=h.data;break}if(!t)throw new tt("No score.gpif found in GPX");L.debug(this.name,"Start Parsing score.gpif");let a=new _r;a.parseXml(t,this.settings),L.debug(this.name,"score.gpif parsed");let o=a.score;r&&(L.debug(this.name,"Start Parsing BinaryStylesheet"),new ed(r).apply(o),L.debug(this.name,"BinaryStylesheet parsed"));let l=null;return s&&(L.debug(this.name,"Start Parsing Part Configuration"),l=new wx(s),l.apply(o),L.debug(this.name,"Part Configuration parsed")),n&&l!=null&&(L.debug(this.name,"Start Parsing Layout Configuration"),new Sx(l,n).apply(o),L.debug(this.name,"Layout Configuration parsed")),o}}class s4 extends co{get name(){return"MusicXML"}constructor(){super(),this._currentPartGroup=null,this._trackFirstMeasureNumber=0,this._maxVoices=0,this._currentDirection=null,this._currentChord=null,this._divisionsPerQuarterNote=0,this._voiceOfStaff=new Map,this._isBeamContinue=!1,this._previousBeatWasPulled=!1,this._previousBeat=null}readScore(){this._trackById=new Map,this._partGroups=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._slurStarts=new Map;let e=this.extractMusicXml(),t=new Xu;try{t.parse(e)}catch{throw new tt("Unsupported format")}return this._score=new ha,this._score.tempo=120,this.parseDom(t),this.settings.importer.mergePartGroupsInMusicXml&&this.mergePartGroups(),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}extractMusicXml(){const e=new Am(this.data);let t;try{t=e.read()}catch{t=[]}if(t.length===0)return this.data.reset(),E.toString(this.data.readAll(),this.settings.importer.encoding);const r=t.find(h=>h.fullName==="META-INF/container.xml");if(!r)throw new tt("No compressed MusicXML");const s=new Xu;try{s.parse(E.toString(r.data,this.settings.importer.encoding))}catch(h){throw new tt("Malformed container.xml, could not parse as XML",h)}let n=s.firstElement;if(!n||n.localName!=="container")throw new tt("Malformed container.xml, root element not 'container'");const a=n.findChildElement("rootfiles");if(!a)throw new tt("Malformed container.xml, 'container/rootfiles' not found");let o="";for(const h of a.childNodes)if(h.nodeType==R.Element&&h.localName==="rootfile"){o=h.getAttribute("full-path");break}if(!o)throw new tt("Unsupported compressed MusicXML, missing rootfile");const l=t.find(h=>h.fullName===o);if(!l)throw new tt(`Malformed container.xml, '${o}' not contained in zip`);return E.toString(l.data,this.settings.importer.encoding)}mergePartGroups(){let e=!1;for(const t of this._partGroups.values())t.length>1&&(this.mergeGroup(t),e=!0);if(e)for(let t=0;t<this._score.tracks.length;t++)this._score.tracks[t].index=t}mergeGroup(e){let t=e[0];for(let r=1;r<e.length;r++){let s=e[r];for(let a of s.staves)t.addStaff(a);let n=this._score.tracks.indexOf(s);this._score.tracks.splice(n,1)}}parseDom(e){let t=e.firstElement;if(!t)throw new tt("Unsupported format");switch(t.localName){case"score-partwise":this.parsePartwise(t);break;case"score-timewise":break;default:throw new tt("Unsupported format")}}parsePartwise(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"work":this.parseWork(t);break;case"movement-title":this._score.title=t.innerText;break;case"identification":this.parseIdentification(t);break;case"part-list":this.parsePartList(t);break;case"part":this.parsePart(t);break}}parseWork(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"work-title":this._score.title=t.innerText;break}}parsePart(e){let t=e.getAttribute("id");if(!this._trackById.has(t))if(this._trackById.size===1){for(const[n,a]of this._trackById)(a.staves.length===0||a.staves[0].bars.length===0)&&(t=n);if(!this._trackById.has(t))return}else return;let r=this._trackById.get(t),s=!0;this._maxVoices=0;for(let n of e.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"measure":this.parseMeasure(n,r,s)&&(s=!1);break}for(let n of r.staves)for(let a of n.bars)this.ensureVoices(a)}parseMeasure(e,t,r){if(e.getAttribute("implicit")==="yes"&&e.getElementsByTagName("note",!1).length===0)return!1;let s=0;if(r)this._divisionsPerQuarterNote=0,this._trackFirstMeasureNumber=parseInt(e.getAttribute("number")),this._trackFirstMeasureNumber||(this._trackFirstMeasureNumber=0),s=0;else{if(s=parseInt(e.getAttribute("number")),!s)return!1;s-=this._trackFirstMeasureNumber}if(r){let l=e.getElementsByTagName("attributes",!1);if(l.length>0){let h=l[0].getElementsByTagName("staves",!1);if(h.length>0){let u=parseInt(h[0].innerText);t.ensureStaveCount(u)}}}let n=new Array(t.staves.length),a=null;for(let l=t.staves[0].bars.length;l<=s;l++)for(let h=0;h<t.staves.length;h++){let u=new Gs;if(n[h]=u,t.staves[h].bars.length>0){let c=t.staves[h].bars[t.staves[h].bars.length-1];u.clef=c.clef}a=this.getOrCreateMasterBar(s),t.staves[h].addBar(u),this.ensureVoices(u)}let o=new Map;if(a){let l=!1;for(let h of e.childNodes)if(h.nodeType===R.Element)switch(h.localName){case"note":this.parseNoteBeat(h,n);break;case"forward":this.parseForward(h,n);break;case"direction":this.parseDirection(h,a);break;case"attributes":l||(this.parseAttributes(h,n,a,t),l=!0);break;case"harmony":this.parseHarmony(h,t,o);break;case"sound":break;case"barline":this.parseBarline(h,a);break}}return!0}ensureVoices(e){for(;e.voices.length<this._maxVoices;){let t=new fs;e.addVoice(t);let r=new si;r.isEmpty=!0,r.chordId=this._currentChord,t.addBeat(r)}}getOrCreateBeat(e,t,r){let s=0,n=e.getElementsByTagName("voice",!1);n.length>0&&(s=parseInt(n[0].innerText)-1);let a=this._previousBeatWasPulled;this._previousBeatWasPulled=!1;let o=e.getElementsByTagName("staff",!1),l=1;if(o.length>0){l=parseInt(o[0].innerText),(this._isBeamContinue||a)&&this._previousBeat.voice.bar.staff.index!==l-1&&(l=this._previousBeat.voice.bar.staff.index+1,this._previousBeatWasPulled=!0);let d=t[0].staff.track.index+"-"+l;this._voiceOfStaff.has(d)||this._voiceOfStaff.set(d,s)}l--;let h;l<0?h=t[0]:l>=t.length?h=t[t.length-1]:h=t[l];let u,c=this.getOrCreateVoice(h,s);return r&&c.beats.length>0||c.beats.length===1&&c.isEmpty?u=c.beats[c.beats.length-1]:(u=new si,u.isEmpty=!1,c.addBeat(u)),this._isBeamContinue=!1,this._previousBeat=u,u}parseForward(e,t){let r=this.getOrCreateBeat(e,t,!1),n=parseInt(e.findChildElement("duration").innerText)*B.Quarter/this._divisionsPerQuarterNote,a=[B.SixtyFourth,B.ThirtySecond,B.Sixteenth,B.Eighth,B.Quarter,B.Half,B.Whole];for(let o of a)if(n>=o){r.duration=o,n-=o;break}r.isEmpty=!1}parseStaffDetails(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"staff-lines":for(let s of t.staves)s.stringTuning.tunings=new Array(parseInt(r.innerText)).fill(0);break;case"staff-tuning":this.parseStaffTuning(r,t);break}for(let r of t.staves)this.isEmptyTuning(r.tuning)&&(r.stringTuning.tunings=[])}parseStaffTuning(e,t){let r=parseInt(e.getAttribute("line")),s="C",n="",a=0;for(let l of e.childNodes)if(l.nodeType===R.Element)switch(l.localName){case"tuning-step":s=l.innerText;break;case"tuning-alter":a=parseInt(l.innerText);break;case"tuning-octave":n=l.innerText;break}let o=$e.getTuningForText(s+n)+a;for(let l of t.staves)l.tuning[l.tuning.length-r]=o}parseHarmony(e,t,r){let s=new Sn;for(let a of e.childNodes)if(a.nodeType===R.Element)switch(a.localName){case"root":s.name=this.parseHarmonyRoot(a);break;case"kind":s.name=s.name+this.parseHarmonyKind(a);break;case"frame":this.parseHarmonyFrame(a,s);break}this._currentChord=$e.newGuid();const n=s.uniqueId;r.has(n)&&(s.showDiagram=!1);for(let a of t.staves)a.addChord(this._currentChord,s);r.set(n,s)}parseHarmonyRoot(e){let t="",r="";for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"root-step":t=s.innerText;break;case"root-alter":switch(parseInt(e.innerText)){case-2:r="bb";break;case-1:r="b";break;case 0:r="";break;case 1:r="#";break;case 2:r="##";break}break}return t+r}parseHarmonyKind(e){const t=e.getAttribute("text");let r="";if(t)r=t;else switch(e.innerText){case"major":r="";break;case"minor":r="m";break;case"augmented":r="+";break;case"diminished":r="○";break;case"dominant":r="7";break;case"major-seventh":r="7M";break;case"minor-seventh":r="m7";break;case"diminished-seventh":r="○7";break;case"augmented-seventh":r="+7";break;case"half-diminished":r="⍉";break;case"major-minor":r="mMaj";break;case"major-sixth":r="maj6";break;case"minor-sixth":r="m6";break;case"dominant-ninth":r="9";break;case"major-ninth":r="maj9";break;case"minor-ninth":r="m9";break;case"dominant-11th":r="11";break;case"major-11th":r="maj11";break;case"minor-11th":r="m11";break;case"dominant-13th":r="13";break;case"major-13th":r="maj13";break;case"minor-13th":r="m13";break;case"suspended-second":r="sus2";break;case"suspended-fourth":r="sus4";break}return r}parseHarmonyFrame(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"frame-strings":const s=parseInt(r.innerText);t.strings=new Array(s);for(let o=0;o<s;o++)t.strings[o]=-1;break;case"first-fret":t.firstFret=parseInt(r.innerText);break;case"frame-note":let n=null,a=null;for(let o of r.childNodes)switch(o.localName){case"string":n=parseInt(o.innerText);break;case"fret":a=parseInt(o.innerText),n&&a>=0&&(t.strings[n-1]=a);break;case"barre":n&&a&&o.getAttribute("type")==="start"&&t.barreFrets.push(a);break}break}}parseBarline(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"repeat":this.parseRepeat(r,t);break;case"ending":this.parseEnding(r,t);break}}parseEnding(e,t){let r=parseInt(e.getAttribute("number"));r>0&&(--r,t.alternateEndings=t.alternateEndings|1<<r&255)}parseRepeat(e,t){let r=e.getAttribute("direction"),s=parseInt(e.getAttribute("times"));(s<0||isNaN(s))&&(s=2),r==="backward"?t.repeatCount=s:r==="forward"&&(t.isRepeatStart=!0)}parseNoteBeat(e,t){let r=e.getElementsByTagName("chord",!1).length>0,s=this.getOrCreateBeat(e,t,r);!s.chordId&&this._currentChord&&(s.chordId=this._currentChord,this._currentChord=null),this._currentDirection&&(s.text=this._currentDirection,this._currentDirection=null);let n=new ct;s.voice.isEmpty=!1,s.isEmpty=!1,s.addNote(n),s.dots=0;let a=!1;for(let o of e.childNodes)if(o.nodeType===R.Element)switch(o.localName){case"grace":s.graceType=K.BeforeBeat,s.duration=B.ThirtySecond;break;case"duration":if(s.isRest&&!a)switch(parseInt(o.innerText)){case 1:s.duration=B.Whole;break;case 2:s.duration=B.Half;break;case 4:s.duration=B.Quarter;break;case 8:s.duration=B.Eighth;break;case 16:s.duration=B.Sixteenth;break;case 32:s.duration=B.ThirtySecond;break;case 64:s.duration=B.SixtyFourth;break;default:s.duration=B.Quarter;break}break;case"tie":this.parseTied(o,n);break;case"cue":break;case"instrument":break;case"type":s.duration=this.getDuration(o.innerText),s.graceType!==K.None&&s.duration<B.Sixteenth&&(s.duration=B.Eighth);break;case"dot":s.dots++;break;case"accidental":this.parseAccidental(o,n);break;case"time-modification":this.parseTimeModification(o,s);break;case"stem":break;case"notehead":o.getAttribute("parentheses")==="yes"&&(n.isGhost=!0);break;case"beam":o.innerText==="continue"&&(this._isBeamContinue=!0);break;case"notations":this.parseNotations(o,s,n);break;case"lyric":this.parseLyric(o,s);break;case"pitch":this.parsePitch(o,n);break;case"unpitched":this.parseUnpitched(o,n);break;case"rest":a=o.getAttribute("measure")==="yes",s.isEmpty=!1,s.notes=[],s.duration=B.Whole;break}if(n.isStringed){for(let o=0;o<s.notes.length;o++)if(s.notes[o].string===n.string&&s.notes[o]!==n){s.removeNote(n);break}}}getDuration(e){switch(e){case"256th":case"128th":case"64th":return B.SixtyFourth;case"32nd":return B.ThirtySecond;case"16th":return B.Sixteenth;case"eighth":return B.Eighth;case"quarter":return B.Quarter;case"half":return B.Half;case"long":case"breve":case"whole":return B.Whole}return B.Quarter}parseLyric(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"text":t.text?t.text+=" "+r.innerText:t.text=r.innerText;break}}parseAccidental(e,t){switch(e.innerText){case"sharp":t.accidentalMode=kt.ForceSharp;break;case"natural":t.accidentalMode=kt.ForceNatural;break;case"flat":t.accidentalMode=kt.ForceFlat;break}}parseTied(e,t){if(e.getAttribute("type")==="start")this._tieStartIds.has(t.id)||(this._tieStartIds.set(t.id,!0),this._tieStarts.push(t));else if(e.getAttribute("type")==="stop"&&this._tieStarts.length>0&&!t.isTieDestination){const r=this._tieStarts[0];r.beat.voice.index===t.beat.voice.index&&r.beat.voice.bar.staff.index===t.beat.voice.bar.staff.index&&r.beat.voice.bar.staff.track.index===t.beat.voice.bar.staff.track.index&&(t.isTieDestination=!0,t.tieOrigin=this._tieStarts[0]),this._tieStarts.splice(0,1),this._tieStartIds.delete(t.id)}}parseNotations(e,t,r){for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"articulations":this.parseArticulations(s,r);break;case"tied":this.parseTied(s,r);break;case"slide":case"glissando":s.getAttribute("type")==="start"&&(r.slideOutType=he.Shift);break;case"dynamics":this.parseDynamics(s,t);break;case"technical":this.parseTechnical(s,r);break;case"ornaments":this.parseOrnaments(s,r);break;case"slur":let n=s.getAttribute("number");switch(n||(n="1"),n=t.voice.bar.staff.index+"_"+n,s.getAttribute("type")){case"start":this._slurStarts.set(n,r);break;case"stop":if(this._slurStarts.has(n)){r.isSlurDestination=!0;let a=this._slurStarts.get(n);a.slurDestination=r,r.slurOrigin=a}break}break}}parseOrnaments(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"tremolo":switch(parseInt(r.innerText)){case 1:t.beat.tremoloSpeed=B.Eighth;break;case 2:t.beat.tremoloSpeed=B.Sixteenth;break;case 3:t.beat.tremoloSpeed=B.ThirtySecond;break}break}}parseTechnical(e,t){let r=[];for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"string":t.string=parseInt(s.innerText),t.string!==-2147483648&&(t.string=t.beat.voice.bar.staff.tuning.length-t.string+1);break;case"fret":t.fret=parseInt(s.innerText);break;case"down-bow":t.beat.pickStroke=Jt.Down;break;case"up-bow":t.beat.pickStroke=Jt.Up;break;case"bend":r.push(s);break}r.length>0&&this.parseBends(r,t),(t.string===-2147483648||t.fret===-2147483648)&&(t.string=-1,t.fret=-1)}parseBends(e,t){let r=V.MaxPosition/e.length,s=0,n=0,a=!0;for(let o of e){let l=o.findChildElement("bend-alter");if(l){let h=Math.round(Math.abs(parseFloat(l.innerText))*2);o.findChildElement("pre-bend")?a?(s+=h,t.addBendPoint(new V(n,s)),n+=r,t.addBendPoint(new V(n,s)),a=!1):n+=r:o.findChildElement("release")?(a&&(s+=h),t.addBendPoint(new V(n,s)),n+=r,s-=h,t.addBendPoint(new V(n,s)),a=!1):(t.addBendPoint(new V(n,s)),s+=h,n+=r,t.addBendPoint(new V(n,s)),a=!1)}}}parseArticulations(e,t){for(let r of e.childNodes)switch(r.localName){case"accent":t.accentuated=Et.Normal;break;case"strong-accent":t.accentuated=Et.Heavy;break;case"staccato":case"detached-legato":t.isStaccato=!0;break}}parseDynamics(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"p":t.dynamics=pe.P;break;case"pp":t.dynamics=pe.PP;break;case"ppp":t.dynamics=pe.PPP;break;case"f":t.dynamics=pe.F;break;case"ff":t.dynamics=pe.FF;break;case"fff":t.dynamics=pe.FFF;break;case"mp":t.dynamics=pe.MP;break;case"mf":t.dynamics=pe.MF;break}}parseTimeModification(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"actual-notes":t.tupletNumerator=parseInt(r.innerText);break;case"normal-notes":t.tupletDenominator=parseInt(r.innerText);break}}parseUnpitched(e,t){let r="",s=0,n=0;for(let o of e.childNodes)if(o.nodeType===R.Element)switch(o.localName){case"display-step":r=o.innerText;break;case"display-alter":s=parseInt(o.innerText);break;case"display-octave":n=parseInt(o.innerText);break}let a=n*12+$e.getToneForText(r)+s;t.octave=a/12|0,t.tone=a-t.octave*12}parsePitch(e,t){let r="",s=0,n=0;for(let o of e.childNodes)if(o.nodeType===R.Element)switch(o.localName){case"step":r=o.innerText;break;case"alter":s=parseFloat(o.innerText),isNaN(s)&&(s=0);break;case"octave":n=parseInt(o.innerText)+1;break}let a=n*12+$e.getToneForText(r)+(s|0);t.octave=a/12|0,t.tone=a-t.octave*12}getOrCreateVoice(e,t){if(t<e.voices.length)return e.voices[t];for(let r=e.voices.length;r<=t;r++)e.addVoice(new fs);return this._maxVoices=Math.max(this._maxVoices,e.voices.length),e.voices[t]}parseDirection(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"sound":let s=r.getAttribute("tempo");if(s){let a=new ii;a.isLinear=!0,a.type=Dt.Tempo,a.value=parseInt(s),t.tempoAutomation=a,t.index===0&&(t.score.tempo=a.value)}break;case"direction-type":let n=r.firstElement;switch(n.localName){case"words":this._currentDirection=n.innerText;break;case"metronome":this.parseMetronome(n,t);break}break}}parseMetronome(e,t){let r=B.Quarter,s=120;for(let a of e.childNodes)if(a.nodeType===R.Element)switch(a.localName){case"beat-unit":r=this.getDuration(a.innerText);break;case"per-minute":s=parseInt(a.innerText);break}let n=new ii;n.type=Dt.Tempo,n.value=s*(r/4|0),t.tempoAutomation=n,t.index===0&&(t.score.tempo=n.value)}parseAttributes(e,t,r,s){let n=0,a=!1;for(let o of e.childNodes)if(o.nodeType===R.Element)switch(o.localName){case"divisions":this._divisionsPerQuarterNote=parseInt(o.innerText);break;case"key":this.parseKey(o,r);break;case"time":this.parseTime(o,r),a=!0;break;case"clef":n=parseInt(o.getAttribute("number")),isNaN(n)&&(n=1),this.parseClef(o,t[n-1]);break;case"staff-details":this.parseStaffDetails(o,s);break;case"transpose":this.parseTranspose(o,s);break}a||(r.timeSignatureCommon=!0)}parseTranspose(e,t){let r=0;for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"chromatic":r+=parseInt(s.innerText);break;case"octave-change":r+=parseInt(s.innerText)*12;break}for(let s of t.staves)s.transpositionPitch=r}parseClef(e,t){let r="s",s=0;for(let n of e.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"sign":r=n.innerText.toLowerCase();break;case"line":s=parseInt(n.innerText);break;case"clef-octave-change":switch(parseInt(n.innerText)){case-2:t.clefOttava=Le._15mb;break;case-1:t.clefOttava=Le._8vb;break;case 1:t.clefOttava=Le._8va;break;case 2:t.clefOttava=Le._15mb;break}break}switch(r){case"g":t.clef=ae.G2;break;case"f":t.clef=ae.F4;break;case"c":s===3?t.clef=ae.C3:t.clef=ae.C4;break;case"percussion":t.clef=ae.Neutral,t.staff.isPercussion=!0;break;case"tab":t.clef=ae.G2,t.staff.showTablature=!0;break;default:t.clef=ae.G2;break}}parseTime(e,t){e.getAttribute("symbol")==="common"&&(t.timeSignatureCommon=!0);let r=!1,s=!1;for(let n of e.childNodes)if(n.nodeType===R.Element){let a=n.innerText;switch(n.localName){case"beats":r||(a.indexOf("+")===-1?t.timeSignatureNumerator=parseInt(a):t.timeSignatureNumerator=4,r=!0);break;case"beat-type":s||(a.indexOf("+")===-1?t.timeSignatureDenominator=parseInt(a):t.timeSignatureDenominator=4,s=!0);break}}}parseKey(e,t){let r=-2147483648,s="";for(let n of e.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"fifths":r=parseInt(n.innerText);break;case"key-step":break;case"key-alter":break;case"mode":s=n.innerText;break}-7<=r&&r<=7?t.keySignature=r:t.keySignature=Rt.C,s==="minor"?t.keySignatureType=vn.Minor:t.keySignatureType=vn.Major}getOrCreateMasterBar(e){if(e<this._score.masterBars.length)return this._score.masterBars[e];for(let t=this._score.masterBars.length;t<=e;t++){let r=new Vs;if(this._score.masterBars.length>0){let s=this._score.masterBars[this._score.masterBars.length-1];r.timeSignatureDenominator=s.timeSignatureDenominator,r.timeSignatureNumerator=s.timeSignatureNumerator,r.keySignature=s.keySignature,r.keySignatureType=s.keySignatureType}this._score.addMasterBar(r)}return this._score.masterBars[e]}parseIdentification(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"creator":t.getAttribute("type")==="composer"&&(this._score.music=t.innerText);break;case"rights":this._score.copyright&&(this._score.copyright+=`
`),this._score.copyright+=t.innerText;break}}parsePartList(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"part-group":this.parsePartGroup(t);break;case"score-part":this.parseScorePart(t);break}}parsePartGroup(e){switch(e.getAttribute("type")){case"start":this._currentPartGroup=e.getAttribute("number"),this._partGroups.set(this._currentPartGroup,[]);break;case"stop":this._currentPartGroup=null;break}}parseScorePart(e){let t=e.getAttribute("id"),r=new ds;r.ensureStaveCount(1);let s=r.staves[0];s.showStandardNotation=!0,this._trackById.set(t,r),this._score.addTrack(r),this._currentPartGroup&&this._partGroups.get(this._currentPartGroup).push(r);for(let n of e.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"part-name":r.name=n.innerText;break;case"part-abbreviation":r.shortName=n.innerText;break;case"midi-instrument":this.parseMidiInstrument(n,r);break}this.isEmptyTuning(r.staves[0].tuning)&&(r.staves[0].stringTuning.tunings=[])}isEmptyTuning(e){if(!e)return!0;for(let t=0;t<e.length;t++)if(e[t]!==0)return!1;return!0}parseMidiInstrument(e,t){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"midi-channel":t.playbackInfo.primaryChannel=parseInt(r.innerText);break;case"midi-program":t.playbackInfo.program=parseInt(r.innerText);break;case"volume":t.playbackInfo.volume=Math.floor(parseInt(r.innerText)/100*16);break;case"pan":t.playbackInfo.balance=Math.max(0,Math.min(16,Math.floor((parseInt(r.innerText)+90)/180*16)));break}}}var to;(function(i){i[i.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",i[i.MultiTrack=1]="MultiTrack"})(to||(to={}));class vx{constructor(){this.events=[]}addEvent(e){if(this.events.length===0||e.tick>=this.events[this.events.length-1].tick)this.events.push(e);else{let t=this.events.length;for(;t>0&&this.events[t-1].tick>e.tick;)t--;this.events.splice(t,0,e)}}writeTo(e){let t=Gt.empty(),r=0;for(let a of this.events){let o=a.tick-r;fn.writeVariableInt(t,o),a.writeTo(t),r=a.tick}const s=new Uint8Array([77,84,114,107]);e.write(s,0,s.length);let n=t.toArray();E.writeInt32BE(e,n.length),e.write(n,0,n.length)}}class fn{constructor(){this.format=to.SingleTrackMultiChannel,this.division=oe.QuarterTime,this.tracks=[]}get events(){if(this.tracks.length==1)return this.tracks[0].events;{const e=[];for(const t of this.tracks)this.events.push(...t.events);return e.sort((t,r)=>t.tick-r.tick),e}}ensureTracks(e){for(;this.tracks.length<e;)this.tracks.push(new vx)}addEvent(e){this.format==to.SingleTrackMultiChannel?(this.ensureTracks(1),this.tracks[0].addEvent(e)):(this.ensureTracks(e.track+1),this.tracks[e.track].addEvent(e))}toBinary(){let e=Gt.empty();return this.writeTo(e),e.toArray()}writeTo(e){let t=new Uint8Array([77,84,104,100]);e.write(t,0,t.length),E.writeInt32BE(e,6),E.writeInt16BE(e,this.format),E.writeInt16BE(e,this.tracks.length),E.writeInt16BE(e,this.division);for(const r of this.tracks)r.writeTo(e)}static writeVariableInt(e,t){let r=new Uint8Array(4),s=0;do r[s++]=t&127,t>>=7;while(t>0);for(;s>0;)s--,s>0?e.writeByte(r[s]|128):e.writeByte(r[s])}}var ke;(function(i){i[i.TimeSignature=88]="TimeSignature",i[i.NoteOn=128]="NoteOn",i[i.NoteOff=144]="NoteOff",i[i.ControlChange=176]="ControlChange",i[i.ProgramChange=192]="ProgramChange",i[i.TempoChange=81]="TempoChange",i[i.PitchBend=224]="PitchBend",i[i.PerNotePitchBend=96]="PerNotePitchBend",i[i.EndOfTrack=47]="EndOfTrack",i[i.AlphaTabRest=241]="AlphaTabRest",i[i.AlphaTabMetronome=242]="AlphaTabMetronome",i[i.SystemExclusive=240]="SystemExclusive",i[i.SystemExclusive2=247]="SystemExclusive2",i[i.Meta=255]="Meta"})(ke||(ke={}));class Us{constructor(e,t,r){this.track=e,this.tick=t,this.type=r}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class kx extends Us{constructor(e,t,r,s,n,a){super(e,t,ke.TimeSignature),this.track=e,this.tick=t,this.numerator=r,this.denominatorIndex=s,this.midiClocksPerMetronomeClick=n,this.thirtySecondNodesInQuarter=a}writeTo(e){e.writeByte(255),e.writeByte(88),fn.writeVariableInt(e,4),e.writeByte(this.numerator&255),e.writeByte(this.denominatorIndex&255),e.writeByte(this.midiClocksPerMetronomeClick&255),e.writeByte(this.thirtySecondNodesInQuarter&255)}}class Hs extends Us{constructor(e,t,r){super(e,t,r)}writeTo(e){e.writeByte(240);const t=Gt.withCapacity(16);t.writeByte(Hs.AlphaTabManufacturerId),this.writeEventData(t),t.writeByte(247),fn.writeVariableInt(e,t.length),t.copyTo(e)}}Hs.AlphaTabManufacturerId=125;Hs.MetronomeEventId=0;Hs.RestEventId=1;class xx extends Hs{constructor(e,t,r,s,n){super(e,t,ke.AlphaTabMetronome),this.isMetronome=!0,this.metronomeNumerator=r,this.metronomeDurationInMilliseconds=n,this.metronomeDurationInTicks=s}writeEventData(e){e.writeByte(Hs.MetronomeEventId),e.writeByte(this.metronomeNumerator),E.writeInt32LE(e,this.metronomeDurationInTicks),E.writeInt32LE(e,this.metronomeDurationInMilliseconds)}}class Bx extends Hs{constructor(e,t,r){super(e,t,ke.AlphaTabRest),this.channel=r}writeEventData(e){e.writeByte(Hs.RestEventId),e.writeByte(this.channel)}}class _x extends Us{constructor(e,t,r,s,n,a){super(e,t,r),this.channel=s,this.noteKey=n,this.noteVelocity=a}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class Tx extends _x{constructor(e,t,r,s,n){super(e,t,ke.NoteOn,r,s,n)}writeTo(e){e.writeByte(this.channel&15|144),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class Cx extends _x{constructor(e,t,r,s,n){super(e,t,ke.NoteOff,r,s,n)}writeTo(e){e.writeByte(this.channel&15|128),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class Nx extends Us{constructor(e,t,r,s,n){super(e,t,ke.ControlChange),this.channel=r,this.controller=s,this.value=n}writeTo(e){e.writeByte(this.channel&15|176),e.writeByte(this.controller&255),e.writeByte(this.value&255)}get data1(){return this.controller}get data2(){return this.value}}class Px extends Us{constructor(e,t,r,s){super(e,t,ke.ProgramChange),this.channel=r,this.program=s}writeTo(e){e.writeByte(this.channel&15|192),e.writeByte(this.program&255)}get data1(){return this.program}}class Ex extends Us{constructor(e,t){super(0,e,ke.TempoChange),this.microSecondsPerQuarterNote=t}writeTo(e){e.writeByte(255),e.writeByte(81),e.writeByte(3),e.writeByte(this.microSecondsPerQuarterNote>>16&255),e.writeByte(this.microSecondsPerQuarterNote>>8&255),e.writeByte(this.microSecondsPerQuarterNote&255)}}class Mx extends Us{constructor(e,t,r,s){super(e,t,ke.PitchBend),this.channel=r,this.value=s}writeTo(e){e.writeByte(this.channel&15|224),e.writeByte(this.value&127),e.writeByte(this.value>>7&127)}get data1(){return this.value&127}get data2(){return this.value>>7&127}}class Lx extends Us{constructor(e,t,r,s,n){super(e,t,ke.PerNotePitchBend),this.channel=r,this.noteKey=s,this.value=n}writeTo(e){throw new Yt(Ut.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class Rx extends Us{constructor(e,t){super(e,t,ke.EndOfTrack)}writeTo(e){e.writeByte(255),e.writeByte(47),e.writeByte(0)}}class Uo{constructor(e,t){this.time=0,this.eventIndex=e,this.event=t,this.isMetronome=this.event.type==ke.AlphaTabMetronome}static newMetronomeEvent(e,t,r,s,n){const a=new xx(0,t,r,s,n);return new Uo(e,a)}}class ce{}ce.DefaultChannelCount=17;ce.MetronomeChannel=ce.DefaultChannelCount-1;ce.AudioChannels=2;ce.MinVolume=0;ce.MinProgram=0;ce.MaxProgram=127;ce.MinPlaybackSpeed=.125;ce.MaxPlaybackSpeed=8;ce.MaxPitchWheel=16384;ce.MaxPitchWheel20=4294967296;ce.DefaultPitchWheel=ce.MaxPitchWheel/2;ce.MicroBufferCount=32;ce.MicroBufferSize=64;class R1{constructor(e,t,r){this.bpm=e,this.ticks=t,this.time=r}}class Kd{constructor(){this.tempoChanges=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=oe.QuarterTime,this.eventIndex=0,this.currentTime=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0}}class n4{get isPlayingMain(){return this._currentState==this._mainState}get isPlayingOneTimeMidi(){return this._currentState==this._oneTimeState}get isPlayingCountIn(){return this._currentState==this._countInState}constructor(e){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this._synthesizer=e,this._mainState=new Kd,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(e){this._mainState.playbackRange=e,e&&(this._mainState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.startTick,1),this._mainState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.endTick,1))}get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}mainSeek(e){if(e*=this.playbackSpeed,this.mainPlaybackRange&&(e<this._mainState.playbackRangeStartTime?e=this._mainState.playbackRangeStartTime:e>this._mainState.playbackRangeEndTime&&(e=this._mainState.playbackRangeEndTime)),e>this._mainState.currentTime)this.mainSilentProcess(e-this._mainState.currentTime);else if(e<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this.isPlayingMain){let t=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(t)}this.mainSilentProcess(e)}}mainSilentProcess(e){if(e<=0)return;let t=Date.now(),r=this._mainState.currentTime+e;if(this.isPlayingMain)for(;this._mainState.currentTime<r;)this.fillMidiEventQueueLimited(r-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(ce.MicroBufferSize);this._mainState.currentTime=r;let s=Date.now()-t;L.debug("Sequencer","Silent seek finished in "+s+"ms (main)")}loadOneTimeMidi(e){this._oneTimeState=this.createStateFromFile(e),this._currentState=this._oneTimeState}loadMidi(e){this._mainState=this.createStateFromFile(e),this._currentState=this._mainState}createStateFromFile(e){const t=new Kd;t.tempoChanges=[],t.division=e.division,t.eventIndex=0,t.currentTime=0,t.synthData=[];let r=120,s=0,n=0,a=0,o=0,l=0,h=0,u=0,c=0;for(let d of e.events){let p=new Uo(t.synthData.length,d);t.synthData.push(p);let f=d.tick-c;if(s+=f,n+=f*(6e4/(r*e.division)),p.time=n,c=d.tick,o>0)for(;h<s;){let m=Uo.newMetronomeEvent(t.synthData.length,h,Math.floor(h/o)%a,o,l);t.synthData.push(m),m.time=u,h+=o,u+=l}if(d.type===ke.TempoChange)r=6e7/d.microSecondsPerQuarterNote,t.tempoChanges.push(new R1(r,s,n)),l=o*(6e4/(r*e.division));else if(d.type===ke.TimeSignature){let m=d,S=Math.pow(2,m.denominatorIndex);a=m.numerator,o=t.division*(4/S)|0,l=o*(6e4/(r*e.division)),t.firstTimeSignatureDenominator===0&&(t.firstTimeSignatureNumerator=m.numerator,t.firstTimeSignatureDenominator=S)}else if(d.type===ke.ProgramChange){let m=d.channel;t.firstProgramEventPerChannel.has(m)||t.firstProgramEventPerChannel.set(m,p)}}return t.synthData.sort((d,p)=>d.time>p.time?1:d.time<p.time?-1:d.eventIndex-p.eventIndex),t.endTime=n,t.endTick=s,t}fillMidiEventQueue(){return this.fillMidiEventQueueLimited(-1)}fillMidiEventQueueLimited(e){let t=ce.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,r=this.internalEndTime;e>0&&(e<t&&(t=e),r=Math.min(this.internalEndTime,this._currentState.currentTime+e));let s=!1;for(this._currentState.currentTime+=t;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<r;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,s=!0;return s}mainTickPositionToTimePosition(e){return this.tickPositionToTimePositionWithSpeed(this._mainState,e,this.playbackSpeed)}mainTimePositionToTickPosition(e){return this.timePositionToTickPositionWithSpeed(this._mainState,e,this.playbackSpeed)}currentTimePositionToTickPosition(e){return this.timePositionToTickPositionWithSpeed(this._currentState,e,this.playbackSpeed)}tickPositionToTimePositionWithSpeed(e,t,r){let s=0,n=120,a=0;for(const o of e.tempoChanges){if(t<o.ticks)break;s=o.time,n=o.bpm,a=o.ticks}return t-=a,s+=t*(6e4/(n*e.division)),s/r}timePositionToTickPositionWithSpeed(e,t,r){t*=r;let s=0,n=120,a=0;for(const o of e.tempoChanges){if(t<o.time)break;s=o.ticks,n=o.bpm,a=o.time}return t-=a,s+=t/(6e4/(n*e.division))|0,s+1}get internalEndTime(){return this.isPlayingMain?this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this.internalEndTime}stop(){this.isPlayingMain&&this.mainPlaybackRange?this._currentState.currentTime=this.mainPlaybackRange.startTick:this._currentState.currentTime=0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const e=new Kd;e.division=this._mainState.division;let t=120,r=4,s=4;this._mainState.eventIndex===0?(t=this._mainState.tempoChanges[0].bpm,r=this._mainState.firstTimeSignatureNumerator,s=this._mainState.firstTimeSignatureDenominator):(t=this._synthesizer.currentTempo,r=this._synthesizer.timeSignatureNumerator,s=this._synthesizer.timeSignatureDenominator),e.tempoChanges.push(new R1(t,0,0));let n=e.division*(4/s)|0,a=n*(6e4/(t*this._mainState.division)),o=0,l=0;for(let h=0;h<r;h++){let u=Uo.newMetronomeEvent(e.synthData.length,o,h,n,a);e.synthData.push(u),u.time=l,o+=n,l+=a}e.synthData.sort((h,u)=>h.time>u.time?1:h.time<u.time?-1:h.eventIndex-u.eventIndex),e.endTime=l,e.endTick=o,this._countInState=e}}var Nt;(function(i){i[i.Paused=0]="Paused",i[i.Playing=1]="Playing"})(Nt||(Nt={}));class Yo{constructor(e,t){this.state=e,this.stopped=t}}class xl{constructor(e,t,r,s,n){this.currentTime=e,this.endTime=t,this.currentTick=r,this.endTick=s,this.isSeek=n}}class sr{constructor(){this.id="",this.size=0}static load(e,t,r){if(e&&sr.HeaderSize>e.size||r.position+sr.HeaderSize>=r.length||(t.id=E.read8BitStringLength(r,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122)||(t.size=E.readUInt32LE(r),e&&sr.HeaderSize+t.size>e.size))return!1;e&&(e.size-=sr.HeaderSize+t.size);let s=t.id==="RIFF",n=t.id==="LIST";return s&&e?!1:!s&&!n?!0:(t.id=E.read8BitStringLength(r,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122?!1:(t.size-=4,!0))}}sr.HeaderSize=8;class Hm{constructor(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.fontSamples=new Float32Array(0)}load(e){const t=new sr,r=new sr;if(!sr.load(null,t,e)||t.id!=="sfbk")throw new Tt("Soundfont is not a valid Soundfont2 file");for(;sr.load(t,r,e);){let s=new sr;if(r.id==="pdta")for(;sr.load(r,s,e);)switch(s.id){case"phdr":for(let n=0,a=s.size/Up.SizeInFile|0;n<a;n++)this.phdrs.push(new Up(e));break;case"pbag":for(let n=0,a=s.size/Gp.SizeInFile|0;n<a;n++)this.pbags.push(new Gp(e));break;case"pmod":for(let n=0,a=s.size/Yp.SizeInFile|0;n<a;n++)this.pmods.push(new Yp(e));break;case"pgen":for(let n=0,a=s.size/zi.SizeInFile|0;n<a;n++)this.pgens.push(new zi(e));break;case"inst":for(let n=0,a=s.size/zp.SizeInFile|0;n<a;n++)this.insts.push(new zp(e));break;case"ibag":for(let n=0,a=s.size/Vp.SizeInFile|0;n<a;n++)this.ibags.push(new Vp(e));break;case"imod":for(let n=0,a=s.size/Hp.SizeInFile|0;n<a;n++)this.imods.push(new Hp(e));break;case"igen":for(let n=0,a=s.size/Wp.SizeInFile|0;n<a;n++)this.igens.push(new Wp(e));break;case"shdr":for(let n=0,a=s.size/$p.SizeInFile|0;n<a;n++)this.sHdrs.push(new $p(e));break;default:e.position+=s.size;break}else if(r.id==="sdta")for(;sr.load(r,s,e);)switch(s.id){case"smpl":this.fontSamples=Hm.loadSamples(s,e);break;default:e.position+=s.size;break}else e.position+=r.size}}static loadSamples(e,t){let r=e.size/2|0;const s=new Float32Array(r);let n=0;const a=new Uint8Array(16*1024);for(;r>0;){let o=Math.min(r,a.length/2|0);t.read(a,0,o*2);for(let l=0;l<o;l++){const h=de.int32ToInt16(a[l*2+1]<<8|a[l*2]);s[n+l]=h/32767}r-=o,n+=o}return s}}class Vp{constructor(e){this.instGenNdx=E.readUInt16LE(e),this.instModNdx=E.readUInt16LE(e)}}Vp.SizeInFile=4;class Hp{constructor(e){this.modSrcOper=E.readUInt16LE(e),this.modDestOper=E.readUInt16LE(e),this.modAmount=E.readInt16LE(e),this.modAmtSrcOper=E.readUInt16LE(e),this.modTransOper=E.readUInt16LE(e)}}Hp.SizeInFile=10;class Wp{constructor(e){this.genOper=E.readUInt16LE(e),this.genAmount=new Fx(e)}}Wp.SizeInFile=4;class zp{constructor(e){this.instName=E.read8BitStringLength(e,20),this.instBagNdx=E.readUInt16LE(e)}}zp.SizeInFile=22;class Gp{constructor(e){this.genNdx=E.readUInt16LE(e),this.modNdx=E.readUInt16LE(e)}}Gp.SizeInFile=4;class zi{constructor(e){this.genOper=E.readUInt16LE(e),this.genAmount=new Fx(e)}}zi.SizeInFile=4;zi.GenInstrument=41;zi.GenKeyRange=43;zi.GenVelRange=44;zi.GenSampleId=53;class Up{constructor(e){this.presetName=E.read8BitStringLength(e,20),this.preset=E.readUInt16LE(e),this.bank=E.readUInt16LE(e),this.presetBagNdx=E.readUInt16LE(e),this.library=E.readUInt32LE(e),this.genre=E.readUInt32LE(e),this.morphology=E.readUInt32LE(e)}}Up.SizeInFile=38;class Yp{constructor(e){this.modSrcOper=E.readUInt16LE(e),this.modDestOper=E.readUInt16LE(e),this.modAmount=E.readUInt16LE(e),this.modAmtSrcOper=E.readUInt16LE(e),this.modTransOper=E.readUInt16LE(e)}}Yp.SizeInFile=10;class $p{constructor(e){this.sampleName=E.read8BitStringLength(e,20),this.start=E.readUInt32LE(e),this.end=E.readUInt32LE(e),this.startLoop=E.readUInt32LE(e),this.endLoop=E.readUInt32LE(e),this.sampleRate=E.readUInt32LE(e),this.originalPitch=e.readByte(),this.pitchCorrection=E.readSInt8(e),this.sampleLink=E.readUInt16LE(e),this.sampleType=E.readUInt16LE(e)}}$p.SizeInFile=46;class Fx{get shortAmount(){return de.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return this.wordAmount&255}get highByteAmount(){return(this.wordAmount&65280)>>8&255}constructor(e){this.wordAmount=E.readUInt16LE(e)}}class a4{constructor(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1}}class o4{constructor(){this.activeChannel=0,this.channelList=[]}setupVoice(e,t){const r=this.channelList[this.activeChannel],s=t.region.pan+r.panOffset;t.playingChannel=this.activeChannel,t.mixVolume=r.mixVolume,t.noteGainDb+=r.gainDb,t.updatePitchRatio(r,e.outSampleRate),s<=-.5?(t.panFactorLeft=1,t.panFactorRight=0):s>=.5?(t.panFactorLeft=0,t.panFactorRight=1):(t.panFactorLeft=Math.sqrt(.5-s),t.panFactorRight=Math.sqrt(.5+s))}}var Ss;(function(i){i[i.None=0]="None",i[i.Continuous=1]="Continuous",i[i.Sustain=2]="Sustain"})(Ss||(Ss={}));var Dn;(function(i){i[i.StereoInterleaved=0]="StereoInterleaved",i[i.StereoUnweaved=1]="StereoUnweaved",i[i.Mono=2]="Mono"})(Dn||(Dn={}));class l4{constructor(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null,this.fontSamples=null}}class mt{static timecents2Secs(e){return Math.pow(2,e/1200)}static decibelsToGain(e){return e>-100?Math.pow(10,e*.05):0}static gainToDecibels(e){return e<=1e-5?-100:20*Math.log10(e)}static cents2Hertz(e){return 8.176*Math.pow(2,e/1200)}static clamp(e,t,r){return e<=t?t:e>=r?r:e}}class Lo{constructor(e){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,e&&(this.delay=e.delay,this.attack=e.attack,this.hold=e.hold,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.keynumToHold=e.keynumToHold,this.keynumToDecay=e.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(e){this.delay=this.delay<-11950?0:mt.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:mt.timecents2Secs(this.attack),this.release=this.release<-11950?0:mt.timecents2Secs(this.release),this.keynumToHold===0&&(this.hold=this.hold<-11950?0:mt.timecents2Secs(this.hold)),this.keynumToDecay===0&&(this.decay=this.decay<-11950?0:mt.timecents2Secs(this.decay)),this.sustain<0?this.sustain=0:e?this.sustain=mt.decibelsToGain(-this.sustain/10):this.sustain=1-this.sustain/1e3}}var ve;(function(i){i[i.StartAddrsOffset=0]="StartAddrsOffset",i[i.EndAddrsOffset=1]="EndAddrsOffset",i[i.StartloopAddrsOffset=2]="StartloopAddrsOffset",i[i.EndloopAddrsOffset=3]="EndloopAddrsOffset",i[i.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",i[i.ModLfoToPitch=5]="ModLfoToPitch",i[i.VibLfoToPitch=6]="VibLfoToPitch",i[i.ModEnvToPitch=7]="ModEnvToPitch",i[i.InitialFilterFc=8]="InitialFilterFc",i[i.InitialFilterQ=9]="InitialFilterQ",i[i.ModLfoToFilterFc=10]="ModLfoToFilterFc",i[i.ModEnvToFilterFc=11]="ModEnvToFilterFc",i[i.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",i[i.ModLfoToVolume=13]="ModLfoToVolume",i[i.Unused1=14]="Unused1",i[i.ChorusEffectsSend=15]="ChorusEffectsSend",i[i.ReverbEffectsSend=16]="ReverbEffectsSend",i[i.Pan=17]="Pan",i[i.Unused2=18]="Unused2",i[i.Unused3=19]="Unused3",i[i.Unused4=20]="Unused4",i[i.DelayModLFO=21]="DelayModLFO",i[i.FreqModLFO=22]="FreqModLFO",i[i.DelayVibLFO=23]="DelayVibLFO",i[i.FreqVibLFO=24]="FreqVibLFO",i[i.DelayModEnv=25]="DelayModEnv",i[i.AttackModEnv=26]="AttackModEnv",i[i.HoldModEnv=27]="HoldModEnv",i[i.DecayModEnv=28]="DecayModEnv",i[i.SustainModEnv=29]="SustainModEnv",i[i.ReleaseModEnv=30]="ReleaseModEnv",i[i.KeynumToModEnvHold=31]="KeynumToModEnvHold",i[i.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",i[i.DelayVolEnv=33]="DelayVolEnv",i[i.AttackVolEnv=34]="AttackVolEnv",i[i.HoldVolEnv=35]="HoldVolEnv",i[i.DecayVolEnv=36]="DecayVolEnv",i[i.SustainVolEnv=37]="SustainVolEnv",i[i.ReleaseVolEnv=38]="ReleaseVolEnv",i[i.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",i[i.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",i[i.Instrument=41]="Instrument",i[i.Reserved1=42]="Reserved1",i[i.KeyRange=43]="KeyRange",i[i.VelRange=44]="VelRange",i[i.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",i[i.Keynum=46]="Keynum",i[i.Velocity=47]="Velocity",i[i.InitialAttenuation=48]="InitialAttenuation",i[i.Reserved2=49]="Reserved2",i[i.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",i[i.CoarseTune=51]="CoarseTune",i[i.FineTune=52]="FineTune",i[i.SampleID=53]="SampleID",i[i.SampleModes=54]="SampleModes",i[i.Reserved3=55]="Reserved3",i[i.ScaleTuning=56]="ScaleTuning",i[i.ExclusiveClass=57]="ExclusiveClass",i[i.OverridingRootKey=58]="OverridingRootKey",i[i.Unused5=59]="Unused5",i[i.EndOper=60]="EndOper"})(ve||(ve={}));class wa{constructor(e){this.loopMode=Ss.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new Lo,this.modEnv=new Lo,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,e&&(this.loopMode=e.loopMode,this.sampleRate=e.sampleRate,this.loKey=e.loKey,this.hiKey=e.hiKey,this.loVel=e.loVel,this.hiVel=e.hiVel,this.group=e.group,this.offset=e.offset,this.end=e.end,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.transpose=e.transpose,this.tune=e.tune,this.pitchKeyCenter=e.pitchKeyCenter,this.pitchKeyTrack=e.pitchKeyTrack,this.attenuation=e.attenuation,this.pan=e.pan,this.ampEnv=new Lo(e.ampEnv),this.modEnv=new Lo(e.modEnv),this.initialFilterQ=e.initialFilterQ,this.initialFilterFc=e.initialFilterFc,this.modEnvToPitch=e.modEnvToPitch,this.modEnvToFilterFc=e.modEnvToFilterFc,this.modLfoToFilterFc=e.modLfoToFilterFc,this.modLfoToVolume=e.modLfoToVolume,this.delayModLFO=e.delayModLFO,this.freqModLFO=e.freqModLFO,this.modLfoToPitch=e.modLfoToPitch,this.delayVibLFO=e.delayVibLFO,this.freqVibLFO=e.freqVibLFO,this.vibLfoToPitch=e.vibLfoToPitch)}clear(e){this.loopMode=Ss.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!e&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(e,t){switch(e){case ve.StartAddrsOffset:this.offset+=de.int16ToUint32(t.shortAmount);break;case ve.EndAddrsOffset:this.end+=de.int16ToUint32(t.shortAmount);break;case ve.StartloopAddrsOffset:this.loopStart+=de.int16ToUint32(t.shortAmount);break;case ve.EndloopAddrsOffset:this.loopEnd+=de.int16ToUint32(t.shortAmount);break;case ve.StartAddrsCoarseOffset:this.offset+=de.int16ToUint32(t.shortAmount)*32768;break;case ve.ModLfoToPitch:this.modLfoToPitch=t.shortAmount;break;case ve.VibLfoToPitch:this.vibLfoToPitch=t.shortAmount;break;case ve.ModEnvToPitch:this.modEnvToPitch=t.shortAmount;break;case ve.InitialFilterFc:this.initialFilterFc=t.shortAmount;break;case ve.InitialFilterQ:this.initialFilterQ=t.shortAmount;break;case ve.ModLfoToFilterFc:this.modLfoToFilterFc=t.shortAmount;break;case ve.ModEnvToFilterFc:this.modEnvToFilterFc=t.shortAmount;break;case ve.EndAddrsCoarseOffset:this.end+=de.int16ToUint32(t.shortAmount)*32768;break;case ve.ModLfoToVolume:this.modLfoToVolume=t.shortAmount;break;case ve.Pan:this.pan=t.shortAmount/1e3;break;case ve.DelayModLFO:this.delayModLFO=t.shortAmount;break;case ve.FreqModLFO:this.freqModLFO=t.shortAmount;break;case ve.DelayVibLFO:this.delayVibLFO=t.shortAmount;break;case ve.FreqVibLFO:this.freqVibLFO=t.shortAmount;break;case ve.DelayModEnv:this.modEnv.delay=t.shortAmount;break;case ve.AttackModEnv:this.modEnv.attack=t.shortAmount;break;case ve.HoldModEnv:this.modEnv.hold=t.shortAmount;break;case ve.DecayModEnv:this.modEnv.decay=t.shortAmount;break;case ve.SustainModEnv:this.modEnv.sustain=t.shortAmount;break;case ve.ReleaseModEnv:this.modEnv.release=t.shortAmount;break;case ve.KeynumToModEnvHold:this.modEnv.keynumToHold=t.shortAmount;break;case ve.KeynumToModEnvDecay:this.modEnv.keynumToDecay=t.shortAmount;break;case ve.DelayVolEnv:this.ampEnv.delay=t.shortAmount;break;case ve.AttackVolEnv:this.ampEnv.attack=t.shortAmount;break;case ve.HoldVolEnv:this.ampEnv.hold=t.shortAmount;break;case ve.DecayVolEnv:this.ampEnv.decay=t.shortAmount;break;case ve.SustainVolEnv:this.ampEnv.sustain=t.shortAmount;break;case ve.ReleaseVolEnv:this.ampEnv.release=t.shortAmount;break;case ve.KeynumToVolEnvHold:this.ampEnv.keynumToHold=t.shortAmount;break;case ve.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=t.shortAmount;break;case ve.KeyRange:this.loKey=t.lowByteAmount,this.hiKey=t.highByteAmount;break;case ve.VelRange:this.loVel=t.lowByteAmount,this.hiVel=t.highByteAmount;break;case ve.StartloopAddrsCoarseOffset:this.loopStart+=de.int16ToUint32(t.shortAmount)*32768;break;case ve.InitialAttenuation:this.attenuation+=t.shortAmount*.1;break;case ve.EndloopAddrsCoarseOffset:this.loopEnd+=de.int16ToUint32(t.shortAmount)*32768;break;case ve.CoarseTune:this.transpose+=t.shortAmount;break;case ve.FineTune:this.tune+=t.shortAmount;break;case ve.SampleModes:this.loopMode=(t.wordAmount&3)===3?Ss.Sustain:(t.wordAmount&3)===1?Ss.Continuous:Ss.None;break;case ve.ScaleTuning:this.pitchKeyTrack=t.shortAmount;break;case ve.ExclusiveClass:this.group=t.wordAmount;break;case ve.OverridingRootKey:this.pitchKeyCenter=t.shortAmount;break}}}var We;(function(i){i[i.None=0]="None",i[i.Delay=1]="Delay",i[i.Attack=2]="Attack",i[i.Hold=3]="Hold",i[i.Decay=4]="Decay",i[i.Sustain=5]="Sustain",i[i.Release=6]="Release",i[i.Done=7]="Done"})(We||(We={}));class Bl{constructor(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=We.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}nextSegment(e,t){if(this.parameters)for(;;)switch(e){case We.None:if(this.samplesUntilNextSegment=this.parameters.delay*t|0,this.samplesUntilNextSegment>0){this.segment=We.Delay,this.segmentIsExponential=!1,this.level=0,this.slope=0;return}e=We.Delay;break;case We.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*t|0,this.samplesUntilNextSegment>0){this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*t|0),this.segment=We.Attack,this.segmentIsExponential=!1,this.level=0,this.slope=1/this.samplesUntilNextSegment;return}e=We.Attack;break;case We.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*t|0,this.samplesUntilNextSegment>0){this.segment=We.Hold,this.segmentIsExponential=!1,this.level=1,this.slope=0;return}e=We.Hold;break;case We.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*t|0,this.samplesUntilNextSegment>0){if(this.segment=We.Decay,this.level=1,this.isAmpEnv){let r=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(r),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/r|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*t|0,this.segmentIsExponential=!1;return}e=We.Decay;break;case We.Decay:this.segment=We.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,this.segmentIsExponential=!1;return;case We.Sustain:if(this.segment=We.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?Bl.FastReleaseTime:this.parameters.release)*t|0,this.isAmpEnv){let r=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(r),this.segmentIsExponential=!0}else this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1;return;default:this.segment=We.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,this.samplesUntilNextSegment=134217727;return}}setup(e,t,r,s,n){this.parameters=new Lo(e),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-t),this.parameters.hold=this.parameters.hold<-1e4?0:mt.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-t),this.parameters.decay=this.parameters.decay<-1e4?0:mt.timecents2Secs(this.parameters.decay)),this.midiVelocity=r|0,this.isAmpEnv=s,this.nextSegment(We.None,n)}process(e,t){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,e):this.level+=this.slope*e),this.samplesUntilNextSegment-=e,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,t)}}Bl.FastReleaseTime=.01;class F1{constructor(){this.samplesUntil=0,this.level=0,this.delta=0}setup(e,t,r){this.samplesUntil=e*r|0,this.delta=4*mt.cents2Hertz(t)/r,this.level=0}process(e){if(this.samplesUntil>e){this.samplesUntil-=e;return}this.level+=this.delta*e,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level)}}class I1{constructor(e){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,e&&(this.qInv=e.qInv,this.a0=e.a0,this.a1=e.a1,this.b1=e.b1,this.b2=e.b2,this.z1=e.z1,this.z2=e.z2,this.active=e.active)}setup(e){let t=Math.tan(Math.PI*e),r=t*t,s=1/(1+t*this.qInv+r);this.a0=r*s,this.a1=2*this.a0,this.b1=2*(r-1)*s,this.b2=(1-t*this.qInv+r)*s}process(e){let t=e*this.a0+this.z1;return this.z1=e*this.a1+this.z2-this.b1*t,this.z2=e*this.a0-this.b2*t,t}}class _l{constructor(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new Bl,this.modEnv=new Bl,this.lowPass=new I1,this.modLfo=new F1,this.vibLfo=new F1,this.mixVolume=0,this.mute=!1}updatePitchRatio(e,t){let r=e.pitchWheel;e.perNotePitchWheel.has(this.playingKey)&&(r+=e.perNotePitchWheel.get(this.playingKey)-8192);const s=r===8192?e.tuning:r/16383*e.pitchRange*2-e.pitchRange+e.tuning;this.calcPitchRatio(s,t)}calcPitchRatio(e,t){if(!this.region)return;const r=this.playingKey+this.region.transpose+this.region.tune/100;let s=this.region.pitchKeyCenter+(r-this.region.pitchKeyCenter)*(this.region.pitchKeyTrack/100);e!==0&&(s+=e),this.pitchInputTimecents=s*100,this.pitchOutputFactor=this.region.sampleRate/(mt.timecents2Secs(this.region.pitchKeyCenter*100)*t)}end(e){this.region&&(this.ampEnv.nextSegment(We.Sustain,e),this.modEnv.nextSegment(We.Sustain,e),this.region.loopMode===Ss.Sustain&&(this.loopEnd=this.loopStart))}endQuick(e){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(We.Sustain,e),this.modEnv.parameters.release=0,this.modEnv.nextSegment(We.Sustain,e)}render(e,t,r,s,n){if(!this.region)return;let a=this.region,l=e.presets[this.playingPreset].fontSamples,h=0,u=e.outputMode===Dn.StereoUnweaved?s:-1,c=a.modEnvToPitch!==0||a.modEnvToFilterFc!==0,d=this.modLfo.delta>0&&(a.modLfoToPitch!==0||a.modLfoToFilterFc!==0||a.modLfoToVolume!==0),p=this.vibLfo.delta>0&&a.vibLfoToPitch!==0,f=this.loopStart<this.loopEnd,m=this.loopStart,S=this.loopEnd,y=a.end,b=S+1,w=this.sourceSamplePosition,x=new I1(this.lowPass),v=a.modLfoToFilterFc!==0||a.modEnvToFilterFc!==0,C=0,P=0,N=0,W=0,Y=a.modLfoToPitch!==0||a.modEnvToPitch!==0||a.vibLfoToPitch!==0,me=0,Ee=0,Xe=0,je=0,qe=a.modLfoToVolume!==0,_e=0,ot=0;for(v?(C=e.outSampleRate,P=a.initialFilterFc,N=a.modLfoToFilterFc,W=a.modEnvToFilterFc):(C=0,P=0,N=0,W=0),Y?(me=0,Ee=a.modLfoToPitch,Xe=a.vibLfoToPitch,je=a.modEnvToPitch):(me=mt.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,Ee=0,Xe=0,je=0),qe?ot=a.modLfoToVolume*.1:(_e=mt.decibelsToGain(this.noteGainDb),ot=0);s>0;){let G,re,se=0,we=s>_l.RenderEffectSampleBlock?_l.RenderEffectSampleBlock:s;if(s-=we,v){let Z=P+this.modLfo.level*N+this.modEnv.level*W;x.active=Z<=13500,x.active&&x.setup(mt.cents2Hertz(Z)/C)}switch(Y&&(me=mt.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*Ee+this.vibLfo.level*Xe+this.modEnv.level*je))*this.pitchOutputFactor),qe&&(_e=mt.decibelsToGain(this.noteGainDb+this.modLfo.level*ot)),G=_e*this.ampEnv.level,n?G=0:G*=this.mixVolume,this.ampEnv.process(we,e.outSampleRate),c&&this.modEnv.process(we,e.outSampleRate),d&&this.modLfo.process(we),p&&this.vibLfo.process(we),e.outputMode){case Dn.StereoInterleaved:for(re=G*this.panFactorLeft,se=G*this.panFactorRight;we-- >0&&w<y;){let Z=w|0,ze=Z>=S&&f?m:Z+1,Qe=w-Z,Ve=l[Z]*(1-Qe)+l[ze]*Qe;x.active&&(Ve=x.process(Ve)),t[r+h]+=Ve*re,h++,t[r+h]+=Ve*se,h++,w+=me,w>=b&&f&&(w-=S-m+1)}break;case Dn.StereoUnweaved:for(re=G*this.panFactorLeft,se=G*this.panFactorRight;we-- >0&&w<y;){let Z=w|0,ze=Z>=S&&f?m:Z+1,Qe=w-Z,Ve=l[Z]*(1-Qe)+l[ze]*Qe;x.active&&(Ve=x.process(Ve)),t[r+h]+=Ve*re,h++,t[r+u]+=Ve*se,u++,w+=me,w>=b&&f&&(w-=S-m+1)}break;case Dn.Mono:for(;we-- >0&&w<y;){let Z=w|0,ze=Z>=S&&f?m:Z+1,Qe=w-Z,Ve=l[Z]*(1-Qe)+l[ze]*Qe;x.active&&(Ve=x.process(Ve)),t[r+h]=Ve*G,h++,w+=me,w>=b&&f&&(w-=S-m+1)}break}if(w>=y||this.ampEnv.segment===We.Done){this.kill();return}}this.sourceSamplePosition=w,(x.active||v)&&(this.lowPass=x)}kill(){this.playingPreset=-1}}_l.RenderEffectSampleBlock=ce.MicroBufferSize;class Xp{constructor(){this._items=[],this._position=0,this.isEmpty=!0}clear(){this._items=[],this._position=0,this.isEmpty=!0}enqueue(e){this.isEmpty=!1,this._items.push(e)}peek(){return this._items[this._position]}dequeue(){const e=this._items[this._position];return this._position++,this._position>=this._items.length/2&&(this._items=this._items.slice(this._position),this._position=0),this.isEmpty=this._items.length==0,e}toArray(){const e=this._items.slice(this._position);return e.reverse(),e}}var Ae;(function(i){i[i.BankSelectCoarse=0]="BankSelectCoarse",i[i.ModulationCoarse=1]="ModulationCoarse",i[i.DataEntryCoarse=6]="DataEntryCoarse",i[i.VolumeCoarse=7]="VolumeCoarse",i[i.PanCoarse=10]="PanCoarse",i[i.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",i[i.BankSelectFine=32]="BankSelectFine",i[i.ModulationFine=33]="ModulationFine",i[i.DataEntryFine=38]="DataEntryFine",i[i.VolumeFine=39]="VolumeFine",i[i.PanFine=42]="PanFine",i[i.ExpressionControllerFine=43]="ExpressionControllerFine",i[i.HoldPedal=64]="HoldPedal",i[i.LegatoPedal=68]="LegatoPedal",i[i.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",i[i.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",i[i.RegisteredParameterFine=100]="RegisteredParameterFine",i[i.RegisteredParameterCourse=101]="RegisteredParameterCourse",i[i.AllSoundOff=120]="AllSoundOff",i[i.ResetControllers=121]="ResetControllers",i[i.AllNotesOff=123]="AllNotesOff"})(Ae||(Ae={}));class h4{constructor(e){this._midiEventQueue=new Xp,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this._transpositionPitches=new Map,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=Dn.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=e}synthesize(e,t,r){return this.fillWorkingBuffer(e,t,r)}synthesizeSilent(e){this.fillWorkingBuffer(null,0,e)}channelGetMixVolume(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].mixVolume:1}channelSetMixVolume(e,t){let r=this.channelInit(e);for(let s of this._voices)s.playingChannel===e&&s.playingPreset!==-1&&(s.mixVolume=t);r.mixVolume=t}channelSetMute(e,t){t?this._mutedChannels.set(e,!0):this._mutedChannels.delete(e)}channelSetSolo(e,t){t?this._soloChannels.set(e,!0):this._soloChannels.delete(e),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}applyTranspositionPitches(e){const t=this._transpositionPitches;for(const r of this._voices)if(r.playingChannel>=0&&r.playingChannel!==9){let s=0;t.has(r.playingChannel)&&(s-=t.get(r.playingChannel)),e.has(r.playingChannel)&&(s+=e.get(r.playingChannel)),r.playingKey+=s,this._channels&&r.updatePitchRatio(this._channels.channelList[r.playingChannel],this.outSampleRate)}this._transpositionPitches=e}dispatchEvent(e){this._midiEventQueue.enqueue(e)}fillWorkingBuffer(e,t,r){const s=this._isAnySolo,n=[];for(;!this._midiEventQueue.isEmpty;){let a=this._midiEventQueue.dequeue();a.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(ce.MetronomeChannel,33),this.channelNoteOn(ce.MetronomeChannel,33,95/127)):a.event&&this.processMidiMessage(a.event),n.push(a)}for(const a of this._voices)if(a.playingPreset!==-1){const o=a.playingChannel,l=this._mutedChannels.has(o)||s&&o!=ce.MetronomeChannel&&!this._soloChannels.has(o);e?a.render(this,e,t,r,l):a.kill()}return n}processMidiMessage(e){switch(L.debug("MIdi","Processing Midi message "+ke[e.type]+"/"+e.tick),e.type){case ke.TimeSignature:const r=e;this.timeSignatureNumerator=r.numerator,this.timeSignatureDenominator=Math.pow(2,r.denominatorIndex);break;case ke.NoteOn:const s=e;this.channelNoteOn(s.channel,s.noteKey,s.noteVelocity/127);break;case ke.NoteOff:const n=e;this.channelNoteOff(n.channel,n.noteKey);break;case ke.ControlChange:const a=e;this.channelMidiControl(a.channel,a.controller,a.value);break;case ke.ProgramChange:const o=e;this.channelSetPresetNumber(o.channel,o.program,o.channel===9);break;case ke.TempoChange:const l=e;this.currentTempo=6e7/l.microSecondsPerQuarterNote;break;case ke.PitchBend:const h=e;this.channelSetPitchWheel(h.channel,h.value);break;case ke.PerNotePitchBend:const u=e;let c=u.value;c=c*ce.MaxPitchWheel/ce.MaxPitchWheel20,this.channelSetPerNotePitchWheel(u.channel,u.noteKey,c);break}}get metronomeVolume(){return this.channelGetMixVolume(ce.MetronomeChannel)}set metronomeVolume(e){this.setupMetronomeChannel(e)}setupMetronomeChannel(e){this.channelSetMixVolume(ce.MetronomeChannel,e),e>0&&(this.channelSetVolume(ce.MetronomeChannel,1),this.channelSetPresetNumber(ce.MetronomeChannel,0,!0))}get masterVolume(){return mt.decibelsToGain(this.globalGainDb)}set masterVolume(e){var t=mt.gainToDecibels(e);const r=t-this.globalGainDb;if(r!==0){for(const s of this._voices)s.playingPreset!==-1&&(s.noteGainDb+=r);this.globalGainDb=t}}resetSoft(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<We.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);if(this._channels)for(const e of this._channels.channelList)e.presetIndex=0,e.bank=0,e.pitchWheel=8192,e.midiPan=8192,e.perNotePitchWheel.clear(),e.midiVolume=16383,e.midiExpression=16383,e.midiRpn=65535,e.midiData=0,e.panOffset=0,e.gainDb=0,e.pitchRange=2,e.tuning=0}get presetCount(){var e;return((e=this.presets)==null?void 0:e.length)??0}reset(){for(let e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<We.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);this._channels=null}setOutput(e,t,r){this.outputMode=e,this.outSampleRate=t>=1?t:44100,this.globalGainDb=r}noteOn(e,t,r){if(!this.presets)return;const s=r*127|0;if(e<0||e>=this.presets.length)return;if(r<=0){this.noteOff(e,t);return}const n=this._voicePlayIndex++;for(const a of this.presets[e].regions){if(t<a.loKey||t>a.hiKey||s<a.loVel||s>a.hiVel)continue;let o=null;if(a.group!==0)for(const u of this._voices)u.playingPreset===e&&u.region.group===a.group?u.endQuick(this.outSampleRate):u.playingPreset===-1&&!o&&(o=u);else for(let u of this._voices)u.playingPreset===-1&&(o=u);if(!o){for(let u=0;u<4;u++){const c=new _l;c.playingPreset=-1,this._voices.push(c)}o=this._voices[this._voices.length-4]}o.region=a,o.playingPreset=e,o.playingKey=t,o.playIndex=n,o.noteGainDb=this.globalGainDb-a.attenuation-mt.gainToDecibels(1/r),this._channels?this._channels.setupVoice(this,o):(o.calcPitchRatio(0,this.outSampleRate),o.panFactorLeft=Math.sqrt(.5-a.pan),o.panFactorRight=Math.sqrt(.5+a.pan)),o.sourceSamplePosition=a.offset;const l=a.loopMode!==Ss.None&&a.loopStart<a.loopEnd;o.loopStart=l?a.loopStart:0,o.loopEnd=l?a.loopEnd:0,o.ampEnv.setup(a.ampEnv,t,s,!0,this.outSampleRate),o.modEnv.setup(a.modEnv,t,s,!1,this.outSampleRate);const h=a.initialFilterQ/10;o.lowPass.qInv=1/Math.pow(10,h/20),o.lowPass.z1=0,o.lowPass.z2=0,o.lowPass.active=a.initialFilterFc<=13500,o.lowPass.active&&o.lowPass.setup(mt.cents2Hertz(a.initialFilterFc)/this.outSampleRate),o.modLfo.setup(a.delayModLFO,a.freqModLFO,this.outSampleRate),o.vibLfo.setup(a.delayVibLFO,a.freqVibLFO,this.outSampleRate)}}bankNoteOn(e,t,r,s){let n=this.getPresetIndex(e,t);return n===-1?!1:(this.noteOn(n,r,s),!0)}noteOff(e,t){let r=null,s=null,n=[];for(let a of this._voices)a.playingPreset!==e||a.playingKey!==t||a.ampEnv.segment>=We.Release||(!r||a.playIndex<r.playIndex?(r=a,s=a,n.push(a)):a.playIndex===r.playIndex&&(s=a,n.push(a)));if(r)for(const a of n)a!==r&&a!==s&&(a.playIndex!==r.playIndex||a.playingPreset!==e||a.playingKey!==t||a.ampEnv.segment>=We.Release)||a.end(this.outSampleRate)}bankNoteOff(e,t,r){const s=this.getPresetIndex(e,t);return s===-1?!1:(this.noteOff(s,r),!0)}noteOffAll(e){for(const t of this._voices)t.playingPreset!==-1&&t.ampEnv.segment<We.Release&&(e?t.endQuick(this.outSampleRate):t.end(this.outSampleRate))}get activeVoiceCount(){let e=0;for(const t of this._voices)t.playingPreset!==-1&&e++;return e}channelInit(e){if(this._channels&&e<this._channels.channelList.length)return this._channels.channelList[e];this._channels||(this._channels=new o4);for(let t=this._channels.channelList.length;t<=e;t++){let r=new a4;r.presetIndex=0,r.bank=0,r.pitchWheel=8192,r.midiPan=8192,r.midiVolume=16383,r.midiExpression=16383,r.midiRpn=65535,r.midiData=0,r.panOffset=0,r.gainDb=0,r.pitchRange=2,r.tuning=0,r.mixVolume=1,this._channels.channelList.push(r)}return this._channels.channelList[e]}getPresetIndex(e,t){if(!this.presets)return-1;for(let r=this.presets.length-1;r>=0;r--){let s=this.presets[r];if(s.presetNumber===t&&s.bank===e)return r}return-1}getPresetName(e){return this.presets?e<0||e>=this.presets.length?null:this.presets[e].name:null}bankGetPresetName(e,t){return this.getPresetName(this.getPresetIndex(e,t))}channelNoteOn(e,t,r){!this._channels||e>this._channels.channelList.length||(this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._channels.activeChannel=e,this.noteOn(this._channels.channelList[e].presetIndex,t,r))}channelNoteOff(e,t){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e));const r=[];let s=null,n=null;for(const o of this._voices)o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=We.Release||(!s||o.playIndex<s.playIndex?(s=o,n=o,r.push(o)):o.playIndex===s.playIndex&&(n=o,r.push(o)));if(this.channelInit(e).perNotePitchWheel.delete(t),!!s)for(const o of r)o!==s&&o!==n&&(o.playIndex!==s.playIndex||o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=We.Release)||o.end(this.outSampleRate)}channelNoteOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const r of this._voices)r.playingPreset!==-1&&r.playingChannel===e&&r.ampEnv.segment<We.Release&&r.end(this.outSampleRate)}channelSoundsOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(let r of this._voices)r.playingPreset!==-1&&r.playingChannel===e&&(r.ampEnv.segment<We.Release||r.ampEnv.parameters.release===0)&&r.endQuick(this.outSampleRate)}channelSetPresetIndex(e,t){this.channelInit(e).presetIndex=de.int32ToUint16(t)}channelSetPresetNumber(e,t,r=!1){const s=this.channelInit(e);let n=0;return r?(n=this.getPresetIndex(128|s.bank&32767,t),n===-1&&(n=this.getPresetIndex(128,t)),n===-1&&(n=this.getPresetIndex(128,0)),n===-1&&(n=this.getPresetIndex(s.bank&2047,t))):n=this.getPresetIndex(s.bank&2047,t),s.presetIndex=n,n!==-1}channelSetBank(e,t){this.channelInit(e).bank=de.int32ToUint16(t)}channelSetBankPreset(e,t,r){const s=this.channelInit(e),n=this.getPresetIndex(t,r);return n===-1?!1:(s.presetIndex=de.int32ToUint16(n),s.bank=de.int32ToUint16(t),!0)}channelSetPan(e,t){for(const r of this._voices)if(r.playingChannel===e&&r.playingPreset!==-1){let s=r.region.pan+t-.5;s<=-.5?(r.panFactorLeft=1,r.panFactorRight=0):s>=.5?(r.panFactorLeft=0,r.panFactorRight=1):(r.panFactorLeft=Math.sqrt(.5-s),r.panFactorRight=Math.sqrt(.5+s))}this.channelInit(e).panOffset=t-.5}channelSetVolume(e,t){const r=this.channelInit(e),s=mt.gainToDecibels(t),n=s-r.gainDb;if(n!==0){for(const a of this._voices)a.playingChannel===e&&a.playingPreset!==-1&&(a.noteGainDb+=n);r.gainDb=s}}channelSetPitchWheel(e,t){const r=this.channelInit(e);r.pitchWheel!==t&&(r.pitchWheel=de.int32ToUint16(t),this.channelApplyPitch(e,r))}channelSetPerNotePitchWheel(e,t,r){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e));const s=this.channelInit(e);s.perNotePitchWheel.has(t)&&s.perNotePitchWheel.get(t)===r||(s.perNotePitchWheel.set(t,r),this.channelApplyPitch(e,s,t))}channelApplyPitch(e,t,r=-1){for(const s of this._voices)s.playingChannel===e&&s.playingPreset!==-1&&(r==-1||s.playingKey===r)&&s.updatePitchRatio(t,this.outSampleRate)}channelSetPitchRange(e,t){const r=this.channelInit(e);r.pitchRange!==t&&(r.pitchRange=t,r.pitchWheel!==8192&&this.channelApplyPitch(e,r))}channelSetTuning(e,t){const r=this.channelInit(e);r.tuning!==t&&(r.tuning=t,this.channelApplyPitch(e,r))}channelMidiControl(e,t,r){let s=this.channelInit(e);switch(t){case Ae.DataEntryFine:s.midiData=de.int32ToUint16(s.midiData&16256|r),s.midiRpn===0?this.channelSetPitchRange(e,(s.midiData>>7)+.01*(s.midiData&127)):s.midiRpn===1?this.channelSetTuning(e,(s.tuning|0)+(s.midiData-8192)/8192):s.midiRpn===2&&this.channelSetTuning(e,r-64+(s.tuning-(s.tuning|0)));return;case Ae.VolumeCoarse:s.midiVolume=de.int32ToUint16(s.midiVolume&127|r<<7),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case Ae.VolumeFine:s.midiVolume=de.int32ToUint16(s.midiVolume&16256|r),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case Ae.ExpressionControllerCoarse:s.midiExpression=de.int32ToUint16(s.midiExpression&127|r<<7),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case Ae.ExpressionControllerFine:s.midiExpression=de.int32ToUint16(s.midiExpression&16256|r),this.channelSetVolume(e,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));return;case Ae.PanCoarse:s.midiPan=de.int32ToUint16(s.midiPan&127|r<<7),this.channelSetPan(e,s.midiPan/16383);return;case Ae.PanFine:s.midiPan=de.int32ToUint16(s.midiPan&16256|r),this.channelSetPan(e,s.midiPan/16383);return;case Ae.DataEntryCoarse:s.midiData=de.int32ToUint16(s.midiData&127|r<<7),s.midiRpn===0?this.channelSetPitchRange(e,(s.midiData>>7)+.01*(s.midiData&127)):s.midiRpn===1?this.channelSetTuning(e,(s.tuning|0)+(s.midiData-8192)/8192):s.midiRpn===2&&t===Ae.DataEntryCoarse&&this.channelSetTuning(e,r-64+(s.tuning-(s.tuning|0)));return;case Ae.BankSelectCoarse:s.bank=de.int32ToUint16(32768|r);return;case Ae.BankSelectFine:s.bank=de.int32ToUint16((s.bank&32768?(s.bank&127)<<7:0)|r);return;case Ae.RegisteredParameterCourse:s.midiRpn=de.int32ToUint16((s.midiRpn===65535?0:s.midiRpn)&127|r<<7);return;case Ae.RegisteredParameterFine:s.midiRpn=de.int32ToUint16((s.midiRpn===65535?0:s.midiRpn)&16256|r);return;case Ae.NonRegisteredParameterFine:s.midiRpn=65535;return;case Ae.NonRegisteredParameterCourse:s.midiRpn=65535;return;case Ae.AllSoundOff:this.channelSoundsOffAll(e);return;case Ae.AllNotesOff:this.channelNoteOffAll(e);return;case Ae.ResetControllers:s.midiVolume=16383,s.midiExpression=16383,s.midiPan=8192,s.bank=0,this.channelSetVolume(e,1),this.channelSetPan(e,.5),this.channelSetPitchRange(e,2);return}}channelGetPresetIndex(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].presetIndex:0}channelGetPresetBank(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].bank&32767:0}channelGetPan(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].panOffset-.5:.5}channelGetVolume(e){return this._channels&&e<this._channels.channelList.length?mt.decibelsToGain(this._channels.channelList[e].gainDb):1}channelGetPitchWheel(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchWheel:8192}channelGetPitchRange(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchRange:2}channelGetTuning(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].tuning:0}resetPresets(){this.presets=[]}loadPresets(e,t){const r=[];for(let s=0;s<e.phdrs.length-1;s++){const n=e.phdrs[s];let a=0;const o=new l4;r.push(o),o.name=n.presetName,o.bank=n.bank,o.presetNumber=n.preset,o.fontSamples=e.fontSamples;let l=0;for(let u=n.presetBagNdx;u<e.phdrs[s+1].presetBagNdx;u++){const c=e.pbags[u];let d=0,p=127,f=0,m=127;for(let S=c.genNdx;S<e.pbags[u+1].genNdx;S++){let y=e.pgens[S];if(y.genOper===zi.GenKeyRange){d=y.genAmount.lowByteAmount,p=y.genAmount.highByteAmount;continue}if(y.genOper===zi.GenVelRange){f=y.genAmount.lowByteAmount,m=y.genAmount.highByteAmount;continue}if(y.genOper!==zi.GenInstrument||y.genAmount.wordAmount>=e.insts.length)continue;let b=e.insts[y.genAmount.wordAmount];for(let w=b.instBagNdx;w<e.insts[y.genAmount.wordAmount+1].instBagNdx;w++){let x=e.ibags[w],v=0,C=127,P=0,N=127;for(let W=x.instGenNdx;W<e.ibags[w+1].instGenNdx;W++){let Y=e.igens[W];if(Y.genOper===zi.GenKeyRange){v=Y.genAmount.lowByteAmount,C=Y.genAmount.highByteAmount;continue}if(Y.genOper===zi.GenVelRange){P=Y.genAmount.lowByteAmount,N=Y.genAmount.highByteAmount;continue}Y.genOper===53&&C>=d&&v<=p&&N>=f&&P<=m&&l++}}}}o.regions=new Array(l);let h=new wa;h.clear(!0);for(let u=n.presetBagNdx;u<e.phdrs[s+1].presetBagNdx;u++){const c=e.pbags[u],d=new wa(h);let p=!1;for(let f=c.genNdx;f<e.pbags[u+1].genNdx;f++){const m=e.pgens[f];if(m.genOper===zi.GenInstrument){let S=m.genAmount.wordAmount;if(S>=e.insts.length)continue;let y=new wa;y.clear(!1);let b=e.insts[S];for(let w=b.instBagNdx;w<e.insts[S+1].instBagNdx;w++){let x=e.ibags[w],v=new wa(y),C=!1;for(let P=x.instGenNdx;P<e.ibags[w+1].instGenNdx;P++){let N=e.igens[P];if(N.genOper===zi.GenSampleId){if(v.hiKey<d.loKey||v.loKey>d.hiKey||v.hiVel<d.loVel||v.loVel>d.hiVel)continue;d.loKey>v.loKey&&(v.loKey=d.loKey),d.hiKey<v.hiKey&&(v.hiKey=d.hiKey),d.loVel>v.loVel&&(v.loVel=d.loVel),d.hiVel<v.hiVel&&(v.hiVel=d.hiVel),v.offset+=d.offset,v.end+=d.end,v.loopStart+=d.loopStart,v.loopEnd+=d.loopEnd,v.transpose+=d.transpose,v.tune+=d.tune,v.pitchKeyTrack+=d.pitchKeyTrack,v.attenuation+=d.attenuation,v.pan+=d.pan,v.ampEnv.delay+=d.ampEnv.delay,v.ampEnv.attack+=d.ampEnv.attack,v.ampEnv.hold+=d.ampEnv.hold,v.ampEnv.decay+=d.ampEnv.decay,v.ampEnv.sustain+=d.ampEnv.sustain,v.ampEnv.release+=d.ampEnv.release,v.modEnv.delay+=d.modEnv.delay,v.modEnv.attack+=d.modEnv.attack,v.modEnv.hold+=d.modEnv.hold,v.modEnv.decay+=d.modEnv.decay,v.modEnv.sustain+=d.modEnv.sustain,v.modEnv.release+=d.modEnv.release,v.initialFilterQ+=d.initialFilterQ,v.initialFilterFc+=d.initialFilterFc,v.modEnvToPitch+=d.modEnvToPitch,v.modEnvToFilterFc+=d.modEnvToFilterFc,v.delayModLFO+=d.delayModLFO,v.freqModLFO+=d.freqModLFO,v.modLfoToPitch+=d.modLfoToPitch,v.modLfoToFilterFc+=d.modLfoToFilterFc,v.modLfoToVolume+=d.modLfoToVolume,v.delayVibLFO+=d.delayVibLFO,v.freqVibLFO+=d.freqVibLFO,v.vibLfoToPitch+=d.vibLfoToPitch,v.ampEnv.envToSecs(!0),v.modEnv.envToSecs(!1),v.delayModLFO=v.delayModLFO<-11950?0:mt.timecents2Secs(v.delayModLFO),v.delayVibLFO=v.delayVibLFO<-11950?0:mt.timecents2Secs(v.delayVibLFO),v.pan<-.5?v.pan=-.5:v.pan>.5&&(v.pan=.5),(v.initialFilterQ<1500||v.initialFilterQ>13500)&&(v.initialFilterQ=0);let W=e.sHdrs[N.genAmount.wordAmount];v.offset+=W.start,v.end+=W.end,v.loopStart+=W.startLoop,v.loopEnd+=W.endLoop,W.endLoop>0&&(v.loopEnd-=1),v.pitchKeyCenter===-1&&(v.pitchKeyCenter=W.originalPitch),v.tune+=W.pitchCorrection,v.sampleRate=W.sampleRate,v.end!==0&&v.end<o.fontSamples.length?v.end++:v.end=o.fontSamples.length,o.regions[a]=new wa(v),a++,C=!0}else v.operator(N.genOper,N.genAmount)}x===e.ibags[b.instBagNdx]&&!C&&(y=new wa(v))}p=!0}else d.operator(m.genOper,m.genAmount)}c===e.pbags[n.presetBagNdx]&&!p&&(h=d)}}if(!t||!this.presets)this.presets=r;else for(const s of r)this.presets.push(s)}}class At{constructor(){this._listeners=[]}on(e){this._listeners.push(e)}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(){for(const e of this._listeners)e()}}class xe{constructor(){this._listeners=[]}on(e){this._listeners.push(e)}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(e){for(const t of this._listeners)t(e)}}class Wm{constructor(e){this.events=e}}class zm{constructor(e){this.playbackRange=e}}class Ix{get isReadyForPlayback(){return this.isReady&&this._isSoundFontLoaded&&this._isMidiLoaded}get logLevel(){return L.logLevel}set logLevel(e){L.logLevel=e}get masterVolume(){return this._synthesizer.masterVolume}set masterVolume(e){e=Math.max(e,ce.MinVolume),this._synthesizer.masterVolume=e}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,ce.MinVolume),this._metronomeVolume=e,this._synthesizer.metronomeVolume=e}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,ce.MinVolume),this._countInVolume=e}get midiEventsPlayedFilter(){return Array.from(this._midiEventsPlayedFilter)}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=new Set(e)}get playbackSpeed(){return this._sequencer.playbackSpeed}set playbackSpeed(e){e=mt.clamp(e,ce.MinPlaybackSpeed,ce.MaxPlaybackSpeed);let t=this._sequencer.playbackSpeed;this._sequencer.playbackSpeed=e,this.timePosition=this.timePosition*(t/e)}get tickPosition(){return this._tickPosition}set tickPosition(e){this.timePosition=this._sequencer.mainTickPositionToTimePosition(e)}get timePosition(){return this._timePosition}set timePosition(e){L.debug("AlphaSynth",`Seeking to position ${e}ms (main)`),this._sequencer.mainSeek(e),this.updateTimePosition(e,!0),this._sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this._sequencer.mainPlaybackRange}set playbackRange(e){this._sequencer.mainPlaybackRange=e,e&&(this.tickPosition=e.startTick),this.playbackRangeChanged.trigger(new zm(e))}get isLooping(){return this._sequencer.isLooping}set isLooping(e){this._sequencer.isLooping=e}destroy(){L.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(e,t){this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this._playedEventsQueue=new Xp,this._midiEventsPlayedFilter=new Set,this._notPlayedSamples=0,this.isReady=!1,this.state=Nt.Paused,this.ready=new At,this.readyForPlayback=new At,this.finished=new At,this.soundFontLoaded=new At,this.soundFontLoadFailed=new xe,this.midiLoaded=new xe,this.midiLoadFailed=new xe,this.stateChanged=new xe,this.positionChanged=new xe,this.midiEventsPlayed=new xe,this.playbackRangeChanged=new xe,L.debug("AlphaSynth","Initializing player"),this.state=Nt.Paused,L.debug("AlphaSynth","Creating output"),this.output=e,L.debug("AlphaSynth","Creating synthesizer"),this._synthesizer=new h4(this.output.sampleRate),this._sequencer=new n4(this._synthesizer),L.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this.checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{if(this.state==Nt.Playing&&!this._sequencer.isFinished){let r=new Float32Array(ce.MicroBufferSize*ce.MicroBufferCount*ce.AudioChannels),s=0;for(let n=0;n<ce.MicroBufferCount;n++){this._sequencer.fillMidiEventQueue();const a=this._synthesizer.synthesize(r,s,ce.MicroBufferSize);s+=ce.MicroBufferSize*ce.AudioChannels;for(const o of a)this._midiEventsPlayedFilter.has(o.event.type)&&this._playedEventsQueue.enqueue(o);if(this._sequencer.isFinished)break}s<r.length&&(r=r.subarray(0,s)),this._notPlayedSamples+=r.length,this.output.addSamples(r)}else{let r=new Float32Array(0);this.output.addSamples(r)}}),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),this.output.open(t)}play(){return this.state!==Nt.Paused||!this._isMidiLoaded?!1:(this.output.activate(),this.playInternal(),this._countInVolume>0&&(L.debug("AlphaSynth","Starting countin"),this._sequencer.startCountIn(),this._synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),!0)}playInternal(){this._sequencer.isPlayingOneTimeMidi&&(L.debug("AlphaSynth","Cancelling one time midi"),this.stopOneTimeMidi()),L.debug("AlphaSynth","Starting playback"),this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this.state=Nt.Playing,this.stateChanged.trigger(new Yo(this.state,!1))}pause(){this.state===Nt.Paused||!this._isMidiLoaded||(L.debug("AlphaSynth","Pausing playback"),this.state=Nt.Paused,this.stateChanged.trigger(new Yo(this.state,!1)),this.output.pause(),this._synthesizer.noteOffAll(!1))}playPause(){this.state!==Nt.Paused||!this._isMidiLoaded?this.pause():this.play()}stop(){this._isMidiLoaded&&(L.debug("AlphaSynth","Stopping playback"),this.state=Nt.Paused,this.output.pause(),this._notPlayedSamples=0,this._sequencer.stop(),this._synthesizer.noteOffAll(!0),this.tickPosition=this._sequencer.mainPlaybackRange?this._sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new Yo(this.state,!0)))}playOneTimeMidiFile(e){this._sequencer.isPlayingOneTimeMidi?this.stopOneTimeMidi():this.pause(),this._sequencer.loadOneTimeMidi(e),this._synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this._synthesizer.resetPresets(),this._isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}loadSoundFont(e,t){this.pause();let r=Gt.fromBuffer(e);try{L.debug("AlphaSynth","Loading soundfont from bytes");let s=new Hm;s.load(r),this._synthesizer.loadPresets(s,t),this._isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),L.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(s){L.error("AlphaSynth","Could not load soundfont from bytes "+s),this.soundFontLoadFailed.trigger(s)}}checkReadyForPlayback(){this.isReadyForPlayback&&(this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this.readyForPlayback.trigger())}loadMidiFile(e){this.stop();try{L.debug("AlphaSynth","Loading midi from model"),this._sequencer.loadMidi(e),this._isMidiLoaded=!0,this.midiLoaded.trigger(new xl(0,this._sequencer.currentEndTime,0,this._sequencer.currentEndTick,!1)),L.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(t){L.error("AlphaSynth","Could not load midi from model "+t),this.midiLoadFailed.trigger(t)}}applyTranspositionPitches(e){this._synthesizer.applyTranspositionPitches(e)}setChannelMute(e,t){this._synthesizer.channelSetMute(e,t)}resetChannelStates(){this._synthesizer.resetChannelStates()}setChannelSolo(e,t){this._synthesizer.channelSetSolo(e,t)}setChannelVolume(e,t){t=Math.max(t,ce.MinVolume),this._synthesizer.channelSetMixVolume(e,t)}onSamplesPlayed(e){if(e===0)return;let t=e/this._synthesizer.outSampleRate*1e3;this._notPlayedSamples-=e*ce.AudioChannels,this.updateTimePosition(this._timePosition+t,!1),this.checkForFinish()}checkForFinish(){let e=0,t=0;this.playbackRange&&this._sequencer.isPlayingMain?(e=this.playbackRange.startTick,t=this.playbackRange.endTick):t=this._sequencer.currentEndTick,this._tickPosition>=t&&this._notPlayedSamples<=0&&(this._notPlayedSamples=0,this._sequencer.isPlayingCountIn?(L.debug("AlphaSynth","Finished playback (count-in)"),this._sequencer.resetCountIn(),this.timePosition=this._sequencer.currentTime,this.playInternal(),this.output.resetSamples()):this._sequencer.isPlayingOneTimeMidi?(L.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=Nt.Paused,this.stopOneTimeMidi()):(L.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.isLooping?this.tickPosition=e:this.stop()))}stopOneTimeMidi(){this.output.pause(),this._synthesizer.noteOffAll(!0),this._sequencer.resetOneTimeMidi(),this.timePosition=this._sequencer.currentTime}updateTimePosition(e,t){const r=e;this._timePosition=r;const s=this._sequencer.currentTimePositionToTickPosition(r);this._tickPosition=s;const n=this._sequencer.currentEndTime,a=this._sequencer.currentEndTick,o=this._sequencer.isPlayingMain?"main":this._sequencer.isPlayingCountIn?"count-in":"one-time";if(L.debug("AlphaSynth",`Position changed: (time: ${r}/${n}, tick: ${s}/${a}, Active Voices: ${this._synthesizer.activeVoiceCount} (${o})`),this._sequencer.isPlayingMain&&this.positionChanged.trigger(new xl(r,n,s,a,t)),t)this._playedEventsQueue.clear();else{const l=new Xp;for(;!this._playedEventsQueue.isEmpty&&this._playedEventsQueue.peek().time<r;){const h=this._playedEventsQueue.dequeue();l.enqueue(h.event)}l.isEmpty||this.midiEventsPlayed.trigger(new Wm(l.toArray()))}}}class H{static parseEnum(e,t){switch(typeof e){case"string":const r=parseInt(e);return isNaN(r)?t[Object.keys(t).find(s=>s.toLowerCase()===e.toLowerCase())]:r;case"number":return e;case"undefined":case"object":return null}throw new Yt(Ut.Format,`Could not parse enum value '${e}'`)}static forEach(e,t){if(e instanceof Map)e.forEach(t);else if(typeof e=="object")for(const r in e)t(e[r],r)}static getValue(e,t){return e instanceof Map?e.get(t):typeof e=="object"?e[t]:null}}class u4{constructor(e,t,r){this.text=e,this.startPos=t,this.endPos=r}}class Ra{constructor(e){this.style="normal",this.variant="normal",this.weight="normal",this.stretch="normal",this.lineHeight="normal",this.size="1rem",this.families=[],this.parseOnlyFamilies=!1,this._currentTokenIndex=-1,this._input="",this._currentToken=null,this._input=e,this._tokens=this.splitToTokens(e)}splitToTokens(e){const t=[];let r=0;for(;r<e.length;){let s=r;for(;s<e.length&&e.charAt(s)!==" ";)s++;s>r&&t.push(new u4(e.substring(r,s),r,s)),r=s+1}return t}parse(){var e;if(this.reset(),this._tokens.length===1)switch((e=this._currentToken)==null?void 0:e.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this.fontStyleVariantWeight(),this.fontSizeLineHeight()),this.fontFamily()}static parseFamilies(e){const t=new Ra(e);return t.parseOnlyFamilies=!0,t.parse(),t.families}fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const e=this._input.substr(this._currentToken.startPos).trim();let t=0;for(;t<e.length;){let r=e.charAt(t);if(r===" "||r==",")t++;else if(r==='"'||r==="'"){const s=this.findEndOfQuote(e,t+1,r);this.families.push(e.substring(t+1,s).split("\\"+r).join(r)),t=s+1}else{const s=this.findEndOfQuote(e,t+1,",");this.families.push(e.substring(t,s).trim()),t=s+1}}}findEndOfQuote(e,t,r){let s=!1;for(;t<e.length;){const n=e.charAt(t);if(!s&&n===r)return t;!s&&n==="\\"?s=!0:s=!1,t+=1}return e.length}fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const e=this._currentToken.text.split("/");if(e.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this.nextToken(),e.length>=2)if(e[1]==="/"){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.size=e[0],this.lineHeight=e[1];else if(e.length>=1){if(this.size=e[0],this._currentToken&&this._currentToken.text.indexOf("/")===0)if(this._currentToken.text==="/"){if(this.nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this.nextToken()}else throw new Error("Missing font size")}nextToken(){this._currentTokenIndex++,this._currentTokenIndex<this._tokens.length?this._currentToken=this._tokens[this._currentTokenIndex]:this._currentToken=null}fontStyleVariantWeight(){let e=!1,t=!1,r=!1,s=3,n=[];for(;;){if(!this._currentToken)return;let a=this._currentToken.text;switch(a){case"normal":case"inherit":n.push(a),s--,this.nextToken();break;case"italic":case"oblique":this.style=a,e=!0,s--,this.nextToken();break;case"small-caps":this.variant=a,t=!0,s--,this.nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=a,r=!0,s--,this.nextToken();break;default:return}if(s===0)break}for(;n.length>0;){const a=n.pop();r?t?e||(this.style=a):this.variant=a:this.weight=a}}reset(){this._currentTokenIndex=-1,this.nextToken()}static quoteFont(e){return e.indexOf(" ")===-1?e:`"${e.replaceAll('"','\\"')}"`}}var lt;(function(i){i[i.Plain=0]="Plain",i[i.Italic=1]="Italic"})(lt||(lt={}));var Yi;(function(i){i[i.Regular=0]="Regular",i[i.Bold=1]="Bold"})(Yi||(Yi={}));class Ce{reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(e){this.families=Ra.parseFamilies(e)}get families(){return this._families}set families(e){this._families=e,this.reset()}get size(){return this._size}set size(e){this._size=e,this.reset()}get style(){return this._style}set style(e){this._style=e,this.reset()}get weight(){return this._weight}set weight(e){this._weight=e,this.reset()}get isBold(){return this.weight===Yi.Bold}get isItalic(){return this.style===lt.Italic}constructor(e,t,r=lt.Plain,s=Yi.Regular){this._cssScale=0,this._families=Ra.parseFamilies(e),this._size=t,this._style=r,this._weight=s,this._css=this.toCssString()}static withFamilyList(e,t,r=lt.Plain,s=Yi.Regular){const n=new Ce("",t,r,s);return n.families=e,n}toCssString(e=1){if(!this._css||!(Math.abs(e-this._cssScale)<.01)){let t="";this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+=this.size*e,t+="px ",t+=this.families.map(r=>Ra.quoteFont(r)).join(", "),this._css=t,this._cssScale=e}return this._css}static fromJson(e){if(e instanceof Ce)return e;switch(typeof e){case"undefined":return null;case"object":{const t=e;let r=t.get("families"),s=t.get("size"),n=H.parseEnum(t.get("style"),lt),a=H.parseEnum(t.get("weight"),Yi);return Ce.withFamilyList(r,s,n,a)}case"string":{const t=new Ra(e);t.parse();let r=t.families,s=t.size.toLowerCase(),n=0;switch(s){case"xx-small":n=7;break;case"x-small":n=10;break;case"small":case"smaller":n=13;break;case"medium":n=16;break;case"large":case"larger":n=18;break;case"x-large":n=24;break;case"xx-large":n=32;break;default:try{s.endsWith("em")?n=parseFloat(s.substr(0,s.length-2))*16:s.endsWith("pt")?n=parseFloat(s.substr(0,s.length-2))*16/12:s.endsWith("px")?n=parseFloat(s.substr(0,s.length-2)):n=12}catch{n=12}break}let a=lt.Plain;t.style==="italic"&&(a=lt.Italic);let o=Yi.Regular;switch(t.weight.toLowerCase()){case"normal":case"lighter":break;default:o=Yi.Bold;break}return Ce.withFamilyList(r,n,a,o)}default:return null}}static toJson(e){const t=new Map;return t.set("families",e.families),t.set("size",e.size),t.set("style",e.style),t.set("weight",e.weight),t}}class Mi{constructor(){this.copyrightFont=new Ce(Mi.sansFont,12,lt.Plain,Yi.Bold),this.titleFont=new Ce(Mi.serifFont,32,lt.Plain),this.subTitleFont=new Ce(Mi.serifFont,20,lt.Plain),this.wordsFont=new Ce(Mi.serifFont,15,lt.Plain),this.effectFont=new Ce(Mi.serifFont,12,lt.Italic),this.fretboardNumberFont=new Ce(Mi.sansFont,11,lt.Plain),this.tablatureFont=new Ce(Mi.sansFont,13,lt.Plain),this.graceFont=new Ce(Mi.sansFont,11,lt.Plain),this.staffLineColor=new Oe(165,165,165,255),this.barSeparatorColor=new Oe(34,34,17,255),this.barNumberFont=new Ce(Mi.sansFont,11,lt.Plain),this.barNumberColor=new Oe(200,0,0,255),this.fingeringFont=new Ce(Mi.serifFont,14,lt.Plain),this.markerFont=new Ce(Mi.serifFont,14,lt.Plain,Yi.Bold),this.mainGlyphColor=new Oe(0,0,0,255),this.secondaryGlyphColor=new Oe(0,0,0,100),this.scoreInfoColor=new Oe(0,0,0,255)}}Mi.sansFont="Arial, sans-serif";Mi.serifFont="Georgia, serif";var kn;(function(i){i[i.Automatic=0]="Automatic",i[i.UseModelLayout=1]="UseModelLayout"})(kn||(kn={}));class c4{constructor(){this.scale=1,this.stretchForce=1,this.layoutMode=Es.Page,this.staveProfile=Ui.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.justifyLastSystem=!1,this.resources=new Mi,this.padding=[35,35],this.firstSystemPaddingTop=5,this.systemPaddingTop=10,this.systemPaddingBottom=20,this.lastSystemPaddingBottom=0,this.systemLabelPaddingLeft=0,this.systemLabelPaddingRight=5,this.accoladeBarPaddingRight=3,this.notationStaffPaddingTop=5,this.notationStaffPaddingBottom=5,this.effectStaffPaddingTop=0,this.effectStaffPaddingBottom=0,this.systemsLayoutMode=kn.Automatic}}class d4{constructor(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1,this.beatTextAsLyrics=!1}}var vs;(function(i){i[i.Off=0]="Off",i[i.Continuous=1]="Continuous",i[i.OffScreen=2]="OffScreen"})(vs||(vs={}));class f4{constructor(){this.noteWideLength=480,this.noteWideAmplitude=2,this.noteSlightLength=480,this.noteSlightAmplitude=2,this.beatWideLength=240,this.beatWideAmplitude=3,this.beatSlightLength=240,this.beatSlightAmplitude=3}}class p4{constructor(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}}var Tl;(function(i){i[i.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",i[i.WebAudioScriptProcessor=1]="WebAudioScriptProcessor"})(Tl||(Tl={}));class g4{constructor(){this.soundFont=null,this.scrollElement="html,body",this.outputMode=Tl.WebAudioAudioWorklets,this.enablePlayer=!1,this.enableCursor=!0,this.enableAnimatedBeatCursor=!0,this.enableElementHighlighting=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=vs.Continuous,this.scrollSpeed=300,this.nativeBrowserSmoothScroll=!0,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new f4,this.slide=new p4,this.playTripletFeel=!0,this.bufferTimeInMilliseconds=500}}class Jd{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scriptfile",e.scriptFile),t.set("fontdirectory",e.fontDirectory),t.set("file",e.file),t.set("tex",e.tex),t.set("tracks",e.tracks),t.set("enablelazyloading",e.enableLazyLoading),t.set("engine",e.engine),t.set("loglevel",e.logLevel),t.set("useworkers",e.useWorkers),t.set("includenotebounds",e.includeNoteBounds),t}static setProperty(e,t,r){switch(t){case"scriptfile":return e.scriptFile=r,!0;case"fontdirectory":return e.fontDirectory=r,!0;case"file":return e.file=r,!0;case"tex":return e.tex=r,!0;case"tracks":return e.tracks=r,!0;case"enablelazyloading":return e.enableLazyLoading=r,!0;case"engine":return e.engine=r,!0;case"loglevel":return e.logLevel=H.parseEnum(r,Hr),!0;case"useworkers":return e.useWorkers=r,!0;case"includenotebounds":return e.includeNoteBounds=r,!0}return!1}}class Zd{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("copyrightfont",Ce.toJson(e.copyrightFont)),t.set("titlefont",Ce.toJson(e.titleFont)),t.set("subtitlefont",Ce.toJson(e.subTitleFont)),t.set("wordsfont",Ce.toJson(e.wordsFont)),t.set("effectfont",Ce.toJson(e.effectFont)),t.set("fretboardnumberfont",Ce.toJson(e.fretboardNumberFont)),t.set("tablaturefont",Ce.toJson(e.tablatureFont)),t.set("gracefont",Ce.toJson(e.graceFont)),t.set("stafflinecolor",Oe.toJson(e.staffLineColor)),t.set("barseparatorcolor",Oe.toJson(e.barSeparatorColor)),t.set("barnumberfont",Ce.toJson(e.barNumberFont)),t.set("barnumbercolor",Oe.toJson(e.barNumberColor)),t.set("fingeringfont",Ce.toJson(e.fingeringFont)),t.set("markerfont",Ce.toJson(e.markerFont)),t.set("mainglyphcolor",Oe.toJson(e.mainGlyphColor)),t.set("secondaryglyphcolor",Oe.toJson(e.secondaryGlyphColor)),t.set("scoreinfocolor",Oe.toJson(e.scoreInfoColor)),t}static setProperty(e,t,r){switch(t){case"copyrightfont":return e.copyrightFont=Ce.fromJson(r),!0;case"titlefont":return e.titleFont=Ce.fromJson(r),!0;case"subtitlefont":return e.subTitleFont=Ce.fromJson(r),!0;case"wordsfont":return e.wordsFont=Ce.fromJson(r),!0;case"effectfont":return e.effectFont=Ce.fromJson(r),!0;case"fretboardnumberfont":return e.fretboardNumberFont=Ce.fromJson(r),!0;case"tablaturefont":return e.tablatureFont=Ce.fromJson(r),!0;case"gracefont":return e.graceFont=Ce.fromJson(r),!0;case"stafflinecolor":return e.staffLineColor=Oe.fromJson(r),!0;case"barseparatorcolor":return e.barSeparatorColor=Oe.fromJson(r),!0;case"barnumberfont":return e.barNumberFont=Ce.fromJson(r),!0;case"barnumbercolor":return e.barNumberColor=Oe.fromJson(r),!0;case"fingeringfont":return e.fingeringFont=Ce.fromJson(r),!0;case"markerfont":return e.markerFont=Ce.fromJson(r),!0;case"mainglyphcolor":return e.mainGlyphColor=Oe.fromJson(r),!0;case"secondaryglyphcolor":return e.secondaryGlyphColor=Oe.fromJson(r),!0;case"scoreinfocolor":return e.scoreInfoColor=Oe.fromJson(r),!0}return!1}}class ef{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scale",e.scale),t.set("stretchforce",e.stretchForce),t.set("layoutmode",e.layoutMode),t.set("staveprofile",e.staveProfile),t.set("barsperrow",e.barsPerRow),t.set("startbar",e.startBar),t.set("barcount",e.barCount),t.set("barcountperpartial",e.barCountPerPartial),t.set("justifylastsystem",e.justifyLastSystem),t.set("resources",Zd.toJson(e.resources)),t.set("padding",e.padding),t.set("firstsystempaddingtop",e.firstSystemPaddingTop),t.set("systempaddingtop",e.systemPaddingTop),t.set("systempaddingbottom",e.systemPaddingBottom),t.set("lastsystempaddingbottom",e.lastSystemPaddingBottom),t.set("systemlabelpaddingleft",e.systemLabelPaddingLeft),t.set("systemlabelpaddingright",e.systemLabelPaddingRight),t.set("accoladebarpaddingright",e.accoladeBarPaddingRight),t.set("notationstaffpaddingtop",e.notationStaffPaddingTop),t.set("notationstaffpaddingbottom",e.notationStaffPaddingBottom),t.set("effectstaffpaddingtop",e.effectStaffPaddingTop),t.set("effectstaffpaddingbottom",e.effectStaffPaddingBottom),t.set("systemslayoutmode",e.systemsLayoutMode),t}static setProperty(e,t,r){switch(t){case"scale":return e.scale=r,!0;case"stretchforce":return e.stretchForce=r,!0;case"layoutmode":return e.layoutMode=H.parseEnum(r,Es),!0;case"staveprofile":return e.staveProfile=H.parseEnum(r,Ui),!0;case"barsperrow":return e.barsPerRow=r,!0;case"startbar":return e.startBar=r,!0;case"barcount":return e.barCount=r,!0;case"barcountperpartial":return e.barCountPerPartial=r,!0;case"justifylastsystem":return e.justifyLastSystem=r,!0;case"padding":return e.padding=r,!0;case"firstsystempaddingtop":return e.firstSystemPaddingTop=r,!0;case"systempaddingtop":return e.systemPaddingTop=r,!0;case"systempaddingbottom":return e.systemPaddingBottom=r,!0;case"lastsystempaddingbottom":return e.lastSystemPaddingBottom=r,!0;case"systemlabelpaddingleft":return e.systemLabelPaddingLeft=r,!0;case"systemlabelpaddingright":return e.systemLabelPaddingRight=r,!0;case"accoladebarpaddingright":return e.accoladeBarPaddingRight=r,!0;case"notationstaffpaddingtop":return e.notationStaffPaddingTop=r,!0;case"notationstaffpaddingbottom":return e.notationStaffPaddingBottom=r,!0;case"effectstaffpaddingtop":return e.effectStaffPaddingTop=r,!0;case"effectstaffpaddingbottom":return e.effectStaffPaddingBottom=r,!0;case"systemslayoutmode":return e.systemsLayoutMode=H.parseEnum(r,kn),!0}if(["resources"].indexOf(t)>=0)return Zd.fromJson(e.resources,r),!0;for(const s of["resources"])if(t.indexOf(s)===0&&Zd.setProperty(e.resources,t.substring(s.length),r))return!0;return!1}}class tf{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;t.set("notationmode",e.notationMode),t.set("fingeringmode",e.fingeringMode);{const r=new Map;t.set("elements",r);for(const[s,n]of e.elements)r.set(s.toString(),n)}return t.set("rhythmmode",e.rhythmMode),t.set("rhythmheight",e.rhythmHeight),t.set("transpositionpitches",e.transpositionPitches),t.set("displaytranspositionpitches",e.displayTranspositionPitches),t.set("smallgracetabnotes",e.smallGraceTabNotes),t.set("extendbendarrowsontiednotes",e.extendBendArrowsOnTiedNotes),t.set("extendlineeffectstobeatend",e.extendLineEffectsToBeatEnd),t.set("slurheight",e.slurHeight),t}static setProperty(e,t,r){switch(t){case"notationmode":return e.notationMode=H.parseEnum(r,Ot),!0;case"fingeringmode":return e.fingeringMode=H.parseEnum(r,jr),!0;case"elements":return e.elements=new Map,H.forEach(r,(s,n)=>{e.elements.set(H.parseEnum(n,te),s)}),!0;case"rhythmmode":return e.rhythmMode=H.parseEnum(r,_s),!0;case"rhythmheight":return e.rhythmHeight=r,!0;case"transpositionpitches":return e.transpositionPitches=r,!0;case"displaytranspositionpitches":return e.displayTranspositionPitches=r,!0;case"smallgracetabnotes":return e.smallGraceTabNotes=r,!0;case"extendbendarrowsontiednotes":return e.extendBendArrowsOnTiedNotes=r,!0;case"extendlineeffectstobeatend":return e.extendLineEffectsToBeatEnd=r,!0;case"slurheight":return e.slurHeight=r,!0}return!1}}class rf{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("encoding",e.encoding),t.set("mergepartgroupsinmusicxml",e.mergePartGroupsInMusicXml),t.set("beattextaslyrics",e.beatTextAsLyrics),t}static setProperty(e,t,r){switch(t){case"encoding":return e.encoding=r,!0;case"mergepartgroupsinmusicxml":return e.mergePartGroupsInMusicXml=r,!0;case"beattextaslyrics":return e.beatTextAsLyrics=r,!0}return!1}}class sf{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("notewidelength",e.noteWideLength),t.set("notewideamplitude",e.noteWideAmplitude),t.set("noteslightlength",e.noteSlightLength),t.set("noteslightamplitude",e.noteSlightAmplitude),t.set("beatwidelength",e.beatWideLength),t.set("beatwideamplitude",e.beatWideAmplitude),t.set("beatslightlength",e.beatSlightLength),t.set("beatslightamplitude",e.beatSlightAmplitude),t}static setProperty(e,t,r){switch(t){case"notewidelength":return e.noteWideLength=r,!0;case"notewideamplitude":return e.noteWideAmplitude=r,!0;case"noteslightlength":return e.noteSlightLength=r,!0;case"noteslightamplitude":return e.noteSlightAmplitude=r,!0;case"beatwidelength":return e.beatWideLength=r,!0;case"beatwideamplitude":return e.beatWideAmplitude=r,!0;case"beatslightlength":return e.beatSlightLength=r,!0;case"beatslightamplitude":return e.beatSlightAmplitude=r,!0}return!1}}class nf{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("simpleslidepitchoffset",e.simpleSlidePitchOffset),t.set("simpleslidedurationratio",e.simpleSlideDurationRatio),t.set("shiftslidedurationratio",e.shiftSlideDurationRatio),t}static setProperty(e,t,r){switch(t){case"simpleslidepitchoffset":return e.simpleSlidePitchOffset=r,!0;case"simpleslidedurationratio":return e.simpleSlideDurationRatio=r,!0;case"shiftslidedurationratio":return e.shiftSlideDurationRatio=r,!0}return!1}}class af{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("soundfont",e.soundFont),t.set("outputmode",e.outputMode),t.set("enableplayer",e.enablePlayer),t.set("enablecursor",e.enableCursor),t.set("enableanimatedbeatcursor",e.enableAnimatedBeatCursor),t.set("enableelementhighlighting",e.enableElementHighlighting),t.set("enableuserinteraction",e.enableUserInteraction),t.set("scrolloffsetx",e.scrollOffsetX),t.set("scrolloffsety",e.scrollOffsetY),t.set("scrollmode",e.scrollMode),t.set("scrollspeed",e.scrollSpeed),t.set("nativebrowsersmoothscroll",e.nativeBrowserSmoothScroll),t.set("songbookbendduration",e.songBookBendDuration),t.set("songbookdipduration",e.songBookDipDuration),t.set("vibrato",sf.toJson(e.vibrato)),t.set("slide",nf.toJson(e.slide)),t.set("playtripletfeel",e.playTripletFeel),t.set("buffertimeinmilliseconds",e.bufferTimeInMilliseconds),t}static setProperty(e,t,r){switch(t){case"soundfont":return e.soundFont=r,!0;case"scrollelement":return e.scrollElement=r,!0;case"outputmode":return e.outputMode=H.parseEnum(r,Tl),!0;case"enableplayer":return e.enablePlayer=r,!0;case"enablecursor":return e.enableCursor=r,!0;case"enableanimatedbeatcursor":return e.enableAnimatedBeatCursor=r,!0;case"enableelementhighlighting":return e.enableElementHighlighting=r,!0;case"enableuserinteraction":return e.enableUserInteraction=r,!0;case"scrolloffsetx":return e.scrollOffsetX=r,!0;case"scrolloffsety":return e.scrollOffsetY=r,!0;case"scrollmode":return e.scrollMode=H.parseEnum(r,vs),!0;case"scrollspeed":return e.scrollSpeed=r,!0;case"nativebrowsersmoothscroll":return e.nativeBrowserSmoothScroll=r,!0;case"songbookbendduration":return e.songBookBendDuration=r,!0;case"songbookdipduration":return e.songBookDipDuration=r,!0;case"playtripletfeel":return e.playTripletFeel=r,!0;case"buffertimeinmilliseconds":return e.bufferTimeInMilliseconds=r,!0}if(["vibrato"].indexOf(t)>=0)return sf.fromJson(e.vibrato,r),!0;for(const s of["vibrato"])if(t.indexOf(s)===0&&sf.setProperty(e.vibrato,t.substring(s.length),r))return!0;if(["slide"].indexOf(t)>=0)return nf.fromJson(e.slide,r),!0;for(const s of["slide"])if(t.indexOf(s)===0&&nf.setProperty(e.slide,t.substring(s.length),r))return!0;return!1}}class io{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s.toLowerCase(),r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("core",Jd.toJson(e.core)),t.set("display",ef.toJson(e.display)),t.set("notation",tf.toJson(e.notation)),t.set("importer",rf.toJson(e.importer)),t.set("player",af.toJson(e.player)),t}static setProperty(e,t,r){if(["core",""].indexOf(t)>=0)return Jd.fromJson(e.core,r),!0;for(const s of["core",""])if(t.indexOf(s)===0&&Jd.setProperty(e.core,t.substring(s.length),r))return!0;if(["display",""].indexOf(t)>=0)return ef.fromJson(e.display,r),!0;for(const s of["display",""])if(t.indexOf(s)===0&&ef.setProperty(e.display,t.substring(s.length),r))return!0;if(["notation"].indexOf(t)>=0)return tf.fromJson(e.notation,r),!0;for(const s of["notation"])if(t.indexOf(s)===0&&tf.setProperty(e.notation,t.substring(s.length),r))return!0;if(["importer"].indexOf(t)>=0)return rf.fromJson(e.importer,r),!0;for(const s of["importer"])if(t.indexOf(s)===0&&rf.setProperty(e.importer,t.substring(s.length),r))return!0;if(["player"].indexOf(t)>=0)return af.fromJson(e.player,r),!0;for(const s of["player"])if(t.indexOf(s)===0&&af.setProperty(e.player,t.substring(s.length),r))return!0;return!1}}class ia{constructor(){this.core=new Zx,this.display=new c4,this.notation=new Sl,this.importer=new d4,this.player=new g4}setSongBookModeSettings(){this.notation.notationMode=Ot.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=jr.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(te.ParenthesisOnTiedBends,!1),this.notation.elements.set(te.TabNotesOnTiedBends,!1),this.notation.elements.set(te.ZerosOnDiveWhammys,!0)}static get songBook(){let e=new ia;return e.setSongBookModeSettings(),e}fillFromJson(e){io.fromJson(this,e)}}class O1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("marker",e.marker),t.set("text",e.text),t}static setProperty(e,t,r){switch(t){case"marker":return e.marker=r,!0;case"text":return e.text=r,!0}return!1}}class ju{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("islinear",e.isLinear),t.set("type",e.type),t.set("value",e.value),t.set("ratioposition",e.ratioPosition),t.set("text",e.text),t}static setProperty(e,t,r){switch(t){case"islinear":return e.isLinear=r,!0;case"type":return e.type=H.parseEnum(r,Dt),!0;case"value":return e.value=r,!0;case"ratioposition":return e.ratioPosition=r,!0;case"text":return e.text=r,!0}return!1}}class D1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("type",e.type),t.set("length",e.length),t}static setProperty(e,t,r){switch(t){case"type":return e.type=H.parseEnum(r,Yr),!0;case"length":return e.length=r,!0}return!1}}class A1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("alternateendings",e.alternateEndings),t.set("keysignature",e.keySignature),t.set("keysignaturetype",e.keySignatureType),t.set("isdoublebar",e.isDoubleBar),t.set("isrepeatstart",e.isRepeatStart),t.set("repeatcount",e.repeatCount),t.set("timesignaturenumerator",e.timeSignatureNumerator),t.set("timesignaturedenominator",e.timeSignatureDenominator),t.set("timesignaturecommon",e.timeSignatureCommon),t.set("tripletfeel",e.tripletFeel),t.set("section",O1.toJson(e.section)),t.set("tempoautomation",ju.toJson(e.tempoAutomation)),e.fermata!==null){const r=new Map;t.set("fermata",r);for(const[s,n]of e.fermata)r.set(s.toString(),D1.toJson(n))}return t.set("start",e.start),t.set("isanacrusis",e.isAnacrusis),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t}static setProperty(e,t,r){switch(t){case"alternateendings":return e.alternateEndings=r,!0;case"keysignature":return e.keySignature=H.parseEnum(r,Rt),!0;case"keysignaturetype":return e.keySignatureType=H.parseEnum(r,vn),!0;case"isdoublebar":return e.isDoubleBar=r,!0;case"isrepeatstart":return e.isRepeatStart=r,!0;case"repeatcount":return e.repeatCount=r,!0;case"timesignaturenumerator":return e.timeSignatureNumerator=r,!0;case"timesignaturedenominator":return e.timeSignatureDenominator=r,!0;case"timesignaturecommon":return e.timeSignatureCommon=r,!0;case"tripletfeel":return e.tripletFeel=H.parseEnum(r,fe),!0;case"fermata":return e.fermata=new Map,H.forEach(r,(s,n)=>{const a=new Im;D1.fromJson(a,s),e.addFermata(parseInt(n),a)}),!0;case"start":return e.start=r,!0;case"isanacrusis":return e.isAnacrusis=r,!0;case"displayscale":return e.displayScale=r,!0;case"displaywidth":return e.displayWidth=r,!0}return["section"].indexOf(t)>=0?(r?(e.section=new Zc,O1.fromJson(e.section,r)):e.section=null,!0):["tempoautomation"].indexOf(t)>=0?(r?(e.tempoAutomation=new ii,ju.fromJson(e.tempoAutomation,r)):e.tempoAutomation=null,!0):!1}}class qu{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("offset",e.offset),t.set("value",e.value),t}static setProperty(e,t,r){switch(t){case"offset":return e.offset=r,!0;case"value":return e.value=r,!0}return!1}}class V1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){var r;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("accentuated",e.accentuated),t.set("bendtype",e.bendType),t.set("bendstyle",e.bendStyle),t.set("iscontinuedbend",e.isContinuedBend),e.bendPoints!==null&&t.set("bendpoints",(r=e.bendPoints)==null?void 0:r.map(s=>qu.toJson(s))),t.set("fret",e.fret),t.set("string",e.string),t.set("octave",e.octave),t.set("tone",e.tone),t.set("percussionarticulation",e.percussionArticulation),t.set("isvisible",e.isVisible),t.set("islefthandtapped",e.isLeftHandTapped),t.set("ishammerpullorigin",e.isHammerPullOrigin),t.set("isslurdestination",e.isSlurDestination),t.set("harmonictype",e.harmonicType),t.set("harmonicvalue",e.harmonicValue),t.set("isghost",e.isGhost),t.set("isletring",e.isLetRing),t.set("ispalmmute",e.isPalmMute),t.set("isdead",e.isDead),t.set("isstaccato",e.isStaccato),t.set("slideintype",e.slideInType),t.set("slideouttype",e.slideOutType),t.set("vibrato",e.vibrato),t.set("istiedestination",e.isTieDestination),t.set("lefthandfinger",e.leftHandFinger),t.set("righthandfinger",e.rightHandFinger),t.set("isfingering",e.isFingering),t.set("trillvalue",e.trillValue),t.set("trillspeed",e.trillSpeed),t.set("durationpercent",e.durationPercent),t.set("accidentalmode",e.accidentalMode),t.set("dynamics",e.dynamics),e.toJson(t),t}static setProperty(e,t,r){switch(t){case"id":return e.id=r,!0;case"accentuated":return e.accentuated=H.parseEnum(r,Et),!0;case"bendtype":return e.bendType=H.parseEnum(r,X),!0;case"bendstyle":return e.bendStyle=H.parseEnum(r,De),!0;case"iscontinuedbend":return e.isContinuedBend=r,!0;case"bendpoints":if(r){e.bendPoints=[];for(const s of r){const n=new V;qu.fromJson(n,s),e.addBendPoint(n)}}return!0;case"fret":return e.fret=r,!0;case"string":return e.string=r,!0;case"octave":return e.octave=r,!0;case"tone":return e.tone=r,!0;case"percussionarticulation":return e.percussionArticulation=r,!0;case"isvisible":return e.isVisible=r,!0;case"islefthandtapped":return e.isLeftHandTapped=r,!0;case"ishammerpullorigin":return e.isHammerPullOrigin=r,!0;case"isslurdestination":return e.isSlurDestination=r,!0;case"harmonictype":return e.harmonicType=H.parseEnum(r,q),!0;case"harmonicvalue":return e.harmonicValue=r,!0;case"isghost":return e.isGhost=r,!0;case"isletring":return e.isLetRing=r,!0;case"ispalmmute":return e.isPalmMute=r,!0;case"isdead":return e.isDead=r,!0;case"isstaccato":return e.isStaccato=r,!0;case"slideintype":return e.slideInType=H.parseEnum(r,zt),!0;case"slideouttype":return e.slideOutType=H.parseEnum(r,he),!0;case"vibrato":return e.vibrato=H.parseEnum(r,Pe),!0;case"istiedestination":return e.isTieDestination=r,!0;case"lefthandfinger":return e.leftHandFinger=H.parseEnum(r,ne),!0;case"righthandfinger":return e.rightHandFinger=H.parseEnum(r,ne),!0;case"isfingering":return e.isFingering=r,!0;case"trillvalue":return e.trillValue=r,!0;case"trillspeed":return e.trillSpeed=H.parseEnum(r,B),!0;case"durationpercent":return e.durationPercent=r,!0;case"accidentalmode":return e.accidentalMode=H.parseEnum(r,kt),!0;case"dynamics":return e.dynamics=H.parseEnum(r,pe),!0}return e.setProperty(t,r)}}class H1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){var r;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("notes",e.notes.map(s=>V1.toJson(s))),t.set("isempty",e.isEmpty),t.set("whammystyle",e.whammyStyle),t.set("ottava",e.ottava),t.set("islegatoorigin",e.isLegatoOrigin),t.set("duration",e.duration),t.set("automations",e.automations.map(s=>ju.toJson(s))),t.set("dots",e.dots),t.set("fadein",e.fadeIn),t.set("lyrics",e.lyrics),t.set("hasrasgueado",e.hasRasgueado),t.set("pop",e.pop),t.set("slap",e.slap),t.set("tap",e.tap),t.set("text",e.text),t.set("brushtype",e.brushType),t.set("brushduration",e.brushDuration),t.set("tupletdenominator",e.tupletDenominator),t.set("tupletnumerator",e.tupletNumerator),t.set("iscontinuedwhammy",e.isContinuedWhammy),t.set("whammybartype",e.whammyBarType),e.whammyBarPoints!==null&&t.set("whammybarpoints",(r=e.whammyBarPoints)==null?void 0:r.map(s=>qu.toJson(s))),t.set("vibrato",e.vibrato),t.set("chordid",e.chordId),t.set("gracetype",e.graceType),t.set("pickstroke",e.pickStroke),t.set("tremolospeed",e.tremoloSpeed),t.set("crescendo",e.crescendo),t.set("displaystart",e.displayStart),t.set("playbackstart",e.playbackStart),t.set("displayduration",e.displayDuration),t.set("playbackduration",e.playbackDuration),t.set("dynamics",e.dynamics),t.set("invertbeamdirection",e.invertBeamDirection),t.set("preferredbeamdirection",e.preferredBeamDirection),t.set("beamingmode",e.beamingMode),t}static setProperty(e,t,r){switch(t){case"id":return e.id=r,!0;case"notes":e.notes=[];for(const s of r){const n=new ct;V1.fromJson(n,s),e.addNote(n)}return!0;case"isempty":return e.isEmpty=r,!0;case"whammystyle":return e.whammyStyle=H.parseEnum(r,De),!0;case"ottava":return e.ottava=H.parseEnum(r,Le),!0;case"islegatoorigin":return e.isLegatoOrigin=r,!0;case"duration":return e.duration=H.parseEnum(r,B),!0;case"automations":e.automations=[];for(const s of r){const n=new ii;ju.fromJson(n,s),e.automations.push(n)}return!0;case"dots":return e.dots=r,!0;case"fadein":return e.fadeIn=r,!0;case"lyrics":return e.lyrics=r,!0;case"hasrasgueado":return e.hasRasgueado=r,!0;case"pop":return e.pop=r,!0;case"slap":return e.slap=r,!0;case"tap":return e.tap=r,!0;case"text":return e.text=r,!0;case"brushtype":return e.brushType=H.parseEnum(r,Ye),!0;case"brushduration":return e.brushDuration=r,!0;case"tupletdenominator":return e.tupletDenominator=r,!0;case"tupletnumerator":return e.tupletNumerator=r,!0;case"iscontinuedwhammy":return e.isContinuedWhammy=r,!0;case"whammybartype":return e.whammyBarType=H.parseEnum(r,Me),!0;case"whammybarpoints":if(r){e.whammyBarPoints=[];for(const s of r){const n=new V;qu.fromJson(n,s),e.addWhammyBarPoint(n)}}return!0;case"vibrato":return e.vibrato=H.parseEnum(r,Pe),!0;case"chordid":return e.chordId=r,!0;case"gracetype":return e.graceType=H.parseEnum(r,K),!0;case"pickstroke":return e.pickStroke=H.parseEnum(r,Jt),!0;case"tremolospeed":return e.tremoloSpeed=H.parseEnum(r,B),!0;case"crescendo":return e.crescendo=H.parseEnum(r,Ii),!0;case"displaystart":return e.displayStart=r,!0;case"playbackstart":return e.playbackStart=r,!0;case"displayduration":return e.displayDuration=r,!0;case"playbackduration":return e.playbackDuration=r,!0;case"dynamics":return e.dynamics=H.parseEnum(r,pe),!0;case"invertbeamdirection":return e.invertBeamDirection=r,!0;case"preferredbeamdirection":return e.preferredBeamDirection=H.parseEnum(r,D),!0;case"beamingmode":return e.beamingMode=H.parseEnum(r,Wr),!0}return!1}}class W1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("beats",e.beats.map(r=>H1.toJson(r))),t.set("isempty",e.isEmpty),t}static setProperty(e,t,r){switch(t){case"id":return e.id=r,!0;case"beats":e.beats=[];for(const s of r){const n=new si;H1.fromJson(n,s),e.addBeat(n)}return!0;case"isempty":return e.isEmpty=r,!0}return!1}}class z1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("clef",e.clef),t.set("clefottava",e.clefOttava),t.set("voices",e.voices.map(r=>W1.toJson(r))),t.set("similemark",e.simileMark),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t}static setProperty(e,t,r){switch(t){case"id":return e.id=r,!0;case"clef":return e.clef=H.parseEnum(r,ae),!0;case"clefottava":return e.clefOttava=H.parseEnum(r,Le),!0;case"voices":e.voices=[];for(const s of r){const n=new fs;W1.fromJson(n,s),e.addVoice(n)}return!0;case"similemark":return e.simileMark=H.parseEnum(r,fr),!0;case"displayscale":return e.displayScale=r,!0;case"displaywidth":return e.displayWidth=r,!0}return!1}}class G1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("name",e.name),t.set("firstfret",e.firstFret),t.set("strings",e.strings),t.set("barrefrets",e.barreFrets),t.set("showname",e.showName),t.set("showdiagram",e.showDiagram),t.set("showfingering",e.showFingering),t}static setProperty(e,t,r){switch(t){case"name":return e.name=r,!0;case"firstfret":return e.firstFret=r,!0;case"strings":return e.strings=r,!0;case"barrefrets":return e.barreFrets=r,!0;case"showname":return e.showName=r,!0;case"showdiagram":return e.showDiagram=r,!0;case"showfingering":return e.showFingering=r,!0}return!1}}class U1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("isstandard",e.isStandard),t.set("name",e.name),t.set("tunings",e.tunings),t}static setProperty(e,t,r){switch(t){case"isstandard":return e.isStandard=r,!0;case"name":return e.name=r,!0;case"tunings":return e.tunings=r,!0}return!1}}class Y1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("bars",e.bars.map(r=>z1.toJson(r))),e.chords!==null){const r=new Map;t.set("chords",r);for(const[s,n]of e.chords)r.set(s.toString(),G1.toJson(n))}return t.set("capo",e.capo),t.set("transpositionpitch",e.transpositionPitch),t.set("displaytranspositionpitch",e.displayTranspositionPitch),t.set("stringtuning",U1.toJson(e.stringTuning)),t.set("showslash",e.showSlash),t.set("showtablature",e.showTablature),t.set("showstandardnotation",e.showStandardNotation),t.set("ispercussion",e.isPercussion),t.set("standardnotationlinecount",e.standardNotationLineCount),t}static setProperty(e,t,r){switch(t){case"bars":e.bars=[];for(const s of r){const n=new Gs;z1.fromJson(n,s),e.addBar(n)}return!0;case"chords":return e.chords=new Map,H.forEach(r,(s,n)=>{const a=new Sn;G1.fromJson(a,s),e.addChord(n,a)}),!0;case"capo":return e.capo=r,!0;case"transpositionpitch":return e.transpositionPitch=r,!0;case"displaytranspositionpitch":return e.displayTranspositionPitch=r,!0;case"showslash":return e.showSlash=r,!0;case"showtablature":return e.showTablature=r,!0;case"showstandardnotation":return e.showStandardNotation=r,!0;case"ispercussion":return e.isPercussion=r,!0;case"standardnotationlinecount":return e.standardNotationLineCount=r,!0}return["stringtuning"].indexOf(t)>=0?(U1.fromJson(e.stringTuning,r),!0):!1}}class $1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("volume",e.volume),t.set("balance",e.balance),t.set("port",e.port),t.set("program",e.program),t.set("primarychannel",e.primaryChannel),t.set("secondarychannel",e.secondaryChannel),t.set("ismute",e.isMute),t.set("issolo",e.isSolo),t}static setProperty(e,t,r){switch(t){case"volume":return e.volume=r,!0;case"balance":return e.balance=r,!0;case"port":return e.port=r,!0;case"program":return e.program=r,!0;case"primarychannel":return e.primaryChannel=r,!0;case"secondarychannel":return e.secondaryChannel=r,!0;case"ismute":return e.isMute=r,!0;case"issolo":return e.isSolo=r,!0}return!1}}class X1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("elementtype",e.elementType),t.set("staffline",e.staffLine),t.set("noteheaddefault",e.noteHeadDefault),t.set("noteheadhalf",e.noteHeadHalf),t.set("noteheadwhole",e.noteHeadWhole),t.set("techniquesymbol",e.techniqueSymbol),t.set("techniquesymbolplacement",e.techniqueSymbolPlacement),t.set("outputmidinumber",e.outputMidiNumber),t}static setProperty(e,t,r){switch(t){case"elementtype":return e.elementType=r,!0;case"staffline":return e.staffLine=r,!0;case"noteheaddefault":return e.noteHeadDefault=H.parseEnum(r,g),!0;case"noteheadhalf":return e.noteHeadHalf=H.parseEnum(r,g),!0;case"noteheadwhole":return e.noteHeadWhole=H.parseEnum(r,g),!0;case"techniquesymbol":return e.techniqueSymbol=H.parseEnum(r,g),!0;case"techniquesymbolplacement":return e.techniqueSymbolPlacement=H.parseEnum(r,le),!0;case"outputmidinumber":return e.outputMidiNumber=r,!0}return!1}}class j1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("staves",e.staves.map(r=>Y1.toJson(r))),t.set("playbackinfo",$1.toJson(e.playbackInfo)),t.set("color",Oe.toJson(e.color)),t.set("name",e.name),t.set("isvisibleonmultitrack",e.isVisibleOnMultiTrack),t.set("shortname",e.shortName),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("percussionarticulations",e.percussionArticulations.map(r=>X1.toJson(r))),t}static setProperty(e,t,r){switch(t){case"staves":e.staves=[];for(const s of r){const n=new yx;Y1.fromJson(n,s),e.addStaff(n)}return!0;case"color":return e.color=Oe.fromJson(r),!0;case"name":return e.name=r,!0;case"isvisibleonmultitrack":return e.isVisibleOnMultiTrack=r,!0;case"shortname":return e.shortName=r,!0;case"defaultsystemslayout":return e.defaultSystemsLayout=r,!0;case"systemslayout":return e.systemsLayout=r,!0;case"percussionarticulations":e.percussionArticulations=[];for(const s of r){const n=new z;X1.fromJson(n,s),e.percussionArticulations.push(n)}return!0}return["playbackinfo"].indexOf(t)>=0?($1.fromJson(e.playbackInfo,r),!0):!1}}class q1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("hidedynamics",e.hideDynamics),t}static setProperty(e,t,r){switch(t){case"hidedynamics":return e.hideDynamics=r,!0}return!1}}class Q1{static fromJson(e,t){t&&H.forEach(t,(r,s)=>this.setProperty(e,s,r))}static toJson(e){if(!e)return null;const t=new Map;return t.set("album",e.album),t.set("artist",e.artist),t.set("copyright",e.copyright),t.set("instructions",e.instructions),t.set("music",e.music),t.set("notices",e.notices),t.set("subtitle",e.subTitle),t.set("title",e.title),t.set("words",e.words),t.set("tab",e.tab),t.set("tempo",e.tempo),t.set("tempolabel",e.tempoLabel),t.set("masterbars",e.masterBars.map(r=>A1.toJson(r))),t.set("tracks",e.tracks.map(r=>j1.toJson(r))),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("stylesheet",q1.toJson(e.stylesheet)),t}static setProperty(e,t,r){switch(t){case"album":return e.album=r,!0;case"artist":return e.artist=r,!0;case"copyright":return e.copyright=r,!0;case"instructions":return e.instructions=r,!0;case"music":return e.music=r,!0;case"notices":return e.notices=r,!0;case"subtitle":return e.subTitle=r,!0;case"title":return e.title=r,!0;case"words":return e.words=r,!0;case"tab":return e.tab=r,!0;case"tempo":return e.tempo=r,!0;case"tempolabel":return e.tempoLabel=r,!0;case"masterbars":e.masterBars=[];for(const s of r){const n=new Vs;A1.fromJson(n,s),e.addMasterBar(n)}return!0;case"tracks":e.tracks=[];for(const s of r){const n=new ds;j1.fromJson(n,s),e.addTrack(n)}return!0;case"defaultsystemslayout":return e.defaultSystemsLayout=r,!0;case"systemslayout":return e.systemsLayout=r,!0}return["stylesheet"].indexOf(t)>=0?(q1.fromJson(e.stylesheet,r),!0):!1}}class Bt{static jsonReplacer(e,t){if(t instanceof Map){if("fromEntries"in Object)return Object.fromEntries(t);{const r={};for(const[s,n]of t)r[s]=n;return r}}else if(ArrayBuffer.isView(t))return Array.apply([],[t]);return t}static scoreToJson(e){let t=Bt.scoreToJsObject(e);return JSON.stringify(t,Bt.jsonReplacer)}static jsonToScore(e,t){return Bt.jsObjectToScore(JSON.parse(e),t)}static scoreToJsObject(e){return Q1.toJson(e)}static jsObjectToScore(e,t){let r=new ha;return Q1.fromJson(r,e),r.finish(t??new ia),r}static settingsToJson(e){let t=Bt.settingsToJsObject(e);return JSON.stringify(t,Bt.jsonReplacer)}static jsonToSettings(e){return Bt.jsObjectToSettings(JSON.parse(e))}static settingsToJsObject(e){return io.toJson(e)}static jsObjectToSettings(e){let t=new ia;return io.fromJson(t,e),t}static jsObjectToMidiFile(e){let t=new fn;return H.forEach(e,(r,s)=>{switch(s){case"division":t.division=r;break;case"tracks":for(let n of r){let a=Bt.jsObjectToMidiTrack(n);t.tracks.push(a)}break}}),t}static jsObjectToMidiTrack(e){let t=new vx;return H.forEach(e,(r,s)=>{switch(s){case"events":for(let n of r){let a=Bt.jsObjectToMidiEvent(n);t.events.push(a)}break}}),t}static jsObjectToMidiEvent(e){let t=H.getValue(e,"track"),r=H.getValue(e,"tick"),s=H.getValue(e,"type");switch(s){case ke.TimeSignature:return new kx(t,r,H.getValue(e,"numerator"),H.getValue(e,"denominatorIndex"),H.getValue(e,"midiClocksPerMetronomeClick"),H.getValue(e,"thirdySecondNodesInQuarter"));case ke.AlphaTabRest:return new Bx(t,r,H.getValue(e,"channel"));case ke.AlphaTabMetronome:return new xx(t,r,H.getValue(e,"metronomeNumerator"),H.getValue(e,"metronomeDurationInTicks"),H.getValue(e,"metronomeDurationInMilliseconds"));case ke.NoteOn:return new Tx(t,r,H.getValue(e,"channel"),H.getValue(e,"noteKey"),H.getValue(e,"noteVelocity"));case ke.NoteOff:return new Cx(t,r,H.getValue(e,"channel"),H.getValue(e,"noteKey"),H.getValue(e,"noteVelocity"));case ke.ControlChange:return new Nx(t,r,H.getValue(e,"channel"),H.getValue(e,"controller"),H.getValue(e,"value"));case ke.ProgramChange:return new Px(t,r,H.getValue(e,"channel"),H.getValue(e,"program"));case ke.TempoChange:return new Ex(r,H.getValue(e,"microSecondsPerQuarterNote"));case ke.PitchBend:return new Mx(t,r,H.getValue(e,"channel"),H.getValue(e,"value"));case ke.PerNotePitchBend:return new Lx(t,r,H.getValue(e,"channel"),H.getValue(e,"noteKey"),H.getValue(e,"value"));case ke.EndOfTrack:return new Rx(t,r)}throw new Yt(Ut.Format,"Unknown Midi Event type: "+s)}static midiFileToJsObject(e){const t=new Map;t.set("division",e.division);const r=[];for(let s of e.tracks)r.push(Bt.midiTrackToJsObject(s));return t.set("tracks",r),t}static midiTrackToJsObject(e){const t=new Map,r=[];for(let s of e.events)r.push(Bt.midiEventToJsObject(s));return t.set("events",r),t}static midiEventToJsObject(e){const t=new Map;switch(t.set("track",e.track),t.set("tick",e.tick),t.set("type",e.type),e.type){case ke.TimeSignature:t.set("numerator",e.numerator),t.set("denominatorIndex",e.denominatorIndex),t.set("midiClocksPerMetronomeClick",e.midiClocksPerMetronomeClick),t.set("thirdySecondNodesInQuarter",e.thirtySecondNodesInQuarter);break;case ke.AlphaTabRest:t.set("channel",e.channel);break;case ke.AlphaTabMetronome:t.set("metronomeNumerator",e.metronomeNumerator),t.set("metronomeDurationInMilliseconds",e.metronomeDurationInMilliseconds),t.set("metronomeDurationInTicks",e.metronomeDurationInTicks);break;case ke.NoteOn:case ke.NoteOff:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("noteVelocity",e.noteVelocity);break;case ke.ControlChange:t.set("channel",e.channel),t.set("controller",e.controller),t.set("value",e.value);break;case ke.ProgramChange:t.set("channel",e.channel),t.set("program",e.program);break;case ke.TempoChange:t.set("microSecondsPerQuarterNote",e.microSecondsPerQuarterNote);break;case ke.PitchBend:t.set("channel",e.channel),t.set("value",e.value);break;case ke.PerNotePitchBend:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("value",e.value);break;case ke.EndOfTrack:break}return t}}class nt{constructor(){this.ready=new At,this.samplesPlayed=new xe,this.sampleRequest=new At}get sampleRate(){return nt.preferredSampleRate}open(){L.debug("AlphaSynth","Initializing synth worker"),this._worker=A.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}handleMessage(e){let t=e.data;switch(t.cmd){case nt.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case nt.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(t.samples);break}}addSamples(e){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:e})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}}nt.CmdOutputPrefix="alphaSynth.output.";nt.CmdOutputAddSamples=nt.CmdOutputPrefix+"addSamples";nt.CmdOutputPlay=nt.CmdOutputPrefix+"play";nt.CmdOutputPause=nt.CmdOutputPrefix+"pause";nt.CmdOutputResetSamples=nt.CmdOutputPrefix+"resetSamples";nt.CmdOutputSampleRequest=nt.CmdOutputPrefix+"sampleRequest";nt.CmdOutputSamplesPlayed=nt.CmdOutputPrefix+"samplesPlayed";nt.preferredSampleRate=0;class Gm{constructor(e,t){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new Ix(new nt,t),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){let e=A.globalThis;e.addEventListener("message",t=>{let r=t.data;switch(r.cmd){case"alphaSynth.initialize":nt.preferredSampleRate=r.sampleRate,L.logLevel=r.logLevel,A.globalThis.alphaSynthWebWorker=new Gm(e,r.bufferTimeInMilliseconds);break}})}handleMessage(e){let t=e.data;switch(t.cmd){case"alphaSynth.setLogLevel":L.logLevel=t.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=t.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=t.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=t.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=t.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=t.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=t.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=t.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=t.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=t.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(Bt.jsObjectToMidiFile(t.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(t.data,t.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(Bt.jsObjectToMidiFile(t.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(t.channel,t.mute);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(t.channel,t.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(t.channel,t.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(t.transpositionPitches)));break}}onPositionChanged(e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek})}onPlayerStateChanged(e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.state,stopped:e.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(e)})}serializeException(e){let t=JSON.parse(JSON.stringify(e));return e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),e.constructor&&e.constructor.name&&(t.type=e.constructor.name),t}onMidiLoaded(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek})}onMidiLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(e)})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(e){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:e.events.map(Bt.midiEventToJsObject)})}onPlaybackRangeChanged(e){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:e.playbackRange})}}var $i;(function(i){i[i.Browser=0]="Browser",i[i.NodeJs=1]="NodeJs",i[i.BrowserModule=2]="BrowserModule"})($i||($i={}));class K1{constructor(e,t){this.characterWidths=e,this.fontSizeToHeight=t}}class hi{static generateFontLookup(e){if(!hi.FontSizeLookupTables.has(e))if(!A.isRunningInWorker&&A.webPlatform!=$i.NodeJs){let r=document.createElement("canvas").getContext("2d");const s=11;r.font=`${s}px ${e}`;const n=[];let a="";for(let d=hi.ControlChars;d<255;d++){let p=String.fromCharCode(d);a+=p;const f=r.measureText(p);n.push(f.width)}const o=r.measureText(a+"ÄÖÜÁÈ"),l=0-Math.abs(o.fontBoundingBoxAscent),u=0+Math.abs(o.fontBoundingBoxDescent)-l,c=new K1(new Uint8Array(n),u/s);hi.FontSizeLookupTables.set(e,c)}else{const t=new K1(new Uint8Array([8]),1.2);hi.FontSizeLookupTables.set(e,t)}}static measureString(e,t,r,s,n){let a,o=11,l=t[0];for(let c=0;c<t.length;c++)if(hi.FontSizeLookupTables.has(t[c])){l=t[c];break}hi.FontSizeLookupTables.has(l)||hi.generateFontLookup(l),a=hi.FontSizeLookupTables.get(l);let h=1;s===lt.Italic&&(h*=1.1),n===Yi.Bold&&(h*=1.1);let u=0;for(let c=0;c<e.length;c++){let d=Math.min(a.characterWidths.length-1,e.charCodeAt(c)-hi.ControlChars);d>=0&&(u+=a.characterWidths[d]*r/o)}return h*=1.07,new Jc(u*h,r*a.fontSizeToHeight)}}hi.FontSizeLookupTables=new Map;hi.ControlChars=32;class An{constructor(){this.id=$e.newGuid(),this.x=0,this.y=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=-1,this.lastMasterBarIndex=-1,this.renderResult=null}}class Ox{constructor(){this.beats=[]}addBeat(e){e.barBounds=this,this.beats.push(e),this.masterBarBounds.addBeat(e)}findBeatAtPos(e){let t=null;for(let r of this.beats)if(!t||r.realBounds.x<e)t=r;else if(r.realBounds.x>e)break;return t}finish(){this.beats.sort((e,t)=>e.realBounds.x-t.realBounds.x)}}class Dx{constructor(){this.notes=null}addNote(e){this.notes||(this.notes=[]),e.beatBounds=this,this.notes.push(e)}findNoteAtPos(e,t){const r=this.notes;if(!r)return null;for(let s of r){let n=s.noteHeadBounds.y+s.noteHeadBounds.h,a=s.noteHeadBounds.x+s.noteHeadBounds.w;if(s.noteHeadBounds.x<=e&&s.noteHeadBounds.y<=t&&e<=a&&t<=n)return s.note}return null}}class Ax{constructor(){this.index=0,this.isFirstOfLine=!1,this.bars=[],this.staffSystemBounds=null}get staveGroupBounds(){return this.staffSystemBounds}addBar(e){e.masterBarBounds=this,this.bars.push(e)}findBeatAtPos(e,t){let r=null,s=1e7;for(let n of this.bars){let a=n.findBeatAtPos(e);if(a&&(!r||r.realBounds.x<a.realBounds.x)){const o=Math.abs(a.realBounds.x-e);(!r||o<s)&&(r=a)}}return r?r.beat:null}finish(){this.bars.sort((e,t)=>e.realBounds.y<t.realBounds.y?-1:e.realBounds.y>t.realBounds.y?1:e.realBounds.x<t.realBounds.x?-1:e.realBounds.x>t.realBounds.x?1:0);for(const e of this.bars)e.finish()}addBeat(e){this.staffSystemBounds.boundsLookup.addBeat(e)}}class td{}class Vx{constructor(){this.index=0,this.bars=[]}finish(){for(let e of this.bars)e.finish()}addBar(e){this.boundsLookup.addMasterBar(e),e.staffSystemBounds=this,this.bars.push(e)}findBarAtPos(e){let t=null;for(let r of this.bars)if(!t||r.realBounds.x<e)t=r;else if(e>r.realBounds.x+r.realBounds.w)break;return t}}class Cl{constructor(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaffSystem=null,this.staffSystems=[],this.isFinished=!1}toJson(){let e={},t=[];e.staffSystems=t;for(let r of this.staffSystems){let s={};s.visualBounds=this.boundsToJson(r.visualBounds),s.realBounds=this.boundsToJson(r.realBounds),s.bars=[];for(let n of r.bars){let a={};a.lineAlignedBounds=this.boundsToJson(n.lineAlignedBounds),a.visualBounds=this.boundsToJson(n.visualBounds),a.realBounds=this.boundsToJson(n.realBounds),a.index=n.index,a.bars=[];for(let o of n.bars){let l={};l.visualBounds=this.boundsToJson(o.visualBounds),l.realBounds=this.boundsToJson(o.realBounds),l.beats=[];for(let h of o.beats){let u={};u.visualBounds=this.boundsToJson(h.visualBounds),u.realBounds=this.boundsToJson(h.realBounds);let c=u;if(c.beatIndex=h.beat.index,c.voiceIndex=h.beat.voice.index,c.barIndex=h.beat.voice.bar.index,c.staffIndex=h.beat.voice.bar.staff.index,c.trackIndex=h.beat.voice.bar.staff.track.index,h.notes){let d=u.notes=[];for(let p of h.notes){let f={},m=f;m.index=p.note.index,f.noteHeadBounds=this.boundsToJson(p.noteHeadBounds),d.push(f)}}l.beats.push(u)}a.bars.push(l)}s.bars.push(a)}t.push(s)}return e}static fromJson(e,t){let r=new Cl,s=e.staffSystems;for(let n of s){let a=new Vx;a.visualBounds=n.visualBounds,a.realBounds=n.realBounds,r.addStaffSystem(a);for(let o of n.bars){let l=new Ax;l.index=o.index,l.isFirstOfLine=o.isFirstOfLine,l.lineAlignedBounds=o.lineAlignedBounds,l.visualBounds=o.visualBounds,l.realBounds=o.realBounds,a.addBar(l);for(let h of o.bars){let u=new Ox;u.visualBounds=h.visualBounds,u.realBounds=h.realBounds,l.addBar(u);for(let c of h.beats){let d=new Dx;d.visualBounds=c.visualBounds,d.realBounds=c.realBounds;let p=c;if(d.beat=t.tracks[p.trackIndex].staves[p.staffIndex].bars[p.barIndex].voices[p.voiceIndex].beats[p.beatIndex],c.notes){d.notes=[];for(let f of c.notes){let m=new td,S=f;m.note=d.beat.notes[S.index],m.noteHeadBounds=f.noteHeadBounds,d.addNote(m)}}u.addBeat(d)}}}}return r}boundsToJson(e){let t={};return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}finish(){for(let e of this.staffSystems)e.finish();this.isFinished=!0}addStaffSystem(e){e.index=this.staffSystems.length,e.boundsLookup=this,this.staffSystems.push(e),this._currentStaffSystem=e}addMasterBar(e){e.staffSystemBounds?this._masterBarLookup.set(e.index,e):(e.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(e.index,e),this._currentStaffSystem.addBar(e))}addBeat(e){var t;this._beatLookup.has(e.beat.id)||this._beatLookup.set(e.beat.id,[]),(t=this._beatLookup.get(e.beat.id))==null||t.push(e)}findMasterBarByIndex(e){return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findMasterBar(e){let t=e.index;return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findBeat(e){const t=this.findBeats(e);return t?t[0]:null}findBeats(e){let t=e.id;return this._beatLookup.has(t)?this._beatLookup.get(t):null}getBeatAtPos(e,t){let r=0,s=this.staffSystems.length-1,n=-1;for(;r<=s;){let l=(s+r)/2|0,h=this.staffSystems[l];if(t>=h.realBounds.y&&t<=h.realBounds.y+h.realBounds.h){n=l;break}t<h.realBounds.y?s=l-1:r=l+1}if(n===-1)return null;let o=this.staffSystems[n].findBarAtPos(e);return o?o.findBeatAtPos(e,t):null}getNoteAtPos(e,t,r){const s=this.findBeats(e);if(s)for(const n of s){const a=n.findNoteAtPos(t,r);if(a)return a}return null}}class Hx{constructor(e){this._currentLayoutMode=Es.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new xe,this.renderFinished=new xe,this.partialRenderFinished=new xe,this.partialLayoutFinished=new xe,this.postRenderFinished=new At,this.error=new xe,this.settings=e,this.recreateCanvas(),this.recreateLayout()}destroy(){var e;this.score=null,(e=this.canvas)==null||e.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}recreateCanvas(){var e;return this._currentRenderEngine!==this.settings.core.engine?((e=this.canvas)==null||e.destroy(),this.canvas=A.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0):!1}recreateLayout(){return!this.layout||this._currentLayoutMode!==this.settings.display.layoutMode?(this.layout=A.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,!0):!1}renderScore(e,t){try{this.score=e;let r=null;if(e!=null&&t!=null){if(!t)r=e.tracks.slice(0);else{r=[];for(let s of t)s>=0&&s<e.tracks.length&&r.push(e.tracks[s])}r.length===0&&e.tracks.length>0&&r.push(e.tracks[0])}this.tracks=r,this.render()}catch(r){this.error.trigger(r)}}renderTracks(e){e.length===0?this.score=null:this.score=e[0].score,this.tracks=e,this.render()}updateSettings(e){this.settings=e}renderResult(e){try{const t=this.layout;t?(L.debug("Rendering","Request render of lazy partial "+e),t.renderLazyPartial(e)):L.warning("Rendering","Request render of lazy partial "+e+" ignored, no layout exists")}catch(t){this.error.trigger(t)}}render(){if(this.width===0){L.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null);return}if(this.boundsLookup=new Cl,this.recreateCanvas(),this.canvas.lineWidth=this.settings.display.scale,this.canvas.settings=this.settings,!this.tracks||this.tracks.length===0||!this.score)L.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this.onRenderFinished(),this.postRenderFinished.trigger(),L.debug("Rendering","Clearing finished");else{L.debug("Rendering","Rendering "+this.tracks.length+" tracks");for(let e=0;e<this.tracks.length;e++){let t=this.tracks[e];L.debug("Rendering","Track "+e+": "+t.name)}this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),L.debug("Rendering","Rendering finished")}}resizeRender(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(L.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(L.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new Cl,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.onRenderFinished(),this.postRenderFinished.trigger()):L.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),L.debug("Rendering","Resize finished")}layoutAndRender(){L.debug("Rendering","Rendering at scale "+this.settings.display.scale+" with layout "+this.layout.name,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this.onRenderFinished(),this.postRenderFinished.trigger()}onRenderFinished(){var t;(t=this.boundsLookup)==null||t.finish();const e=new An;e.totalHeight=this.layout.height,e.totalWidth=this.layout.width,e.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(e)}}class Um{constructor(e){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}static init(){A.globalThis.alphaTabWebWorker=new Um(A.globalThis)}handleMessage(e){let t=e.data;switch(t?t.cmd:""){case"alphaTab.initialize":let s=Bt.jsObjectToSettings(t.settings);L.logLevel=s.core.logLevel,this._renderer=new Hx(s),this._renderer.partialRenderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:a})}),this._renderer.partialLayoutFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:a})}),this._renderer.renderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:a})}),this._renderer.postRenderFinished.on(()=>{var a;this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:((a=this._renderer.boundsLookup)==null?void 0:a.toJson())??null})}),this._renderer.preRender.on(a=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:a})}),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(t.resultId);break;case"alphaTab.setWidth":this._renderer.width=t.width;break;case"alphaTab.renderScore":this.updateFontSizes(t.fontSizes);let n=t.score==null?null:Bt.jsObjectToScore(t.score,this._renderer.settings);this.renderMultiple(n,t.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(t.settings);break}}updateFontSizes(e){if(!(e instanceof Map)){const t=e;e=new Map;for(const r in t)e.set(r,t[r])}if(e){hi.FontSizeLookupTables||(hi.FontSizeLookupTables=new Map);for(let[t,r]of e)hi.FontSizeLookupTables.set(t,r)}}updateSettings(e){io.fromJson(this._renderer.settings,e)}renderMultiple(e,t){try{this._renderer.renderScore(e,t)}catch(r){this.error(r)}}error(e){L.error("Worker","An unexpected error occurred in worker",e),this._main.postMessage({cmd:"alphaTab.error",error:e})}}class m4{constructor(){this._canvas=null,this._color=new Oe(0,0,0,255),this._font=new Ce("Arial",10,lt.Plain),this._lineWidth=0;let e=document.createElement("span");e.classList.add("at"),document.body.appendChild(e);let t=window.getComputedStyle(e),r=t.fontFamily;(r.startsWith('"')||r.startsWith("'"))&&(r=r.substr(1,r.length-2)),this._musicFont=new Ce(r,parseFloat(t.fontSize),lt.Plain),this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(e,t){this._canvas=document.createElement("canvas"),this._canvas.width=e*A.HighDpiFactor|0,this._canvas.height=t*A.HighDpiFactor|0,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px",this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(A.HighDpiFactor,A.HighDpiFactor),this._context.lineWidth=this._lineWidth}endRender(){let e=this._canvas;return this._canvas=null,e}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._context.strokeStyle=e.rgba,this._context.fillStyle=e.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._context&&(this._context.lineWidth=e)}fillRect(e,t,r,s){r>0&&this._context.fillRect(e|0,t|0,r,s)}strokeRect(e,t,r,s){this._context.strokeRect(e|0,t|0,r,s)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(e,t){this._context.moveTo(e,t)}lineTo(e,t){this._context.lineTo(e,t)}quadraticCurveTo(e,t,r,s){this._context.quadraticCurveTo(e,t,r,s)}bezierCurveTo(e,t,r,s,n,a){this._context.bezierCurveTo(e,t,r,s,n,a)}fillCircle(e,t,r){this._context.beginPath(),this._context.arc(e,t,r,0,Math.PI*2,!0),this.fill()}strokeCircle(e,t,r){this._context.beginPath(),this._context.arc(e,t,r,0,Math.PI*2,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(e){this._font=e,this._context&&(this._context.font=e.toCssString(this.settings.display.scale)),this._measureContext.font=e.toCssString(this.settings.display.scale)}get textAlign(){switch(this._context.textAlign){case"left":return Q.Left;case"center":return Q.Center;case"right":return Q.Right;default:return Q.Left}}set textAlign(e){switch(e){case Q.Left:this._context.textAlign="left";break;case Q.Center:this._context.textAlign="center";break;case Q.Right:this._context.textAlign="right";break}}get textBaseline(){switch(this._context.textBaseline){case"hanging":return le.Top;case"middle":return le.Middle;case"bottom":return le.Bottom;default:return le.Top}}set textBaseline(e){switch(e){case le.Top:this._context.textBaseline="hanging";break;case le.Middle:this._context.textBaseline="middle";break;case le.Bottom:this._context.textBaseline="bottom";break}}beginGroup(e){}endGroup(){}fillText(e,t,r){this._context.fillText(e,t,r)}measureText(e){const t=this._measureContext.measureText(e);return new Jc(t.width,t.actualBoundingBoxDescent-t.actualBoundingBoxAscent)}fillMusicFontSymbol(e,t,r,s,n=!1){s!==g.None&&this.fillMusicFontSymbolText(e,t,r,String.fromCharCode(s),n)}fillMusicFontSymbols(e,t,r,s,n=!1){let a="";for(let o of s)o!==g.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,r,a,n)}fillMusicFontSymbolText(e,t,r,s,n=!1){let a=this._context.textAlign,o=this._context.textBaseline,l=this._context.font;this._context.font=this._musicFont.toCssString(r),this._context.textBaseline="middle",n?this._context.textAlign="center":this._context.textAlign="left",this._context.fillText(s,e,t),this._context.textBaseline=o,this._context.font=l,this._context.textAlign=a}beginRotate(e,t,r){this._context.save(),this._context.translate(e,t),this._context.rotate(r*Math.PI/180)}endRotate(){this._context.restore()}}class ns{constructor(e,t=!1){this._midiFile=e,this._smf1Mode=t}addTimeSignature(e,t,r){let s=0,n=r;for(;n=n>>1,n>0;)s++;this._midiFile.addEvent(new kx(0,e,t,s,48,8))}addRest(e,t,r){this._smf1Mode||this._midiFile.addEvent(new Bx(e,t,r))}addNote(e,t,r,s,n,a){this._midiFile.addEvent(new Tx(e,t,a,ns.fixValue(s),ns.fixValue(n))),this._midiFile.addEvent(new Cx(e,t+r,a,ns.fixValue(s),ns.fixValue(n)))}static fixValue(e){return e>127?127:e<0?0:e}addControlChange(e,t,r,s,n){this._midiFile.addEvent(new Nx(e,t,r,s,ns.fixValue(n)))}addProgramChange(e,t,r,s){this._midiFile.addEvent(new Px(e,t,r,s))}addTempo(e,t){const r=6e7/t|0;this._midiFile.addEvent(new Ex(e,r))}addBend(e,t,r,s){s>=ce.MaxPitchWheel?s=ce.MaxPitchWheel:s=Math.floor(s),this._midiFile.addEvent(new Mx(e,t,r,s))}addNoteBend(e,t,r,s,n){this._smf1Mode?this.addBend(e,t,r,n):(n=n*ce.MaxPitchWheel20/ce.MaxPitchWheel,this._midiFile.addEvent(new Lx(e,t,r,s,n)))}finishTrack(e,t){(this._midiFile.format==to.MultiTrack||e==0)&&this._midiFile.addEvent(new Rx(e,t))}}class y4{constructor(e,t){this.closingIndex=0,this.group=e,this.opening=t,e.closings=e.closings.sort((r,s)=>r.index-s.index),this.iterations=e.closings.map(r=>0)}}class b4{get finished(){return this.index>=this._score.masterBars.length}constructor(e){this._repeatStack=[],this._groupsOnStack=new Set,this._previousAlternateEndings=0,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=e}processCurrent(){const e=this._score.masterBars[this.index];let t=e.alternateEndings;if(t===0&&(t=this._previousAlternateEndings),e===e.repeatGroup.opening&&e.repeatGroup.isClosed&&!this._groupsOnStack.has(e.repeatGroup)){const r=new y4(e.repeatGroup,e);this._repeatStack.push(r),this._groupsOnStack.add(e.repeatGroup),this._previousAlternateEndings=0,t=e.alternateEndings}if(this._repeatStack.length===0||t===0)this.shouldPlay=!0;else{const r=this._repeatStack[this._repeatStack.length-1],s=r.iterations[r.closingIndex];this._previousAlternateEndings=t,t&1<<s?this.shouldPlay=!0:this.shouldPlay=!1}this.shouldPlay&&(this.currentTick+=e.calculateDuration())}moveNext(){const t=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&t>0){const r=this._repeatStack[this._repeatStack.length-1];if(r.iterations[r.closingIndex]<t){this.index=r.opening.index,r.iterations[r.closingIndex]++;for(let n=0;n<r.closingIndex;n++)r.iterations[n]=0;r.closingIndex=0,this._previousAlternateEndings=0}else r.closingIndex<r.group.closings.length-1?(r.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(r.group),this.index++)}else this.index++}}class w4{constructor(e,t){this.beat=e,this.playbackStart=t}}class kr{get duration(){return this.end-this.start}constructor(e,t){this._highlightedBeats=new Map,this.highlightedBeats=[],this.nextBeat=null,this.previousBeat=null,this.start=e,this.end=t}highlightBeat(e,t){e.isEmpty&&!e.voice.isEmpty||this._highlightedBeats.has(e.id)||(this._highlightedBeats.set(e.id,!0),this.highlightedBeats.push(new w4(e,t)))}getVisibleBeatAtStart(e){for(const t of this.highlightedBeats)if(t.playbackStart==this.start&&e.has(t.beat.voice.bar.staff.track.index))return t.beat;return null}}class Wx{constructor(){this.start=0,this.end=0,this.tempo=0,this.firstBeat=null,this.lastBeat=null,this.nextMasterBar=null,this.previousMasterBar=null}insertAfter(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.nextBeat=e.nextBeat,t.previousBeat=e,e.nextBeat&&(e.nextBeat.previousBeat=t),e.nextBeat=t,e==this.lastBeat&&(this.lastBeat=t))}insertBefore(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.previousBeat=e.previousBeat,t.nextBeat=e,e.previousBeat&&(e.previousBeat.nextBeat=t),e.previousBeat=t,e==this.firstBeat&&(this.firstBeat=t))}addBeat(e,t,r,s){const n=r+s;if(this.firstBeat==null){const a=new kr(r,n);a.highlightBeat(e,t),this.insertAfter(this.firstBeat,a)}else if(r>=this.lastBeat.end){const a=new kr(this.lastBeat.end,n);a.highlightBeat(e,t),this.insertAfter(this.lastBeat,a)}else{let a=null;if(r<this.firstBeat.start)a=this.firstBeat;else{let o=this.firstBeat;for(;o!=null;){if(r>=o.start&&r<o.end){a=o;break}o=o.nextBeat}if(a===null)throw new Yt(Ut.General,"Error on building lookup, unknown variant")}if(r<a.start)if(n==a.start){const o=new kr(r,a.start);o.highlightBeat(e,t),this.insertBefore(this.firstBeat,o)}else if(n<a.end){const o=new kr(r,a.start);o.highlightBeat(e,t),this.insertBefore(a,o);const l=new kr(a.start,n);for(const h of a.highlightedBeats)l.highlightBeat(h.beat,h.playbackStart);l.highlightBeat(e,t),this.insertBefore(a,l),a.start=n}else if(n==a.end){const o=new kr(r,a.start);o.highlightBeat(e,t),a.highlightBeat(e,t),this.insertBefore(a,o)}else{const o=new kr(r,a.start);o.highlightBeat(e,t),a.highlightBeat(e,t),this.insertBefore(a,o),this.addBeat(e,t,a.end,n-a.end)}else if(r>a.start)if(n==a.end){const o=new kr(a.start,r);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=r,a.highlightBeat(e,t),this.insertBefore(a,o)}else if(n<a.end){const o=new kr(a.start,r);this.insertBefore(a,o);const l=new kr(r,n);this.insertBefore(a,l);for(const h of a.highlightedBeats)o.highlightBeat(h.beat,h.playbackStart),l.highlightBeat(h.beat,h.playbackStart);l.highlightBeat(e,t),a.start=n}else{const o=new kr(a.start,r);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=r,a.highlightBeat(e,t),this.insertBefore(a,o),this.addBeat(e,t,a.end,n-a.end)}else if(n===a.end)a.highlightBeat(e,t);else if(n<a.end){const o=new kr(a.start,n);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);o.highlightBeat(e,t),a.start=n,this.insertBefore(a,o)}else a.highlightBeat(e,t),this.addBeat(e,t,a.end,n-a.end)}}}class S4{get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(e){this.nextBeat=null,this.tickDuration=0,this.duration=0,this.masterBar=e}}class v4{constructor(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[]}findBeat(e,t,r=null){let s=null;return r&&(s=this.findBeatFast(e,r,t)),s||(s=this.findBeatSlow(e,r,t,!1)),s}findBeatFast(e,t,r){if(r>=t.start&&r<t.end)return t;if(t.nextBeat&&r>=t.nextBeat.start&&r<t.nextBeat.end){const s=t.nextBeat;return this.fillNextBeat(s,e),s}return null}fillNextBeat(e,t){e.nextBeat=this.findBeatInMasterBar(e.masterBar,e.beatLookup.nextBeat,e.end,t,!1,!0),e.nextBeat==null&&(e.nextBeat=this.findBeatSlow(t,e,e.end,!0)),e.nextBeat&&(e.tickDuration=e.nextBeat.start-e.start,e.duration=oe.ticksToMillis(e.tickDuration,e.masterBar.tempo)),e.nextBeat||(e.tickDuration=e.masterBar.end-e.start,e.duration=oe.ticksToMillis(e.tickDuration,e.masterBar.tempo))}findBeatSlow(e,t,r,s){let n=null;if(t!=null&&(t.masterBar.start<=r&&t.masterBar.end>r?n=t.masterBar:t.masterBar.nextMasterBar&&t.masterBar.nextMasterBar.start<=r&&t.masterBar.nextMasterBar.end>r&&(n=t.masterBar.nextMasterBar)),n||(n=this.findMasterBar(r)),!n)return null;for(;n;){if(n.firstBeat){let a=this.findBeatInMasterBar(n,n.firstBeat,r,e,!0,s);if(a)return a}n=n.nextMasterBar}return null}findBeatInMasterBar(e,t,r,s,n,a){if(!t)return null;let o=null,l=null;const h=r-e.start;for(;t!=null&&l==null;){if(t.start<=h&&h<t.end){if(o=t,l=t.getVisibleBeatAtStart(s),!l)if(a){let c=e;for(;c!=null&&l==null;){for(;t!=null;){if(l=t.getVisibleBeatAtStart(s),l){o=t,e=c;break}t=t.nextBeat}(!l||!o)&&(c=c.nextMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}else{let c=e;for(;c!=null&&l==null;){for(;t!=null;){if(l=t.getVisibleBeatAtStart(s),l){o=t,e=c;break}t=t.previousBeat}(!l||!o)&&(c=c.previousMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}}else if(t.end>h)break;t=(t==null?void 0:t.nextBeat)??null}return l==null?null:this.createResult(e,o,l,n,s)}createResult(e,t,r,s,n){const a=new S4(e);return a.beat=r,a.beatLookup=t,a.tickDuration=t.end-t.start,s&&this.fillNextBeat(a,n),a.duration=oe.ticksToMillis(a.tickDuration,e.tempo),a}findMasterBar(e){const t=this.masterBars;let r=0,s=t.length-1;for(;r<=s;){const n=(s+r)/2|0,a=t[n];if(e>=a.start&&e<a.end)return a;e<a.start?s=n-1:r=n+1}return null}getMasterBar(e){if(!this.masterBarLookup.has(e.index)){const t=new Wx;return t.masterBar=e,t}return this.masterBarLookup.get(e.index)}getMasterBarStart(e){return this.masterBarLookup.has(e.index)?this.masterBarLookup.get(e.index).start:0}getBeatStart(e){return this.masterBarLookup.has(e.voice.bar.index)?this.masterBarLookup.get(e.voice.bar.index).start+e.playbackStart:0}addMasterBar(e){this.masterBars.push(e),this._currentMasterBar&&(e.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=e),this._currentMasterBar=e,this.masterBarLookup.has(e.masterBar.index)||this.masterBarLookup.set(e.masterBar.index,e)}addBeat(e,t,r){const s=this._currentMasterBar;if(s)if(t<0&&s.previousMasterBar){const n=s.previousMasterBar.end-s.previousMasterBar.start,a=n+t,o=a+r;if(s.previousMasterBar.addBeat(e,a,a,r),o>n){const l=r+t;s.addBeat(e,t,0,l)}}else s.addBeat(e,t,t,r)}}class k4{constructor(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0}}class x4{constructor(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0}}class Re{constructor(e,t,r){this._currentTempo=0,this._programsPerChannel=new Map,this.tickLookup=new v4,this.applyTranspositionPitches=!0,this.transpositionPitches=new Map,this._currentTripletFeel=null,this.vibratoResolution=16,this._score=e,this._settings=t||new ia,this._currentTempo=this._score.tempo,this._handler=r}generate(){this.transpositionPitches.clear();for(const r of this._score.tracks)this.generateTrack(r);L.debug("Midi","Begin midi generation");const e=new b4(this._score);let t=null;for(;!e.finished;){const r=e.index,s=this._score.masterBars[r],n=e.currentTick;if(e.processCurrent(),e.shouldPlay){this.generateMasterBar(s,t,n);for(const a of this._score.tracks)for(const o of a.staves)r<o.bars.length&&this.generateBar(o.bars[r],n)}e.moveNext(),t=s}for(const r of this._score.tracks)this._handler.finishTrack(r.index,e.currentTick);L.debug("Midi","Midi generation done")}generateTrack(e){this.generateChannel(e,e.playbackInfo.primaryChannel,e.playbackInfo),e.playbackInfo.primaryChannel!==e.playbackInfo.secondaryChannel&&this.generateChannel(e,e.playbackInfo.secondaryChannel,e.playbackInfo)}addProgramChange(e,t,r,s){(!this._programsPerChannel.has(r)||this._programsPerChannel.get(r)!==s)&&(this._handler.addProgramChange(e.index,t,r,s),this._programsPerChannel.set(r,s))}static buildTranspositionPitches(e,t){const r=new Map;for(const s of e.tracks){const n=s.index<t.notation.transpositionPitches.length?t.notation.transpositionPitches[s.index]:0;r.set(s.playbackInfo.primaryChannel,n),r.set(s.playbackInfo.secondaryChannel,n)}return r}generateChannel(e,t,r){const s=e.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[e.index]:0;this.transpositionPitches.set(t,s);let n=Re.toChannelShort(r.volume),a=Re.toChannelShort(r.balance);this._handler.addControlChange(e.index,0,t,Ae.VolumeCoarse,n),this._handler.addControlChange(e.index,0,t,Ae.PanCoarse,a),this._handler.addControlChange(e.index,0,t,Ae.ExpressionControllerCoarse,127),this._handler.addControlChange(e.index,0,t,Ae.RegisteredParameterFine,0),this._handler.addControlChange(e.index,0,t,Ae.RegisteredParameterCourse,0),this._handler.addControlChange(e.index,0,t,Ae.DataEntryFine,0),this._handler.addControlChange(e.index,0,t,Ae.DataEntryCoarse,Re.PitchBendRangeInSemitones),this.addProgramChange(e,0,t,r.program)}static toChannelShort(e){const t=Math.max(-32768,Math.min(32767,e*8-1));return Math.max(t,-1)+1}generateMasterBar(e,t,r){(!t||t.timeSignatureDenominator!==e.timeSignatureDenominator||t.timeSignatureNumerator!==e.timeSignatureNumerator)&&this._handler.addTimeSignature(r,e.timeSignatureNumerator,e.timeSignatureDenominator),e.tempoAutomation?(this._handler.addTempo(r,e.tempoAutomation.value),this._currentTempo=e.tempoAutomation.value):t||(this._handler.addTempo(r,e.score.tempo),this._currentTempo=e.score.tempo);const s=new Wx;s.masterBar=e,s.start=r,s.tempo=this._currentTempo,s.end=s.start+e.calculateDuration(),this.tickLookup.addMasterBar(s)}generateBar(e,t){let r=this.getPlaybackBar(e);for(const s of r.voices)this.generateVoice(s,t,e)}getPlaybackBar(e){switch(e.simileMark){case fr.Simple:e.previousBar&&(e=this.getPlaybackBar(e.previousBar));break;case fr.FirstOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break;case fr.SecondOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break}return e}generateVoice(e,t,r){if(!(e.isEmpty&&(!e.bar.isEmpty||e.index!==0)))for(const s of e.beats)this.generateBeat(s,t,r)}generateBeat(e,t,r){let s=e.playbackStart,n=e.playbackDuration;e.voice.bar.isEmpty?n=e.voice.bar.masterBar.calculateDuration():e.voice.bar.masterBar.tripletFeel!==fe.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(s-=this._currentTripletFeel.secondBeatStartOffset,n=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=Re.calculateTripletFeelInfo(s,n,e),this._currentTripletFeel&&(n=this._currentTripletFeel.firstBeatDuration))),r===e.voice.bar?this.tickLookup.addBeat(e,s,n):this.tickLookup.addBeat(e,0,n);const a=e.voice.bar.staff.track;for(const o of e.automations)this.generateAutomation(e,o,t);if(e.isRest)this._handler.addRest(a.index,t+s,a.playbackInfo.primaryChannel);else{let o=this.getBrushInfo(e);for(const l of e.notes)this.generateNote(l,t+s,n,o)}if(e.vibrato!==Pe.None){let o=240,l=3;switch(e.vibrato){case Pe.Slight:o=this._settings.player.vibrato.beatSlightLength,l=this._settings.player.vibrato.beatSlightAmplitude;break;case Pe.Wide:o=this._settings.player.vibrato.beatWideLength,l=this._settings.player.vibrato.beatWideAmplitude;break}this.generateVibratorWithParams(t+s,e.playbackDuration,o,l,(h,u)=>{this._handler.addBend(e.voice.bar.staff.track.index,h,a.playbackInfo.secondaryChannel,u)})}}static calculateTripletFeelInfo(e,t,r){let s;switch(r.voice.bar.masterBar.tripletFeel){case fe.Triplet8th:case fe.Dotted8th:case fe.Scottish8th:s=B.Eighth;break;case fe.Triplet16th:case fe.Dotted16th:case fe.Scottish16th:s=B.Sixteenth;break;default:return null}const n=oe.toTicks(s);if(t!==n||e%n!==0||!r.nextBeat||r.nextBeat.voice!==r.voice||r.playbackDuration!==n)return null;const a=new x4;switch(r.voice.bar.masterBar.tripletFeel){case fe.Triplet8th:a.firstBeatDuration=oe.applyTuplet(oe.toTicks(B.Quarter),3,2),a.secondBeatDuration=oe.applyTuplet(oe.toTicks(B.Eighth),3,2);break;case fe.Dotted8th:a.firstBeatDuration=oe.applyDot(oe.toTicks(B.Eighth),!1),a.secondBeatDuration=oe.toTicks(B.Sixteenth);break;case fe.Scottish8th:a.firstBeatDuration=oe.toTicks(B.Sixteenth),a.secondBeatDuration=oe.applyDot(oe.toTicks(B.Eighth),!1);break;case fe.Triplet16th:a.firstBeatDuration=oe.applyTuplet(oe.toTicks(B.Eighth),3,2),a.secondBeatDuration=oe.applyTuplet(oe.toTicks(B.Sixteenth),3,2);break;case fe.Dotted16th:a.firstBeatDuration=oe.applyDot(oe.toTicks(B.Sixteenth),!1),a.secondBeatDuration=oe.toTicks(B.ThirtySecond);break;case fe.Scottish16th:a.firstBeatDuration=oe.toTicks(B.ThirtySecond),a.secondBeatDuration=oe.applyDot(oe.toTicks(B.Sixteenth),!1);break}return a.secondBeatStartOffset=t-a.firstBeatDuration,a}generateNote(e,t,r,s){const n=e.beat.voice.bar.staff.track,a=e.beat.voice.bar.staff;let o=e.calculateRealValue(this.applyTranspositionPitches,!0);if(e.isPercussion){const f=xt.getArticulation(e);f&&(o=f.outputMidiNumber)}const l=e.isStringed&&e.string<=s.length?s[e.string-1]:0,h=t+l,u=this.getNoteDuration(e,r);u.untilTieOrSlideEnd-=l,u.noteOnly-=l,u.letRingEnd-=l;const c=Re.getNoteVelocity(e),d=e.hasBend||e.beat.hasWhammyBar||e.beat.vibrato!==Pe.None?n.playbackInfo.secondaryChannel:n.playbackInfo.primaryChannel;let p=0;if(e.hasBend?p=Re.getPitchWheel(e.bendPoints[0].value):e.beat.hasWhammyBar?p=Re.getPitchWheel(e.beat.whammyBarPoints[0].value):e.isTieDestination||e.slideOrigin&&e.slideOrigin.slideOutType===he.Legato?p=-1:p=Re.getPitchWheel(0),p>=0&&this._handler.addNoteBend(n.index,h,d,o,p),e.beat.fadeIn&&this.generateFadeIn(e,h,u),e.isTrill&&!a.isPercussion){this.generateTrill(e,h,u,o,c,d);return}if(e.beat.isTremolo){this.generateTremoloPicking(e,h,u,o,c,d);return}if(e.hasBend?this.generateBend(e,h,u,o,d):e.beat.hasWhammyBar&&e.index===0?this.generateWhammy(e.beat,h,u,d):e.slideInType!==zt.None||e.slideOutType!==he.None?this.generateSlide(e,h,u,o,d):(e.vibrato!==Pe.None||e.isTieDestination&&e.tieOrigin.vibrato!==Pe.None)&&this.generateVibrato(e,h,u,o,d),!e.isTieDestination&&(!e.slideOrigin||e.slideOrigin.slideOutType!==he.Legato)){let f=Math.max(u.untilTieOrSlideEnd,u.letRingEnd);this._handler.addNote(n.index,h,f,o,c,d)}}getNoteDuration(e,t){const r=new k4;if(r.noteOnly=t,r.untilTieOrSlideEnd=t,r.letRingEnd=t,e.isDead)return r.noteOnly=this.applyStaticDuration(Re.DefaultDurationDead,t),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isPalmMute)return r.noteOnly=this.applyStaticDuration(Re.DefaultDurationPalmMute,t),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isStaccato)return r.noteOnly=t/2|0,r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isTieOrigin){const s=e.tieDestination;if(s)if(e.isTieDestination){const n=this.getNoteDuration(s,s.beat.playbackDuration);r.untilTieOrSlideEnd=t+n.untilTieOrSlideEnd}else{const n=e.beat.absolutePlaybackStart,a=this.getNoteDuration(s,s.beat.playbackDuration),o=s.beat.absolutePlaybackStart+a.untilTieOrSlideEnd;r.untilTieOrSlideEnd=o-n}}else if(e.slideOutType===he.Legato){const s=e.slideTarget;if(s){const n=e.beat.absolutePlaybackStart,a=this.getNoteDuration(s,s.beat.playbackDuration),o=s.beat.absolutePlaybackStart+a.untilTieOrSlideEnd;r.untilTieOrSlideEnd=o-n}}if(e.isLetRing&&this._settings.notation.notationMode===Ot.GuitarPro){let s=e.beat,n=0;const a=e.beat.voice.bar.masterBar.calculateDuration();for(;s.nextBeat;){let o=s.nextBeat;if(o.isRest||e.isStringed&&o.hasNoteOnString(e.string))break;if(s=s.nextBeat,n=s.absolutePlaybackStart-e.beat.absolutePlaybackStart+s.playbackDuration,n>a){n=a;break}}s===e.beat?r.letRingEnd=t:r.letRingEnd=n}else r.letRingEnd=r.untilTieOrSlideEnd;return r}applyStaticDuration(e,t){const r=this._currentTempo*e/V.MaxPosition|0;return Math.min(r,t)}static getNoteVelocity(e){let t=e.dynamics;switch(!e.beat.voice.bar.staff.isPercussion&&e.hammerPullOrigin&&t--,e.isGhost&&t--,e.accentuated){case Et.Normal:t++;break;case Et.Heavy:t+=2;break}return oe.dynamicToVelocity(t)}generateFadeIn(e,t,r){const s=e.beat.voice.bar.staff.track,a=Re.toChannelShort(s.playbackInfo.volume)/r.noteOnly,o=120,l=r.noteOnly/o|0,h=t+r.noteOnly;for(let u=l-1;u>=0;u--){const c=h-u*o,d=(c-t)*a;u===l-1&&(this._handler.addControlChange(s.index,t,s.playbackInfo.primaryChannel,Ae.VolumeCoarse,d),this._handler.addControlChange(s.index,t,s.playbackInfo.secondaryChannel,Ae.VolumeCoarse,d)),this._handler.addControlChange(s.index,c,s.playbackInfo.primaryChannel,Ae.VolumeCoarse,d),this._handler.addControlChange(s.index,c,s.playbackInfo.secondaryChannel,Ae.VolumeCoarse,d)}}generateVibrato(e,t,r,s,n){let a=0,o=0;switch(e.vibrato!==Pe.None?e.vibrato:e.isTieDestination?e.tieOrigin.vibrato:Pe.Slight){case Pe.Slight:a=this._settings.player.vibrato.noteSlightLength,o=this._settings.player.vibrato.noteSlightAmplitude;break;case Pe.Wide:a=this._settings.player.vibrato.noteWideLength,o=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const h=e.beat.voice.bar.staff.track;this.generateVibratorWithParams(t,r.noteOnly,a,o,(u,c)=>{this._handler.addNoteBend(h.index,u,n,s,c)})}generateVibratorWithParams(e,t,r,s,n){const a=this.vibratoResolution,o=r/2|0;e+=r;const l=e+t;for(;e<l;){let h=0;const u=e+r<l?r:l-e;for(;h<u;){let c=s*Math.sin(h*Math.PI/o);n(e+h|0,Re.getPitchWheel(c)),h+=a}e+=r}}static getPitchWheel(e){return ce.DefaultPitchWheel+e/2*Re.PitchValuePerSemitone}generateSlide(e,t,r,s,n){let a=e.slideOutType===he.Legato?r.noteOnly:r.untilTieOrSlideEnd,o=[],l=e.beat.voice.bar.staff.track;const h=this._settings.player.slide.simpleSlidePitchOffset,u=Math.floor(V.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),c=Math.floor(V.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(e.slideInType){case zt.IntoFromAbove:o.push(new V(0,h)),o.push(new V(u,0));break;case zt.IntoFromBelow:o.push(new V(0,-h)),o.push(new V(u,0));break}switch(e.slideOutType){case he.Legato:case he.Shift:o.push(new V(c,0));const d=(e.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-e.calculateRealValue(this.applyTranspositionPitches,!0))*2;o.push(new V(V.MaxPosition,d));break;case he.OutDown:o.push(new V(V.MaxPosition-u,0)),o.push(new V(V.MaxPosition,-h));break;case he.OutUp:o.push(new V(V.MaxPosition-u,0)),o.push(new V(V.MaxPosition,h));break}this.generateWhammyOrBend(t,a,o,(d,p)=>{this._handler.addNoteBend(l.index,d,n,s,p)})}generateBend(e,t,r,s,n){let a=e.bendPoints,o=e.beat.voice.bar.staff.track;const l=(p,f)=>{this._handler.addNoteBend(o.index,p,n,s,f)};let h=null,u;if(e.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let p=e;for(;p.isTieOrigin&&!p.tieDestination.hasBend;)p=p.tieDestination;u=p.beat.absolutePlaybackStart-e.beat.absolutePlaybackStart+this.getNoteDuration(p,p.beat.playbackDuration).noteOnly}else if(e.isTieOrigin&&e.beat.graceType!==K.None){switch(e.tieDestination.bendType){case X.Bend:case X.BendRelease:case X.PrebendBend:h=e.tieDestination.bendPoints[1].value;break;case X.Prebend:case X.PrebendRelease:h=e.tieDestination.bendPoints[0].value;break}u=Math.max(r.noteOnly,oe.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo))}else u=r.noteOnly;a[0].value>0&&!e.isContinuedBend&&t>0&&t--;const c=Math.min(u,oe.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo));let d=[];switch(e.bendType){case X.Custom:d=a;break;case X.Bend:case X.Release:switch(e.bendStyle){case De.Default:d=a;break;case De.Gradual:d.push(new V(0,e.bendPoints[0].value)),(!h||h<e.bendPoints[1].value)&&(h=e.bendPoints[1].value),d.push(new V(V.MaxPosition,h));break;case De.Fast:(!h||h<e.bendPoints[1].value)&&(h=e.bendPoints[1].value),e.beat.graceType===K.BendGrace?this.generateSongBookWhammyOrBend(t,u,!0,[e.bendPoints[0].value,h],c,l):this.generateSongBookWhammyOrBend(t,u,!1,[e.bendPoints[0].value,h],c,l);return}break;case X.BendRelease:switch(e.bendStyle){case De.Default:d=a;break;case De.Gradual:d.push(new V(0,e.bendPoints[0].value)),d.push(new V(V.MaxPosition/2|0,e.bendPoints[1].value)),d.push(new V(V.MaxPosition,e.bendPoints[2].value));break;case De.Fast:this.generateSongBookWhammyOrBend(t,u,!1,[e.bendPoints[0].value,e.bendPoints[1].value,e.bendPoints[2].value],c,l);return}break;case X.Hold:d=a;break;case X.Prebend:d=a;break;case X.PrebendBend:switch(e.bendStyle){case De.Default:d=a;break;case De.Gradual:d.push(new V(0,e.bendPoints[0].value)),d.push(new V(V.MaxPosition,e.bendPoints[1].value));break;case De.Fast:const p=Re.getPitchWheel(e.bendPoints[0].value);l(t,p|0),(!h||h<e.bendPoints[1].value)&&(h=e.bendPoints[1].value),this.generateSongBookWhammyOrBend(t,u,!1,[e.bendPoints[0].value,h],c,l);return}break;case X.PrebendRelease:switch(e.bendStyle){case De.Default:d=a;break;case De.Gradual:d.push(new V(0,e.bendPoints[0].value)),d.push(new V(V.MaxPosition,e.bendPoints[1].value));break;case De.Fast:const p=Re.getPitchWheel(e.bendPoints[0].value);l(t,p|0),this.generateSongBookWhammyOrBend(t,u,!1,[e.bendPoints[0].value,e.bendPoints[1].value],c,l);return}break}this.generateWhammyOrBend(t,u,d,l)}generateSongBookWhammyOrBend(e,t,r,s,n,a){const o=r?e:e+t-n,l=n/(s.length-1);for(let h=0;h<s.length-1;h++){const u=Re.getPitchWheel(s[h]),c=Re.getPitchWheel(s[h+1]),d=o+l*h;this.generateBendValues(d,l,u,c,a)}}generateWhammy(e,t,r,s){const n=e.whammyBarPoints,a=e.voice.bar.staff.track,o=r.noteOnly;n[0].value>0&&!e.isContinuedWhammy&&t--;const l=(u,c)=>{this._handler.addBend(a.index,u,s,c)};let h=[];switch(e.whammyBarType){case Me.Custom:h=n;break;case Me.Dive:switch(e.whammyStyle){case De.Default:h=n;break;case De.Gradual:h.push(new V(0,n[0].value)),h.push(new V(V.MaxPosition,n[1].value));break;case De.Fast:const u=Math.min(o,oe.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo));this.generateSongBookWhammyOrBend(t,o,!1,[n[0].value,n[1].value],u,l);return}break;case Me.Dip:switch(e.whammyStyle){case De.Default:h=n;break;case De.Gradual:h.push(new V(0,n[0].value)),h.push(new V(V.MaxPosition/2|0,n[1].value)),h.push(new V(V.MaxPosition,n[2].value));break;case De.Fast:const u=Math.min(o,oe.millisToTicks(this._settings.player.songBookDipDuration,this._currentTempo));this.generateSongBookWhammyOrBend(t,o,!0,[n[0].value,n[1].value,n[2].value],u,l);return}break;case Me.Hold:h=n;break;case Me.Predive:h=n;break;case Me.PrediveDive:switch(e.whammyStyle){case De.Default:h=n;break;case De.Gradual:h.push(new V(0,n[0].value)),h.push(new V(V.MaxPosition/2|0,n[0].value)),h.push(new V(V.MaxPosition,n[1].value));break;case De.Fast:const u=Re.getPitchWheel(n[0].value);this._handler.addBend(a.index,t,s,u|0);const c=Math.min(o,oe.millisToTicks(this._settings.player.songBookBendDuration,this._currentTempo));this.generateSongBookWhammyOrBend(t,o,!1,[n[0].value,n[1].value],c,l);return}break}this.generateWhammyOrBend(t,o,h,l)}generateWhammyOrBend(e,t,r,s){const n=t/V.MaxPosition;for(let a=0;a<r.length-1;a++){const o=r[a],l=r[a+1],h=Re.getPitchWheel(o.value),u=Re.getPitchWheel(l.value),c=n*(l.offset-o.offset),d=e+n*o.offset;this.generateBendValues(d,c,h,u,s)}}generateBendValues(e,t,r,s,n){const a=oe.ticksToMillis(t,this._currentTempo),o=Math.abs(s-r)/Re.PitchValuePerSemitone,l=Math.max(Re.MinBreakpointsPerSemitone*o,a/Re.MillisecondsPerBreakpoint),h=t/l,u=(s-r)/l;for(let c=0;c<l;c++)n(e|0,Math.round(r)),r+=u,e+=h;r<s&&n(e|0,s)}generateTrill(e,t,r,s,n,a){const o=e.beat.voice.bar.staff.track,l=e.stringTuning+e.trillFret;let h=oe.toTicks(e.trillSpeed),u=!0,c=t,d=t+r.untilTieOrSlideEnd;for(;c+10<d;)c+h>=d&&(h=d-c),this._handler.addNote(o.index,c,h,u?l:s,n,a),u=!u,c+=h}generateTremoloPicking(e,t,r,s,n,a){const o=e.beat.voice.bar.staff.track;let l=oe.toTicks(e.beat.tremoloSpeed),h=t;const u=t+r.untilTieOrSlideEnd;for(;h+10<u;)h+l>=u&&(l=u-h),this._handler.addNote(o.index,h,l,s,n,a),h+=l}getBrushInfo(e){const t=new Int32Array(e.voice.bar.staff.tuning.length);if(e.brushType!==Ye.None){let r=0,s=0;for(const n of e.notes)n.isTieDestination||(r|=1<<n.string-1,s++);if(e.notes.length>0){let n=0;const a=e.brushDuration/(s-1)|0;for(let o=0;o<e.voice.bar.staff.tuning.length;o++){let l=e.brushType===Ye.ArpeggioDown||e.brushType===Ye.BrushDown?o:t.length-1-o;r&1<<l&&(t[l]=n,n+=a)}}}return t}generateAutomation(e,t,r){switch(t.type){case Dt.Instrument:this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+r,e.voice.bar.staff.track.playbackInfo.primaryChannel,(t.value|0)&255),this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+r,e.voice.bar.staff.track.playbackInfo.secondaryChannel,(t.value|0)&255);break;case Dt.Balance:let s=Re.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+r,e.voice.bar.staff.track.playbackInfo.primaryChannel,Ae.PanCoarse,s),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+r,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Ae.PanCoarse,s);break;case Dt.Volume:let n=Re.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+r,e.voice.bar.staff.track.playbackInfo.primaryChannel,Ae.VolumeCoarse,n),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+r,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Ae.VolumeCoarse,n);break}}prepareSingleBeat(e){let t=-1,r=-1,s=e;for(;s&&(t===-1||r===-1);){for(const h of e.automations)switch(h.type){case Dt.Instrument:r=h.value;break;case Dt.Tempo:t=h.value;break}s=s.previousBeat}const n=e.voice.bar.staff.track,a=e.voice.bar.masterBar;t===-1&&(t=a.score.tempo),r===-1&&(r=n.playbackInfo.program);const o=n.playbackInfo.volume;this.generateTrack(n),this._handler.addTimeSignature(0,a.timeSignatureNumerator,a.timeSignatureDenominator),this._handler.addTempo(0,t);let l=Re.toChannelShort(o);this._handler.addControlChange(0,0,n.playbackInfo.primaryChannel,Ae.VolumeCoarse,l),this._handler.addControlChange(0,0,n.playbackInfo.secondaryChannel,Ae.VolumeCoarse,l)}generateSingleBeat(e){this.prepareSingleBeat(e),this.generateBeat(e,-e.playbackStart,e.voice.bar)}generateSingleNote(e){this.prepareSingleBeat(e.beat),this.generateNote(e,0,e.beat.playbackDuration,new Int32Array(e.beat.voice.bar.staff.tuning.length))}}Re.DefaultDurationDead=30;Re.DefaultDurationPalmMute=80;Re.PitchBendRangeInSemitones=8*2;Re.PitchValuePerSemitone=ce.DefaultPitchWheel/Re.PitchBendRangeInSemitones;Re.MinBreakpointsPerSemitone=6;Re.MillisecondsPerBreakpoint=150;class zx{constructor(){this.startTick=0,this.endTick=0}}class bt{constructor(e,t){this.width=0,this.height=0,this.x=e,this.y=t}get scale(){return this.renderer.scale}doLayout(){}paint(e,t,r){}}class Qr extends bt{constructor(e=0,t=0){super(e,t),this.beat=null,this.nextGlyph=null,this.previousGlyph=null}}class ft extends Qr{constructor(e,t,r,s){super(e,t),this.glyphScale=0,this.glyphScale=r,this.symbol=s}paint(e,t,r){r.fillMusicFontSymbol(e+this.x,t+this.y,this.glyphScale*this.scale,this.symbol,!1)}}class ue extends ft{constructor(e,t,r,s){super(e,t,s?ue.GraceScale:1,ue.getSymbol(r)),this._isGrace=s,this._duration=r}paint(e,t,r){let s=this._isGrace?this.scale:0;r.fillMusicFontSymbol(e+this.x,t+this.y+s,this.glyphScale*this.scale,this.symbol,!1)}doLayout(){let e=(this._isGrace?ue.GraceScale:1)*this.scale;switch(this._duration){case B.QuadrupleWhole:this.width=14*e;break;case B.DoubleWhole:this.width=14*(this._isGrace?ue.GraceScale:1)*this.scale;break;case B.Whole:this.width=14*(this._isGrace?ue.GraceScale:1)*this.scale;break;default:this.width=ue.QuarterNoteHeadWidth*(this._isGrace?ue.GraceScale:1)*this.scale;break}this.height=ue.NoteHeadHeight*e}static getSymbol(e){switch(e){case B.QuadrupleWhole:return g.NoteheadDoubleWholeSquare;case B.DoubleWhole:return g.NoteheadDoubleWhole;case B.Whole:return g.NoteheadWhole;case B.Half:return g.NoteheadHalf;default:return g.NoteheadBlack}}}ue.GraceScale=.75;ue.NoteHeadHeight=8;ue.QuarterNoteHeadWidth=9;class $l extends ft{constructor(e,t,r,s,n){super(e,t,n?ue.GraceScale:1,$l.getSymbol(r,s,n))}doLayout(){this.width=0}static getSymbol(e,t,r){if(r&&(e=B.Eighth),t===D.Up)switch(e){case B.Eighth:return g.FlagEighthUp;case B.Sixteenth:return g.FlagSixteenthUp;case B.ThirtySecond:return g.FlagThirtySecondUp;case B.SixtyFourth:return g.FlagSixtyFourthUp;case B.OneHundredTwentyEighth:return g.FlagOneHundredTwentyEighthUp;case B.TwoHundredFiftySixth:return g.FlagTwoHundredFiftySixthUp;default:return g.FlagEighthUp}switch(e){case B.Eighth:return g.FlagEighthDown;case B.Sixteenth:return g.FlagSixteenthDown;case B.ThirtySecond:return g.FlagThirtySecondDown;case B.SixtyFourth:return g.FlagSixtyFourthDown;case B.OneHundredTwentyEighth:return g.FlagOneHundredTwentyEighthDown;case B.TwoHundredFiftySixth:return g.FlagOneHundredTwentyEighthDown;default:return g.FlagEighthDown}}}$l.FlagWidth=11;class Nr extends bt{get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(e,t){super(0,0),this.ties=[],this.minWidth=0,this.beat=e,this.ties=[],this.voiceContainer=t}addTie(e){e.renderer=this.renderer,this.ties.push(e)}drawBeamHelperAsFlags(e){return e.hasFlag(!1,void 0)}registerLayoutingInfo(e){let t=this.preNotes.computedWidth+this.onNotes.centerX;this.beat.graceGroup&&!this.beat.graceGroup.isComplete&&(t+=Nr.GraceBeatPadding*this.renderer.scale);let r=this.onNotes.computedWidth-this.onNotes.centerX;const s=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(s&&this.drawBeamHelperAsFlags(s)||this.beat.graceType!==K.None)&&(r+=$l.FlagWidth*this.scale*(this.beat.graceType!==K.None?ue.GraceScale:1));for(const n of this.ties)r+=n.width;this.beat.graceType!==K.None&&(r+=Nr.GraceBeatPadding*this.renderer.scale),e.addBeatSpring(this.beat,t,r),e.setPreBeatSize(this.beat,this.preNotes.computedWidth),e.setOnBeatSize(this.beat,this.onNotes.computedWidth),e.setBeatCenterX(this.beat,this.onNotes.centerX)}applyLayoutingInfo(e){let t=e.getBeatCenterX(this.beat)-this.onNotes.centerX;this.beat.graceGroup&&!this.beat.graceGroup.isComplete&&(t+=Nr.GraceBeatPadding*this.renderer.scale),this.preNotes.x=t,this.preNotes.width=e.getPreBeatSize(this.beat),this.onNotes.width=e.getOnBeatSize(this.beat),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();let e=this.beat.notes.length-1;for(;e>=0;)this.createTies(this.beat.notes[e--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(this.onNotes.beamingHelper.beats.length===1)this.beat.duration>=B.Eighth&&(this.minWidth+=20*this.scale);else switch(this.beat.duration){case B.OneHundredTwentyEighth:case B.TwoHundredFiftySixth:this.minWidth+=10*this.scale;break}let e=0;for(let t of this.ties)t.width>e&&(e=t.width);this.minWidth+=e,this.width=this.minWidth}scaleToWidth(e){this.onNotes.updateBeamingHelper(),this.width=e}createTies(e){}static getGroupId(e){return"b"+e.id}paint(e,t,r){if(this.beat.voice.isEmpty||this.preNotes.isEmpty&&this.onNotes.isEmpty&&this.ties.length===0)return;r.beginGroup(Nr.getGroupId(this.beat)),this.preNotes.paint(e+this.x,t+this.y,r),this.onNotes.paint(e+this.x,t+this.y,r);let n=e-this.voiceContainer.x-this.renderer.x,a=t-this.voiceContainer.y-this.renderer.y;for(let o=0,l=this.ties.length;o<l;o++){let h=this.ties[o];h.renderer=this.renderer,h.paint(n,a,r)}r.endGroup()}buildBoundingsLookup(e,t,r,s){let n=new Dx;n.beat=this.beat,n.visualBounds=new Ti,n.visualBounds.x=t+this.x+this.onNotes.x,n.visualBounds.y=e.visualBounds.y,n.visualBounds.w=this.onNotes.width,n.visualBounds.h=e.visualBounds.h,n.realBounds=new Ti,n.realBounds.x=t+this.x,n.realBounds.y=e.realBounds.y,n.realBounds.w=this.width,n.realBounds.h=e.realBounds.h,s&&(n.visualBounds.x=t+this.x,n.realBounds.x=n.visualBounds.x),e.addBeat(n),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(n,t+this.x,r+this.y)}}Nr.GraceBeatPadding=3;class J1{constructor(){this.oldWidth=0,this.newWidth=0,this.settings=null}core(){return this.settings&&this.causeIssue()?this.settings.core:new Zx}causeIssue(){return this.settings=null,!0}}class Gx{constructor(e){this.activeBeats=e}}class Ch{constructor(e){this.bounds=null,this.beat=e}}class B4{constructor(e,t){this._startTime=0,this._trackIndexes=null,this._trackIndexLookup=null,this._isDestroyed=!1,this.score=null,this.tracks=[],this._tickCache=null,this.player=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._playerState=Nt.Paused,this._currentBeat=null,this._currentBarBounds=null,this._previousStateForCursor=Nt.Paused,this._previousCursorCache=null,this._lastScroll=0,this.playedBeatChanged=new xe,this.activeBeatsChanged=new xe,this._beatMouseDown=!1,this._noteMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new xe,this.beatMouseMove=new xe,this.beatMouseUp=new xe,this.noteMouseDown=new xe,this.noteMouseMove=new xe,this.noteMouseUp=new xe,this.scoreLoaded=new xe,this.resize=new xe,this.renderStarted=new xe,this.renderFinished=new xe,this.postRenderFinished=new At,this.error=new xe,this.playerReady=new At,this.playerFinished=new At,this.soundFontLoaded=new At,this.midiLoad=new xe,this.midiLoaded=new xe,this.playerStateChanged=new xe,this.playerPositionChanged=new xe,this.midiEventsPlayed=new xe,this.playbackRangeChanged=new xe,this.settingsUpdated=new At,this.uiFacade=e,this.container=e.rootContainer,e.initialize(this,t),L.logLevel=this.settings.core.logLevel,this.canvasElement=e.createCanvasElement(),this.container.appendChild(this.canvasElement),this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&A.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this.renderer=this.uiFacade.createWorkerRenderer():this.renderer=new Hx(this.settings),this.container.resize.on(A.throttle(()=>{this._isDestroyed||this.container.width!==this.renderer.width&&this.triggerResize()},e.resizeThrottle));let r=new J1;r.oldWidth=this.renderer.width,r.newWidth=this.container.width|0,r.settings=this.settings,this.onResize(r),this.renderer.preRender.on(this.onRenderStarted.bind(this)),this.renderer.renderFinished.on(s=>{this.onRenderFinished(s)}),this.renderer.postRenderFinished.on(()=>{let s=Date.now()-this._startTime;L.debug("rendering","Rendering completed in "+s+"ms"),this.onPostRenderFinished()}),this.renderer.preRender.on(s=>{this._startTime=Date.now()}),this.renderer.partialLayoutFinished.on(this.appendRenderResult.bind(this)),this.renderer.partialRenderFinished.on(this.updateRenderResult.bind(this)),this.renderer.renderFinished.on(s=>{this.appendRenderResult(s),this.appendRenderResult(null)}),this.renderer.error.on(this.onError.bind(this)),this.settings.player.enablePlayer&&this.setupPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}destroy(){this._isDestroyed=!0,this.player&&this.player.destroy(),this.uiFacade.destroy(),this.renderer.destroy()}updateSettings(){var t;const e=this.score;e&&$e.applyPitchOffsets(this.settings,e),this.renderer.updateSettings(this.settings),this.settings.player.enablePlayer?(this.setupPlayer(),e&&((t=this.player)==null||t.applyTranspositionPitches(Re.buildTranspositionPitches(e,this.settings)))):this.destroyPlayer(),this.onSettingsUpdated()}load(e,t){try{return this.uiFacade.load(e,r=>{this.renderScore(r,t)},r=>{this.onError(r)})}catch(r){return this.onError(r),!1}}renderScore(e,t){let r=[];if(!t)e.tracks.length>0&&r.push(e.tracks[0]);else if(t.length===0)e.tracks.length>0&&r.push(e.tracks[0]);else if(t.length===1&&t[0]===-1)for(let s of e.tracks)r.push(s);else for(let s of t)s>=0&&s<=e.tracks.length&&r.push(e.tracks[s]);this.internalRenderTracks(e,r)}renderTracks(e){if(e.length>0){let t=e[0].score;for(let r of e)if(r.score!==t){this.onError(new Yt(Ut.General,"All rendered tracks must belong to the same score."));return}this.internalRenderTracks(t,e)}}internalRenderTracks(e,t){if($e.applyPitchOffsets(this.settings,e),e!==this.score){this.score=e,this.tracks=t,this._trackIndexes=[];for(let r of t)this._trackIndexes.push(r.index);this._trackIndexLookup=new Set(this._trackIndexes),this.onScoreLoaded(e),this.loadMidiForScore(),this.render()}else{this.tracks=t,this._trackIndexes=[];for(let r of t)this._trackIndexes.push(r.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(!this.container.isVisible)L.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{L.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()});else{let e=new J1;e.oldWidth=this.renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this.onResize(e),this.renderer.updateSettings(this.settings),this.renderer.width=this.container.width,this.renderer.resizeRender()}}appendRenderResult(e){e?(this.canvasElement.width=e.totalWidth,this.canvasElement.height=e.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=e.totalWidth,this._cursorWrapper.height=e.totalHeight),(e.width>0||e.height>0)&&this.uiFacade.beginAppendRenderResults(e)):this.uiFacade.beginAppendRenderResults(e)}updateRenderResult(e){e&&e.renderResult&&this.uiFacade.beginUpdateRenderResults(e)}tex(e,t){try{let r=new li;r.logErrors=!0,r.initFromString(e,this.settings);let s=r.readScore();this.renderScore(s,t)}catch(r){this.onError(r)}}loadSoundFont(e,t=!1){return this.player?this.uiFacade.loadSoundFont(e,t):!1}resetSoundFonts(){this.player&&this.player.resetSoundFonts()}render(){this.renderer&&(this.uiFacade.canRender?(this.renderer.width=this.container.width,this.renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render()))}get tickCache(){return this._tickCache}get isReadyForPlayback(){return this.player?this.player.isReadyForPlayback:!1}get playerState(){return this.player?this.player.state:Nt.Paused}get masterVolume(){return this.player?this.player.masterVolume:0}set masterVolume(e){this.player&&(this.player.masterVolume=e)}get metronomeVolume(){return this.player?this.player.metronomeVolume:0}set metronomeVolume(e){this.player&&(this.player.metronomeVolume=e)}get countInVolume(){return this.player?this.player.countInVolume:0}set countInVolume(e){this.player&&(this.player.countInVolume=e)}get midiEventsPlayedFilter(){return this.player?this.player.midiEventsPlayedFilter:[]}set midiEventsPlayedFilter(e){this.player&&(this.player.midiEventsPlayedFilter=e)}get tickPosition(){return this.player?this.player.tickPosition:0}set tickPosition(e){this.player&&(this.player.tickPosition=e)}get timePosition(){return this.player?this.player.timePosition:0}set timePosition(e){this.player&&(this.player.timePosition=e)}get playbackRange(){return this.player?this.player.playbackRange:null}set playbackRange(e){this.player&&(this.player.playbackRange=e,this.settings.player.enableCursor&&this.updateSelectionCursor(e))}get playbackSpeed(){return this.player?this.player.playbackSpeed:0}set playbackSpeed(e){this.player&&(this.player.playbackSpeed=e)}get isLooping(){return this.player?this.player.isLooping:!1}set isLooping(e){this.player&&(this.player.isLooping=e)}destroyPlayer(){this.player&&(this.player.destroy(),this.player=null,this._previousTick=0,this._playerState=Nt.Paused,this.destroyCursors())}setupPlayer(){this.updateCursors(),!this.player&&(this.player=this.uiFacade.createWorkerPlayer(),this.player&&(this.player.ready.on(()=>{this.loadMidiForScore()}),this.player.readyForPlayback.on(()=>{if(this.onPlayerReady(),this.tracks)for(let e of this.tracks){let t=e.playbackInfo.volume/16;this.player.setChannelVolume(e.playbackInfo.primaryChannel,t),this.player.setChannelVolume(e.playbackInfo.secondaryChannel,t)}}),this.player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this.player.soundFontLoadFailed.on(e=>{this.onError(e)}),this.player.midiLoaded.on(this.onMidiLoaded.bind(this)),this.player.midiLoadFailed.on(e=>{this.onError(e)}),this.player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this.player.positionChanged.on(this.onPlayerPositionChanged.bind(this)),this.player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this.player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this.player.finished.on(this.onPlayerFinished.bind(this)),this.setupPlayerEvents()))}loadMidiForScore(){if(!this.player||!this.score||!this.player.isReady)return;L.debug("AlphaTab","Generating Midi");let e=new fn,t=new ns(e),r=new Re(this.score,this.settings,t);r.applyTranspositionPitches=!1,r.generate(),this._tickCache=r.tickLookup,this.onMidiLoad(e),this.player.loadMidiFile(e),this.player.applyTranspositionPitches(r.transpositionPitches)}changeTrackVolume(e,t){if(this.player)for(let r of e)this.player.setChannelVolume(r.playbackInfo.primaryChannel,t),this.player.setChannelVolume(r.playbackInfo.secondaryChannel,t)}changeTrackSolo(e,t){if(this.player)for(let r of e)this.player.setChannelSolo(r.playbackInfo.primaryChannel,t),this.player.setChannelSolo(r.playbackInfo.secondaryChannel,t)}changeTrackMute(e,t){if(this.player)for(let r of e)this.player.setChannelMute(r.playbackInfo.primaryChannel,t),this.player.setChannelMute(r.playbackInfo.secondaryChannel,t)}play(){return this.player?this.player.play():!1}pause(){this.player&&this.player.pause()}playPause(){this.player&&this.player.playPause()}stop(){this.player&&this.player.stop()}playBeat(e){if(!this.player)return;let t=new fn,r=new ns(t);new Re(e.voice.bar.staff.track.score,this.settings,r).generateSingleBeat(e),this.player.playOneTimeMidiFile(t)}playNote(e){if(!this.player)return;let t=new fn,r=new ns(t);new Re(e.beat.voice.bar.staff.track.score,this.settings,r).generateSingleNote(e),this.player.playOneTimeMidiFile(t)}destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}updateCursors(){if(this.settings.player.enableCursor&&!this._cursorWrapper){let e=this.uiFacade.createCursors();e&&(this._cursorWrapper=e.cursorWrapper,this._barCursor=e.barCursor,this._beatCursor=e.beatCursor,this._selectionWrapper=e.selectionWrapper),this._currentBeat!==null&&this.cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,!0)}else!this.settings.player.enableCursor&&this._cursorWrapper&&this.destroyCursors()}setupPlayerEvents(){this._previousTick=0,this._playerState=Nt.Paused,this.renderer.postRenderFinished.on(()=>{this._currentBeat=null,this.cursorUpdateTick(this._previousTick,!1,this._previousTick>10)}),this.player&&(this.player.positionChanged.on(e=>{this._previousTick=e.currentTick,this.uiFacade.beginInvoke(()=>{this.cursorUpdateTick(e.currentTick,!1)})}),this.player.stateChanged.on(e=>{if(this._playerState=e.state,!e.stopped&&e.state===Nt.Paused){let t=this._currentBeat,r=this._tickCache;t&&r&&(this.player.tickPosition=r.getBeatStart(t.beat))}}))}cursorUpdateTick(e,t,r=!1){let s=this._tickCache;if(s){let n=this._trackIndexLookup;if(n!=null&&n.size>0){let a=s.findBeat(n,e,this._currentBeat);a&&this.cursorUpdateBeat(a,t,r)}}}cursorUpdateBeat(e,t,r,s=!1){var f;const n=e.beat,a=((f=e.nextBeat)==null?void 0:f.beat)??null,o=e.duration,l=e.beatLookup.highlightedBeats;if(!n)return;let h=this.renderer.boundsLookup;if(!h)return;let u=this._currentBeat,c=this._previousCursorCache,d=this._previousStateForCursor;if(!s&&n===(u==null?void 0:u.beat)&&h===c&&d===this._playerState)return;let p=h.findBeat(n);p&&(this._currentBeat=e,this._previousCursorCache=h,this._previousStateForCursor=this._playerState,this.uiFacade.beginInvoke(()=>{this.internalCursorUpdateBeat(n,a,o,t,l,h,p,r)}))}scrollToCursor(){const e=this._currentBarBounds;e&&this.internalScrollToCursor(e)}internalScrollToCursor(e){let t=this.uiFacade.getScrollContainer(),r=A.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,s=this.settings.player.scrollMode;if(r){let n=e.realBounds.y+this.settings.player.scrollOffsetY;if(n!==this._lastScroll)switch(this._lastScroll=n,s){case vs.Continuous:let a=this.uiFacade.getOffset(t,this.container);this.uiFacade.scrollToY(t,a.y+n,this.settings.player.scrollSpeed);break;case vs.OffScreen:let o=t.scrollTop+this.uiFacade.getOffset(null,t).h;if(e.visualBounds.y+e.visualBounds.h>=o||e.visualBounds.y<t.scrollTop){let l=e.realBounds.y+this.settings.player.scrollOffsetY;this.uiFacade.scrollToY(t,l,this.settings.player.scrollSpeed)}break}}else{let n=e.visualBounds.x;if(n!==this._lastScroll)switch(this._lastScroll=n,s){case vs.Continuous:let a=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,a,this.settings.player.scrollSpeed);break;case vs.OffScreen:let o=t.scrollLeft+this.uiFacade.getOffset(null,t).w;if(e.visualBounds.x+e.visualBounds.w>=o||e.visualBounds.x<t.scrollLeft){let l=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,l,this.settings.player.scrollSpeed)}break}}}internalCursorUpdateBeat(e,t,r,s,n,a,o,l){const h=this._barCursor,u=this._beatCursor;let c=o.barBounds.masterBarBounds,d=c.visualBounds;this._currentBarBounds=c,h&&h.setBounds(d.x,d.y,d.w,d.h),u&&(this.settings.player.enableAnimatedBeatCursor&&u.stopAnimation(),u.setBounds(o.visualBounds.x,d.y,1,d.h)),this.settings.player.enableElementHighlighting&&this.uiFacade.removeHighlights();let p=!1;if(this._playerState===Nt.Playing&&!s){if(this.settings.player.enableElementHighlighting)for(let f of n){let m=Nr.getGroupId(f.beat);this.uiFacade.highlightElements(m,e.voice.bar.index)}if(this.settings.player.enableAnimatedBeatCursor){let f=c.visualBounds.x+c.visualBounds.w;if(t){let m=a.findBeat(t);m&&m.barBounds.masterBarBounds.staffSystemBounds===c.staffSystemBounds&&(f=m.visualBounds.x)}this.uiFacade.beginInvoke(()=>{u&&u.transitionToX(r/this.playbackSpeed,f)})}l=!s,p=!0}l&&!this._beatMouseDown&&this.settings.player.scrollMode!==vs.Off&&this.internalScrollToCursor(c),p&&(this.onPlayedBeatChanged(e),this.onActiveBeatsChanged(new Gx(n.map(f=>f.beat))))}onPlayedBeatChanged(e){this._isDestroyed||(this.playedBeatChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",e))}onActiveBeatsChanged(e){this._isDestroyed||(this.activeBeatsChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",e))}onBeatMouseDown(e,t){this._isDestroyed||(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new Ch(t),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseDown",t,e))}onNoteMouseDown(e,t){this._isDestroyed||(this._noteMouseDown=!0,this.noteMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseDown",t,e))}onBeatMouseMove(e,t){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==t)&&(this._selectionEnd=new Ch(t),this.cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseMove",t,e))}onNoteMouseMove(e,t){this._isDestroyed||(this.noteMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseMove",t,e))}onBeatMouseUp(e,t){var r,s;if(!this._isDestroyed){if(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){let n=((r=this._tickCache)==null?void 0:r.getBeatStart(this._selectionStart.beat))??this._selectionStart.beat.absolutePlaybackStart;if((((s=this._tickCache)==null?void 0:s.getBeatStart(this._selectionEnd.beat))??this._selectionEnd.beat.absolutePlaybackStart)<n){let o=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=o}}if(this._selectionStart&&this._tickCache){let n=this._tickCache,a=n.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._playerState===Nt.Paused&&this.cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1),this.tickPosition=a+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){let o=n.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),l=new zx;l.startTick=a+this._selectionStart.beat.playbackStart,l.endTick=o+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=l}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseUp",t,e),this._beatMouseDown=!1}}onNoteMouseUp(e,t){this._isDestroyed||(this.noteMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseUp",t,e),this._noteMouseDown=!1)}updateSelectionCursor(e){if(this._tickCache)if(e){const t=this._tickCache.findBeat(this._trackIndexLookup,e.startTick),r=this._tickCache.findBeat(this._trackIndexLookup,e.endTick);if(t&&r){const s=new Ch(t.beat),n=new Ch(r.beat);this.cursorSelectRange(s,n)}}else this.cursorSelectRange(null,null)}setupClickHandling(){this.canvasElement.mouseDown.on(e=>{var n,a;if(!e.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&e.preventDefault();let t=e.getX(this.canvasElement),r=e.getY(this.canvasElement),s=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,r))??null;if(s&&(this.onBeatMouseDown(e,s),this.settings.core.includeNoteBounds)){const o=(a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(s,t,r);o&&this.onNoteMouseDown(e,o)}}),this.canvasElement.mouseMove.on(e=>{var n,a;if(!this._beatMouseDown)return;let t=e.getX(this.canvasElement),r=e.getY(this.canvasElement),s=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,r))??null;if(s&&(this.onBeatMouseMove(e,s),this._noteMouseDown)){const o=(a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(s,t,r);o&&this.onNoteMouseMove(e,o)}}),this.canvasElement.mouseUp.on(e=>{var n,a;if(!this._beatMouseDown)return;this.settings.player.enableUserInteraction&&e.preventDefault();let t=e.getX(this.canvasElement),r=e.getY(this.canvasElement),s=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,r))??null;if(this.onBeatMouseUp(e,s),this._noteMouseDown)if(s){const o=((a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(s,t,r))??null;this.onNoteMouseUp(e,o)}else this.onNoteMouseUp(e,null)}),this.renderer.postRenderFinished.on(()=>{!this._selectionStart||!this.settings.player.enablePlayer||!this.settings.player.enableCursor||!this.settings.player.enableUserInteraction||this.cursorSelectRange(this._selectionStart,this._selectionEnd)})}cursorSelectRange(e,t){var h,u;let r=this.renderer.boundsLookup;if(!r)return;let s=this._selectionWrapper;if(!s||(s.clear(),!e||!t||e.beat===t.beat))return;e.bounds||(e.bounds=r.findBeat(e.beat)),t.bounds||(t.bounds=r.findBeat(t.beat));let n=((h=this._tickCache)==null?void 0:h.getBeatStart(e.beat))??e.beat.absolutePlaybackStart;if((((u=this._tickCache)==null?void 0:u.getBeatStart(t.beat))??t.beat.absolutePlaybackStart)<n){let c=e;e=t,t=c}let o=e.bounds.realBounds.x,l=t.bounds.realBounds.x+t.bounds.realBounds.w;if(t.beat.index===t.beat.voice.beats.length-1&&(l=t.bounds.barBounds.masterBarBounds.realBounds.x+t.bounds.barBounds.masterBarBounds.realBounds.w),e.bounds.barBounds.masterBarBounds.staffSystemBounds!==t.bounds.barBounds.masterBarBounds.staffSystemBounds){let c=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,d=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,p=this.uiFacade.createSelectionElement();p.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,d-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(p);let f=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1,m=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let y=f;y<m;y++){let b=r.staffSystems[y],w=this.uiFacade.createSelectionElement();w.setBounds(c,b.visualBounds.y,d-c,b.visualBounds.h),s.appendChild(w)}let S=this.uiFacade.createSelectionElement();S.setBounds(c,t.bounds.barBounds.masterBarBounds.visualBounds.y,l-c,t.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(S)}else{let c=this.uiFacade.createSelectionElement();c.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,l-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(c)}}onScoreLoaded(e){this._isDestroyed||(this.scoreLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"scoreLoaded",e))}onResize(e){this._isDestroyed||(this.resize.trigger(e),this.uiFacade.triggerEvent(this.container,"resize",e))}onRenderStarted(e){this._isDestroyed||(this.renderStarted.trigger(e),this.uiFacade.triggerEvent(this.container,"renderStarted",e))}onRenderFinished(e){this._isDestroyed||(this.renderFinished.trigger(e),this.uiFacade.triggerEvent(this.container,"renderFinished",e))}onPostRenderFinished(){this._isDestroyed||(this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}onError(e){this._isDestroyed||(L.error("API","An unexpected error occurred",e),this.error.trigger(e),this.uiFacade.triggerEvent(this.container,"error",e))}onPlayerReady(){this._isDestroyed||(this.playerReady.trigger(),this.uiFacade.triggerEvent(this.container,"playerReady",null))}onPlayerFinished(){this._isDestroyed||(this.playerFinished.trigger(),this.uiFacade.triggerEvent(this.container,"playerFinished",null))}onSoundFontLoaded(){this._isDestroyed||(this.soundFontLoaded.trigger(),this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null))}onMidiLoad(e){this._isDestroyed||(this.midiLoad.trigger(e),this.uiFacade.triggerEvent(this.container,"midiLoad",e))}onMidiLoaded(e){this._isDestroyed||(this.midiLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",e))}onPlayerStateChanged(e){this._isDestroyed||(this.playerStateChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playerStateChanged",e))}onPlayerPositionChanged(e){this._isDestroyed||this.score!==null&&this.tracks.length>0&&(this.playerPositionChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",e))}onMidiEventsPlayed(e){this._isDestroyed||(this.midiEventsPlayed.trigger(e),this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",e))}onPlaybackRangeChanged(e){this._isDestroyed||(this.playbackRangeChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",e))}onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}}class ws extends Yt{constructor(e,t){super(Ut.General,e),this.xhr=t,Object.setPrototypeOf(this,ws.prototype)}}class Fa{static loadScoreAsync(e,t,r,s){let n=new XMLHttpRequest;n.open("GET",e,!0,null,null),n.responseType="arraybuffer",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){let a=n.response;if(n.status===200||n.status===0&&a)try{let o=n.response,l=new Uint8Array(o),h=Fa.loadScoreFromBytes(l,s);t(h)}catch(o){r(o)}else n.status===0?r(new ws(`You are offline!!
 Please Check Your Network.`,n)):n.status===404?r(new ws("Requested URL not found.",n)):n.status===500?r(new ws("Internel Server Error.",n)):n.statusText==="parsererror"?r(new ws(`Error.
Parsing JSON Request failed.`,n)):n.statusText==="timeout"?r(new ws("Request Time out.",n)):r(new ws("Unknow Error: "+n.responseText,n))}},n.send()}static loadScoreFromBytes(e,t){t||(t=new ia);let r=A.buildImporters();L.debug("ScoreLoader",`Loading score from ${e.length} bytes using ${r.length} importers`);let s=null,n=Gt.fromBuffer(e);for(let a of r){n.reset();try{L.debug("ScoreLoader","Importing using importer "+a.name),a.init(n,t),s=a.readScore(),L.debug("ScoreLoader","Score imported using "+a.name);break}catch(o){if(o instanceof tt)L.debug("ScoreLoader",a.name+" does not support the file");else throw L.error("ScoreLoader","Score import failed due to unexpected error: ",o),o}}if(s)return s;throw new tt("No compatible importer found for file")}}class of{get isLeftMouseButton(){return this.mouseEvent.button===0}getX(e){let t=e.element,s=t.getBoundingClientRect().left+t.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-s}getY(e){let t=e.element,s=t.getBoundingClientRect().top+t.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-s}preventDefault(){this.mouseEvent.preventDefault()}constructor(e){this.mouseEvent=e}}class as{get width(){return this.element.offsetWidth}set width(e){this.element.style.width=e+"px"}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(e){this.element.scrollTop=e}get scrollTop(){return this.element.scrollLeft}set scrollTop(e){this.element.scrollTop=e}get height(){return this.element.offsetHeight}set height(e){e>=0?this.element.style.height=e+"px":this.element.style.height="100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}constructor(e){this._resizeListeners=0,this.lastBounds=new Ti,this.element=e,this.mouseDown={on:t=>{this.element.addEventListener("mousedown",r=>{t(new of(r))},!0)},off:t=>{}},this.mouseUp={on:t=>{this.element.addEventListener("mouseup",r=>{t(new of(r))},!0)},off:t=>{}},this.mouseMove={on:t=>{this.element.addEventListener("mousemove",r=>{t(new of(r))},!0)},off:t=>{}},this.resize={on:t=>{this._resizeListeners===0&&as.resizeObserver.value.observe(this.element),this.element.addEventListener("resize",t,!0),this._resizeListeners++},off:t=>{this.element.removeEventListener("resize",t,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,as.resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(e,t){this.element.style.transition=`transform ${e}ms linear`,this.setBounds(t,NaN,NaN,NaN)}setBounds(e,t,r,s){isNaN(e)&&(e=this.lastBounds.x),isNaN(t)&&(t=this.lastBounds.y),isNaN(r)&&(r=this.lastBounds.w),isNaN(s)&&(s=this.lastBounds.h),this.element.style.transform=`translate(${e}px, ${t}px) scale(${r}, ${s})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=r,this.lastBounds.h=s}appendChild(e){this.element.appendChild(e.element)}clear(){this.element.innerHTML=""}}as.resizeObserver=new fx(()=>new ResizeObserver(i=>{for(const e of i){let t=new CustomEvent("resize",{detail:e});e.target.dispatchEvent(t)}}));class Ux{constructor(e){this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new xe,this._originalFamilies=e,this._families=e}checkForFontAvailability(){if(A.isRunningInWorker){this.isFontLoaded=!1;return}if(this._isStarted)return;this._isStarted=!0;let e=0,t=window.setInterval(()=>{L.warning("Rendering",`Could not load font '${this._families[0]}' within ${(e+1)*5} seconds`,null),this._families.length>1?(this._families.shift(),e=0):e++},5e3);L.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);let r=a=>{this._families.length>1?(L.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,a),this._families.shift(),window.setTimeout(()=>{n()},0)):(L.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,a),window.clearInterval(t))},s=a=>{L.debug("Font",`[${a}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(t),this.fontLoaded.trigger(this._families[0])},n=async()=>{for(const a of this._families)if(await this.isFontAvailable(a,!1)){s(a);return}try{await document.fonts.load(`1em ${this._families[0]}`)}catch(a){r(a)}return L.debug("Font",`[${this._families[0]}] Font API signaled loaded`),await this.isFontAvailable(this._families[0],!0)?s(this._families[0]):r("Font not available"),!0};document.fonts.ready.then(()=>{n()})}isFontAvailable(e,t){return new Promise(r=>{const s="1em "+e;if(document.fonts.check(s))r(!0);else if(t){L.debug("Font",`Font ${e} not available, creating test element to trigger load`);const n=document.createElement("div");n.style.font=s,n.style.opacity="0",n.style.position="absolute",n.style.top="0",n.style.left="0",n.innerText=`Trigger ${e} load`,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n),document.fonts.check(s)?r(!0):r(!1)},200)}else r(!1)})}}class Ym{constructor(e){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(e)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(e,t,r){let s=0;r>this._buffer.length-this.count&&(r=this._buffer.length-this.count);const n=Math.min(this._buffer.length-this._writePosition,r);return this._buffer.set(e.subarray(t,t+n),this._writePosition),this._writePosition+=n,this._writePosition%=this._buffer.length,s+=n,s<r&&(this._buffer.set(e.subarray(t+s,t+s+r-s),this._writePosition),this._writePosition+=r-s,s=r),this.count+=s,s}read(e,t,r){r>this.count&&(r=this.count);let s=0;const n=Math.min(this._buffer.length-this._readPosition,r);return e.set(this._buffer.subarray(this._readPosition,this._readPosition+n),t),s+=n,this._readPosition+=n,this._readPosition%=this._buffer.length,s<r&&(e.set(this._buffer.subarray(this._readPosition,this._readPosition+r-s),t+s),this._readPosition+=r-s,s=r),this.count-=s,s}}class or{constructor(){this._context=null,this._buffer=null,this._source=null,this.ready=new At,this.samplesPlayed=new xe,this.sampleRequest=new At}get sampleRate(){return this._context?this._context.sampleRate:or.PreferredSampleRate}activate(e){this._context||(this._context=this.createAudioContext()),(this._context.state==="suspended"||this._context.state==="interrupted")&&(L.debug("WebAudio","Audio Context is suspended, trying resume"),this._context.resume().then(()=>{var t,r;L.debug("WebAudio",`Audio Context resume success: state=${(t=this._context)==null?void 0:t.state}, sampleRate:${(r=this._context)==null?void 0:r.sampleRate}`),e&&e()},t=>{var r,s;L.warning("WebAudio",`Audio Context resume failed: state=${(r=this._context)==null?void 0:r.state}, sampleRate:${(s=this._context)==null?void 0:s.sampleRate}, reason=${t}`)}))}patchIosSampleRate(){let e=navigator.userAgent;if(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1){let t=this.createAudioContext(),r=t.createBuffer(1,1,or.PreferredSampleRate),s=t.createBufferSource();s.buffer=r,s.connect(t.destination),s.start(0),s.disconnect(0),t.close()}}createAudioContext(){if("AudioContext"in A.globalThis)return new AudioContext;if("webkitAudioContext"in A.globalThis)return new webkitAudioContext;throw new Yt(Ut.General,"AudioContext not found")}open(e){this.patchIosSampleRate(),this._context=this.createAudioContext(),this._context.state==="suspended"&&this.registerResumeHandler()}registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this.unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}unregisterResumeHandler(){const e=this._resumeHandler;e&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}play(){let e=this._context;this.activate(),this._buffer=e.createBuffer(2,or.BufferSize,e.sampleRate),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0}pause(){this._source&&(this._source.stop(0),this._source.disconnect()),this._source=null}destroy(){var e;this.pause(),(e=this._context)==null||e.close(),this._context=null,this.unregisterResumeHandler()}onSamplesPlayed(e){this.samplesPlayed.trigger(e)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}}or.BufferSize=4096;or.PreferredSampleRate=44100;class Yx extends or{constructor(){super(...arguments),this._audioNode=null,this._bufferCount=0,this._requestedBufferCount=0,this._outputBuffer=new Float32Array(0)}open(e){super.open(e),this._bufferCount=Math.floor(e*this.sampleRate/1e3/or.BufferSize),this._circularBuffer=new Ym(or.BufferSize*this._bufferCount),this.onReady()}play(){super.play();let e=this._context;this._audioNode=e.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(e.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(e){this._circularBuffer.write(e,0,e.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}requestBuffers(){const e=this._bufferCount/2|0;let t=e*or.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*or.BufferSize<t){for(let s=0;s<e;s++)this.onSampleRequest();this._requestedBufferCount+=e}}generateSound(e){let t=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1),s=t.length+r.length,n=this._outputBuffer;n.length!==s&&(n=new Float32Array(s),this._outputBuffer=n);const a=this._circularBuffer.read(n,0,Math.min(n.length,this._circularBuffer.count));let o=0;for(let l=0;l<t.length;l++)t[l]=n[o++],r[l]=n[o++];this.onSamplesPlayed(a/ce.AudioChannels),this.requestBuffers()}}class _4{constructor(e,t){this.loaded=e,this.total=t}}class jp{get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return L.logLevel}set logLevel(e){L.logLevel=e,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:e})}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,ce.MinVolume),this._masterVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:e})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,ce.MinVolume),this._metronomeVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:e})}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,ce.MinVolume),this._countInVolume=e,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:e})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:e})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){e=mt.clamp(e,ce.MinPlaybackSpeed,ce.MaxPlaybackSpeed),this._playbackSpeed=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:e})}get tickPosition(){return this._tickPosition}set tickPosition(e){e<0&&(e=0),this._tickPosition=e,this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:e})}get timePosition(){return this._timePosition}set timePosition(e){e<0&&(e=0),this._timePosition=e,this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:e})}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:e})}get playbackRange(){return this._playbackRange}set playbackRange(e){e&&(e.startTick<0&&(e.startTick=0),e.endTick<0&&(e.endTick=0)),this._playbackRange=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:e})}constructor(e,t){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=Nt.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._midiEventsPlayedFilter=[],this.ready=new At,this.readyForPlayback=new At,this.finished=new At,this.soundFontLoaded=new At,this.soundFontLoadFailed=new xe,this.midiLoaded=new xe,this.midiLoadFailed=new xe,this.stateChanged=new xe,this.positionChanged=new xe,this.midiEventsPlayed=new xe,this.playbackRangeChanged=new xe,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=Nt.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._output=e,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(t.player.bufferTimeInMilliseconds);try{this._synth=A.createWebWorker(t)}catch(r){L.error("AlphaSynth","Failed to create WebWorker: "+r)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:t.core.logLevel,bufferTimeInMilliseconds:t.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:Bt.midiFileToJsObject(e)})}loadSoundFont(e,t){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:e,append:t})}loadSoundFontFromUrl(e,t,r){L.debug("AlphaSynth",`Start loading Soundfont from url ${e}`);let s=new XMLHttpRequest;s.open("GET",e,!0,null,null),s.responseType="arraybuffer",s.onload=n=>{let a=new Uint8Array(s.response);this.loadSoundFont(a,t)},s.onerror=n=>{L.error("AlphaSynth","Loading failed: "+n.message),this.soundFontLoadFailed.trigger(new ws(n.message,s))},s.onprogress=n=>{L.debug("AlphaSynth",`Soundfont downloading: ${n.loaded}/${n.total} bytes`),r(new _4(n.loaded,n.total))},s.send()}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:Bt.midiFileToJsObject(e)})}applyTranspositionPitches(e){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(e.entries()))})}setChannelMute(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:e,mute:t})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:e,solo:t})}setChannelVolume(e,t){t=Math.max(t,ce.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:e,volume:t})}handleWorkerMessage(e){let t=e.data;switch(t.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._timePosition=t.currentTime,this._tickPosition=t.currentTick,this.positionChanged.trigger(new xl(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek));break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new Wm(t.events.map(Bt.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=t.state,this.stateChanged.trigger(new Yo(t.state,t.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=t.playbackRange,this.playbackRangeChanged.trigger(new zm(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(t.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this.midiLoaded.trigger(new xl(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek));break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(t.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(t.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples();break}}checkReady(){this.isReady&&this.ready.trigger()}checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(e){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:e})}onOutputReady(){this._outputIsReady=!0,this.checkReady()}}class T4{constructor(e,t){this._width=0,this.boundsLookup=null,this.preRender=new xe,this.partialRenderFinished=new xe,this.partialLayoutFinished=new xe,this.renderFinished=new xe,this.postRenderFinished=new At,this.error=new xe,this._api=e;try{this._worker=A.createWebWorker(t)}catch(r){L.error("Rendering",`Failed to create WebWorker: ${r}`);return}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(t)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(e){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(e)})}serializeSettingsForWorker(e){const t=Bt.settingsToJsObject(e);return t.delete("player"),t}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(e){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:e})}get width(){return this._width}set width(e){this._width=e,this._worker.postMessage({cmd:"alphaTab.setWidth",width:e})}handleWorkerMessage(e){let t=e.data;switch(t.cmd){case"alphaTab.preRender":this.preRender.trigger(t.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(t.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(t.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(t.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=Cl.fromJson(t.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(t.error);break}}renderScore(e,t){let r=e==null?null:Bt.scoreToJsObject(e);this._worker.postMessage({cmd:"alphaTab.renderScore",score:r,trackIndexes:t,fontSizes:hi.FontSizeLookupTables})}}class C4{constructor(e,t,r,s){this.cursorWrapper=e,this.barCursor=t,this.beatCursor=r,this.selectionWrapper=s}}class Nl{static init(){var e;Nl._isRegistered||(Nl._isRegistered=!0,registerProcessor("alphatab",(e=class extends AudioWorkletProcessor{constructor(r){super(r),this._outputBuffer=new Float32Array(0),this._bufferCount=0,this._requestedBufferCount=0,L.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(r.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/e.BufferSize),this._circularBuffer=new Ym(e.BufferSize*this._bufferCount),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(r){let s=r.data;switch(s.cmd){case nt.CmdOutputAddSamples:const a=s.samples;this._circularBuffer.write(a,0,a.length),this._requestedBufferCount--;break;case nt.CmdOutputResetSamples:this._circularBuffer.clear();break}}process(r,s,n){if(s.length!==1&&s[0].length!==2)return!1;let a=s[0][0],o=s[0][1];if(!a||!o)return!0;let l=a.length+o.length,h=this._outputBuffer;h.length!==l&&(h=new Float32Array(l),this._outputBuffer=h);const u=this._circularBuffer.read(h,0,Math.min(h.length,this._circularBuffer.count));let c=0;for(let d=0;d<a.length;d++)a[d]=h[c++],o[d]=h[c++];return this.port.postMessage({cmd:nt.CmdOutputSamplesPlayed,samples:u/ce.AudioChannels}),this.requestBuffers(),!0}requestBuffers(){const r=this._bufferCount/2|0;let s=r*e.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*e.BufferSize<s){for(let a=0;a<r;a++)this.port.postMessage({cmd:nt.CmdOutputSampleRequest});this._requestedBufferCount+=r}}},e.BufferSize=4096,e)))}}Nl._isRegistered=!1;class $x extends or{constructor(e){super(),this._worklet=null,this._bufferTimeInMilliseconds=0,this._settings=e}open(e){super.open(e),this._bufferTimeInMilliseconds=e,this.onReady()}play(){super.play();let e=this._context;A.createAudioWorklet(e,this._settings).then(()=>{this._worklet=new AudioWorkletNode(e,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this.handleMessage.bind(this),this._source.connect(this._worklet),this._source.start(0),this._worklet.connect(e.destination)},t=>{L.error("WebAudio",`Audio Worklet creation failed: reason=${t}`)})}handleMessage(e){let t=e.data;switch(t.cmd){case nt.CmdOutputSamplesPlayed:this.onSamplesPlayed(t.samples);break;case nt.CmdOutputSampleRequest:this.onSampleRequest();break}}pause(){super.pause(),this._worklet&&(this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(e){var t;(t=this._worklet)==null||t.port.postMessage({cmd:nt.CmdOutputAddSamples,samples:e})}resetSamples(){var e;(e=this._worklet)==null||e.port.postMessage({cmd:nt.CmdOutputResetSamples})}}class N4 extends as{constructor(e,t,r){super(e),this._xscale=t,this._yscale=r}get width(){return this.element.offsetWidth/this._xscale}set width(e){this.element.style.width=e*this._xscale+"px"}get height(){return this.element.offsetHeight/this._yscale}set height(e){e>=0?this.element.style.height=e*this._yscale+"px":this.element.style.height="100%"}setBounds(e,t,r,s){isNaN(e)&&(e=this.lastBounds.x),isNaN(t)&&(t=this.lastBounds.y),isNaN(r)?r=this.lastBounds.w:r=r/this._xscale,isNaN(s)?s=this.lastBounds.h:s=s/this._yscale,this.element.style.transform=`translate(${e}px, ${t}px) scale(${r}, ${s})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=r,this.lastBounds.h=s}}var es;(function(i){i[i.LayoutDone=0]="LayoutDone",i[i.RenderRequested=1]="RenderRequested",i[i.RenderDone=2]="RenderDone",i[i.Detached=3]="Detached"})(es||(es={}));class P4{get resizeThrottle(){return 10}get canRender(){return this.areAllFontsLoaded()}areAllFontsLoaded(){if(A.bravuraFontChecker.checkForFontAvailability(),!A.bravuraFontChecker.isFontLoaded)return!1;let e=!1;for(const t of this._fontCheckers.values())t.isFontLoaded||(e=!0);return e?!1:(L.debug("Font","All fonts loaded: "+this._fontCheckers.size),!0)}onFontLoaded(e){hi.generateFontLookup(e),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(e){if(this._fontCheckers=new Map,this._contents=null,this._file=null,this._totalResultCount=0,this._initialTrackIndexes=null,this._barToElementLookup=new Map,this._resultIdToElementLookup=new Map,this.rootContainerBecameVisible=new At,this.canRenderChanged=new At,this._highlightedElements=[],this._scrollContainer=null,A.webPlatform!==$i.Browser&&A.webPlatform!==$i.BrowserModule)throw new Yt(Ut.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");e.classList.add("alphaTab"),this.rootContainer=new as(e),this.areWorkersSupported="Worker"in window,A.bravuraFontChecker.fontLoaded.on(this.onFontLoaded.bind(this)),this._intersectionObserver=new IntersectionObserver(this.onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(e)}onElementVisibilityChanged(e){for(const t of e){const r=t.target;if(r===this.rootContainer.element)t.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in r&&this._api.settings.core.enableLazyLoading){const s=r;t.isIntersecting?s.renderedResultId!==s.layoutResultId?this._resultIdToElementLookup.has(s.layoutResultId)?s.resultState!==es.RenderRequested&&(s.resultState=es.RenderRequested,this._api.renderer.renderResult(s.layoutResultId)):r.replaceChildren():s.resultState===es.Detached&&(r.replaceChildren(...s.renderedResult),s.resultState=es.RenderDone):s.resultState===es.RenderDone&&(s.resultState=es.Detached,s.replaceChildren())}}}createWorkerRenderer(){return new T4(this._api,this._api.settings)}initialize(e,t){this._api=e;let r;t instanceof ia?r=t:r=Bt.jsObjectToSettings(t);let s=this.getDataAttributes();io.fromJson(r,s),r.notation.notationMode===Ot.SongBook&&r.setSongBookModeSettings(),e.settings=r,this.setupFontCheckers(r),this._initialTrackIndexes=this.parseTracks(r.core.tracks),this._contents="";let n=e.container;r.core.tex&&(this._contents=n.element.innerHTML,n.element.innerHTML=""),this.createStyleElement(r),this._file=r.core.file}setupFontCheckers(e){this.registerFontChecker(e.display.resources.copyrightFont),this.registerFontChecker(e.display.resources.effectFont),this.registerFontChecker(e.display.resources.fingeringFont),this.registerFontChecker(e.display.resources.graceFont),this.registerFontChecker(e.display.resources.markerFont),this.registerFontChecker(e.display.resources.tablatureFont),this.registerFontChecker(e.display.resources.titleFont),this.registerFontChecker(e.display.resources.wordsFont),this.registerFontChecker(e.display.resources.barNumberFont),this.registerFontChecker(e.display.resources.fretboardNumberFont),this.registerFontChecker(e.display.resources.subTitleFont)}registerFontChecker(e){if(!this._fontCheckers.has(e.families.join(", "))){let t=new Ux(e.families);this._fontCheckers.set(e.families.join(", "),t),t.fontLoaded.on(this.onFontLoaded.bind(this)),t.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML=""}createCanvasElement(){let e=document.createElement("div");return e.className="at-surface",e.style.fontSize="0",e.style.overflow="hidden",e.style.lineHeight="0",e.style.position="relative",new as(e)}triggerEvent(e,t,r=null,s){let n=e.element;t="alphaTab."+t;let a=document.createEvent("CustomEvent"),o=s?s.mouseEvent:null;if(a.initCustomEvent(t,!1,!1,r),o&&(a.originalEvent=o),n.dispatchEvent(a),window&&"jQuery"in window){let l=window.jQuery,h=[];h.push(r),o&&h.push(o),l(n).trigger(t,h)}}load(e,t,r){if(e instanceof ha)return t(e),!0;if(e instanceof ArrayBuffer){let s=new Uint8Array(e);return t(Fa.loadScoreFromBytes(s,this._api.settings)),!0}return e instanceof Uint8Array?(t(Fa.loadScoreFromBytes(e,this._api.settings)),!0):typeof e=="string"?(Fa.loadScoreAsync(e,t,r,this._api.settings),!0):!1}loadSoundFont(e,t){return this._api.player?e instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(e),t),!0):e instanceof Uint8Array?(this._api.player.loadSoundFont(e,t),!0):typeof e=="string"?(this._api.loadSoundFontFromUrl(e,t),!0):!1:!1}initialRender(){this._api.renderer.preRender.on(t=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const e=()=>{this._api.renderer.width=this.rootContainer.width|0,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&Fa.loadScoreAsync(this._file,t=>{this._api.renderScore(t,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},t=>{this._api.onError(t)},this._api.settings)};this.rootContainer.isVisible?e():this.rootContainerBecameVisible.on(e)}createStyleElement(e){let t=this._api.container.element.ownerDocument;A.createStyleElement(t,e.core.fontDirectory)}parseTracks(e){if(!e)return[];let t=[];if(typeof e=="string")try{if(e==="all")return[-1];e=JSON.parse(e)}catch{e=[0]}if(typeof e=="number")t.push(e);else if("length"in e){let r=e.length,s=e;for(let n=0;n<r;n++){let a=s[n],o=0;typeof a=="number"?o=a:"index"in a?o=a.index:o=parseInt(a.toString()),(o>=0||o===-1)&&t.push(o)}}else"index"in e&&t.push(e.index);return t}getDataAttributes(){let e=new Map,t=this._api.container.element;if(t.dataset)for(let r of Object.keys(t.dataset)){let s=t.dataset[r];try{s=JSON.parse(s)}catch{s===""&&(s=null)}e.set(r,s)}else for(let r=0;r<t.attributes.length;r++){let s=t.attributes.item(r),n=s.nodeName;if(n.startsWith("data-")){let a=n.substr(5).split("-"),o=a[0];for(let h=1;h<a.length;h++)o+=a[h].substr(0,1).toUpperCase()+a[h].substr(1);let l=s.nodeValue;try{l=JSON.parse(l)}catch{l===""&&(l=null)}e.set(o,l)}}return e}beginUpdateRenderResults(e){if(!this._resultIdToElementLookup.has(e.id))return;const t=this._resultIdToElementLookup.get(e.id),r=e.renderResult;typeof r=="string"?t.innerHTML=r:"nodeType"in r&&t.replaceChildren(r),t.resultState=es.RenderDone,t.renderedResultId=e.id,t.renderedResult=Array.from(t.children)}beginAppendRenderResults(e){const t=this._api.canvasElement.element;if(e){let r;this._totalResultCount<t.childElementCount?r=t.childNodes.item(this._totalResultCount):(r=document.createElement("div"),t.appendChild(r)),r.style.zIndex="1",r.style.position="absolute",r.style.left=e.x+"px",r.style.top=e.y+"px",r.style.width=e.width+"px",r.style.height=e.height+"px",r.style.display="inline-block",r.layoutResultId=e.id,r.resultState=es.LayoutDone,delete r.renderedResultId,delete r.renderedResult,this._resultIdToElementLookup.set(e.id,r);for(let s=e.firstMasterBarIndex;s<=e.lastMasterBarIndex;s++)s>=0&&this._barToElementLookup.set(s,r);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(r),this._intersectionObserver.observe(r)),this._totalResultCount++}else for(;t.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(t.lastChild),t.removeChild(t.lastElementChild)}createWorkerPlayer(){let e=null,t="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===Tl.WebAudioAudioWorklets?(L.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),e=new jp(new $x(this._api.settings),this._api.settings)):t&&(L.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),e=new jp(new Yx,this._api.settings)),e?e.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):L.error("Player","Player requires webworkers and web audio api, browser unsupported",null),e}beginInvoke(e){window.requestAnimationFrame(()=>{e()})}highlightElements(e,t){const r=this._barToElementLookup.get(t);if(r){let s=r.getElementsByClassName(e);for(let n=0;n<s.length;n++)s.item(n).classList.add("at-highlight"),this._highlightedElements.push(s.item(n))}}removeHighlights(){const e=this._highlightedElements;if(e){for(const t of e)t.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){let e=this._api.container.element,t=e.querySelector(".at-cursors");e.removeChild(t)}createCursors(){let e=this._api.container.element,t=document.createElement("div");t.classList.add("at-cursors");let r=document.createElement("div");r.classList.add("at-selection");const s=this.createScalingElement(),n=this.createScalingElement();let a=s.element;a.classList.add("at-cursor-bar");let o=n.element;return o.classList.add("at-cursor-beat"),e.style.position="relative",e.style.textAlign="left",t.style.position="absolute",t.style.zIndex="1000",t.style.display="inline",t.style.pointerEvents="none",r.style.position="absolute",a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.willChange="transform",s.width=1,s.height=1,s.setBounds(0,0,1,1),o.style.position="absolute",o.style.transition="all 0s linear",o.style.left="0",o.style.top="0",o.style.willChange="transform",n.width=3,n.height=1,n.setBounds(0,0,1,1),e.insertBefore(t,e.firstChild),t.appendChild(r),t.appendChild(a),t.appendChild(o),new C4(new as(t),s,n,new as(r))}getOffset(e,t){let r=t.element,s=r.getBoundingClientRect(),n=s.top+r.ownerDocument.defaultView.pageYOffset,a=s.left+r.ownerDocument.defaultView.pageXOffset;if(e){let l=e.element,h=l.nodeName.toLowerCase();if(h!=="html"&&h!=="body"){let u=this.getOffset(null,e);n=n+l.scrollTop-u.y,a=a+l.scrollLeft-u.x}}let o=new Ti;return o.x=a,o.y=n,o.w=s.width,o.h=s.height,o}getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let e=typeof this._api.settings.player.scrollElement=="string"?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement,t=e.nodeName.toLowerCase();return(t==="html"||t==="body")&&("scrollingElement"in document?e=document.scrollingElement:navigator.userAgent.indexOf("WebKit")!==-1?e=document.body:e=document.documentElement),this._scrollContainer=new as(e),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const e=document.createElement("div");e.style.position="absolute";const t=new N4(e,100,100);return t.width=1,t.height=1,t.setBounds(0,0,1,1),t}scrollToY(e,t,r){this.internalScrollToY(e.element,t,r)}scrollToX(e,t,r){this.internalScrollToX(e.element,t,r)}internalScrollToY(e,t,r){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({top:t,behavior:"smooth"});else{let s=e.scrollTop,n=t-s,a=0,o=l=>{a===0&&(a=l);let h=l-a,u=Math.min(h/r,1);e.scrollTop=s+n*u|0,h<r&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}internalScrollToX(e,t,r){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({left:t,behavior:"smooth"});else{let s=e.scrollLeft,n=t-s,a=0,o=l=>{a===0&&(a=l);let h=l-a,u=Math.min(h/r,1);e.scrollLeft=s+n*u|0,h<r&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}}class id extends B4{constructor(e,t){super(new P4(e),t),this.soundFontLoad=new xe}tex(e,t){let r=this.uiFacade;super.tex(e,r.parseTracks(t))}print(e,t=null){let r=window.open("","","width=0,height=0"),s=r.document.createElement("div");e?s.style.width=e:this.settings.display.layoutMode===Es.Horizontal?s.style.width="297mm":s.style.width="210mm",r.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <style>
            .at-surface {
                width: auto !important;
                height: auto !important;
            }
            .at-surface > div {
                position: relative!important;
                left: auto !important;
                top: auto !important;
                break-inside: avoid;
            }
            </style>
          </head>
          <body></body>
        </html>
        `);const n=this.score;n&&(n.artist&&n.title?r.document.title=`${n.title} - ${n.artist}`:n.title&&(r.document.title=`${n.title}`)),r.document.body.appendChild(s);let a=typeof window.screenLeft<"u"?window.screenLeft:window.left,o=typeof window.screenTop<"u"?window.screenTop:window.top,l="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,h="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,u=s.offsetWidth+50,c=window.innerHeight,d=(l/2|0)-(u/2|0)+a,p=(h/2|0)-(c/2|0)+o;r.resizeTo(u,c),r.moveTo(d,p),r.focus();let f=Bt.jsObjectToSettings(Bt.settingsToJsObject(this.settings));f.core.enableLazyLoading=!1,f.core.useWorkers=!0,f.core.file=null,f.core.tracks=null,f.player.enableCursor=!1,f.player.enablePlayer=!1,f.player.enableElementHighlighting=!1,f.player.enableUserInteraction=!1,f.player.soundFont=null,f.display.scale=.8,f.display.stretchForce=.8,io.fromJson(f,t);let m=new id(s,f);r.onunload=()=>{m.destroy()},m.renderer.postRenderFinished.on(()=>{r.print()}),m.renderTracks(this.tracks)}downloadMidi(e=to.SingleTrackMultiChannel){if(!this.score)return;let t=new fn;t.format=e;let r=new ns(t,!0);new Re(this.score,this.settings,r).generate();let n=t.toBinary(),a=this.score.title?`${this.score.title}.mid`:"File.mid",o=document.createElement("a");o.download=a;let l=new Blob([n],{type:"audio/midi"}),h=URL.createObjectURL(l);o.href=h,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}changeTrackMute(e,t){let r=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackMute(r,t)}changeTrackSolo(e,t){let r=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackSolo(r,t)}changeTrackVolume(e,t){let r=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackVolume(r,t)}trackIndexesToTracks(e){if(!this.score)return[];let t=[];if(e.length===1&&e[0]===-1)for(let r of this.score.tracks)t.push(r);else for(let r of e)r>=0&&r<this.score.tracks.length&&t.push(this.score.tracks[r]);return t}loadSoundFontFromUrl(e,t){this.player&&this.player.loadSoundFontFromUrl(e,t,r=>{this.soundFontLoad.trigger(r),this.uiFacade.triggerEvent(this.container,"soundFontLoad",r)})}}class Z1{constructor(){this._initListeners=[]}exec(e,t,r){if(typeof t!="string"&&(r=[t],t="init"),t.charCodeAt(0)===95||t==="exec")return null;let s=new jQuery(e),n=s.data("alphaTab");if(t==="destroy"&&!n)return null;if(t!=="init"&&!n)throw new Error("alphaTab not initialized");let a=this[t];if(a){let o=[s,n].concat(r);return a.apply(this,o)}else return L.error("Api","Method '"+t+"' does not exist on jQuery.alphaTab"),null}init(e,t,r){if(!t){t=new id(e[0],r),e.data("alphaTab",t);for(let s of this._initListeners)s(e,t,r)}}destroy(e,t){e.removeData("alphaTab"),t.destroy()}print(e,t,r,s){t.print(r,s)}load(e,t,r,s){return t.load(r,s)}render(e,t){t.render()}renderScore(e,t,r,s){t.renderScore(r,s)}renderTracks(e,t,r){t.renderTracks(r)}invalidate(e,t){t.render()}tex(e,t,r,s){t.tex(r,s)}muteTrack(e,t,r,s){t.changeTrackMute(r,s)}soloTrack(e,t,r,s){t.changeTrackSolo(r,s)}trackVolume(e,t,r,s){t.changeTrackVolume(r,s)}loadSoundFont(e,t,r,s){t.loadSoundFont(r,s)}resetSoundFonts(e,t){t.resetSoundFonts()}pause(e,t){t.pause()}play(e,t){return t.play()}playPause(e,t){t.playPause()}stop(e,t){t.stop()}api(e,t){return t}player(e,t){return t.player}isReadyForPlayback(e,t){return t.isReadyForPlayback}playerState(e,t){return t.playerState}masterVolume(e,t,r){return typeof r=="number"&&(t.masterVolume=r),t.masterVolume}metronomeVolume(e,t,r){return typeof r=="number"&&(t.metronomeVolume=r),t.metronomeVolume}countInVolume(e,t,r){return typeof r=="number"&&(t.countInVolume=r),t.countInVolume}midiEventsPlayedFilter(e,t,r){return Array.isArray(r)&&(t.midiEventsPlayedFilter=r),t.midiEventsPlayedFilter}playbackSpeed(e,t,r){return typeof r=="number"&&(t.playbackSpeed=r),t.playbackSpeed}tickPosition(e,t,r){return typeof r=="number"&&(t.tickPosition=r),t.tickPosition}timePosition(e,t,r){return typeof r=="number"&&(t.timePosition=r),t.timePosition}loop(e,t,r){return typeof r=="boolean"&&(t.isLooping=r),t.isLooping}renderer(e,t){return t.renderer}score(e,t){return t.score}settings(e,t){return t.settings}tracks(e,t){return t.tracks}_oninit(e){this._initListeners.push(e)}static restore(e){new jQuery(e).empty().removeData("alphaTab")}}class $m{constructor(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.color=new Oe(255,255,255,255),this.lineWidth=1,this.font=new Ce("Arial",10,lt.Plain),this.textAlign=Q.Left,this.textBaseline=le.Top}destroy(){}beginRender(e,t){this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${e|0}px" height="${t|0}px" class="at-surface-svg">
`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=le.Top}beginGroup(e){this.buffer+=`<g class="${e}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(e,t,r,s){r>0&&(this.buffer+=`<rect x="${e|0}" y="${t|0}" width="${r}" height="${s}" fill="${this.color.rgba}" />
`)}strokeRect(e,t,r,s){this.buffer+=`<rect x="${e|0}" y="${t|0}" width="${r}" height="${s}" stroke="${this.color.rgba}"`,this.lineWidth!==1&&(this.buffer+=` stroke-width="${this.lineWidth}"`),this.buffer+=` fill="transparent" />
`}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(e,t){this._currentPath+=` M${e},${t}`}lineTo(e,t){this._currentPathIsEmpty=!1,this._currentPath+=` L${e},${t}`}quadraticCurveTo(e,t,r,s){this._currentPathIsEmpty=!1,this._currentPath+=` Q${e},${t},${r},${s}`}bezierCurveTo(e,t,r,s,n,a){this._currentPathIsEmpty=!1,this._currentPath+=` C${e},${t},${r},${s},${n},${a}`}fillCircle(e,t,r){this._currentPathIsEmpty=!1,this._currentPath+=` M${e-r},${t} A1,1 0 0,0 ${e+r},${t} A1,1 0 0,0 ${e-r},${t} z`,this.fill()}strokeCircle(e,t,r){this._currentPathIsEmpty=!1,this._currentPath+=` M${e-r},${t} A1,1 0 0,0 ${e+r},${t} A1,1 0 0,0 ${e-r},${t} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let e=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;this.lineWidth!==1&&(e+=` stroke-width="${this.lineWidth}"`),e+=' style="fill: none" />',this.buffer+=e}this._currentPath="",this._currentPathIsEmpty=!0}fillText(e,t,r){if(e==="")return;let s=`<text x="${t|0}" y="${r|0}" style="stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}"`;this.color.rgba!=="#000000"&&(s+=` fill="${this.color.rgba}"`),this.textAlign!==Q.Left&&(s+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),s+=`>${$m.escapeText(e)}</text>`,this.buffer+=s}static escapeText(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(e){switch(e){case Q.Left:return"start";case Q.Center:return"middle";case Q.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case le.Top:return"dominant-baseline: hanging";case le.Bottom:return"dominant-baseline: bottom";default:return""}}measureText(e){return e?hi.measureString(e,this.font.families,this.font.size,this.font.style,this.font.weight):new Jc(0,0)}onRenderFinished(){return null}beginRotate(e,t,r){this.buffer+='<g transform="translate('+e+" ,"+t+") rotate( "+r+')">'}endRotate(){this.buffer+="</g>"}}class E4 extends $m{constructor(){super()}fillMusicFontSymbol(e,t,r,s,n){s!==g.None&&this.fillMusicFontSymbolText(e,t,r,`&#${s};`,n)}fillMusicFontSymbols(e,t,r,s,n){let a="";for(let o of s)o!==g.None&&(a+=`&#${o};`);this.fillMusicFontSymbolText(e,t,r,a,n)}fillMusicFontSymbolText(e,t,r,s,n){this.buffer+=`<g transform="translate(${e} ${t})" class="at" ><text`,r!==1?this.buffer+=` style="font-size: ${r*100}%; stroke:none"`:this.buffer+=' style="stroke:none"',this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),n&&(this.buffer+=' text-anchor="'+this.getSvgTextAlignment(Q.Center)+'"'),this.buffer+=`>${s}</text></g>`}}class rd{constructor(){this.isInAccolade=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}canCreate(e,t){return!this.hideOnPercussionTrack||!t.isPercussion}}var be;(function(i){i[i.PreNotes=0]="PreNotes",i[i.OnNotes=1]="OnNotes",i[i.MiddleNotes=2]="MiddleNotes",i[i.Stem=3]="Stem",i[i.PostNotes=4]="PostNotes",i[i.EndBeat=5]="EndBeat"})(be||(be={}));class qr extends bt{get isEmpty(){return!this.glyphs||this.glyphs.length===0}constructor(e,t){super(e,t),this.glyphs=null}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}let e=0;for(let t=0,r=this.glyphs.length;t<r;t++){let s=this.glyphs[t];s.renderer=this.renderer,s.doLayout(),e=Math.max(e,s.width)}this.width=e}addGlyph(e){this.glyphs||(this.glyphs=[]),this.renderer&&(e.renderer=this.renderer),this.glyphs.push(e)}paint(e,t,r){let s=this.glyphs;if(!(!s||s.length===0))for(let n of s)n.paint(e+this.x,t+this.y,r)}}class xo extends qr{constructor(){super(0,0),this.glyphs=[]}addGlyph(e){e.x=this.glyphs.length===0?0:this.glyphs[this.glyphs.length-1].x+this.glyphs[this.glyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width,super.addGlyph(e)}}class Xx extends qr{constructor(e,t,r){super(e,t),this.voice=r,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(e){const t=this.renderer.scale;let r=this.renderer.layoutingInfo.spaceToForce(e/t);this.scaleToForce(r)}scaleToForce(e){const t=this.renderer.scale;this.width=this.renderer.layoutingInfo.calculateVoiceWidth(e)*t;let r=this.renderer.layoutingInfo.buildOnTimePositions(e),s=this.beatGlyphs;for(let n=0,a=s.length;n<a;n++){let o=s[n];switch(o.beat.graceType){case K.None:o.x=r.get(o.beat.absoluteDisplayStart)*t-o.onTimeX;break;default:const l=o.beat.graceGroup.beats[0].absoluteDisplayStart,h=o.beat.graceGroup.id;if(o.beat.graceGroup.isComplete&&r.has(l)){o.x=r.get(l)*t-o.onTimeX;let u=this.renderer.layoutingInfo.allGraceRods.get(h);const c=o.beat.graceGroup.beats[o.beat.graceGroup.beats.length-1].nextBeat,d=c?this.renderer.layoutingInfo.getPreBeatSize(c)+Nr.GraceBeatPadding*this.renderer.scale:0;o.x-=d,o.x-=u[o.beat.graceIndex].postSpringWidth,o.x+=u[o.beat.graceIndex].graceBeatWidth;const p=u[o.beat.graceGroup.beats.length-1];o.x-=p.graceBeatWidth}else{let u=this.renderer.layoutingInfo.incompleteGraceRods.get(h);const c=u[o.beat.graceIndex].postSpringWidth-u[o.beat.graceIndex].preSpringWidth;n>0?o.beat.graceIndex===0?o.x=s[n-1].x+s[n-1].width:o.x=s[n-1].x+u[o.beat.graceIndex-1].postSpringWidth-u[o.beat.graceIndex-1].preSpringWidth-c:o.x=-c}break}if(n>0){let l=o.x-s[n-1].x;s[n-1].scaleToWidth(l)}if(n===a-1){let l=this.width-s[s.length-1].x;o.scaleToWidth(l)}}}registerLayoutingInfo(e){e.updateVoiceSize(this.width);let t=this.beatGlyphs;for(let r of t)r.registerLayoutingInfo(e)}applyLayoutingInfo(e){let t=this.beatGlyphs;for(let r of t)r.applyLayoutingInfo(e);this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,e.minStretchForce))}addGlyph(e){let t=e;e.x=this.beatGlyphs.length===0?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.beatGlyphs.push(t),this.width=e.x+e.width,t.beat.hasTuplet&&t.beat.tupletGroup.beats[0].id===t.beat.id&&this.tupletGroups.push(t.beat.tupletGroup)}doLayout(){}paint(e,t,r){r.color=this.voice.index===0?this.renderer.resources.mainGlyphColor:this.renderer.resources.secondaryGlyphColor;for(let s=0,n=this.beatGlyphs.length;s<n;s++)this.beatGlyphs[s].paint(e+this.x,t+this.y,r)}}Xx.KeySizeBeat="Beat";var Fe;(function(i){i[i.None=0]="None",i[i.Natural=1]="Natural",i[i.Sharp=2]="Sharp",i[i.Flat=3]="Flat",i[i.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",i[i.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",i[i.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",i[i.DoubleSharp=7]="DoubleSharp",i[i.DoubleFlat=8]="DoubleFlat"})(Fe||(Fe={}));class M4{constructor(){this.maxLine=-1e3,this.minLine=-1e3}}class vt{constructor(e){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._barRenderer=e,this._bar=e.bar}static getPercussionLine(e,t){var r;return t<e.staff.track.percussionArticulations.length?e.staff.track.percussionArticulations[t].staffLine:((r=xt.getArticulationByValue(t))==null?void 0:r.staffLine)??0}static getNoteValue(e){if(e.isPercussion)return e.percussionArticulation;let t=e.displayValue;switch(e.accidentalMode){case kt.ForceDoubleFlat:t+=2;break;case kt.ForceDoubleSharp:t-=2;break;case kt.ForceFlat:t+=1;break;case kt.ForceSharp:t-=1;break}return t}applyAccidental(e){const t=vt.getNoteValue(e);let r=e.hasQuarterToneOffset;return this.getAccidental(t,r,e.beat,!1,e)}applyAccidentalForValue(e,t,r,s){return this.getAccidental(t,r,e,s,null)}static computeLineWithoutAccidentals(e,t){let r=0;const s=vt.getNoteValue(t);if(e.staff.isPercussion)r=vt.getPercussionLine(e,s);else{const n=t?t.accidentalMode:kt.Default;r=vt.calculateNoteLine(e,s,n)}return r}getAccidental(e,t,r,s,n=null){let a=Fe.None,o=0;if(this._bar.staff.isPercussion)o=vt.getPercussionLine(this._bar,e);else{const l=n?n.accidentalMode:kt.Default;o=vt.calculateNoteLine(this._bar,e,l);let u=this._bar.masterBar.keySignature+7,c=e%12,d=u<7?Fe.Flat:Fe.Sharp,p=vt.KeySignatureLookup[u][c],f=vt.AccidentalNotes[c];if(t)switch(a=f?d:Fe.Natural,a){case Fe.Natural:a=Fe.NaturalQuarterNoteUp;break;case Fe.Sharp:a=Fe.SharpQuarterNoteUp;break;case Fe.Flat:a=Fe.FlatQuarterNoteUp;break}else{switch(l){case kt.ForceSharp:a=Fe.Sharp;break;case kt.ForceDoubleSharp:a=Fe.DoubleSharp;break;case kt.ForceFlat:a=Fe.Flat;break;case kt.ForceDoubleFlat:a=Fe.DoubleFlat;break;default:f?a=d:p&&(a=Fe.Natural);break}let m=!1;if(n&&n.isTieDestination&&n.beat.index===0){const S=this._barRenderer.previousRenderer;S&&S.accidentalHelper.getNoteLine(n.tieOrigin)===o&&(m=!0)}m?a=Fe.None:a!==Fe.None?(this._registeredAccidentals.has(o)?this._registeredAccidentals.get(o)===a&&(a=Fe.None):p&&a===d&&(a=Fe.None),a!==Fe.None&&this._registeredAccidentals.set(o,a)):this._registeredAccidentals.has(o)?this._registeredAccidentals.get(o)===Fe.Natural?a=Fe.None:(a=Fe.Natural,this._registeredAccidentals.set(o,a)):this._registeredAccidentals.delete(o)}}return n?(this._appliedScoreLines.set(n.id,o),this._notesByValue.set(e,n)):this._appliedScoreLinesByValue.set(e,o),(this.minLine===-1e3||this.minLine<o)&&(this.minLine=o,this.minLineBeat=r),(this.maxLine===-1e3||this.maxLine>o)&&(this.maxLine=o,this.maxLineBeat=r),s||this.registerLine(r,o),a}registerLine(e,t){let r;this._beatLines.has(e.id)?r=this._beatLines.get(e.id):(r=new M4,this._beatLines.set(e.id,r)),(r.minLine===-1e3||t<r.minLine)&&(r.minLine=t),(r.minLine===-1e3||t>r.maxLine)&&(r.maxLine=t)}getMaxLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLine:0}getMinLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLine:0}static calculateNoteLine(e,t,r){let s=t,n=e.masterBar.keySignature,a=e.clef,o=s%12,l=(s/12|0)-1,h=vt.OctaveSteps[a];h-=l*vt.StepsPerOctave;let u=$e.keySignatureIsSharp(n)||$e.keySignatureIsNatural(n)?vt.SharpNoteSteps:vt.FlatNoteSteps;return h-=u[o],h}getNoteLine(e){return this._appliedScoreLines.get(e.id)}getNoteLineForValue(e,t=!1){return this._appliedScoreLinesByValue.has(e)?this._appliedScoreLinesByValue.get(e):t&&this._notesByValue.has(e)?this.getNoteLine(this._notesByValue.get(e)):0}}vt.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]];vt.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1];vt.StepsPerOctave=7;vt.OctaveSteps=[38,32,30,26,38];vt.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6];vt.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6];class L4{constructor(){this.staffId="",this.up=0,this.down=0}}class R4{constructor(){this.startBeat=null,this.startX=0,this.startY=0,this.endBeat=null,this.endX=0,this.endY=0}calcY(e){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(e-this.startX)+this.startY}}class zr{get isRestBeamHelper(){return this.beats.length===1&&this.beats[0].isRest}hasLine(e,t){return e&&this.beatHasLine(t)||!e&&this.beats.length===1&&this.beatHasLine(t)}beatHasLine(e){return e.duration>B.Whole}hasFlag(e,t){return e&&this.beatHasFlag(t)||!e&&this.beats.length===1&&this.beatHasFlag(this.beats[0])}beatHasFlag(e){return!e.isRest&&(e.duration>B.Quarter||e.graceType!==K.None)}constructor(e,t){this._beatLineXPositions=new Map,this._firstNonRestBeat=null,this._lastNonRestBeat=null,this.voice=null,this.beats=[],this.shortestDuration=B.QuadrupleWhole,this.fingeringCount=0,this.hasTuplet=!1,this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNoteCompareValue=-1,this.lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this.highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.minRestLine=null,this.beatOfMinRestLine=null,this.maxRestLine=null,this.beatOfMaxRestLine=null,this.direction=D.Up,this.drawingInfos=new Map,this._staff=e,this._renderer=t,this.beats=[]}getBeatLineX(e){return this.hasBeatLineX(e)?this.direction===D.Up?this._beatLineXPositions.get(e.index).up:this._beatLineXPositions.get(e.index).down:0}hasBeatLineX(e){return this._beatLineXPositions.has(e.index)}registerBeatLineX(e,t,r,s){let n=this.getOrCreateBeatPositions(t);n.staffId=e,n.up=r,n.down=s;for(const a of this.drawingInfos.values())a.startBeat==t?a.startX=this.getBeatLineX(t):a.endBeat==t&&(a.endX=this.getBeatLineX(t))}getOrCreateBeatPositions(e){return this._beatLineXPositions.has(e.index)||this._beatLineXPositions.set(e.index,new L4),this._beatLineXPositions.get(e.index)}finish(){this.direction=this.calculateDirection()}calculateDirection(){let e=null;if(this.voice?this.preferredBeamDirection!==null?e=this.preferredBeamDirection:this.voice.index>0?e=this.invert(D.Down):this.voice.bar.isMultiVoice?e=this.invert(D.Up):this.beats[0].graceType!==K.None&&(e=this.invert(D.Up)):e=D.Up,this.highestNoteInHelper&&this.lowestNoteInHelper){let t=this._renderer.getNoteY(this.highestNoteInHelper,j.Center),r=this._renderer.getNoteY(this.lowestNoteInHelper,j.Center);if(e===null){const s=(t+r)/2;e=this.invert(this._renderer.middleYPosition<s?D.Up:D.Down)}this._renderer.completeBeamingHelper(this)}else e=this.invert(D.Up),this._renderer.completeBeamingHelper(this);return e}static computeLineHeightsForRest(e){switch(e){case B.QuadrupleWhole:return[2,2];case B.DoubleWhole:return[2,2];case B.Whole:return[0,1];case B.Half:return[1,0];case B.Quarter:return[3,3];case B.Eighth:return[2,2];case B.Sixteenth:return[2,4];case B.ThirtySecond:return[4,4];case B.SixtyFourth:return[4,6];case B.OneHundredTwentyEighth:return[6,6];case B.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(e,t){if(this._lastNonRestBeat&&e.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&e.index<=this._firstNonRestBeat.index)return;let r=t,s=t;const n=zr.computeLineHeightsForRest(e.duration);r-=n[0],s+=n[1];const a=this.minRestLine,o=this.maxRestLine;(a===null||a>r)&&(this.minRestLine=r,this.beatOfMinRestLine=e),(o===null||o<s)&&(this.maxRestLine=s,this.beatOfMaxRestLine=e)}invert(e){if(!this.invertBeamDirection)return e;switch(e){case D.Down:return D.Up;default:return D.Down}}checkBeat(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);let t=!1;if(this.beats.length===0)t=!0;else switch(this.beats[this.beats.length-1].beamingMode){case Wr.Auto:t=zr.canJoin(this.beats[this.beats.length-1],e);break;case Wr.ForceSplitToNext:t=!1;break;case Wr.ForceMergeWithNext:t=!0;break}if(t){if(e.preferredBeamDirection!==null&&(this.preferredBeamDirection=e.preferredBeamDirection),e.isRest)this.beats.length===0&&this.beats.push(e);else{this.isRestBeamHelper&&(this.beats=[]),this.beats.push(e),e.graceType!==K.None&&(this.isGrace=!0),e.hasTuplet&&(this.hasTuplet=!0);let r=0;for(let s=0;s<e.notes.length;s++){let n=e.notes[s];(n.leftHandFinger!==ne.Unknown||n.rightHandFinger!==ne.Unknown)&&r++}r>this.fingeringCount&&(this.fingeringCount=r),this.checkNote(e.minNote),this.checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),this._firstNonRestBeat||(this._firstNonRestBeat=e),this._lastNonRestBeat=e}e.hasTuplet&&(this.hasTuplet=!0)}return t}checkNote(e){if(!e)return;let t,r;this.voice&&e.isPercussion?(t=-vt.getPercussionLine(this.voice.bar,vt.getNoteValue(e)),r=t):(t=vt.getNoteValue(e),r=t,e.harmonicType!==q.None&&e.harmonicType!==q.Natural&&(r=e.realValue-this._staff.displayTranspositionPitch)),this.beats.length===1&&this.beats[0]===e.beat&&((this._firstBeatLowestNoteCompareValue===-1||t<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNoteCompareValue=t),(this._firstBeatHighestNoteCompareValue===-1||r>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNoteCompareValue=r)),(this._lastBeatLowestNoteCompareValue===-1||t<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNoteCompareValue=t),(this._lastBeatHighestNoteCompareValue===-1||r>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNoteCompareValue=r),(!this.lowestNoteInHelper||t<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=e,this._lowestNoteCompareValueInHelper=t),(!this.highestNoteInHelper||r>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=e,this._highestNoteCompareValueInHelper=r)}static canJoin(e,t){if(!e||!t||e.graceType!==t.graceType||e.graceType===K.BendGrace||t.graceType===K.BendGrace)return!1;if(e.graceType!==K.None&&t.graceType!==K.None)return!0;let r=e.voice.bar,s=t.voice.bar;if(r!==s)return!1;let n=e.playbackStart,a=t.playbackStart;if(!zr.canJoinDuration(e.duration)||!zr.canJoinDuration(t.duration))return n===a;if(e.tupletGroup!==t.tupletGroup)return!1;if(e.hasTuplet&&t.hasTuplet&&e.tupletGroup===t.tupletGroup&&e.tupletGroup.isFull)return!0;let o=oe.QuarterTime;switch(r.masterBar.timeSignatureDenominator){case 8:r.masterBar.timeSignatureNumerator%3===0&&(o+=oe.QuarterTime/2|0);break}let l=(o+n)/o|0|0,h=(o+a)/o|0|0;return l===h}static canJoinDuration(e){switch(e){case B.Whole:case B.Half:case B.Quarter:return!1;default:return!0}}static isFullBarJoin(e,t,r){return $e.getIndex(e.duration)-2-r>0&&$e.getIndex(t.duration)-2-r>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(e,t){return this._beatLineXPositions.has(t.index)?this._beatLineXPositions.get(t.index).staffId===e||!this._beatLineXPositions.get(t.index).staffId:!0}}class F4{constructor(e,t){this.topY=0,this.bottomY=0,this.topY=e,this.bottomY=t}}class I4{constructor(e){this.topY=-1e3,this.bottomY=-1e3,this.slots=[],this.beat=e}addSlot(e,t){if(this.slots.push(new F4(e,t)),this.topY===-1e3)this.topY=e,this.bottomY=t;else{const r=Math.min(e,t),s=Math.max(e,t);r<this.topY&&(this.topY=r),s>this.bottomY&&(this.bottomY=s)}}}class O4{constructor(){this.reservedLayoutAreasByDisplayTime=new Map,this.restDurationsByDisplayTime=new Map}getBeatMinMaxY(){let e=-1e3,t=-1e3;for(const r of this.reservedLayoutAreasByDisplayTime.values())e===-1e3?(e=r.topY,t=r.bottomY):(e>r.topY&&(e=r.topY),t<r.bottomY&&(t=r.bottomY));return e===-1e3?[0,0]:[e,t]}reserveBeatSlot(e,t,r){t!=r&&(this.reservedLayoutAreasByDisplayTime.has(e.displayStart)||this.reservedLayoutAreasByDisplayTime.set(e.displayStart,new I4(e)),this.reservedLayoutAreasByDisplayTime.get(e.displayStart).addSlot(t,r),e.isRest&&this.registerRest(e))}registerRest(e){this.restDurationsByDisplayTime.has(e.displayStart)||this.restDurationsByDisplayTime.set(e.displayStart,new Map),this.restDurationsByDisplayTime.get(e.displayStart).has(e.playbackDuration)||this.restDurationsByDisplayTime.get(e.displayStart).set(e.playbackDuration,e.id)}applyRestCollisionOffset(e,t,r){if(e.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(e.playbackStart)){const s=zr.computeLineHeightsForRest(e.duration).map(u=>u*r);let n=t-s[0],a=t+s[1],o=n;const l=this.reservedLayoutAreasByDisplayTime.get(e.playbackStart);let h=!1;for(const u of l.slots)if(n>=u.topY&&n<=u.bottomY||a>=u.topY&&a<=u.bottomY){h=!0;break}if(h){e.voice.index==1?o=l.topY-s[1]-s[0]:o=l.bottomY;let u=o+s[0]+s[1];const c=r*2;let d=Math.ceil(Math.abs(o-n)/c);return l.addSlot(o,u),o<n?d*-c:d*c}}return 0}}class D4{constructor(e){this.beamHelpers=[],this.beamHelperLookup=[],this._renderer=e,this.collisionHelper=new O4}initialize(){var e=this._renderer,t=this._renderer.bar;let r=null,s=null;for(let n=0,a=t.voices.length;n<a;n++){let o=t.voices[n];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let l=0,h=o.beats.length;l<h;l++){let u=o.beats[l],c;u.graceType!==K.None?c=s:(c=r,s=null),(!c||!c.checkBeat(u))&&(c&&c.finish(),c=new zr(t.staff,e),c.checkBeat(u),u.graceType!==K.None?s=c:r=c,this.beamHelpers[o.index].push(c)),this.beamHelperLookup[o.index].set(u.index,c)}r&&r.finish(),s&&s.finish(),r=null,s=null}}getBeamingHelperForBeat(e){return this.beamHelperLookup[e.voice.index].get(e.index)}}class jt extends Qr{constructor(e,t,r){super(e,t),this._textRow=0,this._fretRow=0,this._firstFretSpacing=0,this._chord=r}doLayout(){super.doLayout();const e=this.scale;let t=this.renderer.resources;this._textRow=t.effectFont.size*1.5*e,this._fretRow=t.effectFont.size*1.5*e,this._chord.firstFret>1?this._firstFretSpacing=jt.FretSpacing*e:this._firstFretSpacing=0,this.height=this._textRow+this._fretRow+(jt.Frets-1)*jt.FretSpacing*e+2*jt.Padding*e,this.width=this._firstFretSpacing+(this._chord.staff.tuning.length-1)*jt.StringSpacing*e+2*jt.Padding*e}paint(e,t,r){e+=this.x+jt.Padding*this.scale+this._firstFretSpacing,t+=this.y;let s=this.width-2*jt.Padding*this.scale+this.scale-this._firstFretSpacing,n=jt.StringSpacing*this.scale,a=jt.FretSpacing*this.scale,o=this.renderer.resources,l=jt.CircleRadius*this.scale,h=r.textAlign,u=r.textBaseline;r.font=o.effectFont,r.textAlign=Q.Center,r.textBaseline=le.Top,this._chord.showName&&r.fillText(this._chord.name,e+this.width/2,t+o.effectFont.size/2),t+=this._textRow,e+=n/2,r.font=o.fretboardNumberFont,r.textBaseline=le.Middle;for(let d=0;d<this._chord.staff.tuning.length;d++){let p=e+d*n,f=t+this._fretRow/2,m=this._chord.strings[this._chord.staff.tuning.length-d-1];m<0?r.fillMusicFontSymbol(p,f,this.scale,g.FretboardX,!0):m===0?r.fillMusicFontSymbol(p,f,this.scale,g.FretboardO,!0):(m-=this._chord.firstFret-1,r.fillText(m.toString(),p,f))}t+=this._fretRow;for(let d=0;d<this._chord.staff.tuning.length;d++){let p=e+d*n;r.fillRect(p,t,1,a*jt.Frets+this.scale)}this._chord.firstFret>1&&(r.textAlign=Q.Left,r.fillText(this._chord.firstFret.toString(),e-this._firstFretSpacing,t+a/2)),r.fillRect(e,t-this.scale,s,2*this.scale);for(let d=0;d<=jt.Frets;d++){let p=t+d*a;r.fillRect(e,p,s,this.scale)}let c=new Map;for(let d of this._chord.barreFrets){let p=[-1,-1];c.set(d-this._chord.firstFret,p)}for(let d=0;d<this._chord.strings.length;d++){let p=this._chord.strings[d];if(p>0){if(p-=this._chord.firstFret,c.has(p)){let S=c.get(p);(S[0]===-1||d<S[0])&&(S[0]=d),(S[1]===-1||d>S[1])&&(S[1]=d)}let f=t+p*a+a/2+.5*this.scale,m=e+(this._chord.strings.length-d-1)*n;r.fillCircle(m,f,l)}}for(const[d,p]of c){let f=t+d*a+a/2+.5*this.scale,m=e+(this._chord.strings.length-p[1]-1)*n,S=e+(this._chord.strings.length-p[0]-1)*n;r.fillRect(m,f-l,S-m,l*2)}r.textAlign=h,r.textBaseline=u}}jt.Padding=5;jt.Frets=5;jt.CircleRadius=2.5;jt.StringSpacing=10;jt.FretSpacing=12;class eb extends qr{constructor(e,t,r=Q.Center){super(e,t),this._glyphWidth=0,this.glyphs=[],this._align=r}doLayout(){let e=0;switch(this._align){case Q.Left:e=0;break;case Q.Center:e=(this.width-this._glyphWidth)/2;break;case Q.Right:e=this.width-this._glyphWidth;break}for(let t of this.glyphs)t.x=e,e+=t.width}addGlyphToRow(e){this.glyphs.push(e),this._glyphWidth+=e.width,e.height>this.height&&(this.height=e.height)}}class Xl extends qr{constructor(e,t,r=Q.Center){super(e,t),this._rows=[],this.height=0,this.glyphs=[],this._align=r}doLayout(){let e=0,t=0,r=Xl.Padding*this.scale;this._rows=[];let s=new eb(e,t,this._align);s.width=this.width;for(let n of this.glyphs)e+n.width<this.width?(s.addGlyphToRow(n),e+=n.width):(s.isEmpty||(s.doLayout(),this._rows.push(s),t+=s.height+r),e=0,s=new eb(e,t,this._align),s.width=this.width,s.addGlyphToRow(n),e+=n.width);s.isEmpty||(s.doLayout(),this._rows.push(s),t+=s.height+r),this.height=t}paint(e,t,r){for(let s of this._rows)s.paint(e+this.x,t+this.y,r)}}Xl.Padding=3;class A4 extends Xl{constructor(e,t){super(e,t)}addChord(e){if(e.strings.length>0){let t=new jt(0,0,e);t.renderer=this.renderer,t.doLayout(),this.glyphs.push(t)}}}class ci extends Qr{constructor(e,t,r,s,n=Q.Left){super(e,t),this._lineHeights=null,this._lines=r.split(`
`),this.font=s,this.textAlign=n}doLayout(){super.doLayout(),this._lineHeights=[];const e=this.renderer.scoreRenderer.canvas;for(const t of this._lines){e.font=this.font;const r=e.measureText(t).height*this.scale;this._lineHeights.push(r),this.height+=r}}paint(e,t,r){let s=r.color;r.color=s,r.font=this.font;let n=r.textAlign;r.textAlign=this.textAlign;let a=t+this.y;for(let o=0;o<this._lines.length;o++)r.fillText(this._lines[o],e+this.x,a),a+=this._lineHeights[o];r.textAlign=n}}class V4{get staveId(){return this._factory.staffId}constructor(e,t,r){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.trackIndex=0,this.staveTop=0,this.topSpacing=0,this.bottomSpacing=0,this.staveBottom=0,this.isFirstInAccolade=!1,this.isLastInAccolade=!1,this._factory=r,this.trackIndex=e,this.modelStaff=t}getSharedLayoutData(e,t){return this._sharedLayoutData.has(e)?this._sharedLayoutData.get(e):t}setSharedLayoutData(e,t){this._sharedLayoutData.set(e,t)}get isInAccolade(){return this._factory.isInAccolade}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(e){this.staveTop=e}registerStaffBottom(e){this.staveBottom=e}addBarRenderer(e){e.staff=this,e.index=this.barRenderers.length,e.reLayout(),this.barRenderers.push(e),this.system.layout.registerBarRenderer(this.staveId,e)}addBar(e,t){let r;e?r=this._factory.create(this.system.layout.renderer,e):r=new ht(this.system.layout.renderer,e),r.staff=this,r.index=this.barRenderers.length,r.layoutingInfo=t,r.doLayout(),r.registerLayoutingInfo();const s=r.barDisplayWidth;s>0&&this.system.layout.systemsLayoutMode==qi.FromModelWithWidths&&(r.width=s),this.barRenderers.push(r),e&&this.system.layout.registerBarRenderer(this.staveId,r)}revertLastBar(){let e=this.barRenderers[this.barRenderers.length-1];return this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staveId,e),e}scaleToWidth(e){this._sharedLayoutData=new Map;let t=this.topOverflow,r=0;switch(this.system.layout.systemsLayoutMode){case qi.Automatic:let n=(e-this.system.computedWidth)/this.barRenderers.length;for(const o of this.barRenderers){o.x=r,o.y=this.topSpacing+t;let l=o.computedWidth+n;o.scaleToWidth(l),r+=o.width}break;case qi.FromModelWithScale:e-=this.system.accoladeWidth;const a=this.system.totalBarDisplayScale;for(const o of this.barRenderers){o.x=r,o.y=this.topSpacing+t;const l=o.barDisplayScale*e/a;o.scaleToWidth(l),r+=o.width}break;case qi.FromModelWithWidths:for(const o of this.barRenderers){o.x=r,o.y=this.topSpacing+t;const l=o.barDisplayWidth;l>0?o.scaleToWidth(l):o.scaleToWidth(o.computedWidth),r+=o.width}break}}get topOverflow(){let e=0;for(let t=0,r=this.barRenderers.length;t<r;t++){let s=this.barRenderers[t];s.topOverflow>e&&(e=s.topOverflow)}return e}get bottomOverflow(){let e=0;for(let t=0,r=this.barRenderers.length;t<r;t++){let s=this.barRenderers[t];s.bottomOverflow>e&&(e=s.bottomOverflow)}return e}finalizeStaff(){const e=this.system.layout.renderer.settings;this.topSpacing=this._factory.getStaffPaddingTop(this)*e.display.scale,this.bottomSpacing=this._factory.getStaffPaddingBottom(this)*e.display.scale,this.height=0;let t=!1,r=this.topOverflow;for(let s=0;s<this.barRenderers.length;s++)this.barRenderers[s].y=this.topSpacing+r,this.height=Math.max(this.height,this.barRenderers[s].height),this.barRenderers[s].finalizeRenderer()&&(t=!0);if(t){r=this.topOverflow;for(let s=0;s<this.barRenderers.length;s++)this.barRenderers[s].y=this.topSpacing+r,this.height=Math.max(this.height,this.barRenderers[s].height),this.barRenderers[s].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+r+this.bottomOverflow+this.bottomSpacing)}paint(e,t,r,s,n){if(!(this.height===0||n===0))for(let a=s,o=Math.min(s+n,this.barRenderers.length);a<o;a++)this.barRenderers[a].paint(e+this.x,t+this.y,r)}}class tb{constructor(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preBeatWidth=0,this.graceBeatWidth=0,this.postSpringWidth=0,this.allDurations=new Set}get springWidth(){return this.preSpringWidth+this.postSpringWidth}get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}}class ro{constructor(){this._timeSortedSprings=[],this._xMin=0,this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this._incompleteGraceRodsWidth=0,this.version=0,this.preBeatSizes=new Map,this.onBeatSizes=new Map,this.onBeatCenterX=new Map,this.preBeatSize=0,this.postBeatSize=0,this.voiceSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.incompleteGraceRods=new Map,this.allGraceRods=new Map,this.springs=new Map,this.height=0}updateVoiceSize(e){e>this.voiceSize&&(this.voiceSize=e,this.version++)}setPreBeatSize(e,t){(!this.preBeatSizes.has(e.id)||this.preBeatSizes.get(e.id)<t)&&(this.preBeatSizes.set(e.id,t),this.version++)}getPreBeatSize(e){return this.preBeatSizes.has(e.id)?this.preBeatSizes.get(e.id):0}setOnBeatSize(e,t){(!this.onBeatSizes.has(e.id)||this.onBeatSizes.get(e.id)<t)&&(this.onBeatSizes.set(e.id,t),this.version++)}getOnBeatSize(e){return this.onBeatSizes.has(e.id)?this.onBeatSizes.get(e.id):0}getBeatCenterX(e){return this.onBeatCenterX.has(e.id)?this.onBeatCenterX.get(e.id):0}setBeatCenterX(e,t){(!this.onBeatCenterX.has(e.id)||this.onBeatCenterX.get(e.id)<t)&&(this.onBeatCenterX.set(e.id,t),this.version++)}updateMinStretchForce(e){this.minStretchForce<e&&(this.minStretchForce=e)}addSpring(e,t,r,s,n){this.version++;let a;if(this.springs.has(e))a=this.springs.get(e),a.postSpringWidth<n&&(a.postSpringWidth=n),a.graceBeatWidth<r&&(a.graceBeatWidth=r),a.preBeatWidth<s&&(a.preBeatWidth=s),t<a.smallestDuration&&(a.smallestDuration=t),t>a.longestDuration&&(a.longestDuration=t),a.allDurations.add(t);else{if(a=new tb,a.timePosition=e,a.allDurations.add(t),this._timeSortedSprings.length>0){let h=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const u of h.allDurations)h.timePosition+u}a.longestDuration=t,a.postSpringWidth=n,a.graceBeatWidth=r,a.preBeatWidth=s,this.springs.set(e,a);let o=this._timeSortedSprings,l=o.length-1;for(;l>0&&o[l].timePosition>e;)l--;this._timeSortedSprings.splice(l+1,0,a)}return(this._minTime===-1||this._minTime>e)&&(this._minTime=e),a}addBeatSpring(e,t,r){let s=e.absoluteDisplayStart;if(e.graceType!==K.None){const n=e.graceGroup.id;this.allGraceRods.has(n)||this.allGraceRods.set(n,new Array(e.graceGroup.beats.length)),!e.graceGroup.isComplete&&!this.incompleteGraceRods.has(n)&&this.incompleteGraceRods.set(n,new Array(e.graceGroup.beats.length));let a=this.allGraceRods.get(n)[e.graceIndex];if(a)a.postSpringWidth<r&&(a.postSpringWidth=r),a.preBeatWidth<t&&(a.preBeatWidth=t);else{const o=new tb;o.timePosition=s,o.postSpringWidth=r,o.preBeatWidth=t,e.graceGroup.isComplete||(this.incompleteGraceRods.get(n)[e.graceIndex]=o),this.allGraceRods.get(n)[e.graceIndex]=o}}else{let n=0;if(e.graceGroup&&this.allGraceRods.has(e.graceGroup.id))for(const a of this.allGraceRods.get(e.graceGroup.id))n+=a.springWidth;this.addSpring(s,e.displayDuration,n,t,r)}}finish(){for(const[e,t]of this.allGraceRods){let r=0;if(this.incompleteGraceRods.has(e))for(const s of t)r+=s.preBeatWidth,s.graceBeatWidth=r,r+=s.postSpringWidth;else for(let s=t.length-1;s>=0;s--)t[s].graceBeatWidth=r,r-=t[s].preBeatWidth+t[s].postSpringWidth}this._incompleteGraceRodsWidth=0;for(const e of this.incompleteGraceRods.values())for(const t of e)this._incompleteGraceRodsWidth+=t.preBeatWidth+t.postSpringWidth;this.calculateSpringConstants(),this.version++}calculateSpringConstants(){this._xMin=0;let e=this.springs;for(const s of e.values())s.springWidth<this._xMin&&(this._xMin=s.springWidth);let t=0,r=this._timeSortedSprings;if(r.length===0){this.totalSpringConstant=-1,this.minStretchForce=-1;return}for(let s=0;s<r.length;s++){let n=r[s],a=0;if(s===r.length-1)a=n.longestDuration;else{let o=r[s+1];a=Math.abs(o.timePosition-n.timePosition)}n.springConstant=this.calculateSpringConstant(n,a),t+=1/n.springConstant}this.totalSpringConstant=1/t,this.minStretchForce=0;for(let s=0;s<r.length;s++){let n=r[s],a=0;if(s===r.length-1)a=n.postSpringWidth;else{let l=r[s+1];a=n.postSpringWidth+l.preSpringWidth}s===0&&(a+=n.preSpringWidth);let o=a*n.springConstant;this.updateMinStretchForce(o)}}paint(e,t,r){}calculateSpringConstant(e,t){t<=0&&(t=oe.toTicks(B.SixtyFourth)),e.smallestDuration===0&&(e.smallestDuration=t);let r=e.smallestDuration,s=1+.85*Math.log2(t/ro.MinDuration);return r/t*(1/(s*ro.MinDurationWidth))}spaceToForce(e){return this.totalSpringConstant!==-1?(this._timeSortedSprings.length>0&&(e-=this._timeSortedSprings[0].preSpringWidth),e-=this._incompleteGraceRodsWidth,Math.max(e,0)*this.totalSpringConstant):-1}calculateVoiceWidth(e){let t=0;return this.totalSpringConstant!==-1&&(t=this.calculateWidth(e,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(t+=this._timeSortedSprings[0].preSpringWidth),t+=this._incompleteGraceRodsWidth,t}calculateWidth(e,t){return e/t}buildOnTimePositions(e){if(this.totalSpringConstant===-1)return new Map;if($e.isAlmostEqualTo(this._onTimePositionsForce,e)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=e;let t=new Map;this._onTimePositions=t;let r=this._timeSortedSprings;if(r.length===0)return t;let s=r[0].preSpringWidth;for(let n=0;n<r.length;n++)t.set(r[n].timePosition,s),s+=this.calculateWidth(e,r[n].springConstant);return t}}ro.MinDuration=30;ro.MinDurationWidth=7;class H4{constructor(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.renderers=[]}}class W4{constructor(e,t){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInAccolade=null,this.lastStaffInAccolade=null,this.staffSystem=e,this.track=t}addStaff(e){this.staves.push(e),e.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(e)}}class Pl{constructor(e){this._allStaves=[],this._firstStaffInAccolade=null,this._lastStaffInAccolade=null,this._accoladeSpacingCalculated=!1,this.x=0,this.y=0,this.index=0,this.accoladeWidth=0,this.isFull=!1,this.width=0,this.computedWidth=0,this.totalBarDisplayScale=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[],this.layout=e,this.topPadding=e.renderer.settings.display.systemPaddingTop,this.bottomPadding=e.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].masterBar.index}addMasterBarRenderers(e,t){if(e.length===0)return null;this.masterBarsRenderers.push(t),this.calculateAccoladeSpacing(e),t.layoutingInfo.preBeatSize=0;let r=0;for(let s=0,n=this.staves.length;s<n;s++){let a=this.staves[s];for(let o=0,l=a.staves.length;o<l;o++){let h=a.staves[o],u=t.renderers[r++];h.addBarRenderer(u)}}return this.updateWidthFromLastBar(),t}addBars(e,t){if(e.length===0)return null;let r=new H4;r.layoutingInfo=new ro,r.masterBar=e[0].score.masterBars[t],this.masterBarsRenderers.push(r),this.calculateAccoladeSpacing(e);let s=r.layoutingInfo;for(let n of this.staves)for(let a of n.staves){let o=n.track.staves[a.modelStaff.index].bars[t];a.addBar(o,s);let l=a.barRenderers[a.barRenderers.length-1];r.renderers.push(l),l.isLinkedToPrevious&&(r.isLinkedToPrevious=!0),l.canWrap||(r.canWrap=!1)}return s.finish(),r.width=this.updateWidthFromLastBar(),r}revertLastBar(){if(this.masterBarsRenderers.length>1){let e=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let t=0,r=0;for(let s=0,n=this._allStaves.length;s<n;s++){let o=this._allStaves[s].revertLastBar();const l=o.computedWidth;l>t&&(t=l);const h=o.barDisplayScale;h>r&&(r=h)}return this.width-=t,this.computedWidth-=t,this.totalBarDisplayScale-=r,e}return null}updateWidthFromLastBar(){let e=0,t=0;for(let r=0,s=this._allStaves.length;r<s;r++){let n=this._allStaves[r];const a=n.barRenderers[n.barRenderers.length-1];a.applyLayoutingInfo(),a.computedWidth>e&&(e=a.computedWidth);const o=a.barDisplayScale;o>t&&(t=o)}return this.width+=e,this.computedWidth+=e,this.totalBarDisplayScale+=t,e}calculateAccoladeSpacing(e){const t=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){if(this._accoladeSpacingCalculated=!0,this.index===0&&this.layout.renderer.settings.notation.isNotationElementVisible(te.TrackNames)){let r=this.layout.renderer.canvas,s=t.display.resources.effectFont;r.font=s;for(let n of e)this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,r.measureText(n.shortName).width));this.accoladeWidth*=this.layout.scale,this.accoladeWidth+=t.display.systemLabelPaddingLeft*this.layout.scale,this.accoladeWidth+=t.display.systemLabelPaddingRight*this.layout.scale}else this.accoladeWidth=0;this.accoladeWidth+=Pl.AccoladeBarSize*this.layout.scale,this.accoladeWidth+=t.display.accoladeBarPaddingRight*this.layout.scale,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}getStaffTrackGroup(e){for(let t=0,r=this.staves.length;t<r;t++){let s=this.staves[t];if(s.track===e)return s}return null}addStaff(e,t){let r=this.getStaffTrackGroup(e);r||(r=new W4(this,e),this.staves.push(r)),t.staffTrackGroup=r,t.system=this,t.index=this._allStaves.length,this._allStaves.push(t),r.addStaff(t),t.isInAccolade&&(this._firstStaffInAccolade||(this._firstStaffInAccolade=t,t.isFirstInAccolade=!0),r.firstStaffInAccolade||(r.firstStaffInAccolade=t),this._lastStaffInAccolade||(this._lastStaffInAccolade=t,t.isLastInAccolade=!0),this._lastStaffInAccolade&&(this._lastStaffInAccolade.isLastInAccolade=!1),this._lastStaffInAccolade=t,this._lastStaffInAccolade.isLastInAccolade=!0,r.lastStaffInAccolade=t)}get height(){return this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding}scaleToWidth(e){for(let t=0,r=this._allStaves.length;t<r;t++)this._allStaves[t].scaleToWidth(e);this.width=e}paint(e,t,r){t+=this.topPadding,this.paintPartial(e+this.x,t+this.y,r,0,this.masterBarsRenderers.length)}paintPartial(e,t,r,s,n){for(let o=0,l=this._allStaves.length;o<l;o++)this._allStaves[o].paint(e,t,r,s,n);let a=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&s===0){if(r.color=a.barSeparatorColor,this._firstStaffInAccolade&&this._lastStaffInAccolade){let l=t+this._firstStaffInAccolade.y+this._firstStaffInAccolade.staveTop+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow,h=t+this._lastStaffInAccolade.y+this._lastStaffInAccolade.topSpacing+this._lastStaffInAccolade.topOverflow+this._lastStaffInAccolade.staveBottom,u=e+this._firstStaffInAccolade.x;r.beginPath(),r.moveTo(u,l),r.lineTo(u,h),r.stroke()}r.font=a.effectFont;const o=this.layout.renderer.settings;for(let l=0,h=this.staves.length;l<h;l++){let u=this.staves[l];if(u.firstStaffInAccolade&&u.lastStaffInAccolade){let c=t+u.firstStaffInAccolade.y+u.firstStaffInAccolade.staveTop+u.firstStaffInAccolade.topSpacing+u.firstStaffInAccolade.topOverflow,d=t+u.lastStaffInAccolade.y+u.lastStaffInAccolade.topSpacing+u.lastStaffInAccolade.topOverflow+u.lastStaffInAccolade.staveBottom;const p=this.index===0&&this.layout.renderer.settings.notation.isNotationElementVisible(te.TrackNames);let f=e+u.firstStaffInAccolade.x,m=Pl.AccoladeBarSize*this.layout.scale,S=o.display.accoladeBarPaddingRight*this.layout.scale,y=c-m*4,b=d+m*4;p&&r.fillText(u.track.shortName,e+o.display.systemLabelPaddingLeft*this.layout.scale,c),r.fillRect(f-S-m,y,m,b-y);let w=f-S-m,x=f+m*2;r.beginPath(),r.moveTo(w,y),r.bezierCurveTo(w,y,w,y,x,y-m),r.bezierCurveTo(f,y+m,w,y+m,w,y+m),r.closePath(),r.fill(),r.beginPath(),r.moveTo(w,b),r.bezierCurveTo(w,b,f,b,x,b+m),r.bezierCurveTo(f,b-m,w,b-m,w,b-m),r.closePath(),r.fill()}}}}finalizeSystem(){const e=this.layout.renderer.settings;this.index===0&&(this.topPadding=e.display.firstSystemPaddingTop*e.display.scale),this.isLast&&(this.bottomPadding=e.display.lastSystemPaddingBottom*e.display.scale);let t=0;for(let r of this._allStaves)r.x=this.accoladeWidth,r.y=t,r.finalizeStaff(),t+=r.height}buildBoundingsLookup(e,t){if(this.layout.renderer.boundsLookup.isFinished||!this._firstStaffInAccolade||!this._lastStaffInAccolade)return;t+=this.topPadding;let r=this._allStaves[this._allStaves.length-1],s=t+this.y+this._firstStaffInAccolade.y,n=t+this.y+this._lastStaffInAccolade.y+this._lastStaffInAccolade.height,a=t+this.y+this._allStaves[0].y,o=t+this.y+r.y+r.height,l=t+this.y+this._firstStaffInAccolade.y+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow+(this._firstStaffInAccolade.barRenderers.length>0?this._firstStaffInAccolade.barRenderers[0].topPadding:0),h=t+this.y+r.y+r.height-r.bottomSpacing-r.bottomOverflow-(r.barRenderers.length>0?r.barRenderers[0].bottomPadding:0),u=n-s,c=h-l,d=o-a,p=this.x+this._firstStaffInAccolade.x,f=new Vx;f.visualBounds=new Ti,f.visualBounds.x=e,f.visualBounds.y=t+this.y,f.visualBounds.w=this.width,f.visualBounds.h=this.height-this.topPadding-this.bottomPadding,f.realBounds=new Ti,f.realBounds.x=e,f.realBounds.y=t+this.y,f.realBounds.w=this.width,f.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(f);let m=new Map;for(let S=0;S<this.staves.length;S++)for(let y of this.staves[S].stavesRelevantForBoundsLookup)for(let b of y.barRenderers){let w;m.has(b.bar.masterBar.index)?w=m.get(b.bar.masterBar.index):(w=new Ax,w.index=b.bar.masterBar.index,w.isFirstOfLine=b.isFirstOfLine,w.realBounds=new Ti,w.realBounds.x=p+b.x,w.realBounds.y=a,w.realBounds.w=b.width,w.realBounds.h=d,w.visualBounds=new Ti,w.visualBounds.x=p+b.x,w.visualBounds.y=s,w.visualBounds.w=b.width,w.visualBounds.h=u,w.lineAlignedBounds=new Ti,w.lineAlignedBounds.x=p+b.x,w.lineAlignedBounds.y=l,w.lineAlignedBounds.w=b.width,w.lineAlignedBounds.h=c,this.layout.renderer.boundsLookup.addMasterBar(w),m.set(w.index,w)),b.buildBoundingsLookup(w,p,t+this.y+y.y)}}getBarX(e){if(!this._firstStaffInAccolade||this.layout.renderer.tracks.length===0)return 0;let t=this.layout.renderer.tracks[0].staves[0].bars[e];return this.layout.getRendererForBar(this._firstStaffInAccolade.staveId,t).x}}Pl.AccoladeBarSize=3;class sd extends qr{constructor(e,t,r,s){super(e,t),this._tuning=r,this._trackLabel=s,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this.createGlyphs(this._tuning);for(const e of this.glyphs)e.renderer=this.renderer,e.doLayout()}}paint(e,t,r){r.textBaseline=le.Middle,super.paint(e,t,r)}createGlyphs(e){const t=this.renderer.scale,r=this.renderer.resources;this.height=0;const s=15*t;if(this._trackLabel.length>0){const o=new ci(0,this.height,this._trackLabel,r.effectFont,Q.Left);o.renderer=this.renderer,o.doLayout(),this.height+=o.height,o.y+=o.height/2,this.addGlyph(o)}const n=new ci(0,this.height,e.name,r.effectFont,Q.Left);n.renderer=this.renderer,n.doLayout(),this.height+=n.height,n.y+=n.height/2,this.addGlyph(n);const a=64*t;if(this.renderer.scoreRenderer.canvas.font=r.effectFont,this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width*t,Math.max(this.renderer.scoreRenderer.canvas.measureText(e.name).width*t,2*a)),!e.isStandard){this.height+=s;const o=.7,l=sd.CircleNumberHeight*o*t;let h=Math.ceil(e.tunings.length/2)|0,u=0,c=this.height;for(let d=0,p=e.tunings.length;d<p;d++){const f=g.GuitarString0+(d+1);this.addGlyph(new ft(u,c+l/2.5,o,f));const m="= "+O.getTextForTuning(e.tunings[d],!1);this.addGlyph(new ci(u+l+1*t,c,m,r.effectFont,Q.Left)),c+=s,d===h-1&&(c=this.height,u+=a)}this.height+=h*s}this.width+=15*t}}sd.CircleNumberHeight=20;class z4 extends Xl{constructor(e,t){super(e,t,Q.Left)}addTuning(e,t){if(e.tunings.length>0){let r=new sd(0,0,e,t);r.renderer=this.renderer,r.doLayout(),this.glyphs.push(r)}}}class G4{constructor(e,t){this.args=e,this.renderCallback=t}}var qi;(function(i){i[i.Automatic=0]="Automatic",i[i.FromModelWithScale=1]="FromModelWithScale",i[i.FromModelWithWidths=2]="FromModelWithWidths"})(qi||(qi={}));class jx{constructor(e){this._barRendererLookup=new Map,this.width=0,this.height=0,this.scoreInfoGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.systemsLayoutMode=qi.Automatic,this._lazyPartials=new Map,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=e}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();let e=this.renderer.score,t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t)),this.firstBarIndex=t;let r=this.renderer.settings.display.barCount;r<0&&(r=e.masterBars.length),r=t+r-1,r=Math.min(e.masterBars.length-1,Math.max(0,r)),this.lastBarIndex=r,this.createScoreInfoGlyphs(),this.doLayoutAndRender()}registerPartial(e,t){e.height!=0&&(this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(e.id,new G4(e,t)),this.renderer.partialLayoutFinished.trigger(e)):(this.renderer.partialLayoutFinished.trigger(e),this.internalRenderLazyPartial(e,t)))}internalRenderLazyPartial(e,t){const r=this.renderer.canvas;r.beginRender(e.width,e.height),t(r),e.renderResult=r.endRender(),this.renderer.partialRenderFinished.trigger(e)}renderLazyPartial(e){if(this._lazyPartials.has(e)){const t=this._lazyPartials.get(e);this.internalRenderLazyPartial(t.args,t.renderCallback)}}createScoreInfoGlyphs(){L.debug("ScoreLayout","Creating score info glyphs");let e=this.renderer.settings.notation,t=this.renderer.score,r=this.renderer.settings.display.resources;this.scoreInfoGlyphs=new Map,t.title&&e.isNotationElementVisible(te.ScoreTitle)&&this.scoreInfoGlyphs.set(te.ScoreTitle,new ci(0,0,t.title,r.titleFont,Q.Center)),t.subTitle&&e.isNotationElementVisible(te.ScoreSubTitle)&&this.scoreInfoGlyphs.set(te.ScoreSubTitle,new ci(0,0,t.subTitle,r.subTitleFont,Q.Center)),t.artist&&e.isNotationElementVisible(te.ScoreArtist)&&this.scoreInfoGlyphs.set(te.ScoreArtist,new ci(0,0,t.artist,r.subTitleFont,Q.Center)),t.album&&e.isNotationElementVisible(te.ScoreAlbum)&&this.scoreInfoGlyphs.set(te.ScoreAlbum,new ci(0,0,t.album,r.subTitleFont,Q.Center)),t.music&&t.music===t.words&&e.isNotationElementVisible(te.ScoreWordsAndMusic)?this.scoreInfoGlyphs.set(te.ScoreWordsAndMusic,new ci(0,0,"Music and Words by "+t.words,r.wordsFont,Q.Center)):(t.music&&e.isNotationElementVisible(te.ScoreMusic)&&this.scoreInfoGlyphs.set(te.ScoreMusic,new ci(0,0,"Music by "+t.music,r.wordsFont,Q.Right)),t.words&&e.isNotationElementVisible(te.ScoreWords)&&this.scoreInfoGlyphs.set(te.ScoreWords,new ci(0,0,"Words by "+t.words,r.wordsFont,Q.Left)));const s=new ht(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[n,a]of this.scoreInfoGlyphs)a.renderer=s,a.doLayout();if(e.isNotationElementVisible(te.GuitarTuning)){let n=[];for(let a of this.renderer.tracks)for(let o of a.staves)if(!o.isPercussion&&o.isStringed&&o.tuning.length>0&&o.showTablature){n.push(o);break}if(n.length>0){this.tuningGlyph=new z4(0,0),this.tuningGlyph.renderer=s;for(const a of n)this.tuningGlyph.addTuning(a.stringTuning,n.length>1?a.track.name:"")}}if(e.isNotationElementVisible(te.ChordDiagrams)){this.chordDiagrams=new A4(0,0),this.chordDiagrams.renderer=s;let n=new Set;for(let a of this.renderer.tracks)for(let o of a.staves){const l=o.chords;if(l)for(const[,h]of l)n.has(h.uniqueId)||h.showDiagram&&(n.add(h.uniqueId),this.chordDiagrams.addChord(h))}}}get scale(){return this.renderer.settings.display.scale}createEmptyStaffSystem(){let e=new Pl(this);for(let t=0;t<this.renderer.tracks.length;t++){let r=this.renderer.tracks[t],s=!1;for(let n of r.staves)if(n.showStandardNotation){s=!0;break}for(let n=0;n<r.staves.length;n++){let a=r.staves[n],o;if(a.isPercussion)o=Ui.Score;else if(this.renderer.settings.display.staveProfile!==Ui.Default)o=this.renderer.settings.display.staveProfile;else if(a.showTablature&&a.showStandardNotation)o=Ui.ScoreTab;else if(a.showTablature)o=s?Ui.TabMixed:Ui.Tab;else if(a.showStandardNotation)o=Ui.Score;else continue;let l=A.staveProfiles.get(o);for(let h of l)h.canCreate(r,a)&&e.addStaff(r,new V4(t,a,h))}}return e}registerBarRenderer(e,t){this._barRendererLookup.has(e)||this._barRendererLookup.set(e,new Map),this._barRendererLookup.get(e).set(t.bar.id,t)}unregisterBarRenderer(e,t){this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).delete(t.bar.id)}getRendererForBar(e,t){let r=t.id;return this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).has(r)?this._barRendererLookup.get(e).get(r):null}layoutAndRenderAnnotation(e){let t="rendered by alphaTab",r=this.renderer.settings.display.resources,s=12*this.renderer.settings.display.scale,n=Math.floor(s);const a=new An,o=Ce.withFamilyList(r.copyrightFont.families,s,lt.Plain,Yi.Bold);this.renderer.canvas.font=o;const l=A.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical;return a.width=this.renderer.canvas.measureText(t).width,a.height=n,a.x=l?(this.width-a.width)/2:this.firstBarX,a.y=e,a.totalWidth=this.width,a.totalHeight=e+n,a.firstMasterBarIndex=-1,a.lastMasterBarIndex=-1,this.registerPartial(a,h=>{h.color=r.mainGlyphColor,h.font=o,h.textAlign=Q.Left,h.textBaseline=le.Top,h.fillText(t,0,0)}),e+n}}var j;(function(i){i[i.TopWithStem=0]="TopWithStem",i[i.Top=1]="Top",i[i.Center=2]="Center",i[i.Bottom=3]="Bottom",i[i.BottomWithStem=4]="BottomWithStem"})(j||(j={}));var et;(function(i){i[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"})(et||(et={}));class ht{get nextRenderer(){return!this.bar||!this.bar.nextBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.nextBar)}get previousRenderer(){return!this.bar||!this.bar.previousBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.previousBar)}constructor(e,t){this._preBeatGlyphs=new xo,this._voiceContainers=new Map,this._postBeatGlyphs=new xo,this._ties=[],this.x=0,this.y=0,this.width=0,this.computedWidth=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this._wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=e,this.bar=t,t&&(this.helpers=new D4(this))}registerTies(e){this._ties.push(...e)}get middleYPosition(){return 0}registerOverflowTop(e){return e>this.topOverflow?(this.topOverflow=e,!0):!1}registerOverflowBottom(e){return e>this.bottomOverflow?(this.bottomOverflow=e,!0):!1}scaleToWidth(e){let t=e-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const r of this._voiceContainers.values())r.scaleToWidth(t);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+t,this.width=e}get resources(){return this.settings.display.resources}get settings(){return this.scoreRenderer.settings}get scale(){return this.settings.display.scale}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}get isFirstOfLine(){return this.index===0}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){let e=this.layoutingInfo,t=this._preBeatGlyphs.width;e.preBeatSize<t&&(e.preBeatSize=t);for(const s of this._voiceContainers.values())s.registerLayoutingInfo(e),s.x+s.width;let r=this._postBeatGlyphs.width;e.postBeatSize<r&&(e.postBeatSize=r)}applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const r of this._voiceContainers.values()){r.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,r.applyLayoutingInfo(this.layoutingInfo);let s=r.x+r.width;e<s&&(e=s)}this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const t=this.barDisplayWidth;return t>0&&this.scoreRenderer.layout.systemsLayoutMode==qi.FromModelWithWidths&&(this.width=t,this.computedWidth=t),!0}finalizeRenderer(){this.isFinalized=!0;let e=!1;const t=this.y-this.staff.topSpacing,r=this.y+this.height+this.staff.bottomSpacing;for(const s of this._ties)if(s.doLayout(),s.height>0){const n=s.y+s.height-r;n>0&&this.registerOverflowBottom(n)&&(e=!0);const a=s.y-t;a<0&&this.registerOverflowTop(a*-1)&&(e=!0)}return e}doLayout(){if(this.bar){this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new xo,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new xo,this._postBeatGlyphs.renderer=this;for(let e=0;e<this.bar.voices.length;e++){let t=this.bar.voices[e];if(this.hasVoiceContainer(t)){let r=new Xx(0,0,t);r.renderer=this,this._voiceContainers.set(this.bar.voices[e].index,r)}}this.bar.simileMark===fr.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.createBeatGlyphs(),this.createPostBeatGlyphs(),this.updateSizes();for(const e of this.helpers.beamHelpers)for(const t of e)t.finish();this.computedWidth=this.width}}hasVoiceContainer(e){return!e.isEmpty||e.index===0}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);let e=this._voiceContainers,t=this.beatGlyphsStart,r=t;for(const s of e.values()){s.x=t,s.doLayout();let n=s.x+s.width;r<n&&(r=n)}this._postBeatGlyphs.x=Math.floor(r),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height*this.scale}addPreBeatGlyph(e){e.renderer=this,this._preBeatGlyphs.addGlyph(e)}addBeatGlyph(e){e.renderer=this,e.preNotes.renderer=this,e.onNotes.renderer=this,e.onNotes.beamingHelper=this.helpers.beamHelperLookup[e.beat.voice.index].get(e.beat.index),this.getVoiceContainer(e.beat.voice).addGlyph(e)}getVoiceContainer(e){return this._voiceContainers.has(e.index)?this._voiceContainers.get(e.index):void 0}getBeatContainer(e){var t,r;return(r=(t=this.getVoiceContainer(e.voice))==null?void 0:t.beatGlyphs)==null?void 0:r[e.index]}getPreNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.preNotes}getOnNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.onNotes}paint(e,t,r){this.paintBackground(e,t,r),r.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(e+this.x,t+this.y,r);for(const s of this._voiceContainers.values())r.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.paint(e+this.x,t+this.y,r);r.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(e+this.x,t+this.y,r)}paintBackground(e,t,r){this.layoutingInfo.paint(e+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,t+this.y+this.height,r)}buildBoundingsLookup(e,t,r){let s=new Ox;s.bar=this.bar,s.visualBounds=new Ti,s.visualBounds.x=t+this.x,s.visualBounds.y=r+this.y+this.topPadding,s.visualBounds.w=this.width,s.visualBounds.h=this.height-this.topPadding-this.bottomPadding,s.realBounds=new Ti,s.realBounds.x=t+this.x,s.realBounds.y=r+this.y,s.realBounds.w=this.width,s.realBounds.h=this.height,e.addBar(s);for(const[n,a]of this._voiceContainers){let o=this.bar.isEmpty&&n===0;if(!a.voice.isEmpty||o)for(let l=0,h=a.beatGlyphs.length;l<h;l++)a.beatGlyphs[l].buildBoundingsLookup(s,t+this.x+a.x,r+this.y+a.y,o)}}addPostBeatGlyph(e){this._postBeatGlyphs.addGlyph(e)}createPreBeatGlyphs(){this._wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}createVoiceGlyphs(e){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(e,t=be.PreNotes){let r=this.getBeatContainer(e);if(r)switch(t){case be.PreNotes:return r.voiceContainer.x+r.x;case be.OnNotes:return r.voiceContainer.x+r.x+r.onNotes.x;case be.MiddleNotes:return r.voiceContainer.x+r.x+r.onTimeX;case be.Stem:const s=r.onNotes.beamingHelper?r.onNotes.beamingHelper.getBeatLineX(e):r.onNotes.x+r.onNotes.width/2;return r.voiceContainer.x+s;case be.PostNotes:return r.voiceContainer.x+r.x+r.onNotes.x+r.onNotes.width;case be.EndBeat:return r.voiceContainer.x+r.x+r.width}return 0}getNoteX(e,t){let r=this.getBeatContainer(e.beat);return r?r.voiceContainer.x+r.x+r.onNotes.x+r.onNotes.getNoteX(e,t):0}getNoteY(e,t){let r=this.getOnNotesGlyphForBeat(e.beat);return r?r.getNoteY(e,t):NaN}reLayout(){(this._wasFirstOfLine&&!this.isFirstOfLine||!this._wasFirstOfLine&&this.isFirstOfLine)&&(this._preBeatGlyphs=new xo,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()),this.updateSizes(),this.registerLayoutingInfo()}paintSimileMark(e,t,r){switch(this.bar.simileMark){case fr.Simple:r.fillMusicFontSymbol(e+this.x+(this.width-20*this.scale)/2,t+this.y+this.height/2,1,g.Repeat1Bar,!1);break;case fr.SecondOfDouble:r.fillMusicFontSymbol(e+this.x-28*this.scale/2,t+this.y+this.height/2,1,g.Repeat2Bars,!1);break}}completeBeamingHelper(e){}getBeatDirection(e){return this.helpers.getBeamingHelperForBeat(e).direction}}ht.RawLineSpacing=8;ht.StemWidth=.12*ht.RawLineSpacing;ht.StaffLineThickness=.13*ht.RawLineSpacing;ht.BeamThickness=.5*ht.RawLineSpacing;ht.BeamSpacing=.25*ht.RawLineSpacing;var Be;(function(i){i[i.SinglePreBeat=0]="SinglePreBeat",i[i.SingleOnBeat=1]="SingleOnBeat",i[i.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",i[i.GroupedOnBeat=3]="GroupedOnBeat",i[i.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",i[i.FullBar=5]="FullBar"})(Be||(Be={}));class U4 extends bt{constructor(e,t){super(0,0),this._uniqueEffectGlyphs=[],this._effectGlyphs=[],this.isEmpty=!0,this.previousBand=null,this.isLinkedToPrevious=!1,this.firstBeat=null,this.lastBeat=null,this.height=0,this.slot=null,this.voice=e,this.info=t}doLayout(){super.doLayout();for(let e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(e){if(e.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,e)&&(!this.info.hideOnMultiTrack||this.renderer.staff.trackIndex===0)){if(this.isEmpty=!1,(!this.firstBeat||e.isBefore(this.firstBeat))&&(this.firstBeat=e),!this.lastBeat||e.isAfter(this.lastBeat))switch(this.lastBeat=e,this.info.sizingMode){case Be.SingleOnBeatToEnd:case Be.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat);break}let t=this.createOrResizeGlyph(this.info.sizingMode,e);t.height>this.height&&(this.height=t.height)}}createOrResizeGlyph(e,t){let r;switch(e){case Be.FullBar:return r=this.info.createNewGlyph(this.renderer,t),r.renderer=this.renderer,r.beat=t,r.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,r),this._uniqueEffectGlyphs[t.voice.index].push(r),r;case Be.SinglePreBeat:case Be.SingleOnBeat:case Be.SingleOnBeatToEnd:return r=this.info.createNewGlyph(this.renderer,t),r.renderer=this.renderer,r.beat=t,r.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,r),this._uniqueEffectGlyphs[t.voice.index].push(r),r;case Be.GroupedOnBeat:case Be.GroupedOnBeatToEnd:let s=e===Be.GroupedOnBeat?Be.SingleOnBeat:Be.SingleOnBeatToEnd;if(t.index>0||this.renderer.index>0){let n=t.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,n)){let a=null;if(t.index>0&&this._effectGlyphs[t.voice.index].has(n.index))a=this._effectGlyphs[t.voice.index].get(n.index);else if(this.renderer.index>0){let h=this.renderer.previousRenderer.getBand(n.voice,this.info.effectId);if(h){let u=h._effectGlyphs[n.voice.index];u.has(n.index)&&(a=u.get(n.index))}}let o=this.createOrResizeGlyph(s,t);return a&&this.info.canExpand(n,t)&&(a.nextGlyph=o,o.previousGlyph=a,this.isLinkedToPrevious=!0),o}return this.createOrResizeGlyph(s,t)}return this.createOrResizeGlyph(s,t);default:return this.createOrResizeGlyph(Be.SingleOnBeat,t)}}paint(e,t,r){super.paint(e,t,r);for(let s=0,n=this._uniqueEffectGlyphs.length;s<n;s++){let a=this._uniqueEffectGlyphs[s];for(let o=0,l=a.length;o<l;o++)a[o].paint(e+this.x,t+this.y,r)}}alignGlyphs(){for(let e=0;e<this._effectGlyphs.length;e++)for(const t of this._effectGlyphs[e].keys())this.alignGlyph(this.info.sizingMode,this.renderer.bar.voices[e].beats[t])}alignGlyph(e,t){let r=this._effectGlyphs[t.voice.index].get(t.index),s,n=this.renderer.getBeatContainer(t);switch(e){case Be.SinglePreBeat:s=n.preNotes,r.x=this.renderer.beatGlyphsStart+s.x+n.x,r.width=s.width;break;case Be.SingleOnBeat:case Be.GroupedOnBeat:s=n.onNotes,r.x=this.renderer.beatGlyphsStart+s.x+n.x,r.width=s.width;break;case Be.SingleOnBeatToEnd:case Be.GroupedOnBeatToEnd:s=n.onNotes,r.x=this.renderer.beatGlyphsStart+s.x+n.x,n.beat.isLastOfVoice?r.width=this.renderer.width-r.x:r.width=n.width-n.preNotes.width-n.preNotes.x;break;case Be.FullBar:r.width=this.renderer.width;break}}}class Y4{constructor(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null}}class $4{constructor(){this.bands=[],this.shared=new Y4}update(e){e.info.canShareBand||(this.shared.uniqueEffectId=e.info.effectId),e.slot=this,this.bands.push(e),e.height>this.shared.height&&(this.shared.height=e.height),(!this.shared.firstBeat||e.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=e.firstBeat),(!this.shared.lastBeat||e.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=e.lastBeat)}canBeUsed(e){return(!this.shared.uniqueEffectId&&e.info.canShareBand||e.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(e.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class X4{constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(e){if(this._effectSlot.has(e.info.effectId)){let r=this._effectSlot.get(e.info.effectId);if(r.canBeUsed(e))return r}for(let r of this.slots)if(r.canBeUsed(e))return r;let t=new $4;return this.slots.push(t),t}register(e){let t=this.getOrCreateSlot(e);t.update(e),this._effectSlot.set(e.info.effectId,t)}}class jl extends qr{constructor(){super(0,0),this.computedWidth=0}doLayout(){let e=0;if(this.glyphs)for(let t=0,r=this.glyphs.length;t<r;t++){let s=this.glyphs[t];s.x=e,s.renderer=this.renderer,s.doLayout(),e+=s.width}this.width=e,this.computedWidth=e}noteLoop(e){for(let t=this.container.beat.notes.length-1;t>=0;t--)e(this.container.beat.notes[t])}}class ql extends jl{constructor(){super(...arguments),this.centerX=0}updateBeamingHelper(){}buildBoundingsLookup(e,t,r){}getNoteX(e,t){return 0}getNoteY(e,t){return 0}}class j4 extends ht{constructor(e,t,r){super(e,t),this._bands=[],this._bandLookup=new Map,this.sizingInfo=null,this._infos=r}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),super.updateSizes()}finalizeRenderer(){let e=super.finalizeRenderer();return this.updateHeight()&&(e=!0),e}updateHeight(){if(!this.sizingInfo)return!1;let e=0;for(let t of this.sizingInfo.slots){t.shared.y=e;for(let r of t.bands)r.y=e,r.height=t.shared.height;e+=t.shared.height}return e!==this.height?(this.height=e,!0):!1}applyLayoutingInfo(){if(!super.applyLayoutingInfo())return!1;if(this.index>0){let e=this.previousRenderer;this.sizingInfo=e.sizingInfo}else this.sizingInfo=new X4;for(let e of this._bands)e.alignGlyphs(),e.isEmpty||this.sizingInfo.register(e);return this.updateHeight(),!0}scaleToWidth(e){super.scaleToWidth(e);for(let t of this._bands)t.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(let e of this.bar.voices)if(this.hasVoiceContainer(e))for(let t of this._infos){let r=new U4(e,t);r.renderer=this,r.doLayout(),this._bands.push(r),this._bandLookup.set(e.index+"."+t.effectId,r)}for(let e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e);for(let e of this._bands)e.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(e){for(let t of e.beats){let r=new Nr(t,this.getVoiceContainer(e));r.preNotes=new jl,r.onNotes=new ql,this.addBeatGlyph(r);for(let s of this._bands)s.createGlyph(t)}}paint(e,t,r){this.paintBackground(e,t,r);for(let s of this._bands)r.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.isEmpty||s.paint(e+this.x,t+this.y,r)}getBand(e,t){let r=e.index+"."+t;return this._bandLookup.has(r)?this._bandLookup.get(r):null}}class Jr extends rd{get staffId(){return this._staffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(e,t){super(),this._infos=t,this._staffId=e,this.isInAccolade=!1,this.isRelevantForBoundsLookup=!1}create(e,t){return new j4(e,t,this._infos.filter(r=>e.settings.notation.isNotationElementVisible(r.notationElement)))}}class El extends Qr{constructor(e,t,r){super(e,t),this._endingsString="",this._endings=[];for(let s=0;s<Vs.MaxAlternateEndings;s++)r&1<<s&&this._endings.push(s)}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+(El.Padding*this.scale+2);let e="";for(let t=0,r=this._endings.length;t<r;t++)e+=this._endings[t]+1,e+=". ";this._endingsString=e}paint(e,t,r){super.paint(e,t,r);let s=r.textBaseline;if(r.textBaseline=le.Top,this._endings.length>0){let n=this.renderer.resources;r.font=n.wordsFont,r.moveTo(e+this.x,t+this.y+this.height),r.lineTo(e+this.x,t+this.y),r.lineTo(e+this.x+this.width,t+this.y),r.stroke(),r.fillText(this._endingsString,e+this.x+El.Padding*this.scale,t+this.y*this.scale)}r.textBaseline=s}}El.Padding=3;class $t{get effectId(){return this.notationElement.toString()}}class lf extends $t{get notationElement(){return te.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Be.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.alternateEndings!==0}createNewGlyph(e,t){return new El(0,0,t.voice.bar.masterBar.alternateEndings)}canExpand(e,t){return!0}}class ib extends $t{get notationElement(){return te.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.index===0&&t.voice.bar.index===0&&t.voice.bar.staff.capo!==0}createNewGlyph(e,t){return new ci(0,0,"Capo. fret "+t.voice.bar.staff.capo,e.resources.effectFont,Q.Left)}canExpand(e,t){return!1}}class hf extends $t{get notationElement(){return te.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.hasChord}createNewGlyph(e,t){return new ci(0,0,t.chord.name,e.resources.effectFont,Q.Center)}canExpand(e,t){return!1}}class Ql extends Qr{constructor(e){super(),this.forceGroupedRendering=!1,this.endOnBarLine=!1,this.endPosition=e}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(e,t,r){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering){this.paintNonGrouped(e,t,r);return}let s;if(!this.isLinkedWithNext&&this.forceGroupedRendering)s=this;else for(s=this.nextGlyph;s.isLinkedWithNext;)s=s.nextGlyph;let n=s.renderer,a=s.beat,o=this.endPosition,l=e-this.renderer.x,h=this.calculateEndX(n,a,l,o);this.paintGrouped(e,t,h,r)}calculateEndX(e,t,r,s){return t?r+e.x+e.getBeatX(t,s):r+e.x+this.x+this.width}paintNonGrouped(e,t,r){let s=e-this.renderer.x,n=this.calculateEndX(this.renderer,this.beat,s,this.endPosition);this.paintGrouped(e,t,n,r)}}class Ml extends Ql{constructor(e,t,r){super(be.EndBeat),this._crescendo=Ii.None,this._crescendo=r,this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=17*this.scale}paintGrouped(e,t,r,s){let n=e+this.x,a=this.height*this.scale;s.beginPath(),this._crescendo===Ii.Crescendo?(r-=Ml.Padding*this.scale,s.moveTo(r,t+this.y),s.lineTo(n,t+this.y+a/2),s.lineTo(r,t+this.y+a)):(r-=Ml.Padding*this.scale,s.moveTo(n,t+this.y),s.lineTo(r,t+this.y+a/2),s.lineTo(n,t+this.y+a)),s.stroke()}}Ml.Padding=ue.QuarterNoteHeadWidth/2|0;class rb extends $t{get notationElement(){return te.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.crescendo!==Ii.None}createNewGlyph(e,t){return new Ml(0,0,t.crescendo)}canExpand(e,t){return e.crescendo===t.crescendo}}class Xm extends ft{constructor(e,t,r){super(e,t,.6,Xm.getSymbol(r))}doLayout(){super.doLayout(),this.height=17*this.scale,this.y+=this.height/2}static getSymbol(e){switch(e){case pe.PPP:return g.DynamicPPP;case pe.PP:return g.DynamicPP;case pe.P:return g.DynamicPiano;case pe.MP:return g.DynamicMP;case pe.MF:return g.DynamicMF;case pe.F:return g.DynamicForte;case pe.FF:return g.DynamicFF;case pe.FFF:return g.DynamicFFF;default:return g.None}}}class sb extends $t{get notationElement(){return te.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return this.internalShouldCreateGlyph(t)}internalShouldCreateGlyph(e){if(e.voice.bar.staff.track.score.stylesheet.hideDynamics||e.isEmpty||e.voice.isEmpty||e.isRest||e.graceType!==K.None)return!1;let t=this.getPreviousDynamicsBeat(e),r=e.voice.index===0&&!t||e.dynamics!==(t==null?void 0:t.dynamics);if(r&&e.voice.index>0){for(let s of e.voice.bar.voices)if(s.index<e.voice.index){let n=s.getBeatAtPlaybackStart(e.playbackStart);n&&e.dynamics===n.dynamics&&this.internalShouldCreateGlyph(n)&&(r=!1)}}return r}getPreviousDynamicsBeat(e){let t=e.previousBeat;for(;t!=null;){if(!t.isRest&&t.graceType===K.None)return t;t=t.previousBeat}return null}createNewGlyph(e,t){return new Xm(0,0,t.dynamics)}canExpand(e,t){return!0}}class q4 extends Qr{doLayout(){super.doLayout(),this.height=17*this.scale}paint(e,t,r){let s=6*this.scale,n=Math.max(this.width,14*this.scale),a=this.height/2;r.beginPath(),r.moveTo(e+this.x,t+this.y+a),r.quadraticCurveTo(e+this.x+n/2,t+this.y+a,e+this.x+n,t+this.y+a-s),r.moveTo(e+this.x,t+this.y+a),r.quadraticCurveTo(e+this.x+n/2,t+this.y+a,e+this.x+n,t+this.y+a+s),r.stroke()}}class uf extends $t{get notationElement(){return te.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.fadeIn}createNewGlyph(e,t){return new q4}canExpand(e,t){return!0}}class jm extends ft{constructor(e,t,r){super(e,t,1,jm.getSymbol(r))}static getSymbol(e){switch(e){case Yr.Short:return g.FermataShortAbove;case Yr.Medium:return g.FermataAbove;case Yr.Long:return g.FermataLongAbove;default:return g.None}}doLayout(){this.width=23*this.scale,this.height=12*this.scale}paint(e,t,r){super.paint(e-this.width/2,t+this.height,r)}}class cf extends $t{get notationElement(){return te.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index===0&&!!t.fermata}createNewGlyph(e,t){return new jm(0,0,t.fermata.type)}canExpand(e,t){return!0}}class nb extends $t{get notationElement(){return te.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index!==0||t.isRest||e.notation.fingeringMode!==jr.SingleNoteEffectBand&&e.notation.fingeringMode!==jr.SingleNoteEffectBandForcePiano||t.notes.length!==1?!1:t.notes[0].isFingering}createNewGlyph(e,t){let r=ne.Unknown,s=!1,n=t.notes[0];n.leftHandFinger!==ne.Unknown?(r=n.leftHandFinger,s=!0):n.rightHandFinger!==ne.Unknown&&(r=n.rightHandFinger);let a=$e.fingerToString(e.settings,t,r,s)??"";return new ci(0,0,a,e.resources.fingeringFont,Q.Left)}canExpand(e,t){return!0}}class ua extends $t{constructor(){super(...arguments),this.lastCreateInfo=null}shouldCreateGlyph(e,t){this.lastCreateInfo=[];for(let r=0,s=t.notes.length;r<s;r++){let n=t.notes[r];this.shouldCreateGlyphForNote(n)&&this.lastCreateInfo.push(n)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(e,t){return!0}}class Ys extends Ql{constructor(e){super(be.OnNotes),this._label=e}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=be.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.height=this.renderer.resources.effectFont.size}paintNonGrouped(e,t,r){let s=this.renderer.resources;r.font=s.effectFont;let n=r.textAlign;r.textAlign=Q.Center,r.fillText(this._label,e+this.x,t+this.y),r.textAlign=n}paintGrouped(e,t,r,s){this.paintNonGrouped(e,t,s);let n=3*this.scale,a=s.measureText(this._label).width,o=e+this.x+a/2+n,l=t+this.y+4*this.scale,h=8*this.scale;if(r>o){let u=o;for(;u<r;)s.beginPath(),s.moveTo(u,l|0),s.lineTo(Math.min(u+h,r),l|0),u+=h+n,s.stroke();s.beginPath(),s.moveTo(r,l-5*this.scale|0),s.lineTo(r,l+5*this.scale|0),s.stroke()}}}Ys.LineSpacing=3;Ys.LineTopPadding=4;Ys.LineTopOffset=5;Ys.LineSize=8;class ir extends ua{get effectId(){return this._effectId}get notationElement(){return te.EffectHarmonics}constructor(e){switch(super(),this._beat=null,this._harmonicType=e,e){case q.None:this._effectId="harmonics-none";break;case q.Natural:this._effectId="harmonics-natural";break;case q.Artificial:this._effectId="harmonics-artificial";break;case q.Pinch:this._effectId="harmonics-pinch";break;case q.Tap:this._effectId="harmonics-tap";break;case q.Semi:this._effectId="harmonics-semi";break;case q.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId="";break}}shouldCreateGlyphForNote(e){return!e.isHarmonic||e.harmonicType!==this._harmonicType?!1:(e.beat!==this._beat&&(this._beat=e.beat),!0)}get sizingMode(){return Be.GroupedOnBeat}createNewGlyph(e,t){return new Ys(ir.harmonicToString(this._harmonicType))}static harmonicToString(e){switch(e){case q.Natural:return"N.H.";case q.Artificial:return"A.H.";case q.Pinch:return"P.H.";case q.Tap:return"T.H.";case q.Semi:return"S.H.";case q.Feedback:return"Fdbk."}return""}}class df extends $t{get notationElement(){return te.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isLetRing}get sizingMode(){return Be.GroupedOnBeat}createNewGlyph(e,t){return new Ys("LetRing")}canExpand(e,t){return!0}}class Q4 extends Qr{constructor(e,t,r,s,n=Q.Center){super(e,t),this._lines=r,this.font=s,this.textAlign=n}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(e,t,r){r.font=this.font;let s=r.textAlign;r.textAlign=this.textAlign;for(let n=0;n<this._lines.length;n++)this._lines[n]&&r.fillText(this._lines[n],e+this.x,t+this.y+n*this.font.size);r.textAlign=s}}class Nh extends $t{get notationElement(){return te.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.lyrics}createNewGlyph(e,t){return new Q4(0,0,t.lyrics,e.resources.effectFont,Q.Center)}canExpand(e,t){return!0}}class ff extends $t{get notationElement(){return te.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return Be.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.isSectionStart}createNewGlyph(e,t){return new ci(0,0,t.voice.bar.masterBar.section.marker?"["+t.voice.bar.masterBar.section.marker+"] "+t.voice.bar.masterBar.section.text:t.voice.bar.masterBar.section.text,e.resources.markerFont,Q.Left)}canExpand(e,t){return!0}}class K4 extends Ql{constructor(e,t){super(be.PostNotes),this._ottava=e,this._aboveStaff=t}doLayout(){super.doLayout(),this.height=13*this.scale}paintNonGrouped(e,t,r){this.paintOttava(e,t,r)}paintOttava(e,t,r){let s=0;switch(this._ottava){case Le._15ma:s=37*this.scale,r.fillMusicFontSymbol(e+this.x-s/2,t+this.y+this.height,.8,g.QuindicesimaAlta,!1);break;case Le._8va:s=26*this.scale,r.fillMusicFontSymbol(e+this.x-s/2,t+this.y+this.height,.8,g.OttavaAlta,!1);break;case Le._8vb:s=23*this.scale,r.fillMusicFontSymbol(e+this.x-s/2,t+this.y+this.height,.8,g.OttavaBassaVb,!1);break;case Le._15mb:s=36*this.scale,r.fillMusicFontSymbols(e+this.x-s/2,t+this.y+this.height,.8,[g.Quindicesima,g.OctaveBaselineM,g.OctaveBaselineB],!1);break}return s/2}paintGrouped(e,t,r,s){let n=this.paintOttava(e,t,s),a=3*this.scale,o=e+this.x+n+a,l=t+this.y;l+=this._aboveStaff?2*this.scale:this.height-2*this.scale;let h=8*this.scale;if(r>o){let u=o;for(;u<r;)s.beginPath(),s.moveTo(u,l|0),s.lineTo(Math.min(u+h,r),l|0),u+=h+a,s.stroke();s.beginPath(),this._aboveStaff?(s.moveTo(r,l),s.lineTo(r,t+this.y+this.height)):(s.moveTo(r,l),s.lineTo(r,t+this.y)),s.stroke()}}}class Ph extends $t{get effectId(){return"ottavia-"+(this._aboveStaff?"above":"below")}get notationElement(){return te.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.GroupedOnBeat}constructor(e){super(),this._aboveStaff=e}shouldCreateGlyph(e,t){switch(t.ottava){case Le._15ma:return this._aboveStaff;case Le._8va:return this._aboveStaff;case Le._8vb:return!this._aboveStaff;case Le._15mb:return!this._aboveStaff}return!1}createNewGlyph(e,t){return new K4(t.ottava,this._aboveStaff)}canExpand(e,t){return e.ottava===t.ottava}}class pf extends ua{get notationElement(){return te.EffectPalmMute}shouldCreateGlyphForNote(e){return e.isPalmMute}get sizingMode(){return Be.GroupedOnBeat}createNewGlyph(e,t){return new Ys("P.M.")}constructor(){super()}}class gf extends ua{get notationElement(){return te.EffectPickSlide}shouldCreateGlyphForNote(e){return e.slideOutType===he.PickSlideDown||e.slideOutType===he.PickSlideUp}get sizingMode(){return Be.GroupedOnBeat}createNewGlyph(e,t){return new Ys("P.S.")}constructor(){super()}}class Ll extends ft{constructor(e,t,r){super(e,t,ue.GraceScale,Ll.getSymbol(r))}doLayout(){this.width=9*this.scale,this.height=13*this.scale}paint(e,t,r){super.paint(e,t+this.height,r)}static getSymbol(e){switch(e){case Jt.Up:return g.StringsUpBow;case Jt.Down:return g.StringsDownBow;default:return g.None}}}class mf extends $t{get notationElement(){return te.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.pickStroke!==Jt.None}createNewGlyph(e,t){return new Ll(0,0,t.pickStroke)}canExpand(e,t){return!0}}class qx extends Ql{constructor(e){super(be.EndBeat),this._stepSize=0,this._type=e}doLayout(){switch(super.doLayout(),this._type){case Pe.Slight:this._stepSize=12*this.scale;break;case Pe.Wide:this._stepSize=23*this.scale;break}this.height=18*this.scale}paintGrouped(e,t,r,s){let n=e+this.x,a=r-n,o=Math.max(1,a/this._stepSize);s.beginPath(),s.moveTo(n,t+this.y);for(let l=0;l<o;l++)s.lineTo(n+this._stepSize/2,t+this.y+this.height),s.lineTo(n+this._stepSize,t+this.y),n+=this._stepSize;s.stroke()}}class Eh extends $t{get notationElement(){return te.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Pe.Slight}createNewGlyph(e,t){return new qx(Pe.Slight)}canExpand(e,t){return!0}}class ra extends Ql{constructor(e,t,r,s=1.2,n=!1){super(be.EndBeat),this._scale=0,this._symbol=g.None,this._symbolSize=0,this._type=r,this._scale=s,this.x=e,this.y=t,this._partialWaves=n}doLayout(){super.doLayout();let e=0;switch(this._type){case Pe.Slight:this._symbol=g.WiggleTrill,this._symbolSize=9*this._scale,e=6*this._scale;break;case Pe.Wide:this._symbol=g.WiggleVibratoMediumFast,this._symbolSize=10*this._scale,e=10*this._scale;break}this.height=e*this.scale}paintGrouped(e,t,r,s){let n=e+this.x,a=r-n,o=this._symbolSize*this.scale,l=a/o;this._partialWaves||(l=Math.floor(l)),l<1&&(l=1);let h=0;for(let u=0;u<l;u++)s.fillMusicFontSymbol(e+this.x+h,t+this.y+this.height*2,this._scale*this.scale,this._symbol,!1),h+=o}}class Mh extends ua{get notationElement(){return te.EffectSlightNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Pe.Slight||e.isTieDestination&&e.tieOrigin.vibrato===Pe.Slight}get sizingMode(){return Be.GroupedOnBeatToEnd}createNewGlyph(e,t){return new ra(0,0,Pe.Slight,1.2)}constructor(){super()}}class ab extends $t{get notationElement(){return te.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return t.slap||t.pop||t.tap}createNewGlyph(e,t){let r=e.resources;return t.slap?new ci(0,0,"S",r.effectFont,Q.Left):t.pop?new ci(0,0,"P",r.effectFont,Q.Left):new ci(0,0,"T",r.effectFont,Q.Left)}canExpand(e,t){return!0}}class J4 extends Qr{constructor(e,t,r){super(e,t),this._tempo=0,this._tempo=r}doLayout(){super.doLayout(),this.height=25*this.scale}paint(e,t,r){let s=this.renderer.resources;r.font=s.markerFont,r.fillMusicFontSymbol(e+this.x,t+this.y+this.height*.8,this.scale*ue.GraceScale,g.NoteQuarterUp,!1),r.textBaseline=le.Top,r.fillText("= "+this._tempo.toString(),e+this.x+this.height/2,t+this.y+r.font.size/2)}}class yf extends $t{get notationElement(){return te.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Be.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&(!!t.voice.bar.masterBar.tempoAutomation||t.voice.bar.index===0)}createNewGlyph(e,t){let r=0;return t.voice.bar.masterBar.tempoAutomation?r=t.voice.bar.masterBar.tempoAutomation.value:r=t.voice.bar.staff.track.score.tempo,new J4(0,0,r)}canExpand(e,t){return!0}}class bf extends $t{get notationElement(){return te.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.text}createNewGlyph(e,t){return new ci(0,0,t.text,e.resources.effectFont,Q.Left)}canExpand(e,t){return!0}}class Z4 extends Qr{constructor(e,t){super(e,t)}doLayout(){super.doLayout(),this.height=this.renderer.resources.markerFont.size*this.scale}paint(e,t,r){let s=this.renderer.resources;r.font=s.markerFont;let n=r.measureText("tr").width;r.fillText("tr",e+this.x,t+this.y);let a=n+3*this.scale,o=this.width-a,l=1.2,h=11*this.scale*l,u=Math.max(1,(o-a)/h),c=a,d=t+this.y+this.height*1.2;for(let p=0;p<u;p++)r.fillMusicFontSymbol(e+this.x+c,d,l,g.WiggleTrill,!1),c+=h}}class Lh extends ua{get notationElement(){return te.EffectTrill}shouldCreateGlyphForNote(e){return e.isTrill}get sizingMode(){return Be.SingleOnBeat}createNewGlyph(e,t){return new Z4(0,0)}}var st;(function(i){i[i.Full=0]="Full",i[i.PartialLeft=1]="PartialLeft",i[i.PartialRight=2]="PartialRight"})(st||(st={}));class Ie extends Qr{constructor(e){super(0,0),this._tripletFeel=e}doLayout(){super.doLayout(),this.height=25*this.scale}paint(e,t,r){e+=this.x,t+=this.y;let s=t+this.height*ue.GraceScale;r.font=this.renderer.resources.effectFont,r.fillText("(",e,t+this.height*.3);let n=e+10*this.scale,a=e+40*this.scale;switch(this._tripletFeel){case fe.NoTripletFeel:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full]),this.renderBarNote(a,s,Ie.NoteScale,r,[st.Full]);break;case fe.Triplet8th:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full]),r.fillMusicFontSymbol(a,s,Ie.NoteScale,g.NoteQuarterUp,!1),r.fillMusicFontSymbol(a+Ie.NoteSeparation*this.scale,s,Ie.NoteScale,g.NoteEighthUp,!1),this.renderTriplet(a,t,r);break;case fe.Triplet16th:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full,st.Full]),this.renderBarNote(a,s,Ie.NoteScale,r,[st.Full,st.PartialRight]),this.renderTriplet(a,t,r);break;case fe.Dotted8th:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full]),this.renderBarNote(a,s,Ie.NoteScale,r,[st.Full,st.PartialRight]),r.fillCircle(a+9*this.scale,s,this.scale);break;case fe.Dotted16th:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full,st.Full]),this.renderBarNote(a,s,Ie.NoteScale,r,[st.Full,st.Full,st.PartialRight]),r.fillCircle(a+9*this.scale,s,this.scale);break;case fe.Scottish8th:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full]),this.renderBarNote(a,s,Ie.NoteScale,r,[st.Full,st.PartialLeft]),r.fillCircle(a+Ie.NoteSeparation*this.scale+8*this.scale,s,this.scale);break;case fe.Scottish16th:this.renderBarNote(n,s,Ie.NoteScale,r,[st.Full,st.Full]),this.renderBarNote(a,s,Ie.NoteScale,r,[st.Full,st.Full,st.PartialLeft]),r.fillCircle(a+Ie.NoteSeparation*this.scale+8*this.scale,s,this.scale);break}r.fillText("=",e+30*this.scale,t+5*this.scale),r.fillText(")",e+65*this.scale,t+this.height*.3)}renderBarNote(e,t,r,s,n){s.fillMusicFontSymbol(e,t,r,g.NoteQuarterUp,!1);let a=Ie.NoteSeparation/2*this.scale;for(let o=0;o<n.length;o++)switch(n[o]){case st.Full:s.fillRect(e+4*this.scale,t-Ie.NoteHeight*this.scale+Ie.BarSeparation*this.scale*o,Ie.NoteSeparation*this.scale,Ie.BarHeight*this.scale);break;case st.PartialLeft:s.fillRect(e+4*this.scale,t-Ie.NoteHeight*this.scale+Ie.BarSeparation*this.scale*o,a,Ie.BarHeight*this.scale);break;case st.PartialRight:s.fillRect(e+4*this.scale+a,t-Ie.NoteHeight*this.scale+Ie.BarSeparation*this.scale*o,a,Ie.BarHeight*this.scale);break}s.fillMusicFontSymbol(e+Ie.NoteSeparation*this.scale,t,r,g.NoteQuarterUp,!1)}renderTriplet(e,t,r){t+=2*this.scale;let s=this.renderer.resources.effectFont;r.font=Ce.withFamilyList(s.families,s.size*.8,s.style);let n=e+Ie.NoteSeparation*this.scale+3*this.scale;r.beginPath(),r.moveTo(e,t+3*this.scale),r.lineTo(e,t),r.lineTo(e+5*this.scale,t),r.moveTo(n+5*this.scale,t+3*this.scale),r.lineTo(n+5*this.scale,t),r.lineTo(n,t),r.stroke(),r.fillText("3",e+7*this.scale,t-10*this.scale),r.font=s}}Ie.NoteScale=.4;Ie.NoteHeight=12;Ie.NoteSeparation=12;Ie.BarHeight=2;Ie.BarSeparation=3;class wf extends $t{get notationElement(){return te.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Be.SinglePreBeat}shouldCreateGlyph(e,t){return t.index===0&&(t.voice.bar.masterBar.index===0&&t.voice.bar.masterBar.tripletFeel!==fe.NoTripletFeel||t.voice.bar.masterBar.index>0&&t.voice.bar.masterBar.tripletFeel!==t.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(e,t){return new Ie(t.voice.bar.masterBar.tripletFeel)}canExpand(e,t){return!0}}class ob extends $t{get notationElement(){return te.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Be.GroupedOnBeat}shouldCreateGlyph(e,t){return t.hasWhammyBar}createNewGlyph(e,t){return new Ys("w/bar")}canExpand(e,t){return!0}}class Rh extends $t{get notationElement(){return te.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Be.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Pe.Wide}createNewGlyph(e,t){return new qx(Pe.Wide)}canExpand(e,t){return!0}}class Fh extends ua{get notationElement(){return te.EffectWideNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Pe.Wide||e.isTieDestination&&e.tieOrigin.vibrato===Pe.Wide}get sizingMode(){return Be.GroupedOnBeatToEnd}createNewGlyph(e,t){return new ra(0,0,Pe.Wide,1.2)}}class lb{constructor(){this.x=0,this.width=0,this.masterBars=[]}}class e5 extends jx{get name(){return"HorizontalScreen"}constructor(e){super(e),this._system=null,this._pagePadding=null}get supportsResize(){return!1}get firstBarX(){let e=this._pagePadding[0];return this._system&&(e+=this._system.accoladeWidth),e}doResize(){}doLayoutAndRender(){switch(this._pagePadding=this.renderer.settings.display.padding,this.renderer.settings.display.systemsLayoutMode){case kn.Automatic:this.systemsLayoutMode=qi.Automatic;break;case kn.UseModelLayout:this.systemsLayoutMode=qi.FromModelWithWidths;break}this._pagePadding||(this._pagePadding=[0,0,0,0]),this._pagePadding.length===1?this._pagePadding=[this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]:this._pagePadding.length===2&&(this._pagePadding=[this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]);let e=this.renderer.score,t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t));let r=t,s=this.renderer.settings.display.barCount;s<=0&&(s=e.masterBars.length),s=t+s-1,s=Math.min(e.masterBars.length-1,Math.max(0,s)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this._pagePadding[0],this._system.y=this._pagePadding[1];let n=this.renderer.settings.display.barCountPerPartial,a=[],o=new lb,l=0;for(;r<=s;){let u=this._system.addBars(this.renderer.tracks,r);if(u)if(o.masterBars.length===0&&u.isLinkedToPrevious&&a.length>0){let c=a[a.length-1];c.masterBars.push(e.masterBars[r]),c.width+=u.width,l+=u.width,o.x+=l}else o.masterBars.push(e.masterBars[r]),o.width+=u.width,o.masterBars.length>=n&&(a.length===0&&(o.width+=this._system.accoladeWidth+this._pagePadding[0]),l+=o.width,a.push(o),L.debug(this.name,"Finished partial from bar "+o.masterBars[0].index+" to "+o.masterBars[o.masterBars.length-1].index,null),o=new lb,o.x=l);r++}o.masterBars.length>0&&(a.length===0&&(o.width+=this._system.accoladeWidth+this._pagePadding[0]),a.push(o),L.debug(this.name,"Finished partial from bar "+o.masterBars[0].index+" to "+o.masterBars[o.masterBars.length-1].index,null)),this.finalizeStaffSystem(),this.height=Math.floor(this._system.y+this._system.height),this.width=this._system.x+this._system.width+this._pagePadding[2],r=0;let h=0;for(let u=0;u<a.length;u++){const c=a[u],d=new An;d.x=h,d.y=0,d.totalWidth=this.width,d.totalHeight=this.height,d.width=c.width,d.height=this.height,d.firstMasterBarIndex=c.masterBars[0].index,d.lastMasterBarIndex=c.masterBars[c.masterBars.length-1].index,h+=c.width;const p=r,f=u;this._system.buildBoundingsLookup(0,0),this.registerPartial(d,m=>{let S=this._system.getBarX(c.masterBars[0].index)+this._system.accoladeWidth;f===0&&(S-=this._system.x+this._system.accoladeWidth),m.color=this.renderer.settings.display.resources.mainGlyphColor,m.textAlign=Q.Left,L.debug(this.name,"Rendering partial from bar "+c.masterBars[0].index+" to "+c.masterBars[c.masterBars.length-1].index,null),this._system.paintPartial(-S,this._system.y,m,p,c.masterBars.length)}),r+=c.masterBars.length}this.height=this.layoutAndRenderAnnotation(this.height)+this._pagePadding[3]}finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class t5 extends jx{get name(){return"PageView"}constructor(e){super(e),this._systems=[],this._allMasterBarRenderers=[],this._barsFromPreviousSystem=[],this._pagePadding=null}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case kn.Automatic:this.systemsLayoutMode=qi.Automatic;break;case kn.UseModelLayout:this.systemsLayoutMode=qi.FromModelWithScale;break}this._pagePadding=this.renderer.settings.display.padding,this._pagePadding||(this._pagePadding=[0,0,0,0]),this._pagePadding.length===1?this._pagePadding=[this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]:this._pagePadding.length===2&&(this._pagePadding=[this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]);let e=this._pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],e=this.layoutAndRenderScoreInfo(e,-1),e=this.layoutAndRenderTunings(e,-1),e=this.layoutAndRenderChordDiagrams(e,-1),e=this.layoutAndRenderScore(e),e=this.layoutAndRenderAnnotation(e),this.height=e+this._pagePadding[3]}get supportsResize(){return!0}get firstBarX(){let e=this._pagePadding[0];return this._systems.length>0&&(e+=this._systems[0].accoladeWidth),e}doResize(){let e=this._pagePadding[1];this.width=this.renderer.width;let t=this.height;e=this.layoutAndRenderScoreInfo(e,t),e=this.layoutAndRenderTunings(e,t),e=this.layoutAndRenderChordDiagrams(e,t),e=this.resizeAndRenderScore(e,t),e=this.layoutAndRenderAnnotation(e),this.height=e+this._pagePadding[3]}layoutAndRenderTunings(e,t=-1){if(!this.tuningGlyph)return e;let r=this.renderer.settings.display.resources;this.tuningGlyph.x=this._pagePadding[0],this.tuningGlyph.width=this.width,this.tuningGlyph.doLayout();let s=this.tuningGlyph.height;const n=new An;return n.x=0,n.y=e,n.width=this.width,n.height=s,n.totalWidth=this.width,n.totalHeight=t<0?e+n.height:t,this.registerPartial(n,a=>{a.color=r.scoreInfoColor,a.textAlign=Q.Center,this.tuningGlyph.paint(0,0,a)}),e+s}layoutAndRenderChordDiagrams(e,t=-1){if(!this.chordDiagrams)return e;const r=this.renderer.settings.display.resources;this.chordDiagrams.width=this.width,this.chordDiagrams.doLayout();const s=Math.floor(this.chordDiagrams.height),n=new An;return n.x=0,n.y=e,n.width=this.width,n.height=s,n.totalWidth=this.width,n.totalHeight=t<0?e+s:t,this.registerPartial(n,a=>{a.color=r.scoreInfoColor,a.textAlign=Q.Center,this.chordDiagrams.paint(0,0,a)}),e+s}layoutAndRenderScoreInfo(e,t=-1){L.debug(this.name,"Layouting score info");const r=new An;r.x=0,r.y=e;let s=0,n=this.scale,a=this.renderer.settings.display.resources,o=[te.ScoreTitle,te.ScoreSubTitle,te.ScoreArtist,te.ScoreAlbum,te.ScoreWordsAndMusic];for(let u=0;u<o.length;u++)if(this.scoreInfoGlyphs.has(o[u])){let c=this.scoreInfoGlyphs.get(o[u]);c.x=this.width/2,c.y=s,c.textAlign=Q.Center,s+=c.font.size*n}let l=!1,h=0;if(this.scoreInfoGlyphs.has(te.ScoreMusic)){let u=this.scoreInfoGlyphs.get(te.ScoreMusic);u.x=this.width-this._pagePadding[2],u.y=s,u.textAlign=Q.Right,l=!0,h=u.font.size*n}if(this.scoreInfoGlyphs.has(te.ScoreWords)){let u=this.scoreInfoGlyphs.get(te.ScoreWords);u.x=this._pagePadding[0],u.y=s,u.textAlign=Q.Left,l=!0,h=u.font.size*n}return l&&(s+=h),this.scoreInfoGlyphs.size>0&&(s=Math.floor(s+17*this.scale),r.width=this.width,r.height=s,r.totalWidth=this.width,r.totalHeight=t<0?e+r.height:t,this.registerPartial(r,u=>{u.color=a.scoreInfoColor,u.textAlign=Q.Center;for(const c of this.scoreInfoGlyphs.values())c.paint(0,0,u)})),e+s}resizeAndRenderScore(e,t){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode==qi.FromModelWithScale)for(let s=0;s<this._systems.length;s++){let n=this._systems[s];this.fitSystem(n),e+=this.paintSystem(n,t)}else{this._systems=[];let s=0,n=this.maxWidth,a=this.createEmptyStaffSystem();for(a.index=this._systems.length,a.x=this._pagePadding[0],a.y=e;s<this._allMasterBarRenderers.length;){let o=this._allMasterBarRenderers[s];if(a.width+o.width<=n||a.masterBarsRenderers.length===0)a.addMasterBarRenderers(this.renderer.tracks,o),s++;else{for(;o&&!o.canWrap&&a.masterBarsRenderers.length>1;)o=a.revertLastBar(),s--;a.isFull=!0,a.isLast=this.lastBarIndex===a.lastBarIndex,this._systems.push(a),this.fitSystem(a),e+=this.paintSystem(a,t),a=this.createEmptyStaffSystem(),a.index=this._systems.length,a.x=this._pagePadding[0],a.y=e}}a.isLast=this.lastBarIndex===a.lastBarIndex,this.fitSystem(a),e+=this.paintSystem(a,t)}return e}layoutAndRenderScore(e){let r=this.firstBarIndex,s=this.lastBarIndex;for(this._systems=[];r<=s;){let n=this.createStaffSystem(r,s);this._systems.push(n),n.x=this._pagePadding[0],n.y=e,r=n.lastBarIndex+1,this.fitSystem(n),L.debug(this.name,"Rendering partial from bar "+n.firstBarIndex+" to "+n.lastBarIndex,null),e+=this.paintSystem(n,e)}return e}paintSystem(e,t){let r=Math.floor(e.height);const s=new An;return s.x=0,s.y=e.y,s.totalWidth=this.width,s.totalHeight=t,s.width=this.width,s.height=r,s.firstMasterBarIndex=e.firstBarIndex,s.lastMasterBarIndex=e.lastBarIndex,e.buildBoundingsLookup(0,0),this.registerPartial(s,n=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=Q.Left,e.paint(0,-s.y,n)}),t+=r,r}fitSystem(e){e.isFull||e.width>this.maxWidth||this.renderer.settings.display.justifyLastSystem?e.scaleToWidth(this.maxWidth):e.scaleToWidth(e.width),e.finalizeSystem()}getBarsPerSystem(e){let t=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode==qi.FromModelWithScale){let r,s;this.renderer.tracks.length>1?(r=this.renderer.score.defaultSystemsLayout,s=this.renderer.score.systemsLayout):(r=this.renderer.tracks[0].defaultSystemsLayout,s=this.renderer.tracks[0].systemsLayout),t=e<s.length?s[e]:r}return t}createStaffSystem(e,t){let r=this.createEmptyStaffSystem();r.index=this._systems.length;let s=this.getBarsPerSystem(r.index),n=this.maxWidth,a=t+1,o=e;for(;o<a;){if(this._barsFromPreviousSystem.length>0)for(let h of this._barsFromPreviousSystem)r.addMasterBarRenderers(this.renderer.tracks,h),o=h.masterBar.index;else{let h=r.addBars(this.renderer.tracks,o);h&&this._allMasterBarRenderers.push(h)}this._barsFromPreviousSystem=[];let l=!1;if((s===-1&&r.width>=n&&r.masterBarsRenderers.length!==0||r.masterBarsRenderers.length===s+1)&&(l=!0),l){let h=r.revertLastBar();if(h)for(this._barsFromPreviousSystem.push(h);h&&!h.canWrap&&r.masterBarsRenderers.length>1;)h=r.revertLastBar(),h&&this._barsFromPreviousSystem.push(h);return r.isFull=!0,r.isLast=!1,this._barsFromPreviousSystem.reverse(),r}r.x=0,o++}return r.isLast=t===r.lastBarIndex,r}get maxWidth(){return this.renderer.width-this._pagePadding[0]-this._pagePadding[2]}}class pn extends ft{constructor(e,t,r,s=!1){super(e,t,s?ue.GraceScale:1,pn.getMusicSymbol(r)),this._isGrace=s,this._accidentalType=r}static getMusicSymbol(e){switch(e){case Fe.Natural:return g.AccidentalNatural;case Fe.Sharp:return g.AccidentalSharp;case Fe.Flat:return g.AccidentalFlat;case Fe.NaturalQuarterNoteUp:return g.AccidentalQuarterToneNaturalArrowUp;case Fe.SharpQuarterNoteUp:return g.AccidentalQuarterToneSharpArrowUp;case Fe.FlatQuarterNoteUp:return g.AccidentalQuarterToneFlatArrowUp;case Fe.DoubleSharp:return g.AccidentalDoubleSharp;case Fe.DoubleFlat:return g.AccidentalDoubleFlat}return g.None}doLayout(){switch(this._accidentalType){case Fe.DoubleFlat:this.width=18;break;default:this.width=8;break}this.width=this.width*(this._isGrace?ue.GraceScale:1)*this.scale}}class qm extends ft{constructor(e,t,r,s){super(e,t,1,qm.getSymbol(r)),this._clef=r,this._clefOttava=s}doLayout(){switch(this._clef){case ae.Neutral:this.width=15*this.scale;break;case ae.C3:case ae.C4:case ae.F4:case ae.G2:this.width=28*this.scale;break}}static getSymbol(e){switch(e){case ae.Neutral:return g.UnpitchedPercussionClef1;case ae.C3:return g.CClef;case ae.C4:return g.CClef;case ae.F4:return g.FClef;case ae.G2:return g.GClef;default:return g.None}}paint(e,t,r){super.paint(e,t,r);let s,n=!1;switch(this._clefOttava){case Le._15ma:s=new ft(-4*this.scale,0,.5,g.Quindicesima),n=!0;break;case Le._8va:s=new ft(-2*this.scale,0,.5,g.Ottava),n=!0;break;case Le._8vb:s=new ft(-6*this.scale,0,.5,g.Ottava);break;case Le._15mb:s=new ft(-8*this.scale,0,.5,g.Quindicesima);break;default:return}let a=0,o=0;switch(this._clef){case ae.Neutral:a=n?-12:15,o=0;break;case ae.C3:a=n?-19:27,o=0;break;case ae.C4:a=n?-19:27,o=0;break;case ae.F4:a=n?-9:27,o=-4;break;case ae.G2:a=n?-37:30,o=0;break;default:return}s.renderer=this.renderer,s.doLayout();let l=this.width/2;s.paint(e+this.x+l+o*this.scale,t+this.y+a*this.scale,r)}}class Qu extends ft{constructor(e,t,r){super(e,t,1,Qu.getSymbol(r))}static getSymbol(e){switch(e){case Et.None:return g.None;case Et.Normal:return g.ArticAccentAbove;case Et.Heavy:return g.ArticMarcatoAbove;default:return g.None}}doLayout(){this.width=9*this.scale,this.height=9*this.scale}paint(e,t,r){super.paint(e-2*this.scale,t+this.height,r)}}class Ku extends bt{constructor(e,t,r){super(e,t),this._size=0,this._size=r}doLayout(){this.width=this._size+3*this.scale}paint(e,t,r){r.fillCircle(e+this.x,t+this.y,this._size)}}class i5 extends ft{constructor(e,t,r){super(e,t,r?ue.GraceScale:1,g.NoteheadXOrnate),this._isGrace=r}doLayout(){this.width=9*(this._isGrace?ue.GraceScale:1)*this.scale,this.height=ue.NoteHeadHeight*this.scale}}class Ju extends ft{constructor(e,t,r,s){super(e,t,s?ue.GraceScale:1,Ju.getSymbol(r)),this._isGrace=s}static getSymbol(e){switch(e){case B.QuadrupleWhole:case B.DoubleWhole:case B.Whole:case B.Half:return g.NoteheadDiamondWhiteWide;default:return g.NoteheadDiamondBlackWide}}doLayout(){this.width=9*(this._isGrace?ue.GraceScale:1)*this.scale,this.height=ue.NoteHeadHeight*this.scale}}class It extends bt{constructor(e,t,r){super(0,0),this.yOffset=0,this.startNoteRenderer=null,this.endNoteRenderer=null,this.tieDirection=D.Up,this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._tieHeight=0,this._shouldDraw=!1,this.startBeat=e,this.endBeat=t,this.forEnd=r}doLayout(){if(this.width=0,!this.endBeat){this._shouldDraw=!1;return}let e=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar);this.startNoteRenderer=e;let t=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.endBeat.voice.bar);this.endNoteRenderer=t,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=e?this.getBeamDirection(this.startBeat,e):this.getBeamDirection(this.endBeat,t),!this.forEnd&&e?(e!==t?(this._startX=e.x+this.getStartX(),this._startY=e.y+this.getStartY()+this.yOffset,!t||e.staff!==t.staff?(this._endX=e.x+e.width,this._endY=this._startY):(this._endX=t.x+this.getEndX(),this._endY=t.y+this.getEndY()+this.yOffset)):(this._startX=e.x+this.getStartX(),this._endX=t.x+this.getEndX(),this._startY=e.y+this.getStartY()+this.yOffset,this._endY=t.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!e||e.staff!==t.staff)&&(this._startX=t.x,this._endX=t.x+this.getEndX(),this._startY=t.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw&&(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur()?this._tieHeight=0:(this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY),this.height=It.calculateActualTieHeight(this.renderer.scale,this._startX,this._startY,this._endX,this._endY,this.tieDirection===D.Down,this._tieHeight,4).h),this.tieDirection===D.Up&&(this.y-=this.height))}paint(e,t,r){this._shouldDraw&&(this.shouldDrawBendSlur()?It.drawBendSlur(r,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===D.Down,this.scale):It.paintTie(r,this.scale,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===D.Down,this._tieHeight,4))}shouldDrawBendSlur(){return!1}getTieHeight(e,t,r,s){return 22}getBeamDirection(e,t){return D.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(e,t,r,s,n,a,o,l){const h=It.computeBezierControlPoints(e,t,r,s,n,a,o,l);t=h[0],r=h[1];const u=h[2],c=h[3];s=h[6],n=h[7];const d=(t-u)/(t-2*u+s),p=It.calculateExtrema(t,r,u,c,s,n,d),f=p.length>0?Math.min(t,s,p[0]):Math.min(t,s),m=p.length>0?Math.max(t,s,p[0]):Math.max(t,s),S=(r-c)/(r-2*c+n),y=It.calculateExtrema(t,r,u,c,s,n,S),b=y.length>0?Math.min(r,n,y[1]):Math.min(r,n),w=y.length>0?Math.max(r,n,y[1]):Math.max(r,n),x=new Ti;return x.x=f,x.y=b,x.w=m-f,x.h=w-b,x}static calculateExtrema(e,t,r,s,n,a,o){if(o<=0||1<=o)return[];const l=e+(r-e)*o,h=t+(s-t)*o,u=r+(n-r)*o,c=s+(a-s)*o;return[l+(u-l)*o,h+(c-h)*o]}static computeBezierControlPoints(e,t,r,s,n,a,o,l){if(t===s&&r===n)return[];if(s<t){let b=t;t=s,s=b,b=r,r=n,n=b}o*=e,l*=e;let h=n-r,u=s-t,c=Math.sqrt(h*h+u*u);a?h*=-1:u*=-1,h/=c,u/=c;let d=(s+t)/2,p=(n+r)/2,f=d+o*h,m=p+o*u,S=d+(o-l)*h,y=p+(o-l)*u;return[t,r,f,m,S,y,s,n]}static paintTie(e,t,r,s,n,a,o=!1,l=22,h=4){const u=It.computeBezierControlPoints(t,r,s,n,a,o,l,h);e.beginPath(),e.moveTo(u[0],u[1]),e.quadraticCurveTo(u[2],u[3],u[6],u[7]),e.quadraticCurveTo(u[4],u[5],u[0],u[1]),e.closePath(),e.fill()}static drawBendSlur(e,t,r,s,n,a,o,l){let h=n-r,u=s-t,c=Math.sqrt(h*h+u*u);a?h*=-1:u*=-1,h/=c,u/=c;let d=(s+t)/2,p=(n+r)/2,f=It.BendSlurHeight*o;s-t<20&&(f/=2);let m=d+f*h,S=p+f*u;if(e.beginPath(),e.moveTo(t,r),e.lineTo(m,S),e.lineTo(s,n),e.stroke(),l){let y=e.measureText(l).width,b=a?0:-e.font.size;e.fillText(l,m-y/2,S+b)}}}It.BendSlurHeight=11;class nd extends bt{constructor(e){super(0,0),this._isOpen=e}doLayout(){super.doLayout(),this.width=nd.Size*this.scale}paint(e,t,r){this._isOpen?It.paintTie(r,this.scale,e+this.x+this.width,t+this.y+this.height,e+this.x+this.width,t+this.y,!1,6,3):It.paintTie(r,this.scale,e+this.x,t+this.y,e+this.x,t+this.y+this.height,!1,6,3)}}nd.Size=6;class r5{constructor(e,t){this.line=0,this.line=e,this.isGhost=t}}class Zu extends bt{constructor(e){super(0,0),this._infos=[],this._glyphs=[],this.isEmpty=!0,this._isOpen=e}addParenthesis(e){let t=this.renderer,r=t.getNoteLine(e),s=e.isGhost||this.isTiedBend(e)&&t.settings.notation.isNotationElementVisible(te.ParenthesisOnTiedBends);this.addParenthesisOnLine(r,s)}addParenthesisOnLine(e,t){let r=new r5(e,t);this._infos.push(r),t&&(this.isEmpty=!1)}isTiedBend(e){return e.isTieDestination?e.tieOrigin.hasBend?!0:this.isTiedBend(e.tieOrigin):!1}doLayout(){let e=this.renderer;this._infos.sort((s,n)=>s.line-n.line);let t=null,r=e.getScoreHeight(1);for(let s=0,n=this._infos.length;s<n;s++){let a;if(!this._infos[s].isGhost)t=null;else if(!t)a=new nd(this._isOpen),a.renderer=this.renderer,a.y=e.getScoreY(this._infos[s].line)-r,a.height=r*2,a.doLayout(),this._glyphs.push(a),t=a;else{let o=e.getScoreY(this._infos[s].line)+r;t.height=o-t.y}}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(e,t,r){super.paint(e,t,r);for(let s of this._glyphs)s.paint(e+this.x,t+this.y,r)}}class s5{constructor(e,t){this.line=0,this.glyph=e,this.line=t}}class Qx extends bt{constructor(){super(0,0),this._infos=[],this._noteHeadPadding=0,this.minNote=null,this.maxNote=null,this.spacingChanged=new At,this.upLineX=0,this.downLineX=0,this.displacedX=0,this.noteStartX=0}add(e,t){let r=new s5(e,t);this._infos.push(r),(!this.minNote||this.minNote.line>r.line)&&(this.minNote=r),(!this.maxNote||this.maxNote.line<r.line)&&(this.maxNote=r)}get hasTopOverflow(){return!!this.minNote&&this.minNote.line<=0}get hasBottomOverflow(){return!!this.maxNote&&this.maxNote.line>8}doLayout(){this._infos.sort((o,l)=>l.line-o.line);let e=0,t=!1,r=0,s=!1,n=this.direction,a=0;for(let o=0,l=this._infos.length;o<l;o++){let h=this._infos[o].glyph;h.renderer=this.renderer,h.doLayout();let u=!1;o===0?e=h.width:Math.abs(r-this._infos[o].line)<=1?t?t=!1:(u=!0,h.x=e,s=!0,t=!0):t=!1,n===D.Down?h.x=u?0:e:h.x=u?e:0,h.x+=this.noteStartX,r=this._infos[o].line,a=Math.max(a,h.x+h.width)}s?(this._noteHeadPadding=0,this.upLineX=e,this.downLineX=e):(this._noteHeadPadding=n===D.Down?-e:0,a+=this._noteHeadPadding,this.upLineX=a,this.downLineX=0),this.displacedX=e,this.width=a}paint(e,t,r){e+=this.x,t+=this.y;let s=this.renderer,n=3*this.scale,a=this.width-this.noteStartX+n*2;if(this.hasTopOverflow){let h=r.color;r.color=s.resources.staffLineColor;let u=-2;for(;u>=this.minNote.line;){let c=t+s.getScoreY(u);r.fillRect(e-n+this.noteStartX,c,a,this.scale),u-=2}r.color=h}if(this.hasBottomOverflow){let h=r.color;r.color=s.resources.staffLineColor;let u=10;for(;u<=this.maxNote.line;){let c=t+s.getScoreY(u);r.fillRect(e-n+this.noteStartX,c,a,this.scale),u+=2}r.color=h}let o=this._infos,l=e+this._noteHeadPadding;for(let h of o)h.glyph.renderer=this.renderer,h.glyph.paint(l,t,r)}}class ad extends ft{constructor(e,t,r){super(e,t,1,ad.getSymbol(r))}doLayout(){this.width=12*this.scale}static getSymbol(e){switch(e){case B.ThirtySecond:return g.Tremolo3;case B.Sixteenth:return g.Tremolo2;case B.Eighth:return g.Tremolo1;default:return g.None}}}class n5 extends Qx{constructor(){super(),this._noteGlyphLookup=new Map,this._notes=[],this._tremoloPicking=null,this.aboveBeatEffects=new Map,this.belowBeatEffects=new Map}get direction(){return this.beamingHelper.direction}getNoteX(e,t){if(this._noteGlyphLookup.has(e.id)){let r=this._noteGlyphLookup.get(e.id),s=this.x+r.x+this._noteHeadPadding;switch(t){case et.Left:break;case et.Center:s+=r.width/2;break;case et.Right:s+=r.width;break}return s}return 0}getNoteY(e,t){if(this._noteGlyphLookup.has(e.id)){const r=this._noteGlyphLookup.get(e.id);let s=this.y+r.y;switch(t){case j.TopWithStem:s-=this.renderer.getStemSize(this.beamingHelper);break;case j.Top:s-=r.height/2;break;case j.Center:break;case j.Bottom:s+=r.height/2;break;case j.BottomWithStem:s+=this.renderer.getStemSize(this.beamingHelper);break}return s}return 0}addNoteGlyph(e,t,r){super.add(e,r),this._noteGlyphLookup.set(t.id,e),this._notes.push(t)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.upLineX,e+this.x+this.downLineX)}doLayout(){super.doLayout();let e=this.direction;for(const t of this.aboveBeatEffects.values())t.renderer=this.renderer,t.doLayout();for(const t of this.belowBeatEffects.values())t.renderer=this.renderer,t.doLayout();if(this.beat.isTremolo){let t=0,r=e===D.Up?this.minNote:this.maxNote,s=e===D.Up?this.displacedX:0,n=this.beat.tremoloSpeed;switch(n){case B.ThirtySecond:t=e===D.Up?-15:15;break;case B.Sixteenth:t=e===D.Up?-12:15;break;case B.Eighth:t=e===D.Up?-10:10;break;default:t=e===D.Up?-10:15;break}this._tremoloPicking=new ad(s,r.glyph.y+t*this.scale,n),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(e,t,r){for(let s of this._notes)if(this._noteGlyphLookup.has(s.id)){let n=this._noteGlyphLookup.get(s.id),a=new td;a.note=s,a.noteHeadBounds=new Ti,a.noteHeadBounds.x=t+this.x+this._noteHeadPadding+n.x,a.noteHeadBounds.y=r+this.y+n.y-n.height/2,a.noteHeadBounds.w=n.width,a.noteHeadBounds.h=n.height,e.addNote(a)}}paint(e,t,r){let s=this.renderer,n=0,a=0,o=1,l=-o;this.beamingHelper.direction===D.Up?(a=s.getScoreY(this.minNote.line),n=s.getScoreY(this.maxNote.line-2)):(a=s.getScoreY(this.maxNote.line-1),n=s.getScoreY(this.minNote.line+1),l*=-1,o*=-1);for(const h of this.aboveBeatEffects.values())n+=l*h.height,h.paint(e+this.x+2*this.scale,t+this.y+n,r);for(const h of this.belowBeatEffects.values())a+=o*h.height,h.paint(e+this.x+2*this.scale,t+this.y+a,r);super.paint(e,t,r),this._tremoloPicking&&this._tremoloPicking.paint(e,t,r)}}class sa extends ft{constructor(e,t,r){super(e,t,1,sa.getSymbol(r)),this._duration=r}static getSymbol(e){switch(e){case B.QuadrupleWhole:return g.RestLonga;case B.DoubleWhole:return g.RestDoubleWhole;case B.Whole:return g.RestWhole;case B.Half:return g.RestHalf;case B.Quarter:return g.RestQuarter;case B.Eighth:return g.RestEighth;case B.Sixteenth:return g.RestSixteenth;case B.ThirtySecond:return g.RestThirtySecond;case B.SixtyFourth:return g.RestSixtyFourth;case B.OneHundredTwentyEighth:return g.RestOneHundredTwentyEighth;case B.TwoHundredFiftySixth:return g.RestTwoHundredFiftySixth;default:return g.None}}static getSize(e){switch(e){case B.QuadrupleWhole:case B.DoubleWhole:case B.Whole:case B.Half:case B.Quarter:case B.Eighth:case B.Sixteenth:return 9;case B.ThirtySecond:return 12;case B.SixtyFourth:return 14;case B.OneHundredTwentyEighth:case B.TwoHundredFiftySixth:return 20}return 10}doLayout(){this.width=sa.getSize(this._duration)*this.scale}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class hb{constructor(){this.x=0,this.y=-3e3,this.width=0}}class Kx extends qr{constructor(){super(0,0)}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}this.glyphs.sort((r,s)=>r.y<s.y?-1:r.y>s.y?1:0);let e=[];e.push(new hb);let t=21*this.scale;for(let r=0,s=this.glyphs.length;r<s;r++){let n=this.glyphs[r];n.renderer=this.renderer,n.doLayout();let a=0;for(;e[a].y>n.y;)a++,a===e.length&&e.push(new hb);n.x=a,e[a].y=n.y+t,e[a].width<n.width&&(e[a].width=n.width)}this.width=0;for(const r of e)this.width+=r.width,r.x=this.width;for(let r=0,s=this.glyphs.length;r<s;r++){let n=this.glyphs[r];const a=e[n.x];n.x=this.width-a.x}}}class Ri extends Qx{get direction(){return D.Up}constructor(e,t=!1){super(),this._showParenthesis=!1,this._noteValueLookup=new Map,this._accidentals=new Kx,this._preNoteParenthesis=null,this._postNoteParenthesis=null,this.isEmpty=!0,this.noteHeadOffset=0,this._beat=e,this._showParenthesis=t,t&&(this._preNoteParenthesis=new Zu(!0),this._postNoteParenthesis=new Zu(!1))}containsNoteValue(e){return this._noteValueLookup.has(e)}getNoteValueY(e){return this._noteValueLookup.has(e)?this.y+this._noteValueLookup.get(e).y:0}addGlyph(e,t=!1){let r=this.renderer,s=new ue(0,0,B.Quarter,!0),n=r.accidentalHelper.applyAccidentalForValue(this._beat,e,t,!0),a=r.accidentalHelper.getNoteLineForValue(e,!1);if(s.y=r.getScoreY(a),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(a,!0),this._postNoteParenthesis.addParenthesisOnLine(a,!0)),n!==Fe.None){let o=new pn(0,s.y,n,!0);o.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(o)}this._noteValueLookup.set(e,s),this.add(s,a),this.isEmpty=!1}doLayout(){let e=0;this._showParenthesis&&(this._preNoteParenthesis.x=e,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),e+=this._preNoteParenthesis.width+Ri.ElementPadding*this.scale),this._accidentals.isEmpty||(e+=this._accidentals.width+Ri.ElementPadding*this.scale,this._accidentals.x=e,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),e+=this._accidentals.width+Ri.ElementPadding*this.scale),this.noteStartX=e,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+Ri.ElementPadding*this.scale,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+Ri.ElementPadding*this.scale)}paint(e,t,r){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,t+this.y,r),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,t+this.y,r),this._postNoteParenthesis.paint(e+this.x,t+this.y,r)),super.paint(e,t,r)}}Ri.ElementPadding=2;class Qm extends bt{constructor(){super(...arguments),this.BendNoteHeads=[]}drawBendSlur(e,t,r,s,n,a,o,l){It.drawBendSlur(e,t,r,s,n,a,o,l)}doLayout(){super.doLayout(),this.width=0;for(let e of this.BendNoteHeads)e.doLayout(),this.width+=e.width+10*this.scale}getTieDirection(e,t){switch(t.getBeatDirection(e)){case D.Up:return D.Down;default:return D.Up}}}Qm.EndPadding=(10/2|0)+3;class Qs extends V{constructor(e=0,t=0){super(e,t),this.lineValue=0,this.lineValue=t}}class Tr extends bt{constructor(){super(0,0),this._notes=[],this._renderPoints=new Map,this._preBendMinValue=-1,this._bendMiddleMinValue=-1,this._bendEndMinValue=-1,this._bendEndContinuedMinValue=-1,this._releaseMinValue=-1,this._releaseContinuedMinValue=-1,this._maxBendValue=-1}addBends(e){this._notes.push(e);let t=this.createRenderingPoints(e);this._renderPoints.set(e.id,t),(this._maxBendValue===-1||this._maxBendValue<e.maxBendPoint.value)&&(this._maxBendValue=e.maxBendPoint.value);let r=0;switch(e.bendType){case X.Bend:r=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||r<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=r):(this._bendEndMinValue===-1||r<this._bendEndMinValue)&&(this._bendEndMinValue=r);break;case X.Release:r=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||r<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=r):r>0&&(this._releaseMinValue===-1||r<this._releaseMinValue)&&(this._releaseMinValue=r);break;case X.BendRelease:r=t[1].value,(this._bendMiddleMinValue===-1||r<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=r),r=t[2].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||r<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=r):r>0&&(this._releaseMinValue===-1||r<this._releaseMinValue)&&(this._releaseMinValue=r);break;case X.Prebend:r=t[0].value,(this._preBendMinValue===-1||r<this._preBendMinValue)&&(this._preBendMinValue=r);break;case X.PrebendBend:r=t[0].value,(this._preBendMinValue===-1||r<this._preBendMinValue)&&(this._preBendMinValue=r),r=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||r<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=r):(this._bendEndMinValue===-1||r<this._bendEndMinValue)&&(this._bendEndMinValue=r);break;case X.PrebendRelease:r=t[0].value,(this._preBendMinValue===-1||r<this._preBendMinValue)&&(this._preBendMinValue=r),r=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||r<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=r):r>0&&(this._releaseMinValue===-1||r<this._releaseMinValue)&&(this._releaseMinValue=r);break}}doLayout(){super.doLayout();let e=this._maxBendValue*Tr.BendValueHeight*this.scale;this.renderer.registerOverflowTop(e);let t=0;for(let r of this._notes){let s=this._renderPoints.get(r.id);switch(r.bendType){case X.Bend:s[1].lineValue=r.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case X.Release:t=r.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(s[1].lineValue=t);break;case X.BendRelease:s[1].lineValue=this._bendMiddleMinValue,t=r.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(s[2].lineValue=t);break;case X.Prebend:s[0].lineValue=this._preBendMinValue;break;case X.PrebendBend:s[0].lineValue=this._preBendMinValue,s[1].lineValue=r.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case X.PrebendRelease:s[0].lineValue=this._preBendMinValue,t=r.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(s[1].lineValue=t);break}}this.width=0,this._notes.sort((r,s)=>r.isStringed?r.string-s.string:r.realValue-s.realValue)}createRenderingPoints(e){let t=[];switch(e.bendType){case X.Custom:for(let r of e.bendPoints)t.push(new Qs(r.offset,r.value));break;case X.BendRelease:t.push(new Qs(0,e.bendPoints[0].value)),t.push(new Qs(V.MaxPosition/2|0,e.bendPoints[1].value)),t.push(new Qs(V.MaxPosition,e.bendPoints[3].value));break;case X.Bend:case X.Hold:case X.Prebend:case X.PrebendBend:case X.PrebendRelease:case X.Release:t.push(new Qs(0,e.bendPoints[0].value)),t.push(new Qs(V.MaxPosition,e.bendPoints[1].value));break}return t}paint(e,t,r){let s=r.color;this._notes.length>1&&(r.color=this.renderer.resources.secondaryGlyphColor);for(let n of this._notes){let a=this._renderPoints.get(n.id),o=this.renderer,l=n,h=!1,u=null,c=!1,d=n.bendStyle===De.Gradual?"grad.":"",p=null;for(;l.isTieOrigin;){let w=l.tieDestination;if(u=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,w.beat.voice.bar),!u||o.staff!==u.staff)break;if(l=w,h=!0,l.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes){c=!0;break}}p=l.beat,u=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,p.voice.bar),p.isLastOfVoice&&!l.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(p=null);let f=0,m=0,S=t+o.y;f=e+o.x,a[0].value>0||n.isContinuedBend?f+=o.getBeatX(n.beat,be.MiddleNotes):f+=o.getNoteX(n,et.Right),!p||p.isLastOfVoice&&!c?m=e+u.x+u.postBeatGlyphsStart:c||!p.nextBeat?m=e+u.x+u.getBeatX(p,be.MiddleNotes):n.bendType===X.Hold?m=e+u.x+u.getBeatX(p.nextBeat,be.OnNotes):m=e+u.x+u.getBeatX(p.nextBeat,be.PreNotes),h||(m-=Tr.ArrowSize*this.scale);let b=(m-f)/V.MaxPosition;r.beginPath();for(let w=0,x=a.length-1;w<x;w++){let v=a[w],C=a[w+1];w===0&&v.value!==0&&!n.isTieDestination&&this.paintBend(n,new Qs(0,0),v,f,S,b,d,r),n.bendType!==X.Prebend?(w===0&&(f+=2*this.scale),this.paintBend(n,v,C,f,S,b,d,r)):n.isTieOrigin&&n.tieDestination.hasBend&&(C=new Qs(V.MaxPosition,v.value),C.lineValue=v.lineValue,this.paintBend(n,v,C,f,S,b,d,r))}r.color=s}}paintBend(e,t,r,s,n,a,o,l){let h=this.renderer,u=this.renderer.resources,c=h.lineOffset/2,d=s+a*t.offset,p=Tr.BendValueHeight*this.scale,f=n-p*t.lineValue;t.value===0?r.offset===t.offset?f+=h.getNoteY(e.beat.maxStringNote,j.Top):f+=h.getNoteY(e,j.Center):f+=c;let m=s+a*r.offset,S=n-p*r.lineValue;r.lineValue===0?S+=h.getNoteY(e,j.Center):S+=c;let y=0,b=Tr.ArrowSize*this.scale;if(r.value>t.value?(S+b>f&&(S=f-b),l.beginPath(),l.moveTo(m,S),l.lineTo(m-b*.5,S+b),l.lineTo(m+b*.5,S+b),l.closePath(),l.fill(),y=b):r.value!==t.value&&(S<f&&(S=f+b),l.beginPath(),l.moveTo(m,S),l.lineTo(m-b*.5,S-b),l.lineTo(m+b*.5,S-b),l.closePath(),l.fill(),y=-b),l.stroke(),t.value===r.value){if(t.lineValue>0){let w=m,x=Tr.DashSize*this.scale,v=d+x;if((w-d)/(x*2)<1)l.moveTo(w,f),l.lineTo(d,f);else for(;w>v;)l.moveTo(w,f),l.lineTo(w-x,f),w-=x*2;l.stroke()}}else m>d?(l.moveTo(d,f),l.bezierCurveTo((d+m)/2,f,m,f,m,S+y),l.stroke()):(l.moveTo(d,f),l.lineTo(m,S),l.stroke());if(o&&t.offset<r.offset){l.font=u.graceFont;let w=l.measureText(o).width,x=0,v=0;if(f>S){let C=Math.abs(f-S);x=C>l.font.size*1.3?f-C/2:f,v=(d+m-w)/2}else x=f,v=m-w;l.fillText(o,v,x)}if(r.value!==0&&t.value!==r.value){let w=r.value,x=r.value>t.value;w=Math.abs(w);let v="";if(w===4)v="full",w-=4;else if(w>=4||w<=-4){let C=w/4|0;v+=C,w-=C*4}if(w>0&&(v+=Tr.getFractionSign(w)),v!==""){S=n-p*r.value;let C=S;x||(C=f+Math.abs(S-f)*1/3),l.font=u.tablatureFont;let P=l.measureText(v).width,N=C-u.tablatureFont.size*.5-2*this.scale,W=m-P/2;l.fillText(v,W,N)}}}static getFractionSign(e){switch(e){case 1:return"¼";case 2:return"½";case 3:return"¾";default:return e+"/ 4"}}}Tr.ArrowSize=6;Tr.DashSize=3;Tr.BendValueHeight=6;class nr extends bt{constructor(e){super(0,0),this._isSimpleDip=!1,this._beat=e,this._renderPoints=this.createRenderingPoints(e)}createRenderingPoints(e){if(e.whammyBarType===Me.Custom)return e.whammyBarPoints;let t=[];switch(e.whammyBarType){case Me.Dive:case Me.Hold:case Me.PrediveDive:case Me.Predive:t.push(new V(0,e.whammyBarPoints[0].value)),t.push(new V(V.MaxPosition,e.whammyBarPoints[1].value));break;case Me.Dip:t.push(new V(0,e.whammyBarPoints[0].value)),t.push(new V(V.MaxPosition/2|0,e.whammyBarPoints[1].value)),t.push(new V(V.MaxPosition,e.whammyBarPoints[e.whammyBarPoints.length-1].value));break}return t}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===Ot.SongBook&&this._beat.whammyBarType===Me.Dip;let e=null,t=null,r=this._beat;for(;r&&r.hasWhammyBar;)(!e||e.value>r.minWhammyPoint.value)&&(e=r.minWhammyPoint),(!t||t.value<r.maxWhammyPoint.value)&&(t=r.maxWhammyPoint),r=r.nextBeat;let s=t.value>0?Math.abs(this.getOffset(t.value)):0;(s>0||this._beat.whammyBarPoints[0].value!==0||this.renderer.settings.notation.isNotationElementVisible(te.ZerosOnDiveWhammys))&&(s+=this.renderer.resources.tablatureFont.size*2);let n=e.value<0?Math.abs(this.getOffset(e.value)):0;this.renderer.registerOverflowTop(s+n);let a=this.renderer.staff.getSharedLayoutData(nr.TopOffsetSharedDataKey,-1);s>a&&this.renderer.staff.setSharedLayoutData(nr.TopOffsetSharedDataKey,s)}getOffset(e){if(e===0)return 0;let t=nr.PerHalfSize*this.scale+Math.log2(Math.abs(e)/2)*nr.PerHalfSize*this.scale;return e<0&&(t=-t),t}paint(e,t,r){let s=this.renderer,n=this._beat.nextBeat,a=null,o=be.PreNotes;n&&(a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,n.voice.bar),!a||a.staff!==s.staff||a!==s&&!n.hasWhammyBar?(n=null,a=null):o=n.hasWhammyBar&&(s.settings.notation.notationMode!==Ot.SongBook||n.whammyBarType!==Me.Dip)?be.MiddleNotes:be.PreNotes);let l=0,h=0;this._isSimpleDip?(l=e+s.x+s.getBeatX(this._beat,be.OnNotes)-2*this.scale,h=e+s.x+s.getBeatX(this._beat,be.PostNotes)+2*this.scale):(l=e+s.x+s.getBeatX(this._beat,be.MiddleNotes),h=a?e+a.x+a.getBeatX(n,o):e+s.x+s.width-2*this.scale);let u=r.textAlign;if(r.textAlign=Q.Center,this._renderPoints.length>=2){let c=(h-l)/V.MaxPosition;r.beginPath();let d=t+this.renderer.staff.getSharedLayoutData(nr.TopOffsetSharedDataKey,0),p=this._beat.whammyStyle===De.Gradual?"grad.":"";for(let f=0,m=this._renderPoints.length-1;f<m;f++){let S=this._renderPoints[f],y=this._renderPoints[f+1],b=f<m-2?this._renderPoints[f+2]:null,w=f===0;f===0&&S.value!==0&&!this._beat.isContinuedWhammy&&(this.paintWhammy(!1,new V(0,0),S,y,l,d,c,r),w=!1),this.paintWhammy(w,S,y,b,l,d,c,r,p),p=""}r.stroke()}r.textAlign=u}paintWhammy(e,t,r,s,n,a,o,l,h){let u=n+o*t.offset,c=n+o*r.offset,d=a-this.getOffset(t.value),p=a-this.getOffset(r.value);if(t.offset===r.offset){let S=nr.DashSize*this.scale;if(Math.abs(p-d)/(S*2)<1)l.moveTo(u,d),l.lineTo(c,p);else{let b=Math.max(d,p),w=Math.min(d,p);for(;b>w;)l.moveTo(u,w),l.lineTo(u,w+S),w+=S*2}l.stroke()}else if(t.value===r.value){let S=nr.DashSize*this.scale;if(Math.abs(c-u)/(S*2)<1)l.moveTo(u,d),l.lineTo(c,p);else{let b=Math.max(u,c),w=Math.min(u,c);for(;b>w;)l.moveTo(b,d),l.lineTo(b-S,d),b-=S*2}l.stroke()}else l.moveTo(u,d),l.lineTo(c,p);let f=this.renderer.resources;if(e&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){let S=d;S-=f.tablatureFont.size+2*this.scale,this.renderer.settings.notation.isNotationElementVisible(te.ZerosOnDiveWhammys)&&l.fillText("0",u,S),h&&(S-=f.tablatureFont.size+2*this.scale,l.fillText(h,u,S))}let m=Math.abs(r.value);if((m!==0||this.renderer.settings.notation.isNotationElementVisible(te.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&t.value!==r.value){let S="";if(r.value<0&&(S+="-"),m>=4){let w=m/4|0;S+=w,m-=w*4}else m===0&&(S+="0");m>0&&(S+=Tr.getFractionSign(m));let y=0;this._isSimpleDip?y=Math.min(d,p)-f.tablatureFont.size-2*this.scale:(y=t.offset===r.offset?Math.min(d,p):p,y-=f.tablatureFont.size+2*this.scale,s&&s.value>r.value&&(y-=2*this.scale));let b=c;l.fillText(S,b,y)}}}nr.TopOffsetSharedDataKey="tab.whammy.topoffset";nr.PerHalfSize=6;nr.DashSize=3;class Un extends Qm{constructor(e){super(0,0),this._beat=e}doLayout(){let e=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case Me.None:case Me.Custom:case Me.Hold:return;case Me.Dive:case Me.PrediveDive:{let t=new Ri(this._beat,!1);t.renderer=this.renderer;let r=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(let s of this._beat.notes)s.isTieOrigin||t.addGlyph(this.getBendNoteValue(s,r),r.value%2!==0);t.doLayout(),this.BendNoteHeads.push(t)}break;case Me.Dip:if(e===Ot.SongBook){let t=this.renderer.resources;this.renderer.simpleWhammyOverflow=t.tablatureFont.size*1.5+Un.SimpleDipHeight*this.scale+Un.SimpleDipPadding*this.scale}else{let t=new Ri(this._beat,!1);if(t.renderer=this.renderer,this.renderer.settings.notation.notationMode===Ot.GuitarPro){let s=this._beat.whammyBarPoints[1];for(let n of this._beat.notes)t.addGlyph(this.getBendNoteValue(n,this._beat.whammyBarPoints[1]),s.value%2!==0)}t.doLayout(),this.BendNoteHeads.push(t);let r=new Ri(this._beat,!1);if(r.renderer=this.renderer,this.renderer.settings.notation.notationMode===Ot.GuitarPro){let s=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(let n of this._beat.notes)r.addGlyph(this.getBendNoteValue(n,s),s.value%2!==0)}r.doLayout(),this.BendNoteHeads.push(r)}break;case Me.Predive:break}super.doLayout()}paint(e,t,r){let s=this._beat;switch(s.whammyBarType){case Me.None:case Me.Custom:return}let n=this.renderer.settings.notation.notationMode,a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,s.voice.bar),o=e+a.x+a.getBeatX(s,be.MiddleNotes),l=this.getTieDirection(s,a),h=this._beat.notes.length===1?l:D.Up,u=r.textAlign;for(let c=0;c<s.notes.length;c++){let d=s.notes[c],p=t+a.y;c>0&&c>=(this._beat.notes.length/2|0)&&(h=D.Down),h===D.Down?p+=a.getNoteY(d,j.Bottom):p+=a.getNoteY(d,j.Top);let f=e+a.x;s.isLastOfVoice?f+=a.width:f+=a.getBeatX(s,be.EndBeat),f-=8*this.scale;let m=s.whammyStyle===De.Gradual&&c===0?"grad.":"",S=null;d.isTieOrigin&&(S=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,d.tieDestination.beat.voice.bar),S&&S.staff===a.staff?f=e+S.x+S.getBeatX(d.tieDestination.beat,be.MiddleNotes):S=null);let y=ue.NoteHeadHeight*this.scale*ue.GraceScale*.5;h===D.Up&&(y=-y);let b=s.whammyBarPoints.length>0?this.getBendNoteValue(d,s.whammyBarPoints[s.whammyBarPoints.length-1]):0,w=0,x=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(b)?(w=this.BendNoteHeads[0].getNoteValueY(b)+y,x=!0):S&&(d.isTieOrigin&&d.tieDestination.beat.hasWhammyBar||d.beat.isContinuedWhammy)?(w=t+S.y+S.getNoteY(d.tieDestination,j.Top),x=!0,h===D.Down&&(w+=ue.NoteHeadHeight*this.scale)):d.isTieOrigin&&(S?w=t+S.y+S.getNoteY(d.tieDestination,j.Top):w=p,h===D.Down&&(w+=ue.NoteHeadHeight*this.scale)),s.whammyBarType){case Me.Hold:d.isTieOrigin&&It.paintTie(r,this.scale,o,p,f,w,l===D.Down,22,4);break;case Me.Dive:c===0&&(this.BendNoteHeads[0].x=f-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,r),this.BendNoteHeads[0].containsNoteValue(b)&&(w+=this.BendNoteHeads[0].y)),x?this.drawBendSlur(r,o,p,f,w,h===D.Down,this.scale,m):d.isTieOrigin&&It.paintTie(r,this.scale,o,p,f,w,l===D.Down,22,4);break;case Me.Dip:if(n===Ot.SongBook){if(c===0){let P=e+a.x+a.getBeatX(this._beat,be.OnNotes)-2*this.scale,N=e+a.x+a.getBeatX(this._beat,be.PostNotes)+2*this.scale,W=(P+N)/2,Y=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();r.font=this.renderer.resources.tablatureFont,r.fillText(Y,W,t+this.y);let me=t+this.y+r.font.size+2*this.scale,Ee=me+Un.SimpleDipHeight*this.scale;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(r.moveTo(P,Ee),r.lineTo(W,me),r.lineTo(N,Ee)):(r.moveTo(P,me),r.lineTo(W,Ee),r.lineTo(N,me)),r.stroke()}d.isTieOrigin&&It.paintTie(r,this.scale,o,p,f,w,l===D.Down,22,4)}else{let P=(o+f)/2;this.BendNoteHeads[0].x=P-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,r);let N=this.getBendNoteValue(d,s.whammyBarPoints[1]),W=this.BendNoteHeads[0].getNoteValueY(N)+y;this.drawBendSlur(r,o,p,P,W,h===D.Down,this.scale,m),this.BendNoteHeads[1].x=f-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=t+a.y,this.BendNoteHeads[1].paint(0,0,r),w=this.BendNoteHeads[1].getNoteValueY(b)+y,this.drawBendSlur(r,P,W,f,w,h===D.Down,this.scale,m)}break;case Me.PrediveDive:case Me.Predive:let v=e+a.x+a.getBeatX(d.beat,be.PreNotes);v+=a.getPreNotesGlyphForBeat(d.beat).prebendNoteHeadOffset;let C=t+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(d.displayValue-(d.beat.whammyBarPoints[0].value/2|0),!1))+y;this.drawBendSlur(r,v,C,o,p,h===D.Down,this.scale,m),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=f-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,r),this.drawBendSlur(r,o,p,f,w,h===D.Down,this.scale,m));break}}r.textAlign=u}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}Un.SimpleDipHeight=nr.PerHalfSize*2;Un.SimpleDipPadding=2;class Fi extends bt{constructor(e,t,r){super(e,t),this.width=r}}class a5 extends ft{constructor(e,t,r,s,n){super(e,t,n?ue.GraceScale:1,r.getSymbol(s)),this._isGrace=n,this._articulation=r}paint(e,t,r){let s=this._isGrace?this.scale:0;r.fillMusicFontSymbol(e+this.x,t+this.y+s,this.glyphScale*this.scale,this.symbol,!1),this._articulation.techniqueSymbol!==g.None&&this._articulation.techniqueSymbolPlacement===le.Middle&&r.fillMusicFontSymbol(e+this.x,t+this.y+s,this.glyphScale*this.scale,this._articulation.techniqueSymbol,!1)}doLayout(){let e=(this._isGrace?ue.GraceScale:1)*this.scale;switch(this.symbol){case g.NoteheadWhole:this.width=14;break;case g.NoteheadCircleX:case g.NoteheadDiamondWhite:this.width=9;break;case g.NoteheadHeavyXHat:case g.NoteheadHeavyX:this.width=13;break;default:this.width=10;break}this.width=this.width*(this._isGrace?ue.GraceScale:1)*this.scale,this.height=ue.NoteHeadHeight*e}}class ub extends ft{constructor(e,t){super(e,t,ue.GraceScale,g.ArticStaccatoAbove)}doLayout(){this.width=ue.QuarterNoteHeadWidth*this.scale,this.height=7*this.scale}paint(e,t,r){super.paint(e+3*this.scale,t+5*this.scale,r)}}class o5 extends ft{constructor(e,t){super(e,t,.5,g.PictEdgeOfCymbal)}doLayout(){this.width=22*this.scale,this.height=15*this.scale}paint(e,t,r){super.paint(e-3*this.scale,t+this.height,r)}}class l5 extends ft{constructor(e,t){super(e,t,ue.GraceScale,g.GuitarGolpe)}doLayout(){this.width=9*this.scale,this.height=10*this.scale}paint(e,t,r){super.paint(e,t+this.height,r)}}class h5 extends ql{constructor(){super(...arguments),this._collisionOffset=-1e3,this._skipPaint=!1,this.noteHeads=null,this.restGlyph=null}getNoteX(e,t){return this.noteHeads?this.noteHeads.getNoteX(e,t):0}buildBoundingsLookup(e,t,r){this.noteHeads&&this.noteHeads.buildBoundingsLookup(e,t+this.x,r+this.y)}getNoteY(e,t){return this.noteHeads?this.noteHeads.getNoteY(e,t):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph&&(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&this._collisionOffset===-1e3)){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const e=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;e.has(this.container.beat.playbackStart)&&e.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&e.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}paint(e,t,r){this._skipPaint||super.paint(e,t,r)}doLayout(){let e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let t=Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2)*2;this.container.beat.duration===B.Whole&&this.renderer.bar.staff.standardNotationLineCount!==1&&this.renderer.bar.staff.standardNotationLineCount!==3&&(t-=2);const r=new sa(0,e.getScoreY(t),this.container.beat.duration);if(this.restGlyph=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addGlyph(r),this.renderer.bar.isMultiVoice)if(this.container.beat.voice.index===0){const s=zr.computeLineHeightsForRest(this.container.beat.duration);let n=r.y-e.getScoreHeight(s[0]),a=r.y+e.getScoreHeight(s[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,a)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,t),this.container.beat.dots>0){this.addGlyph(new Fi(0,0,5*this.scale));for(let s=0;s<this.container.beat.dots;s++){let n=new qr(0,0);n.renderer=this.renderer,this.createBeatDot(t,n),this.addGlyph(n)}}}else{const t=new n5;this.noteHeads=t,t.beat=this.container.beat,t.beamingHelper=this.beamingHelper;let r=new Zu(!1);r.renderer=this.renderer;for(let s of this.container.beat.notes)s.isVisible&&(this.createNoteGlyph(s),r.addParenthesis(s));if(this.addGlyph(t),r.isEmpty||(this.addGlyph(new Fi(0,0,4*(this.container.beat.graceType!==K.None?ue.GraceScale:1)*this.scale)),this.addGlyph(r)),this.container.beat.hasWhammyBar){let s=new Un(this.container.beat);s.renderer=this.renderer,s.doLayout(),this.container.ties.push(s)}if(this.container.beat.dots>0){this.addGlyph(new Fi(0,0,5*this.scale));for(let s=0;s<this.container.beat.dots;s++){let n=new qr(0,0);n.renderer=this.renderer;for(let a of this.container.beat.notes)this.createBeatDot(e.getNoteLine(a),n);this.addGlyph(n)}}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2}createBeatDot(e,t){let r=this.renderer;t.addGlyph(new Ku(0,r.getScoreY(e),1.5*this.scale))}createNoteHeadGlyph(e){let t=this.container.beat.graceType!==K.None;if(e.beat.voice.bar.staff.isPercussion){const r=xt.getArticulation(e);if(r)return new a5(0,0,r,e.beat.duration,t);L.warning("Rendering",`No articulation found for percussion instrument ${e.percussionArticulation}`)}return e.isDead?new i5(0,0,t):e.beat.graceType===K.BendGrace?new ue(0,0,B.Quarter,!0):e.harmonicType===q.Natural?new Ju(0,0,e.beat.duration,t):new ue(0,0,e.beat.duration,t)}createNoteGlyph(e){if(e.beat.graceType===K.BendGrace&&!e.hasBend)return;let t=this.renderer,r=this.createNoteHeadGlyph(e),s=t.getNoteLine(e);if(r.y=t.getScoreY(s),this.noteHeads.addNoteGlyph(r,e,s),e.harmonicType!==q.None&&e.harmonicType!==q.Natural){let n=e.displayValue+e.harmonicPitch;r=new Ju(0,0,e.beat.duration,this.container.beat.graceType!==K.None),s=t.accidentalHelper.getNoteLineForValue(n,!1),r.y=t.getScoreY(s),this.noteHeads.addNoteGlyph(r,e,s)}if(e.isStaccato&&!this.noteHeads.aboveBeatEffects.has("Staccato")&&this.noteHeads.belowBeatEffects.set("Staccato",new ub(0,0)),e.accentuated===Et.Normal&&!this.noteHeads.aboveBeatEffects.has("Accent")&&this.noteHeads.belowBeatEffects.set("Accent",new Qu(0,0,Et.Normal)),e.accentuated===Et.Heavy&&!this.noteHeads.aboveBeatEffects.has("HAccent")&&this.noteHeads.belowBeatEffects.set("HAccent",new Qu(0,0,Et.Heavy)),e.isPercussion){const n=xt.getArticulation(e);if(n&&n.techniqueSymbolPlacement!==le.Middle){const a=n.techniqueSymbolPlacement===le.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(n.techniqueSymbol){case g.PictEdgeOfCymbal:a.set("PictEdgeOfCymbal",new o5(0,0));break;case g.ArticStaccatoAbove:a.set("ArticStaccatoAbove",new ub(0,0));break;case g.StringsUpBow:a.set("StringsUpBow",new Ll(0,0,Jt.Up));break;case g.StringsDownBow:a.set("StringsDownBow",new Ll(0,0,Jt.Down));break;case g.GuitarGolpe:a.set("GuitarGolpe",new l5(0,0));break}}}}}class u5 extends bt{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=this._beat.brushType===Ye.ArpeggioUp||this._beat.brushType===Ye.ArpeggioDown?10*this.scale:0}paint(e,t,r){if(this._beat.brushType===Ye.ArpeggioUp||this._beat.brushType===Ye.ArpeggioDown){let s=this.renderer,n=s.lineOffset,a=t+this.y+(s.getNoteY(this._beat.maxNote,j.Bottom)-n),o=t+this.y+s.getNoteY(this._beat.minNote,j.Top)+n,l=e+this.x+this.width/2,h=8*this.scale,u=new ra(0,0,Pe.Slight,1.2,!0);u.renderer=this.renderer,u.doLayout();let c=-u.height/2;if(this._beat.brushType===Ye.ArpeggioUp){let d=a+h,p=o-h;u.width=Math.abs(p-d),r.beginRotate(e+this.x+5*this.scale,p,-90),u.paint(0,c,r),r.endRotate(),r.beginPath(),r.moveTo(l,o),r.lineTo(l+h/2,o-h),r.lineTo(l-h/2,o-h),r.closePath(),r.fill()}else if(this._beat.brushType===Ye.ArpeggioDown){let d=a+h,p=o;u.width=Math.abs(p-d),r.beginRotate(e+this.x+5*this.scale,d,90),u.paint(0,c,r),r.endRotate(),r.beginPath(),r.moveTo(l,a),r.lineTo(l+h/2,a+h),r.lineTo(l-h/2,a+h),r.closePath(),r.fill()}}}}class c5 extends jl{get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}doLayout(){if(!this.container.beat.isRest){let e=new Kx;e.renderer=this.renderer;let t=new Zu(!0);t.renderer=this.renderer;const r=new Ri(this.container.beat,!0);this._prebends=r,r.renderer=this.renderer;for(let s of this.container.beat.notes)if(s.isVisible){if(s.hasBend)switch(s.bendType){case X.PrebendBend:case X.Prebend:case X.PrebendRelease:r.addGlyph(s.displayValue-(s.bendPoints[0].value/2|0),!1);break}else if(s.beat.hasWhammyBar)switch(s.beat.whammyBarType){case Me.PrediveDive:case Me.Predive:this._prebends.addGlyph(s.displayValue-(s.beat.whammyBarPoints[0].value/2|0),!1);break}this.createAccidentalGlyph(s,e),t.addParenthesis(s)}r.isEmpty||(this.addGlyph(r),this.addGlyph(new Fi(0,0,4*(this.container.beat.graceType!==K.None?ue.GraceScale:1)*this.scale))),this.container.beat.brushType!==Ye.None&&(this.addGlyph(new u5(this.container.beat)),this.addGlyph(new Fi(0,0,4*this.scale))),t.isEmpty||(this.addGlyph(t),this.addGlyph(new Fi(0,0,4*(this.container.beat.graceType!==K.None?ue.GraceScale:1)*this.scale))),e.isEmpty||(this.accidentals=e,this.addGlyph(new Fi(0,0,2*(this.container.beat.graceType!==K.None?ue.GraceScale:1)*this.scale)),this.addGlyph(e),this.addGlyph(new Fi(0,0,2*(this.container.beat.graceType!==K.None?ue.GraceScale:1)*this.scale)))}super.doLayout()}createAccidentalGlyph(e,t){let r=this.renderer,s=r.accidentalHelper.applyAccidental(e),n=r.getNoteLine(e),a=this.container.beat.graceType!==K.None;if(s!==Fe.None){let o=new pn(0,r.getScoreY(n),s,a);o.renderer=this.renderer,t.addGlyph(o)}if(e.harmonicType!==q.None&&e.harmonicType!==q.Natural){let o=e.displayValue+e.harmonicPitch;s=r.accidentalHelper.applyAccidentalForValue(e.beat,o,a,!1),n=r.accidentalHelper.getNoteLineForValue(o,!1);let l=new pn(0,r.getScoreY(n),s,a);l.renderer=this.renderer,t.addGlyph(l)}}constructor(){super(),this._prebends=null,this.accidentals=null}}class Km extends ft{constructor(e,t,r,s){super(e,t,s,Km.getSymbol(r)),this._digit=0,this._scale=0,this._digit=r,this._scale=s}doLayout(){this.width=this.getDigitWidth(this._digit)*this.scale*this._scale}getDigitWidth(e){switch(e){case 0:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return 14;case 1:return 10;default:return 0}}static getSymbol(e){switch(e){case 0:return g.TimeSig0;case 1:return g.TimeSig1;case 2:return g.TimeSig2;case 3:return g.TimeSig3;case 4:return g.TimeSig4;case 5:return g.TimeSig5;case 6:return g.TimeSig6;case 7:return g.TimeSig7;case 8:return g.TimeSig8;case 9:return g.TimeSig9;default:return g.None}}}class ru extends qr{constructor(e,t,r,s=1){super(e,t),this._number=0,this._scale=0,this._number=r,this._scale=s}doLayout(){let e=this._number;for(;e>0;){let t=e%10,r=new Km(0,0,t,this._scale);this.addGlyph(r),e=e/10|0}if(this.glyphs){this.glyphs.reverse();let t=0;for(let r=0,s=this.glyphs.length;r<s;r++){let n=this.glyphs[r];n.x=t,n.y=0,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t}}}ru.numberHeight=18;class Jx extends qr{constructor(e,t,r,s,n){super(e,t),this._numerator=0,this._denominator=0,this._numerator=r,this._denominator=s,this._isCommon=n}doLayout(){if(this._isCommon&&this._numerator===2&&this._denominator===2){let e=new ft(0,0,this.commonScale,g.TimeSigCutCommon);e.width=14*this.scale,this.addGlyph(e),super.doLayout()}else if(this._isCommon&&this._numerator===4&&this._denominator===4){let e=new ft(0,0,this.commonScale,g.TimeSigCommon);e.width=14*this.scale,this.addGlyph(e),super.doLayout()}else{const e=ru.numberHeight*this.scale;let t=new ru(0,-e/2,this._numerator,this.numberScale),r=new ru(0,e/2,this._denominator,this.numberScale);this.addGlyph(t),this.addGlyph(r),super.doLayout();for(let s=0,n=this.glyphs.length;s<n;s++){let a=this.glyphs[s];a.x=(this.width-a.width)/2}}}}class d5 extends Jx{get commonScale(){return 1}get numberScale(){return 1}}class f5 extends Qm{constructor(e){super(0,0),this._notes=[],this._endNoteGlyph=null,this._middleNoteGlyph=null,this._beat=e}addBends(e){if(this._notes.push(e),!e.isTieOrigin)switch(e.bendType){case X.Bend:case X.PrebendRelease:case X.PrebendBend:{let t=this._endNoteGlyph;t||(t=new Ri(e.beat,!1),t.renderer=this.renderer,this._endNoteGlyph=t,this.BendNoteHeads.push(t));let r=e.bendPoints[e.bendPoints.length-1];t.addGlyph(this.getBendNoteValue(e,r),r.value%2!==0)}break;case X.Release:if(!e.isTieOrigin){let t=this._endNoteGlyph;t||(t=new Ri(e.beat,!1),t.renderer=this.renderer,this._endNoteGlyph=t,this.BendNoteHeads.push(t));let r=e.bendPoints[e.bendPoints.length-1];t.addGlyph(this.getBendNoteValue(e,r),r.value%2!==0)}break;case X.BendRelease:{let t=this._middleNoteGlyph;t||(t=new Ri(e.beat,!1),this._middleNoteGlyph=t,t.renderer=this.renderer,this.BendNoteHeads.push(t));let r=e.bendPoints[1];t.addGlyph(this.getBendNoteValue(e,e.bendPoints[1]),r.value%2!==0);let s=this._endNoteGlyph;s||(s=new Ri(e.beat,!1),s.renderer=this.renderer,this._endNoteGlyph=s,this.BendNoteHeads.push(s));let n=e.bendPoints[e.bendPoints.length-1];s.addGlyph(this.getBendNoteValue(e,n),n.value%2!==0)}break}}paint(e,t,r){let s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._beat.voice.bar),n=e+s.x+s.getBeatX(this._beat,be.MiddleNotes),a=e+s.x;this._beat.isLastOfVoice?a+=s.postBeatGlyphsStart:a+=s.getBeatX(this._beat.nextBeat,be.PreNotes),a-=8*this.scale;let o=(n+a)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=o-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=t+s.y,this._middleNoteGlyph.paint(0,0,r)),this._endNoteGlyph&&(this._endNoteGlyph.x=a-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=t+s.y,this._endNoteGlyph.paint(0,0,r)),this._notes.sort((u,c)=>c.displayValue-u.displayValue);let l=this._beat.graceType===K.BendGrace?this._beat.nextBeat:this._beat,h=this._notes.length===1?this.getTieDirection(l,s):D.Up;for(let u=0;u<this._notes.length;u++){let c=this._notes[u];u>0&&u>=(this._notes.length/2|0)&&(h=D.Down);let d=t+s.y+s.getNoteY(c,j.Top),p=ue.NoteHeadHeight*this.scale*ue.GraceScale*.5;h===D.Down&&(d+=ue.NoteHeadHeight*this.scale);let f=c.bendStyle===De.Gradual?"grad.":"";if(c.isTieOrigin){let m=c.tieDestination,S=m?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,m.beat.voice.bar):null;if(!S||S.staff!==s.staff){let y=e+s.x+s.width,b=c.tieDestination.realValue;s.accidentalHelper.applyAccidentalForValue(c.beat,b,!1,!0);let w=t+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(b,!1));c.bendType===X.Hold||c.bendType===X.Prebend?It.paintTie(r,this.scale,n,d,y,w,h===D.Down,22,4):this.drawBendSlur(r,n,d,y,w,h===D.Down,this.scale,f)}else{let y=e+S.x+S.getBeatX(m.beat,be.MiddleNotes),b=t+S.y+S.getNoteY(m,j.Top);h===D.Down&&(b+=ue.NoteHeadHeight*this.scale),c.bendType===X.Hold||c.bendType===X.Prebend?It.paintTie(r,this.scale,n,d,y,b,h===D.Down,22,4):this.drawBendSlur(r,n,d,y,b,h===D.Down,this.scale,f)}switch(c.bendType){case X.Prebend:case X.PrebendBend:case X.PrebendRelease:let y=e+s.x+s.getBeatX(c.beat,be.PreNotes);y+=s.getPreNotesGlyphForBeat(c.beat).prebendNoteHeadOffset;let b=t+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(c.displayValue-(c.bendPoints[0].value/2|0),!1))+p;this.drawBendSlur(r,y,b,n,d,h===D.Down,this.scale);break}}else{h===D.Up&&(p=-p);let m=0,S=0;switch(c.bendType){case X.Bend:m=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this._endNoteGlyph.getNoteValueY(m)+p,this.drawBendSlur(r,n,d,a,S,h===D.Down,this.scale,f);break;case X.BendRelease:let y=this.getBendNoteValue(c,c.bendPoints[1]),b=this._middleNoteGlyph.getNoteValueY(y)+p;this.drawBendSlur(r,n,d,o,b,h===D.Down,this.scale,f),m=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this._endNoteGlyph.getNoteValueY(m)+p,this.drawBendSlur(r,o,b,a,S,h===D.Down,this.scale,f);break;case X.Release:this.BendNoteHeads.length>0&&(m=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this.BendNoteHeads[0].getNoteValueY(m)+p,this.drawBendSlur(r,n,d,a,S,h===D.Down,this.scale,f));break;case X.Prebend:case X.PrebendBend:case X.PrebendRelease:let w=e+s.x+s.getBeatX(c.beat,be.PreNotes);w+=s.getPreNotesGlyphForBeat(c.beat).prebendNoteHeadOffset;let x=t+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(c.displayValue-(c.bendPoints[0].value/2|0),!1))+p;this.drawBendSlur(r,w,x,n,d,h===D.Down,this.scale),this.BendNoteHeads.length>0&&(m=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this.BendNoteHeads[0].getNoteValueY(m)+p,this.drawBendSlur(r,n,d,a,S,h===D.Down,this.scale,f));break}}}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class qp extends It{constructor(e,t,r=!1){super(e,t,r)}doLayout(){super.doLayout()}getBeamDirection(e,t){if(e.isRest)return D.Up;switch(t.getBeatDirection(e)){case D.Up:return D.Down;default:return D.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case D.Up:return this.startNoteRenderer.getNoteY(this.startBeat.maxNote,j.Top);default:return this.startNoteRenderer.getNoteY(this.startBeat.minNote,j.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case D.Up:return e.getScoreY(9);default:return e.getScoreY(0)}const t=this.startNoteRenderer.getBeatDirection(this.startBeat),r=e.getBeatDirection(this.endBeat);if(t!==r&&this.startBeat.graceType===K.None)if(r===this.tieDirection)switch(this.tieDirection){case D.Up:return e.getNoteY(this.endBeat.maxNote,j.TopWithStem);default:return e.getNoteY(this.endBeat.minNote,j.BottomWithStem)}else switch(this.tieDirection){case D.Up:return e.getNoteY(this.endBeat.maxNote,j.BottomWithStem);default:return e.getNoteY(this.endBeat.minNote,j.TopWithStem)}switch(this.tieDirection){case D.Up:return e.getNoteY(this.endBeat.maxNote,j.Top);default:return e.getNoteY(this.endBeat.minNote,j.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,be.MiddleNotes)}getEndX(){const e=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>B.Whole&&e===this.tieDirection?be.Stem:be.MiddleNotes)}}class p5 extends bt{constructor(e,t,r,s){super(0,0),this._outType=t,this._inType=e,this._startNote=r,this._parent=s}doLayout(){this.width=0}paint(e,t,r){this.paintSlideIn(e,t,r),this.drawSlideOut(e,t,r)}paintSlideIn(e,t,r){let s=this.renderer,n=12*this.scale,a=e+s.x+s.getNoteX(this._startNote,et.Left)-2*this.scale,o=t+s.y+s.getNoteY(this._startNote,j.Center),l=a-n,h=t+s.y;switch(this._inType){case zt.IntoFromBelow:h+=s.getNoteY(this._startNote,j.Bottom);break;case zt.IntoFromAbove:h+=s.getNoteY(this._startNote,j.Top);break;default:return}let u=this.getAccidentalsWidth(s,this._startNote.beat);l-=u,a-=u,this.paintSlideLine(r,!1,l,a,h,o)}getAccidentalsWidth(e,t){let r=e.getPreNotesGlyphForBeat(t);return r&&r.accidentals?r.accidentals.width:0}drawSlideOut(e,t,r){let s=this.renderer,n=12*this.scale,a=1*this.scale,o=2*this.scale,l=0,h=0,u=0,c=0,d=!1;switch(this._outType){case he.Shift:case he.Legato:if(l=e+s.x+s.getBeatX(this._startNote.beat,be.PostNotes),h=t+s.y+s.getNoteY(this._startNote,j.Center),this._startNote.slideTarget){let p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);!p||p.staff!==s.staff?(u=e+s.x+s.width,c=h):(u=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,be.PreNotes)-a,c=t+p.y+p.getNoteY(this._startNote.slideTarget,j.Center)),this._startNote.slideTarget.realValue>this._startNote.realValue?(h+=o,c-=o):(h-=o,c+=o)}else u=e+s.x+this._parent.x,c=h;break;case he.OutUp:l=e+s.x+s.getNoteX(this._startNote,et.Right),h=t+s.y+s.getNoteY(this._startNote,j.Center),u=l+n,c=t+s.y+s.getNoteY(this._startNote,j.Top);break;case he.OutDown:l=e+s.x+s.getNoteX(this._startNote,et.Right),h=t+s.y+s.getNoteY(this._startNote,j.Center),u=l+n,c=t+s.y+s.getNoteY(this._startNote,j.Bottom);break;case he.PickSlideUp:l=e+s.x+s.getNoteX(this._startNote,et.Right),h=t+s.y+s.getNoteY(this._startNote,j.Center),c=t+s.y+s.getNoteY(this._startNote,j.Top),u=e+s.x+s.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=e+s.x+s.getBeatX(this._startNote.beat.nextBeat,be.PreNotes)),d=!0;break;case he.PickSlideDown:l=e+s.x+s.getNoteX(this._startNote,et.Right),h=t+s.y+s.getNoteY(this._startNote,j.Center),c=t+s.y+s.getNoteY(this._startNote,j.Bottom),u=e+s.x+s.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=e+s.x+s.getBeatX(this._startNote.beat.nextBeat,be.PreNotes)),d=!0;break;default:return}this.paintSlideLine(r,d,l,u,h,c)}paintSlideLine(e,t,r,s,n,a){if(t){let o=new ra(0,0,Pe.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,a-=o.height/2;let l=s-r,h=a-n,u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));o.width=l;let c=Math.asin(h/u)*(180/Math.PI);e.beginRotate(r,n,c),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(r,n),e.lineTo(s,a),e.stroke()}}class Ih extends qp{constructor(e,t,r=!1){super(e.beat,t.beat,r),this._startNote=e,this._endNote=t}getTieHeight(e,t,r,s){return Math.log2(r-e+1)*this.renderer.settings.notation.slurHeight}getStartY(){if(this.isStartCentered())switch(this.tieDirection){case D.Up:return this.startNoteRenderer.getNoteY(this._startNote,j.Top);default:return this.startNoteRenderer.getNoteY(this._startNote,j.Bottom)}return this.startNoteRenderer.getNoteY(this._startNote,j.Center)}getEndY(){if(this.isEndCentered())if(this.isEndOnStem())switch(this.tieDirection){case D.Up:return this.endNoteRenderer.getNoteY(this._endNote,j.TopWithStem);default:return this.endNoteRenderer.getNoteY(this._endNote,j.BottomWithStem)}else switch(this.tieDirection){case D.Up:return this.endNoteRenderer.getNoteY(this._endNote,j.Top);default:return this.endNoteRenderer.getNoteY(this._endNote,j.Bottom)}else return this.endNoteRenderer.getNoteY(this._endNote,j.Center)}isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===D.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===D.Down}isEndCentered(){return this._startNote.beat.graceType===K.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===D.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===D.Down)}isEndOnStem(){const e=this.endNoteRenderer,t=this.startNoteRenderer.getBeatDirection(this.startBeat),r=e.getBeatDirection(this.endBeat);return t!==r&&this.startBeat.graceType===K.None}getStartX(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,be.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,et.Right)}getEndX(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,be.Stem):this.endNoteRenderer.getNoteX(this._endNote,et.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,be.PreNotes)}}class cb extends It{constructor(e,t,r=!1){super(e?e.beat:null,t?t.beat:null,r),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){switch(t.getBeatDirection(e)){case D.Up:return D.Down;default:return D.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case D.Up:return this.startNoteRenderer.getNoteY(this.startNote,j.Top);default:return this.startNoteRenderer.getNoteY(this.startNote,j.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case D.Up:return e.getScoreY(9);default:return e.getScoreY(0)}switch(this.tieDirection){case D.Up:return e.getNoteY(this.endNote,j.Top);default:return e.getNoteY(this.endNote,j.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,be.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,be.PreNotes)}}class g5 extends Nr{constructor(e,t){super(e,t),this._bend=null,this._effectSlur=null,this._effectEndSlur=null}doLayout(){if(this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let e=this.beat.nextBeat;for(;e.nextBeat&&e.nextBeat.isLegatoDestination;)e=e.nextBeat;this.addTie(new qp(this.beat,e,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let e=this.beat.previousBeat;for(;e.previousBeat&&e.previousBeat.isLegatoOrigin;)e=e.previousBeat;this.addTie(new qp(e,this.beat,!0))}this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(e.isVisible){if(e.isTieOrigin&&!e.hasBend&&!e.beat.hasWhammyBar&&e.beat.graceType!==K.BendGrace&&e.tieDestination&&e.tieDestination.isVisible){let t=new cb(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination&&!e.tieOrigin.hasBend&&!e.beat.hasWhammyBar){let t=new cb(e.tieOrigin,e,!0);this.addTie(t)}if(e.slideInType!==zt.None||e.slideOutType!==he.None){let t=new p5(e.slideInType,e.slideOutType,e,this);this.addTie(t)}if(e.isSlurOrigin&&e.slurDestination&&e.slurDestination.isVisible){let t=new Ih(e,e.slurDestination,!1);this.addTie(t)}if(e.isSlurDestination){let t=new Ih(e.slurOrigin,e,!0);this.addTie(t)}if(!this._effectSlur&&e.isEffectSlurOrigin&&e.effectSlurDestination){const t=new Ih(e,e.effectSlurDestination,!1);this._effectSlur=t,this.addTie(t)}if(!this._effectEndSlur&&e.beat.isEffectSlurDestination&&e.beat.effectSlurOrigin){let t=this.onNotes.beamingHelper.direction,r=t===D.Up?e.beat.effectSlurOrigin.minNote:e.beat.effectSlurOrigin.maxNote,s=t===D.Up?e.beat.minNote:e.beat.maxNote;const n=new Ih(r,s,!0);this._effectEndSlur=n,this.addTie(n)}if(e.hasBend){if(!this._bend){const t=new f5(e.beat);this._bend=t,t.renderer=this.renderer,this.addTie(t)}this._bend.addBends(e)}}}}class m5 extends bt{constructor(e,t,r,s){super(e,t),this._dotOffset=0,this._circleSize=0,this._dotOffset=0,this._circleSize=0,this._dotOffset=s,this._circleSize=r}doLayout(){this.width=13*this.scale}paint(e,t,r){let s=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x+.5,l=a-n;r.fillRect(o,n,s,l),o+=s*2-.5,r.beginPath(),r.moveTo(o,n),r.lineTo(o,a),r.stroke(),o+=3*this.scale;let h=this._circleSize*this.scale,u=(n+a)/2;r.fillCircle(o,u-h*this._dotOffset,h),r.fillCircle(o,u+h*this._dotOffset,h)}}class y5 extends bt{constructor(e,t){super(e,t)}doLayout(){this.renderer.isLast?this.width=15*this.scale:!this.renderer.nextRenderer||this.renderer.nextRenderer.staff!==this.renderer.staff||!this.renderer.nextRenderer.bar.masterBar.isRepeatStart?(this.width=2*this.scale,this.renderer.bar.masterBar.isDoubleBar&&(this.width+=2*this.scale)):this.width=2*this.scale}paint(e,t,r){let s=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x,l=a-n;this.renderer.isLast?(r.fillRect(o+this.width-s-s,n,this.scale,l),r.fillRect(o+this.width-s,n,s,l)):(!this.renderer.nextRenderer||this.renderer.nextRenderer.staff!==this.renderer.staff||!this.renderer.nextRenderer.bar.masterBar.isRepeatStart)&&(r.fillRect(o+this.width-this.scale,n,this.scale,l),this.renderer.bar.masterBar.isDoubleBar&&r.fillRect(o+this.width-5*this.scale,n,this.scale,l))}}class b5 extends bt{constructor(e,t){super(e,t)}doLayout(){this.width=11*this.scale}paint(e,t,r){let s=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x,l=a-n,h=1.5*this.scale,u=(n+a)/2,c=3;r.fillCircle(o,u-h*c,h),r.fillCircle(o,u+h*c,h),o+=4*this.scale,r.beginPath(),r.moveTo(o,n),r.lineTo(o,a),r.stroke(),o+=3*this.scale+.5,r.fillRect(o,n,s,l)}}class w5 extends bt{constructor(e,t,r){super(e,t),this._count=0,this._count=0,this._count=r}doLayout(){this.width=0}paint(e,t,r){let s=this.renderer.resources,n=r.textAlign;r.font=s.barNumberFont,r.textAlign=Q.Right;let a="x"+this._count,o=r.measureText(a).width/1.5;r.fillText(a,e+this.x-o,t+this.y),r.textAlign=n}}class S5 extends bt{constructor(e,t,r){super(e,t),this._number=0,this._number=r}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString()).width+5*this.scale}paint(e,t,r){if(!this.renderer.staff.isFirstInAccolade)return;let s=this.renderer.resources,n=r.color;const a=r.textBaseline;r.textBaseline=le.Top,r.color=s.barNumberColor,r.font=s.barNumberFont,r.fillText(this._number.toString(),e+this.x,t+this.y),r.color=n,r.textBaseline=a}}class so extends ht{constructor(e,t){super(e,t),this.firstLineY=0,this._startSpacing=!1,this.tupletSize=0}get lineOffset(){return(this.lineSpacing+1)*this.scale}get topGlyphOverflow(){const e=this.resources;return(e.tablatureFont.size/2+e.tablatureFont.size*.2)*this.scale}get bottomGlyphOverflow(){const e=this.resources;return(e.tablatureFont.size/2+e.tablatureFont.size*.2)*this.scale}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){let e=this.lineOffset*(this.heightLineCount-1),t=(this.drawnLineCount-1)*this.lineOffset;this.firstLineY=this.topPadding+(e-t)/2}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=15*this.scale+this.resources.effectFont.size*.3,super.doLayout()}getLineY(e){return this.firstLineY+this.getLineHeight(e)}getLineHeight(e){return this.lineOffset*e}paintBackground(e,t,r){super.paintBackground(e,t,r);const s=this.resources;r.color=s.staffLineColor;const n=[];for(let a=0,o=this.drawnLineCount;a<o;a++)n.push([]);this.collectSpaces(n);for(const a of n)a.sort((o,l)=>o[0]>l[0]?1:o[0]<l[0]?-1:0);for(let a=0;a<this.drawnLineCount;a++){const o=this.getLineY(a);let l=0;for(let h of n[a])r.fillRect(e+this.x+l,t+this.y+o|0,h[0]-l,this.scale*ht.StaffLineThickness),l=h[0]+h[1];r.fillRect(e+this.x+l,t+this.y+o|0,this.width-l,this.scale*ht.StaffLineThickness)}r.color=s.mainGlyphColor,this.paintSimileMark(e,t,r)}collectSpaces(e){}createStartSpacing(){this._startSpacing||(this.addPreBeatGlyph(new Fi(0,0,2*this.scale)),this._startSpacing=!0)}paintTuplets(e,t,r){for(const s of this.bar.voices)if(this.hasVoiceContainer(s)){const n=this.getVoiceContainer(s);for(const a of n.tupletGroups)this.paintTupletHelper(e+this.beatGlyphsStart,t,r,a)}}paintTupletHelper(e,t,r,s){const n=this.resources;let a=r.textAlign,o=r.textBaseline;r.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.textAlign=Q.Center,r.textBaseline=le.Middle;let l,h=s.beats[0].tupletNumerator,u=s.beats[0].tupletDenominator;h===2&&u===3?l="2":h===3&&u===2?l="3":h===4&&u===6?l="4":h===5&&u===4?l="5":h===6&&u===4?l="6":h===7&&u===4?l="7":h===9&&u===8?l="9":h===10&&u===8?l="10":h===11&&u===8?l="11":h===12&&u===8?l="12":h===13&&u===8?l="13":l=h+":"+u;let c=10*this.scale,d=5*this.scale;if(s.beats.length===1||!s.isFull)for(const p of s.beats){let f=this.helpers.beamHelperLookup[s.voice.index].get(p.index);if(!f)continue;let m=this.getBeamDirection(f),S=f.getBeatLineX(p),y=this.calculateBeamYWithDirection(f,S,m);m===D.Down?y+=c+d:y-=c+d,r.font=n.effectFont,r.fillText(l,e+this.x+S,t+this.y+y)}else{let p=s.beats[0],f=s.beats[s.beats.length-1],m=null,S=null;for(let we=0;we<s.beats.length;we++)if(!s.beats[we].isRest){m=s.beats[we];break}for(let we=s.beats.length-1;we>=0;we--)if(!s.beats[we].isRest){S=s.beats[we];break}let y=!1;m||(m=p,y=!0),S||(S=f);let b=this.helpers.beamHelperLookup[s.voice.index].get(p.index),w=this.helpers.beamHelperLookup[s.voice.index].get(f.index),x=b.getBeatLineX(p),v=w.getBeatLineX(f),C=this.helpers.beamHelperLookup[s.voice.index].get(m.index),P=this.helpers.beamHelperLookup[s.voice.index].get(S.index),N=this.getBeamDirection(b),W=this.calculateBeamYWithDirection(C,x,N),Y=this.calculateBeamYWithDirection(P,v,N);y&&(W=Math.max(W,Y),Y=W),r.font=n.effectFont;let me=r.measureText(l).width,Ee=3*this.scale,Xe=(x+v)/2,je=Xe-me/2-Ee,qe=Xe+me/2+Ee,_e=(Y-W)/(v-x),ot=W-_e*x,G=_e*je+ot,re=_e*Xe+ot,se=_e*qe+ot;N===D.Down&&(c*=-1,d*=-1),r.beginPath(),r.moveTo(e+this.x+x,t+this.y+W-c|0),r.lineTo(e+this.x+x,t+this.y+W-c-d|0),r.lineTo(e+this.x+je,t+this.y+G-c-d|0),r.stroke(),r.beginPath(),r.moveTo(e+this.x+qe,t+this.y+se-c-d|0),r.lineTo(e+this.x+v,t+this.y+Y-c-d|0),r.lineTo(e+this.x+v,t+this.y+Y-c|0),r.stroke(),r.fillText(l,e+this.x+Xe,t+this.y+re-c-d)}r.textAlign=a,r.textBaseline=o}paintBeams(e,t,r){for(const s of this.helpers.beamHelpers)for(const n of s)this.paintBeamHelper(e+this.beatGlyphsStart,t,r,n)}drawBeamHelperAsFlags(e){return e.beats.length===1}paintBeamHelper(e,t,r,s){r.color=s.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.isRestBeamHelper||(this.drawBeamHelperAsFlags(s)?this.paintFlag(e,t,r,s):this.paintBar(e,t,r,s))}shouldPaintFlag(e,t){return!(e.graceType===K.BendGrace||!t.hasBeatLineX(e)||e.graceType!==K.None&&this.settings.notation.notationMode===Ot.SongBook||e.duration===B.Whole||e.duration===B.DoubleWhole||e.duration===B.QuadrupleWhole)}paintFlag(e,t,r,s){for(const n of s.beats){if(!this.shouldPaintFlag(n,s))continue;let a=n.graceType!==K.None,o=a?ue.GraceScale:1,l=this.getFlagStemSize(s.shortestDuration),h=s.getBeatLineX(n),u=this.getBeamDirection(s),c=this.getFlagTopY(n),d=this.getFlagBottomY(n),p=0,f=0;if(u===D.Down?(d+=l*o,p=d,f=t+this.y+d):(c-=l*o,p=c,f=t+this.y+c),this.paintFingering(r,n,e+this.x+h,u,f),!!s.hasLine(!0,n)){if(this.paintBeamingStem(n,t+this.y,e+this.x+h,t+this.y+c,t+this.y+d,r),n.graceType===K.BeforeBeat){let m=15*this.scale,S=12*this.scale;r.beginPath(),u===D.Down?(r.moveTo(e+this.x+h-S/2,t+this.y+d-m),r.lineTo(e+this.x+h+S/2,t+this.y+d)):(r.moveTo(e+this.x+h-S/2,t+this.y+c+m),r.lineTo(e+this.x+h+S/2,t+this.y+c)),r.stroke()}if(s.hasFlag(!0,n)){let m=new $l(h-this.scale/2,p,n.duration,u,a);m.renderer=this,m.doLayout(),m.paint(e+this.x,t+this.y,r)}}}}paintFingering(e,t,r,s,n){let a=this.settings;if(a.notation.fingeringMode!==jr.ScoreDefault&&a.notation.fingeringMode!==jr.ScoreForcePiano)return;s===D.Up?r-=10*this.scale:r+=3*this.scale;let o=t.notes.slice(0);o.sort((l,h)=>l.realValue-h.realValue);for(let l=0;l<o.length;l++){let h=o[l],u=null;h.leftHandFinger!==ne.Unknown?u=$e.fingerToString(a,t,h.leftHandFinger,!0):h.rightHandFinger!==ne.Unknown&&(u=$e.fingerToString(a,t,h.rightHandFinger,!1)),u&&(e.fillText(u,r,n),n-=e.font.size|0)}}getFlagStemSize(e){let t=0;switch(e){case B.QuadrupleWhole:case B.Half:case B.Quarter:case B.Eighth:case B.Sixteenth:case B.ThirtySecond:case B.SixtyFourth:case B.OneHundredTwentyEighth:case B.TwoHundredFiftySixth:t=3;break;default:t=0;break}return this.getLineHeight(t)}calculateBeamY(e,t){return this.calculateBeamYWithDirection(e,t,this.getBeamDirection(e))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.bar.masterBar.isRepeatStart&&this.addPreBeatGlyph(new m5(0,0,1.5,3)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new S5(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs(),this.bar.masterBar.isRepeatEnd?(this.addPostBeatGlyph(new b5(this.x,0)),this.bar.masterBar.repeatCount>2&&this.addPostBeatGlyph(new w5(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))):this.addPostBeatGlyph(new y5(0,0))}paintBar(e,t,r,s){for(let n=0,a=s.beats.length;n<a;n++){let o=s.beats[n];if(!s.hasBeatLineX(o))continue;let h=o.graceType!==K.None?ue.GraceScale:1,u=s.getBeatLineX(o),c=this.getBeamDirection(s),d=t+this.y+this.getBarLineStart(o,c),p=t+this.y+this.calculateBeamY(s,u);this.paintBeamingStem(o,t+this.y,e+this.x+u,d,p,r);let f=p;c===D.Down?f+=r.font.size*2:n!==0&&(f-=r.font.size*1.5),this.paintFingering(r,o,e+this.x+u,c,f);let m=6*this.scale*h,S=(ht.BeamSpacing+ht.BeamThickness)*this.scale*h,y=ht.BeamThickness*this.scale*h,b=$e.getIndex(o.duration)-2,w=t+this.y;c===D.Down&&(S=-S,y=-y);for(let x=0;x<b;x++){let v=0,C=0,P=0,N=0,W=w+x*S;if(n<s.beats.length-1){if(zr.isFullBarJoin(o,s.beats[n+1],x))v=u,C=s.getBeatLineX(s.beats[n+1]);else if(n===0||!zr.isFullBarJoin(s.beats[n-1],o,x))v=u,C=v+m;else continue;P=W+this.calculateBeamY(s,v),N=W+this.calculateBeamY(s,C),so.paintSingleBar(r,e+this.x+v,P,e+this.x+C,N,y)}else n>0&&!zr.isFullBarJoin(o,s.beats[n-1],x)&&(v=u-m,C=u,P=W+this.calculateBeamY(s,v),N=W+this.calculateBeamY(s,C),so.paintSingleBar(r,e+this.x+v,P,e+this.x+C,N,y))}}}static paintSingleBar(e,t,r,s,n,a){e.beginPath(),e.moveTo(t,r),e.lineTo(s,n),e.lineTo(s,n+a),e.lineTo(t,r+a),e.closePath(),e.fill()}}class os extends so{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.accidentalHelper=new vt(this)}get lineSpacing(){return ht.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}getScoreY(e){return super.getLineY(e/2)}getScoreHeight(e){return super.getLineHeight(e/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){let e=this.getScoreY(-2),t=this.getScoreY(10),r=this.simpleWhammyOverflow;this.registerOverflowTop(r);let s=this.getScoreY(this.accidentalHelper.maxLine),n=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);n.direction===D.Up&&(s-=this.getStemSize(n),s-=n.fingeringCount*this.resources.graceFont.size,n.hasTuplet&&(s-=this.tupletSize)),s<e&&this.registerOverflowTop(Math.abs(s)+r);let a=this.getScoreY(this.accidentalHelper.minLine),o=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);o.direction===D.Down&&(a+=this.getStemSize(o),a+=o.fingeringCount*this.resources.graceFont.size,o.hasTuplet&&(a+=this.tupletSize)),a>t&&this.registerOverflowBottom(Math.abs(a)-t)}}paint(e,t,r){super.paint(e,t,r),this.paintBeams(e,t,r),this.paintTuplets(e,t,r)}getFlagTopY(e){return this.getScoreY(this.accidentalHelper.getMinLine(e))}getFlagBottomY(e){return this.getScoreY(this.accidentalHelper.getMaxLine(e))}getBeamDirection(e){return e.direction}getStemSize(e){let t=e.beats.length===1?this.getFlagStemSize(e.shortestDuration):this.getBarStemSize(e.shortestDuration);return e.isGrace&&(t=t*ue.GraceScale),t}getBarStemSize(e){let t=0;switch(e){case B.QuadrupleWhole:case B.Half:case B.Quarter:case B.Eighth:case B.Sixteenth:t=6;break;case B.ThirtySecond:t=8;break;case B.SixtyFourth:t=9;break;case B.OneHundredTwentyEighth:t=9;break;case B.TwoHundredFiftySixth:t=10;break;default:t=0;break}return this.getScoreHeight(t)}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(e,t){let r=super.getNoteY(e,t);if(isNaN(r)){const s=vt.computeLineWithoutAccidentals(this.bar,e);r=this.getScoreY(s)}return r}applyLayoutingInfo(){const e=super.applyLayoutingInfo();if(e&&this.bar.isMultiVoice){let t=this.getScoreY(-2),r=this.getScoreY(10),s=this.helpers.collisionHelper.getBeatMinMaxY();s[0]<t&&this.registerOverflowTop(Math.abs(s[0])),s[1]>r&&this.registerOverflowBottom(Math.abs(s[1])-r)}return e}calculateBeamYWithDirection(e,t,r){let s=this.getStemSize(e);if(!e.drawingInfos.has(r)){let n=new R4;e.drawingInfos.set(r,n);const a=e.beats[0],o=e.beats[e.beats.length-1];let l=e.isRestBeamHelper;n.startBeat=a,n.startX=e.getBeatLineX(a),l?n.startY=r===D.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.startY=r===D.Up?this.getScoreY(this.accidentalHelper.getMinLine(a))-s:this.getScoreY(this.accidentalHelper.getMaxLine(a))+s,n.endBeat=o,n.endX=e.getBeatLineX(o),l?n.endY=r===D.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.endY=r===D.Up?this.getScoreY(this.accidentalHelper.getMinLine(o))-s:this.getScoreY(this.accidentalHelper.getMaxLine(o))+s;let h=10*this.scale;if(r===D.Down&&n.startY>n.endY&&n.startY-n.endY>h&&(n.endY=n.startY-h),r===D.Down&&n.endY>n.startY&&n.endY-n.startY>h&&(n.startY=n.endY-h),r===D.Up&&n.startY<n.endY&&n.endY-n.startY>h&&(n.endY=n.startY+h),r===D.Up&&n.endY<n.startY&&n.startY-n.endY>h&&(n.startY=n.endY+h),e.beats.length>1){if(r===D.Up){let u=this.getScoreY(this.accidentalHelper.getMinLine(e.beatOfHighestNote))-s;const d=n.calcY(e.getBeatLineX(e.beatOfHighestNote))-u;d>0&&(n.startY-=d,n.endY-=d)}else{let u=this.getScoreY(this.accidentalHelper.getMaxLine(e.beatOfLowestNote))+s;const c=n.calcY(e.getBeatLineX(e.beatOfLowestNote)),d=u-c;d>0&&(n.startY+=d,n.endY+=d)}if(e.minRestLine!==null||e.maxRestLine!==null){const u=$e.getIndex(e.shortestDuration)-2;let c=e.isGrace?ue.GraceScale:1,d=u*(ht.BeamSpacing+ht.BeamThickness)*this.scale*c;if(d+=ht.BeamSpacing,r===D.Up&&e.minRestLine!==null){let p=this.getScoreY(e.minRestLine)-d;const m=n.calcY(e.getBeatLineX(e.beatOfMinRestLine))-p;m>0&&(n.startY-=m,n.endY-=m)}else if(r===D.Down&&e.maxRestLine!==null){let p=this.getScoreY(e.maxRestLine)+d;const f=n.calcY(e.getBeatLineX(e.beatOfMaxRestLine)),m=p-f;m>0&&(n.startY+=m,n.endY+=m)}}}}return e.drawingInfos.get(r).calcY(t)}getBarLineStart(e,t){return t===D.Up?this.getScoreY(this.accidentalHelper.getMaxLine(e)):this.getScoreY(this.accidentalHelper.getMinLine(e))}createLinePreBeatGlyphs(){if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let e=0;switch(this.bar.clef){case ae.Neutral:e=this.bar.staff.standardNotationLineCount-1;break;case ae.F4:e=2;break;case ae.C3:e=4;break;case ae.C4:e=2;break;case ae.G2:e=6;break}this.createStartSpacing(),this.addPreBeatGlyph(new qm(0,this.getScoreY(e)+.5*ht.StaffLineThickness,this.bar.clef,this.bar.clefOttava))}(this.index===0&&this.bar.masterBar.keySignature!==Rt.C||this.bar.previousBar&&this.bar.masterBar.keySignature!==this.bar.previousBar.masterBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){let e=0,t=this.bar.masterBar.keySignature,r=this.bar.previousBar?this.bar.previousBar.masterBar.keySignature:0;switch(this.bar.clef){case ae.Neutral:e=0;break;case ae.G2:e=1;break;case ae.F4:e=3;break;case ae.C3:e=2;break;case ae.C4:e=0;break}let s=new Map,n=[];if($e.keySignatureIsSharp(t))for(let l=0;l<Math.abs(t);l++){let h=os.SharpKsSteps[l]+e;n.push(new pn(0,this.getScoreY(h),Fe.Sharp,!1)),s.set(h,!0)}else for(let l=0;l<Math.abs(t);l++){let h=os.FlatKsSteps[l]+e;n.push(new pn(0,this.getScoreY(h),Fe.Flat,!1)),s.set(h,!0)}let a=Math.abs(r),o=$e.keySignatureIsSharp(r)?os.SharpKsSteps:os.FlatKsSteps;for(let l=0;l<a;l++){let h=o[l]+e;s.has(h)||this.addPreBeatGlyph(new pn(0,this.getScoreY(o[l]+e),Fe.Natural,!1))}for(let l of n)this.addPreBeatGlyph(l)}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Fi(0,0,5*this.scale));const e=this.bar.staff.standardNotationLineCount-1;this.addPreBeatGlyph(new d5(0,this.getScoreY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon))}createVoiceGlyphs(e){for(const t of e.beats){let r=new g5(t,this.getVoiceContainer(e));r.preNotes=new c5,r.onNotes=new h5,this.addBeatGlyph(r)}}getNoteLine(e){return this.accidentalHelper.getNoteLine(e)}completeBeamingHelper(e){if(this.bar.isMultiVoice&&e.highestNoteInHelper&&e.lowestNoteInHelper){let t=this.getNoteY(e.highestNoteInHelper,j.Center),r=this.getNoteY(e.lowestNoteInHelper,j.Center),s=this.getStemSize(e);e.hasTuplet&&(s+=this.resources.effectFont.size*2),e.direction==D.Up?t-=s:r+=s;for(const n of e.beats)this.helpers.collisionHelper.reserveBeatSlot(n,t,r)}}paintBeamingStem(e,t,r,s,n,a){a.lineWidth=ht.StemWidth*this.scale,a.beginPath(),a.moveTo(r,s),a.lineTo(r,n),a.stroke(),a.lineWidth=this.scale}}os.StaffId="score";os.SharpKsSteps=[-1,2,-2,1,4,0,3];os.FlatKsSteps=[3,0,4,1,5,2,6];class db extends rd{get staffId(){return os.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new os(e,t)}constructor(){super()}}class v5 extends bt{constructor(e,t,r,s){super(0,0),this._inType=e,this._outType=t,this._startNote=r,this._parent=s}doLayout(){this.width=0}paint(e,t,r){this.paintSlideIn(e,t,r),this.paintSlideOut(e,t,r)}paintSlideIn(e,t,r){let s=this.renderer,n=12*this.scale,a=3*this.scale,o=0,l=0,h=0,u=0;switch(this._inType){case zt.IntoFromBelow:h=e+s.x+s.getNoteX(this._startNote,et.Left),u=t+s.y+s.getNoteY(this._startNote,j.Center),o=h-n,l=t+s.y+s.getNoteY(this._startNote,j.Center)+a;break;case zt.IntoFromAbove:h=e+s.x+s.getNoteX(this._startNote,et.Left),u=t+s.y+s.getNoteY(this._startNote,j.Center),o=h-n,l=t+s.y+s.getNoteY(this._startNote,j.Center)-a;break;default:return}this.paintSlideLine(r,!1,o,h,l,u)}paintSlideOut(e,t,r){let s=this.renderer,n=12*this.scale,a=3*this.scale,o=0,l=0,h=0,u=0,c=!1;const d=2*this.scale;switch(this._outType){case he.Shift:case he.Legato:if(o=e+s.x+s.getBeatX(this._startNote.beat,be.PostNotes),l=t+s.y+s.getNoteY(this._startNote,j.Center),this._startNote.slideTarget){let p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);!p||p.staff!==s.staff?(h=e+s.x+s.width,u=l):(h=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,be.OnNotes)-d,u=t+p.y+p.getNoteY(this._startNote.slideTarget,j.Center)),this._startNote.slideTarget.fret>this._startNote.fret?(l+=a,u-=a):(l-=a,u+=a)}else h=e+s.x+this._parent.x,u=l;break;case he.OutUp:o=e+s.x+s.getNoteX(this._startNote,et.Right),l=t+s.y+s.getNoteY(this._startNote,j.Center),h=o+n-d,u=t+s.y+s.getNoteY(this._startNote,j.Center)-a;break;case he.OutDown:o=e+s.x+s.getNoteX(this._startNote,et.Right),l=t+s.y+s.getNoteY(this._startNote,j.Center),h=o+n-d,u=t+s.y+s.getNoteY(this._startNote,j.Center)+a;break;case he.PickSlideDown:o=e+s.x+s.getNoteX(this._startNote,et.Right),l=t+s.y+s.getNoteY(this._startNote,j.Center),h=e+s.x+s.getBeatX(this._startNote.beat,be.EndBeat),u=l+a*3,c=!0;break;case he.PickSlideUp:o=e+s.x+s.getNoteX(this._startNote,et.Right),l=t+s.y+s.getNoteY(this._startNote,j.Center),h=e+s.x+s.getBeatX(this._startNote.beat,be.EndBeat),u=l-a*3,c=!0;break;default:return}this.paintSlideLine(r,c,o,h,l,u)}paintSlideLine(e,t,r,s,n,a){if(t){let o=new ra(0,0,Pe.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,a-=o.height/2;let l=s-r,h=a-n,u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));o.width=l;let c=Math.asin(h/u)*(180/Math.PI);e.beginRotate(r,n,c),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(r,n),e.lineTo(s,a),e.stroke()}}class gn extends It{constructor(e,t,r=!1){super(e.beat,t.beat,r),this.startNote=e,this.endNote=t}getTieHeight(e,t,r,s){return this.startNote===this.endNote?15:super.getTieHeight(e,t,r,s)}getBeamDirection(e,t){return this.startNote===this.endNote?D.Up:gn.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(e){return e.string>3?D.Up:D.Down}getStartY(){return this.startNote===this.endNote?this.startNoteRenderer.getNoteY(this.startNote,j.Center):this.tieDirection===D.Up?this.startNoteRenderer.getNoteY(this.startNote,j.Top):this.startNoteRenderer.getNoteY(this.startNote,j.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,et.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,et.Left):this.endNoteRenderer.getNoteX(this.endNote,et.Center)}}class fb extends gn{constructor(e,t,r,s=!1){super(e,t,s),this._direction=gn.getBeamDirectionForNote(e),this._forSlide=r}getTieHeight(e,t,r,s){return Math.log(r-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,r,s){if(this._forSlide!==r||this.forEnd!==s||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id||this._direction!==gn.getBeamDirectionForNote(e))return!1;switch(this._direction){case D.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case D.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,r){let s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,s),a="tab.slur."+this.startNote.beat.id+"."+this.endNote.beat.id+"."+n,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(e,t,r))}}class k5 extends Nr{constructor(e,t){super(e,t),this._bend=null,this._effectSlurs=[]}drawBeamHelperAsFlags(e){return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(!e.isVisible)return;let t=this.renderer;if(e.isTieOrigin&&t.showTiedNotes&&e.tieDestination.isVisible){let r=new gn(e,e.tieDestination,!1);this.addTie(r)}if(e.isTieDestination&&t.showTiedNotes){let r=new gn(e.tieOrigin,e,!0);this.addTie(r)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){let r=new gn(e,e,!1);this.addTie(r)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let r=!1;for(let s of this._effectSlurs)if(s.tryExpand(e,e.effectSlurDestination,!1,!1)){r=!0;break}if(!r){let s=new fb(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(s),this.addTie(s)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let r=!1;for(let s of this._effectSlurs)if(s.tryExpand(e.effectSlurOrigin,e,!1,!0)){r=!0;break}if(!r){let s=new fb(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(s),this.addTie(s)}}if(e.slideInType!==zt.None||e.slideOutType!==he.None){let r=new v5(e.slideInType,e.slideOutType,e,this);this.addTie(r)}if(e.hasBend){if(!this._bend){const r=new Tr;this._bend=r,r.renderer=this.renderer,this.addTie(r)}this._bend.addBends(e)}}}class x5 extends bt{constructor(e,t,r){super(e,t),this._noteString=null,this._trillNoteString=null,this._trillNoteStringWidth=0,this.isEmpty=!1,this.noteStringWidth=0,this._note=r}doLayout(){let e=this._note,t=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===q.Natural&&e.harmonicValue!==0&&(t=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)e.beat.index===0&&this.renderer.settings.notation.notationMode==Ot.GuitarPro||(e.bendType===X.Bend||e.bendType===X.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(te.TabNotesOnTiedBends)?this._noteString="("+(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch).toString()+")":this._noteString="";else if(this._noteString=e.isDead?"x":t.toString(),e.isGhost)this._noteString="("+this._noteString+")";else if(e.harmonicType===q.Natural){let r=this._noteString.indexOf(".");r>=0&&(this._noteString=this._noteString.substr(0,r+2)),this._noteString="<"+this._noteString+">"}if(e.isTrill)this._trillNoteString="("+(e.trillFret-e.beat.voice.bar.staff.transpositionPitch).toString()+")";else if($e.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case q.Artificial:case q.Pinch:case q.Tap:case q.Semi:case q.Feedback:let r=(t+e.harmonicValue).toString(),s=r.indexOf(".");s>=0&&(r=r.substr(0,s+2)),this._trillNoteString="<"+r+">";break;default:this._trillNoteString="";break}this.isEmpty=!this._noteString,this.isEmpty||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString).width*this.scale,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3*this.scale+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth))}paint(e,t,r){if(this.isEmpty)return;let s=this.noteStringWidth+this._trillNoteStringWidth,n=e+this.x+(this.width-s)/2,a=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,r.fillText(this._trillNoteString,n+this.noteStringWidth+3*this.scale,t+this.y),this.renderer.scoreRenderer.canvas.font=a,r.fillText(this._noteString,n,t+this.y)}buildBoundingsLookup(e,t,r){let s=new td;s.note=this._note,s.noteHeadBounds=new Ti,s.noteHeadBounds.x=t+this.x,s.noteHeadBounds.y=r+this.y-this.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,e.addNote(s)}}class B5 extends bt{constructor(e,t,r){super(e,t),this._notes=[],this.minStringNote=null,this.beatEffects=new Map,this.notesPerString=new Map,this.noteStringWidth=0,this._isGrace=r}buildBoundingsLookup(e,t,r){for(const s of this._notes)s.buildBoundingsLookup(e,t+this.x,r+this.y)}getNoteX(e,t){if(this.notesPerString.has(e.string)){let r=this.notesPerString.get(e.string),s=this.x+r.x;switch(t){case et.Left:break;case et.Center:s+=r.noteStringWidth/2;break;case et.Right:s+=r.width;break}return s}return 0}getNoteY(e,t){if(this.notesPerString.has(e.string)){const r=this.notesPerString.get(e.string);let s=this.y+r.y;switch(t){case j.Top:case j.TopWithStem:s-=r.height/2+2*this.scale;break;case j.Center:break;case j.Bottom:case j.BottomWithStem:s+=r.height/2;break}return s}return 0}doLayout(){let e=0,t=0;for(let a=0,o=this._notes.length;a<o;a++){let l=this._notes[a];l.renderer=this.renderer,l.doLayout(),l.width>e&&(e=l.width),l.noteStringWidth>t&&(t=l.noteStringWidth)}this.noteStringWidth=t;let r=this.renderer.resources.tablatureFont.size,s=this.getNoteY(this.minStringNote,j.Center)+r/2,n=7*this.scale;for(const a of this.beatEffects.values())a.y+=s,a.x+=this.width/2,a.renderer=this.renderer,s+=n,a.doLayout();this.width=e}addNoteGlyph(e,t){this._notes.push(e),this.notesPerString.set(t.string,e),(!this.minStringNote||t.string<this.minStringNote.string)&&(this.minStringNote=t)}paint(e,t,r){e+=this.x,t+=this.y;let s=this.renderer.resources,n=r.textBaseline;r.textBaseline=le.Middle,r.font=this._isGrace?s.graceFont:s.tablatureFont;let a=this._notes,o=this.width;for(let l of a)l.renderer=this.renderer,l.width=o,l.paint(e,t,r);r.textBaseline=n;for(const l of this.beatEffects.values())l.paint(e,t,r)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class _5 extends ft{constructor(e,t,r,s){super(e,t,1,sa.getSymbol(s)),this._isVisibleRest=r,this._duration=s}doLayout(){this._isVisibleRest?this.width=sa.getSize(this._duration)*this.scale:this.width=10*this.scale}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,r){this._isVisibleRest&&super.paint(e,t,r)}}class T5 extends ql{constructor(){super(...arguments),this.noteNumbers=null,this.restGlyph=null}getNoteX(e,t){return this.noteNumbers?this.noteNumbers.getNoteX(e,t):0}getNoteY(e,t){return this.noteNumbers?this.noteNumbers.getNoteY(e,t):0}buildBoundingsLookup(e,t,r){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(e,t+this.x,r+this.y)}doLayout(){let e=this.renderer;if(this.container.beat.isRest){let r=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),s=e.getTabY(r);const n=new _5(0,s,e.showRests,this.container.beat.duration);if(this.restGlyph=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n),this.container.beat.dots>0&&e.showRests){this.addGlyph(new Fi(0,0,5*this.scale));for(let a=0;a<this.container.beat.dots;a++)this.addGlyph(new Ku(0,s,1.5*this.scale))}}else{let r=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==K.None;const s=new B5(0,0,r);this.noteNumbers=s,s.beat=this.container.beat,s.beamingHelper=this.beamingHelper;for(let n of this.container.beat.notes)n.isVisible&&this.createNoteGlyph(n);if(this.addGlyph(s),this.container.beat.hasWhammyBar){let n=new nr(this.container.beat);n.renderer=this.renderer,n.doLayout(),this.container.ties.push(n)}if(this.container.beat.isTremolo&&!this.noteNumbers.beatEffects.has("tremolo")){let n=0,a=this.container.beat.tremoloSpeed;switch(a){case B.ThirtySecond:n=10;break;case B.Sixteenth:n=5;break;case B.Eighth:n=0;break}this.noteNumbers.beatEffects.set("tremolo",new ad(5*this.scale,n*this.scale,a))}if(this.container.beat.dots>0&&e.settings.notation.rhythmMode!==_s.Hidden){this.addGlyph(new Fi(0,0,5*this.scale));for(let n=0;n<this.container.beat.dots;n++)this.addGlyph(new Ku(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight*e.scale,1.5*this.scale))}}if(!this.glyphs)return;let t=0;for(let r=0,s=this.glyphs.length;r<s;r++){let n=this.glyphs[r];n.x=t,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t,this.computedWidth=t,this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2}updateBeamingHelper(){this.container.beat.isRest?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.noteNumbers.updateBeamingHelper(this.container.x+this.x)}createNoteGlyph(e){let t=this.renderer,r=new x5(0,0,e),s=e.beat.voice.bar.staff.tuning.length-e.string;r.y=t.getTabY(s),r.renderer=this.renderer,r.doLayout(),this.noteNumbers.addNoteGlyph(r,e);let n=r.y-r.height/2,a=n+r.height;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,a)}}class C5 extends bt{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=10*this.scale}paint(e,t,r){let s=this.renderer,n=t+this.x+s.getNoteY(this._beat.maxStringNote,j.Top),a=t+this.y+s.getNoteY(this._beat.minStringNote,j.Bottom),o=e+this.x+this.width/2|0,l=8*this.scale;if(this._beat.brushType!==Ye.None){if(this._beat.brushType===Ye.BrushUp||this._beat.brushType===Ye.BrushDown)r.beginPath(),r.moveTo(o,n),r.lineTo(o,a),r.stroke();else if(this._beat.brushType===Ye.ArpeggioUp){let h=new ra(0,0,Pe.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();let u=n,c=a-l;h.width=Math.abs(c-u),r.beginRotate(e+this.x+4*this.scale,c,-90),h.paint(0,-h.height/2,r),r.endRotate()}else if(this._beat.brushType===Ye.ArpeggioDown){let h=new ra(0,0,Pe.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();let u=n+l,c=a;h.width=Math.abs(c-u),r.beginRotate(e+this.x+4*this.scale,u,90),h.paint(0,-h.height/2,r),r.endRotate()}this._beat.brushType===Ye.BrushUp||this._beat.brushType===Ye.ArpeggioUp?(r.beginPath(),r.moveTo(o,a),r.lineTo(o+l/2,a-l),r.lineTo(o-l/2,a-l),r.closePath(),r.fill()):(r.beginPath(),r.moveTo(o,n),r.lineTo(o+l/2,n+l),r.lineTo(o-l/2,n+l),r.closePath(),r.fill())}}}class N5 extends jl{doLayout(){this.container.beat.brushType!==Ye.None&&!this.container.beat.isRest&&(this.addGlyph(new C5(this.container.beat)),this.addGlyph(new Fi(0,0,4*this.scale))),super.doLayout()}constructor(){super()}}class P5 extends bt{constructor(e,t){super(e,t)}doLayout(){this.width=28*this.scale}paint(e,t,r){let s=this.renderer.bar.staff.tuning.length,n=s<=4?g.FourStringTabClef:g.SixStringTabClef,a=s<=4?s/4.5:s/6.5;r.fillMusicFontSymbol(e+this.x+5*this.scale,t+this.y,a*this.scale,n,!1)}}class E5 extends Jx{get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?ue.GraceScale:1}}class no extends so{constructor(e,t){super(e,t),this._hasTuplets=!1,this.showTimeSignature=!1,this.showRests=!1,this.showTiedNotes=!1}get lineSpacing(){return no.TabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}getTabY(e){return super.getLineY(e)}getTabHeight(e){return super.getLineHeight(e)}collectSpaces(e){const t=this.scale;for(let r of this.bar.voices)if(this.hasVoiceContainer(r)){let s=this.getVoiceContainer(r);for(let n of s.beatGlyphs){let a=n.onNotes,o=a.noteNumbers;if(o)for(const[l,h]of o.notesPerString)h.isEmpty||e[this.bar.staff.tuning.length-l].push(new Float32Array([s.x+n.x+a.x+o.x,o.width+t]))}}}adjustSizes(){this.settings.notation.rhythmMode!==_s.Hidden&&(this.height+=this.settings.notation.rhythmHeight*this.settings.display.scale,this.bottomPadding+=this.settings.notation.rhythmHeight*this.settings.display.scale)}doLayout(){if(super.doLayout(),this.settings.notation.rhythmMode!==_s.Hidden){this._hasTuplets=!1;for(let e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){if(this.isFirstOfLine){let e=(this.bar.staff.tuning.length-1)/2;this.addPreBeatGlyph(new P5(5*this.scale,this.getTabY(e)))}this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Fi(0,0,5*this.scale));const e=(this.bar.staff.tuning.length+1)/2-1;this.addPreBeatGlyph(new E5(0,this.getTabY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon))}createVoiceGlyphs(e){for(const t of e.beats){let r=new k5(t,this.getVoiceContainer(e));r.preNotes=new N5,r.onNotes=new T5,this.addBeatGlyph(r)}}paint(e,t,r){super.paint(e,t,r),this.settings.notation.rhythmMode!==_s.Hidden&&(this.paintBeams(e,t,r),this.paintTuplets(e,t,r))}drawBeamHelperAsFlags(e){return super.drawBeamHelperAsFlags(e)||this.settings.notation.rhythmMode===_s.ShowWithBeams}getFlagTopY(e){const t=this.getOnNotesGlyphForBeat(e);return!t.noteNumbers||e.duration===B.Half?this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this.tupletSize:t.noteNumbers.getNoteY(t.noteNumbers.minStringNote,j.Bottom)}getFlagBottomY(e){return this.getFlagAndBarPos()}getFlagStemSize(e){return 0}getBarLineStart(e,t){let r=this.getOnNotesGlyphForBeat(e);return!r.noteNumbers||e.duration===B.Half?this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this.tupletSize:r.noteNumbers.getNoteY(r.noteNumbers.minStringNote,j.Bottom)+this.lineOffset/2}getBeamDirection(e){return D.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(e,t,r){return this.getFlagAndBarPos()}shouldPaintFlag(e,t){return!super.shouldPaintFlag(e,t)||e.graceType!==K.None?!1:this.drawBeamHelperAsFlags(t)}paintBeamingStem(e,t,r,s,n,a){if(n<s){const h=n;n=s,s=h}a.lineWidth=ht.StemWidth*this.scale,a.beginPath();let o=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(e.displayStart)&&(o=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(e.displayStart).slots.slice(),o.sort((h,u)=>h.topY-u.topY));let l=n;for(;l>s;){a.moveTo(r,l);let h=s;if(o.length>0&&o[o.length-1].bottomY>h){const u=o.pop();h=t+u.bottomY,a.lineTo(r,h),l=t+u.topY}else{a.lineTo(r,h);break}}a.stroke(),a.lineWidth=this.scale}}no.StaffId="tab";no.TabLineSpacing=10;class Sf extends rd{get staffId(){return no.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(e,t,r){super(),this._showTimeSignature=e,this._showRests=t,this._showTiedNotes=r,this.hideOnPercussionTrack=!0}canCreate(e,t){return t.tuning.length>0&&super.canCreate(e,t)}create(e,t){let r=new no(e,t);return r.showRests=this._showRests,r.showTimeSignature=this._showTimeSignature,r.showTiedNotes=this._showTiedNotes,r}}class Rl extends Qr{constructor(){super(0,0)}doLayout(){super.doLayout();const e=this.renderer.resources.effectFont;this.height=e.size+Rl.Padding*this.scale}paint(e,t,r){let s=this.renderer.resources;r.font=s.effectFont;let n=r.textAlign;r.textAlign=Q.Center,r.fillText("T",e+this.x,t+this.y+r.font.size/2),r.textAlign=n,r.strokeCircle(e+this.x,t+this.y+r.font.size/2+(Rl.Padding-1)*this.scale,r.font.size/1.6)}}Rl.Padding=4;class Oh extends ua{get notationElement(){return te.EffectTap}get sizingMode(){return Be.SingleOnBeat}shouldCreateGlyphForNote(e){return e.isLeftHandTapped}createNewGlyph(e,t){return new Rl}}class $s{constructor(){this.noteRange=1,this.x=0,this.y=0}}var Vn;(function(i){i[i.None=0]="None",i[i.Rectangle=1]="Rectangle",i[i.Ellipse=2]="Ellipse",i[i.Circle=3]="Circle"})(Vn||(Vn={}));class vf extends $s{constructor(){super(...arguments),this.align=Q.Left,this.frame=Vn.None,this.text="",this.fontFace="",this.weight=0,this.height=0}}class pb extends $s{constructor(){super(...arguments),this.chord=new Sn}}class gb extends $s{}class mb extends $s{}class M5 extends $s{constructor(){super(...arguments),this.number=0}}class yb extends $s{constructor(){super(...arguments),this.decrescendo=!1}}class kf extends $s{constructor(){super(...arguments),this.allNumbers=!1,this.firstNumber=0,this.lastNumber=0}}class L5 extends $s{constructor(){super(...arguments),this.octave=1}}class R5 extends $s{}class F5{constructor(){this.defaultClef=ae.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0}}class I5{constructor(){this.from=0,this.to=0,this.curly=!1}}class O5{constructor(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null}}class ec{constructor(){this._trackChannel=0,this._beamingMode=Wr.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new Vs,this._voiceStates=new Map}parseXml(e,t){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;let r=new Xu;try{r.parse(e)}catch(s){throw new tt("Could not parse XML",s)}this.parseDom(r),this.consolidate(),this.score.finish(t)}consolidate(){let e=this.score.tempo;for(const t of this.score.tracks){const r=this._voiceCounts.get(t.index);for(const s of t.staves){for(;s.bars.length<this.score.masterBars.length;)this.addNewBar(s);for(const n of s.bars){for(;n.voices.length<r;)n.addVoice(new fs);for(const o of n.voices)if(o.beats.length===0){const l=new si;l.isEmpty=!0,o.addBeat(l)}const a=n.masterBar;a.tempoAutomation&&(a.tempoAutomation.value!==e?e=a.tempoAutomation.value:a.tempoAutomation=null)}}}ec.applyEffectRange(this._slurs,(t,r)=>{r.isLegatoOrigin=!0}),ec.applyEffectRange(this._crescendo,(t,r)=>{r.crescendo=t.decrescendo?Ii.Decrescendo:Ii.Crescendo})}static applyEffectRange(e,t){for(const[r,s]of e){const n=s.noteRange;let a=r;for(let o=0;o<n;o++)if(t(s,a),a.index+1<a.voice.beats.length)a=a.voice.beats[a.index+1];else if(a.voice.bar.index+1<a.voice.bar.staff.bars.length)a=a.voice.bar.staff.bars[a.voice.bar.index+1].voices[a.voice.index].beats[0];else break}}parseDom(e){let t=e.firstElement;if(!t)throw new tt("No valid XML");if(t.localName==="score"){this.score=new ha,this.score.tempo=120;for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"info":this.parseInfo(r);break;case"layout":this.parseLayout(r);break;case"gallery":this.parseGallery(r);break;case"pageObjects":this.parsePageObjects(r);break;case"systems":this.parseSystems(r);break}}else throw new tt('Root node of XML was not "score"')}parseLayout(e){for(let n of e.childNodes)if(n.nodeType===R.Element)switch(n.localName){case"staves":this.parseLayoutStaves(n);break;case"brackets":this.parseBrackets(n);break}const t=this._brackets.filter(n=>!!n.curly);t.sort((n,a)=>n.from-a.from);let r=0,s=null;for(let n=0;n<this._staffLayouts.length;n++){const a=this._staffLayouts[n];for(;r<t.length&&n>t[r].to;)r++;s&&r<t.length&&n>t[r].from&&n<=t[r].to?s.ensureStaveCount(s.staves.length+1):(s=new ds,s.ensureStaveCount(1),s.name=a.description,s.playbackInfo.volume=Math.floor(a.volume/128*16),s.playbackInfo.program=a.instrument,a.percussion?(s.playbackInfo.primaryChannel=9,s.playbackInfo.secondaryChannel=9):(s.playbackInfo.primaryChannel=this._trackChannel++,s.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(s));const o=s.staves[s.staves.length-1];o.isPercussion=a.percussion,o.transpositionPitch=a.transpose,o.displayTranspositionPitch=0,o.showTablature=!1,this._staffLookup.set(a.index,o)}}parseBrackets(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"bracket":this.parseBracket(t);break}}parseBracket(e){const t=new I5;t.from=parseInt(e.getAttribute("from")),t.to=parseInt(e.getAttribute("to")),e.attributes.has("curly")&&(t.curly=e.attributes.get("curly")==="true"),this._brackets.push(t)}parseLayoutStaves(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"staffLayout":this.parseStaffLayout(t);break}}parseStaffLayout(e){const t=new F5;t.description=e.getAttribute("description");for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"notation":r.attributes.has("defaultClef")&&(t.defaultClef=this.parseClef(r.attributes.get("defaultClef")));break;case"sound":r.attributes.has("percussion")&&(t.percussion=r.attributes.get("percussion")==="true"),r.attributes.has("instr")&&(t.instrument=parseInt(r.attributes.get("instr"))),r.attributes.has("volume")&&(t.volume=parseInt(r.attributes.get("volume"))),r.attributes.has("transpose")&&(t.transpose=parseInt(r.attributes.get("transpose")));break}this._staffLayoutLookup.set(t.description,t),t.index=this._staffLayouts.length,this._staffLayouts.push(t)}parseClef(e){switch(e){case"treble":return ae.G2;case"bass":return ae.F4;case"alto":return ae.C4;case"tenor":return ae.C4}return ae.G2}parseClefOttava(e){return e.endsWith("-")?Le._8vb:e.endsWith("+")?Le._8va:Le.Regular}parseSystems(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"system":this.parseSystem(t);break}}parseSystem(e){e.attributes.has("tempo")&&this.score.masterBars.length===0&&(this.score.tempo=parseInt(e.attributes.get("tempo"))),e.getAttribute("beamGrouping")==="0"&&(this._beamingMode=Wr.ForceSplitToNext);for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"staves":this.parseStaves(e,t);break}this._isFirstSystem=!1}parseStaves(e,t){let r=this.score.masterBars.length;for(let s of t.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"staff":this.parseStaff(e,r,s);break}}parseStaff(e,t,r){const s=r.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(s),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(r.getAttribute("defaultTime"));const n=this._staffLookup.get(this._currentStaffLayout.index);for(;n.bars.length<t;)this.addNewBar(n);for(let a of r.childNodes)if(a.nodeType===R.Element)switch(a.localName){case"voices":this.parseVoices(s,n,e,t,a);break}}parseTime(e){switch(e){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(e.indexOf("/")>0){const t=e.split("/");this._timeSignature.timeSignatureNumerator=parseInt(t[0]),this._timeSignature.timeSignatureDenominator=parseInt(t[1]),this._timeSignature.timeSignatureCommon=!1}break}}parseVoices(e,t,r,s,n){let a=0;for(let o of n.childNodes)if(o.nodeType===R.Element)switch(o.localName){case"voice":this.parseVoice(e,t,r,a,s,o),a++;break}}getOrCreateBar(e,t){return t<e.bars.length?e.bars[t]:this.addNewBar(e)}addNewBar(e){let t=new Gs;if(e.bars.length>0?(t.clef=e.bars[e.bars.length-1].clef,t.clefOttava=e.bars[e.bars.length-1].clefOttava):t.clef=this._currentStaffLayout.defaultClef,e.addBar(t),e.bars.length>this.score.masterBars.length){let r=new Vs;this.score.addMasterBar(r),r.index>0&&(r.keySignature=r.previousMasterBar.keySignature,r.keySignatureType=r.previousMasterBar.keySignatureType,r.tripletFeel=r.previousMasterBar.tripletFeel),r.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,r.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,r.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return t}newBar(e,t){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(e,t)}parseVoice(e,t,r,s,n,a){const o=e+"_"+s;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(o)?(this._currentVoiceState=this._voiceStates.get(o),this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this.ensureVoice(t,s)):(this._currentVoiceState=new O5,this._currentVoiceState.currentBarIndex=n-1,this._voiceStates.set(o,this._currentVoiceState),this.newBar(t,s)),a.attributes.has("stemDir"))switch(a.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=D.Up;break;case"down":this._currentVoiceState.voiceStemDir=D.Down;break;default:this._currentVoiceState.voiceStemDir=null;break}else this._currentVoiceState.voiceStemDir=null;const l=a.findChildElement("noteObjects");if(r.attributes.has("tempo")&&(this._currentBar.masterBar.tempoAutomation=new ii,this._currentBar.masterBar.tempoAutomation.isLinear=!0,this._currentBar.masterBar.tempoAutomation.type=Dt.Tempo,this._currentBar.masterBar.tempoAutomation.value=parseInt(r.attributes.get("tempo"))),l){for(let h of l.childNodes)if(h.nodeType===R.Element)switch(this._currentVoiceState.currentBarComplete&&h.localName!=="barline"&&this.newBar(t,s),h.localName){case"clefSign":this._currentBar.clef=this.parseClef(h.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(h.getAttribute("clef"));break;case"keySign":this._currentBar.masterBar.keySignature=parseInt(h.getAttribute("fifths"));break;case"timeSign":this.parseTime(h.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(h.getAttribute("type")){case"double":this._currentBar.masterBar.isDoubleBar=!0,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(h),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(t,s),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(h),this.newBar(t,s),this._currentBar.masterBar.isRepeatStart=!0;break;case"dashed":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break}break;case"chord":let u=new si;this.initFromPreviousBeat(u,this._currentVoice),u.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(u.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,u,h.findChildElement("duration")),u.updateDurations(),this._currentVoiceState.currentPosition+=u.playbackDuration,this._currentVoice.addBeat(u),this.parseChord(u,h),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const c=this.parseRestDurations(this._currentBar,h.findChildElement("duration"));c&&(this.initFromPreviousBeat(c,this._currentVoice),c.updateDurations(),this._currentVoiceState.currentPosition+=c.playbackDuration,this._currentVoice.addBeat(c),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0));break}}}initFromPreviousBeat(e,t){let r=this.getLastBeat(t);r&&(e.dynamics=r.dynamics)}getLastBeat(e){if(e.beats.length>0)return e.beats[e.beats.length-1];if(e.bar.index>0){const t=e.bar.staff.bars[e.bar.index-1];if(e.index<t.voices.length){const r=t.voices[e.index];return this.getLastBeat(r)}}return null}ensureVoice(e,t){for(;this._currentBar.voices.length<t+1;)this._currentBar.addVoice(new fs);(!this._voiceCounts.has(e.track.index)||this._voiceCounts.get(e.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(e.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[t]}parseChord(e,t){const r=new ct;for(let s of t.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"stem":switch(s.getAttribute("dir")){case"up":e.preferredBeamDirection=D.Up;break;case"down":e.preferredBeamDirection=D.Down;break}break;case"articulation":switch(s.getAttribute("type")){case"staccato":r.isStaccato=!0;break;case"normalAccent":r.accentuated=Et.Normal;break;case"strongAccent":r.accentuated=Et.Heavy;break}break;case"lyric":this.parseLyric(e,s);break;case"drawObjects":this.parseBeatDrawObject(e,s);break;case"heads":this.parseHeads(e,r,s);break;case"beam":switch(s.getAttribute("group")){case"force":e.beamingMode=Wr.ForceMergeWithNext;break;case"divide":e.beamingMode=Wr.ForceSplitToNext;break}break}}parseHeads(e,t,r){for(let s of r.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"head":this.parseHead(e,t,s);break}}parseHead(e,t,r){const s=new ct,n=$e.parseTuning(r.getAttribute("pitch"));s.octave=n.octave-1,s.tone=n.noteValue,s.isStaccato=t.isStaccato,s.accentuated=t.accentuated,e.addNote(s);for(let a of r.childNodes)if(a.nodeType===R.Element)switch(a.localName){case"alter":a.attributes.has("step")&&(s.tone+=parseInt(a.attributes.get("step")));break;case"tie":a.attributes.has("begin")?this._tieStartIds.has(s.id)||(this._tieStartIds.set(s.id,!0),this._tieStarts.push(s)):a.attributes.has("end")&&this._tieStarts.length>0&&!s.isTieDestination&&(s.isTieDestination=!0,s.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(s.id));break}}parseBeatDrawObject(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"drawObj":const s=this.parseDrawObj(r);if(s){if(s instanceof vf)s.fontFace.startsWith("capella")?s.text==="u"?(e.fermata=new Im,e.fermata.type=Yr.Medium):s.text==="f"?e.dynamics=pe.F:s.text==="j"&&(e.dynamics=pe.MF):this._isFirstSystem&&this.score.title===""&&s.align===Q.Center&&s.height>16&&s.weight>400?this.score.title=s.text:this._isFirstSystem&&this.score.artist===""&&s.align===Q.Center&&s.y<0?this.score.artist=s.text:this._isFirstSystem&&this.score.music===""&&s.align===Q.Right&&s.y<0?this.score.music=s.text:s.text.startsWith("by capella")||(e.text=s.text);else if(!(s instanceof pb))if(s instanceof mb)e.vibrato=Pe.Slight;else if(s instanceof yb)e.crescendo=s.decrescendo?Ii.Decrescendo:Ii.Crescendo,s.noteRange++,this._crescendo.set(e,s);else if(s instanceof gb){const n=s;this._slurs.set(e,n)}else s instanceof kf&&this.applyVolta(s)}break}}parseBarDrawObject(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"drawObj":const r=this.parseDrawObj(t);r&&r instanceof kf&&this.applyVolta(r);break}}applyVolta(e){if(e.lastNumber>0?(this._currentVoiceState.repeatCount=e.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):e.firstNumber>0&&(this._currentVoiceState.repeatCount=e.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),e.lastNumber>0&&e.firstNumber>0){let t=0;for(let r=e.firstNumber;r<=e.lastNumber;r++)t=t|1<<r-1;this._currentBar.masterBar.alternateEndings=t}else e.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<e.lastNumber-1:e.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<e.firstNumber-1)}parseLyric(e,t){for(let r of t.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"verse":e.lyrics||(e.lyrics=[]);let s=r.innerText;r.getAttribute("hyphen")==="true"&&(s+="-"),e.lyrics.push(s);break}}parseRestDurations(e,t){const r=t.getAttribute("base");if(r.indexOf("/")!==-1){let n=new si;return n.beamingMode=this._beamingMode,this.parseDuration(e,n,t),n}if(parseInt(r)===1){let n=new si;return n.beamingMode=this._beamingMode,n.duration=B.Whole,n}else return L.warning("Importer","Multi-Bar rests are not supported"),null}parseDurationValue(e){switch(e){case"2/1":return B.DoubleWhole;case"1/1":return B.Whole;case"1/2":return B.Half;case"1/4":return B.Quarter;case"1/8":return B.Eighth;case"1/16":return B.Sixteenth;case"1/32":return B.ThirtySecond;case"1/64":return B.SixtyFourth;case"1/128":return B.OneHundredTwentyEighth;default:return L.warning("Importer","Unsupported duration"),B.Quarter}}parseDuration(e,t,r){const s=r.getAttribute("base");t.duration=this.parseDurationValue(s),r.attributes.has("dots")&&(t.dots=parseInt(r.attributes.get("dots")));const n=r.findChildElement("tuplet");if(n){t.tupletNumerator=parseInt(n.getAttribute("count"));const a=n.getAttribute("tripartite")==="true"?3:1,o=n.getAttribute("prolong")==="true"?0:1;let l=0;for(;a*Math.pow(2,l+o)<t.tupletNumerator;)l++;t.tupletDenominator=a*Math.pow(2,l)}}parsePageObjects(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"drawObj":const r=this.parseDrawObj(t);if(r&&r instanceof vf)switch(r.align){case Q.Center:this.score.title?this.score.subTitle||(this.score.subTitle=t.innerText):this.score.title=t.innerText;break;case Q.Right:this.score.artist||(this.score.artist=t.innerText);break}break}}parseGallery(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"drawObj":const r=this.parseDrawObj(t);r&&this._galleryObjects.set(t.getAttribute("name"),r);break}}parseDrawObj(e){let t=null,r=1;for(let s of e.childNodes)if(s.nodeType===R.Element)switch(s.localName){case"text":t=this.parseText(s);break;case"guitar":t=this.parseGuitar(s);break;case"slur":t=this.parseSlur(s);break;case"wavyLine":t=this.parseWavyLine(s);break;case"bracket":t=this.parseTupletBracket(s);break;case"wedge":t=this.parseWedge(s);break;case"volta":t=this.parseVolta(s);break;case"octaveClef":t=this.parseOctaveClef(s);break;case"trill":t=this.parseTrill(s);break;case"basic":s.attributes.has("noteRange")&&(r=parseInt(s.attributes.get("noteRange")));break}return t&&(t.noteRange=r),t}parseTrill(e){return new R5}parseOctaveClef(e){const t=new L5;return e.attributes.has("octave")&&(t.octave=parseInt(e.attributes.get("octave"))),t}parseVolta(e){const t=new kf;return t.allNumbers=e.attributes.get("allNumbers")==="true",e.attributes.has("firstNumber")&&(t.firstNumber=parseInt(e.attributes.get("firstNumber"))),e.attributes.has("lastNumber")&&(t.lastNumber=parseInt(e.attributes.get("lastNumber"))),t}parseWedge(e){const t=new yb;return t.decrescendo=e.attributes.get("decrescendo")==="true",t}parseTupletBracket(e){const t=new M5;return e.attributes.has("number")&&(t.number=parseInt(e.attributes.get("number"))),t}parseWavyLine(e){return new mb}parseSlur(e){return new gb}parseGuitar(e){const t=new pb,r=e.innerText.trim();for(let s=0;s<r.length;s++)r.charAt(s)==="/"?t.chord.strings.push(0):t.chord.strings.push(parseInt(r.charAt(s)));return t}parseText(e){const t=new vf;switch(e.attributes.has("x")&&(t.x=parseFloat(e.attributes.get("x"))),e.attributes.has("x")&&(t.y=parseFloat(e.attributes.get("y"))),e.getAttribute("align")){case"left":t.align=Q.Left;break;case"center":t.align=Q.Center;break;case"right":t.align=Q.Right;break}switch(e.getAttribute("frame")){case"rectangle":t.frame=Vn.Rectangle;break;case"ellipse":t.frame=Vn.Ellipse;break;case"circle":t.frame=Vn.Circle;break;case"none":t.frame=Vn.None;break}if(e.firstElement){for(let r of e.childNodes)if(r.nodeType===R.Element)switch(r.localName){case"font":t.fontFace=r.getAttribute("face"),r.attributes.has("weight")&&(t.weight=parseInt(r.attributes.get("weight"))),r.attributes.has("height")&&(t.height=parseInt(r.attributes.get("height")));break;case"content":t.text=r.innerText;break}}else t.text=e.innerText;return t}parseInfo(e){for(let t of e.childNodes)if(t.nodeType===R.Element)switch(t.localName){case"author":this.score.tab=t.firstChild.innerText;break;case"comment":this.score.notices=t.firstChild.innerText;break}}}class D5 extends co{get name(){return"Capella"}constructor(){super()}readScore(){L.debug(this.name,"Loading ZIP entries");let e=new Am(this.data),t,r=null;if(t=e.read(),L.debug(this.name,"Zip entries loaded"),t.length>0)for(let s of t)switch(s.fileName){case"score.xml":r=E.toString(s.data,this.settings.importer.encoding);break}else this.data.reset(),r=E.toString(this.data.readAll(),this.settings.importer.encoding);if(!r)throw new tt("No valid capella file");L.debug(this.name,"Start Parsing score.xml");try{let s=new ec;return s.parseXml(r,this.settings),L.debug(this.name,"score.xml parsed"),s.score}catch(s){throw new tt("Failed to parse CapXML",s)}}}class A5{constructor(e){this._targets=new Set,this._callback=e,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}observe(e){this._targets.add(e)}unobserve(e){this._targets.delete(e)}disconnect(){this._targets.clear()}onWindowResize(){const e=[];for(const t of this._targets)e.push({target:t,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(e,this)}}class V5{constructor(e){this._elements=[];let t=null;const r=this._check.bind(this);this._check=()=>{t||(t=setTimeout(()=>{r(),t=null},100))},this._callback=e,window.addEventListener("resize",this._check,!0),document.addEventListener("scroll",this._check,!0)}observe(e){this._elements.indexOf(e)>=0||(this._elements.push(e),this._check())}unobserve(e){this._elements=this._elements.filter(t=>t!=e)}_check(){const e=[];this._elements.forEach(t=>{const r=t.getBoundingClientRect();r.top+r.height>=0&&r.top<=window.innerHeight&&r.left+r.width>=0&&r.left<=window.innerWidth&&e.push({target:t,isIntersecting:!0})}),e.length&&this._callback(e,this)}}function bb(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose]}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(n){return Promise.reject(n)}}),i.stack.push({value:e,dispose:r,async:t})}return e}var H5=typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=i,r.suppressed=e,r};function wb(i){function e(r){i.error=i.hasError?new H5(r,i.error,"An error was suppressed during disposal."):r,i.hasError=!0}function t(){for(;i.stack.length;){var r=i.stack.pop();try{var s=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(s).then(t,function(n){return e(n),t()})}catch(n){e(n)}}if(i.hasError)throw i.error}return t()}class Ue{static enable(e,t){Ue.alphaSkia=t,Ue.initializeMusicFont(Ue.alphaSkia.AlphaSkiaTypeface.register(e))}static initializeMusicFont(e){Ue.musicFont=e}static registerFont(e,t){const r=Ue.alphaSkia.AlphaSkiaTypeface.register(e.buffer);t||(t=Ce.withFamilyList([r.familyName],12,r.isItalic?lt.Italic:lt.Plain,r.isBold?Yi.Bold:Yi.Regular));for(const s of t.families)this.customTypeFaces.set(Ue.customTypefaceKey(s,t.isBold,t.isItalic),r);return t}static customTypefaceKey(e,t,r){return e.toLowerCase()+"_"+t+"_"+r}getTypeFace(){if(this._typeFaceCache!=this.font.toCssString(this.settings.display.scale)){if(this._typeFaceIsSystem){const t={stack:[],error:void 0,hasError:!1};try{const r=bb(t,this._typeFace,!1)}catch(r){t.error=r,t.hasError=!0}finally{wb(t)}}for(const t of this.font.families){var e=Ue.customTypefaceKey(t,this.font.isBold,this.font.isItalic);Ue.customTypeFaces.has(e)?(this._typeFaceIsSystem=!1,this._typeFace=Ue.customTypeFaces.get(e)):(this._typeFaceIsSystem=!0,this._typeFace=Ue.alphaSkia.AlphaSkiaTypeface.create(t,this.font.isBold,this.font.isItalic))}this._typeFaceCache=this.font.toCssString(this.settings.display.scale)}return this._typeFace}constructor(){this._color=new Oe(0,0,0,0),this._lineWidth=0,this._typeFaceCache="",this._typeFaceIsSystem=!1,this._typeFace=null,this.font=new Ce("Arial",10,lt.Plain),this.textAlign=Q.Left,this.textBaseline=le.Top,this._canvas=new Ue.alphaSkia.AlphaSkiaCanvas,this.color=new Oe(0,0,0,255)}destroy(){const e={stack:[],error:void 0,hasError:!1};try{const t=bb(e,this._canvas,!1)}catch(t){e.error=t,e.hasError=!0}finally{wb(e)}}onRenderFinished(){return null}beginRender(e,t){this._canvas.beginRender(e,t,A.HighDpiFactor)}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._canvas.color=Ue.alphaSkia.AlphaSkiaCanvas.rgbaToColor(e.r,e.g,e.b,e.a))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._canvas.lineWidth=e}fillRect(e,t,r,s){r>0&&this._canvas.fillRect(e|0,t|0,r,s)}strokeRect(e,t,r,s){this._canvas.strokeRect(e|0,t|0,r,s)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(e,t){this._canvas.moveTo(e,t)}lineTo(e,t){this._canvas.lineTo(e,t)}quadraticCurveTo(e,t,r,s){this._canvas.quadraticCurveTo(e,t,r,s)}bezierCurveTo(e,t,r,s,n,a){this._canvas.bezierCurveTo(e,t,r,s,n,a)}fillCircle(e,t,r){this._canvas.fillCircle(e,t,r)}strokeCircle(e,t,r){this._canvas.strokeCircle(e,t,r)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}beginGroup(e){}endGroup(){}fillText(e,t,r){if(e.length==0)return;let s=Ue.alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case Q.Left:s=Ue.alphaSkia.AlphaSkiaTextAlign.Left;break;case Q.Center:s=Ue.alphaSkia.AlphaSkiaTextAlign.Center;break;case Q.Right:s=Ue.alphaSkia.AlphaSkiaTextAlign.Right;break}let n=Ue.alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case le.Top:n=Ue.alphaSkia.AlphaSkiaTextBaseline.Top;break;case le.Middle:n=Ue.alphaSkia.AlphaSkiaTextBaseline.Middle;break;case le.Bottom:n=Ue.alphaSkia.AlphaSkiaTextBaseline.Bottom;break}this._canvas.fillText(e,this.getTypeFace(),this.font.size*this.settings.display.scale,t,r,s,n)}measureText(e){return new Jc(this._canvas.measureText(e,this.getTypeFace(),this.font.size*this.settings.display.scale),this.font.size*Ue.FontSizeToLineHeight)}fillMusicFontSymbol(e,t,r,s,n){s!==g.None&&this.fillMusicFontSymbolText(e,t,r,String.fromCharCode(s),n)}fillMusicFontSymbols(e,t,r,s,n){let a="";for(let o of s)o!==g.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,r,a,n)}fillMusicFontSymbolText(e,t,r,s,n){this._canvas.fillText(s,Ue.musicFont,A.MusicFontSize*this.settings.display.scale*r,e,t,n?Ue.alphaSkia.AlphaSkiaTextAlign.Center:Ue.alphaSkia.AlphaSkiaTextAlign.Left,Ue.alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(e,t,r){this._canvas.beginRotate(e,t,r)}endRotate(){this._canvas.endRotate()}}Ue.musicFont=null;Ue.customTypeFaces=new Map;Ue.FontSizeToLineHeight=1.2;class Xi extends ft{constructor(e,t,r,s){super(e,t,s?ue.GraceScale:1,Xi.getSymbol(r)),this._isGrace=s,this._duration=r}paint(e,t,r){let s=this._isGrace?this.scale:0;r.fillMusicFontSymbol(e+this.x,t+this.y+s,this.glyphScale*this.scale,this.symbol,!1)}doLayout(){const e=(this._isGrace?ue.GraceScale:1)*this.scale;switch(this._duration){case B.QuadrupleWhole:case B.DoubleWhole:case B.Whole:this.width=Xi.WholeNoteHeadWidth*e;break;case B.Half:this.width=Xi.HalfNoteHeadWidth*e;break;default:this.width=Xi.QuarterNoteHeadWidth*e;break}this.height=Xi.NoteHeadHeight*e}static getSymbol(e){switch(e){case B.QuadrupleWhole:case B.DoubleWhole:case B.Whole:return g.NoteheadSlashWhiteWhole;case B.Half:return g.NoteheadSlashWhiteHalf;default:return g.NoteheadSlashVerticalEnds}}}Xi.NoteHeadHeight=17;Xi.QuarterNoteHeadWidth=12;Xi.HalfNoteHeadWidth=25;Xi.WholeNoteHeadWidth=32;class Sb extends It{constructor(e,t,r=!1){super(e.beat,t.beat,r),this.startNote=e,this.endNote=t}getTieHeight(e,t,r,s){return this.startNote===this.endNote?15:super.getTieHeight(e,t,r,s)}getBeamDirection(e,t){return D.Down}static getBeamDirectionForNote(e){return D.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,j.Center)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,et.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,et.Left)}}class W5 extends Nr{constructor(e,t){super(e,t),this._tiedNoteTie=null}createTies(e){if(e.isVisible){if(!this._tiedNoteTie&&e.isTieOrigin&&e.tieDestination.isVisible){let t=new Sb(e,e.tieDestination,!1);this._tiedNoteTie=t,this.addTie(t)}if(!this._tiedNoteTie&&e.isTieDestination){let t=new Sb(e.tieOrigin,e,!0);this._tiedNoteTie=t,this.addTie(t)}}}}class z5 extends sa{constructor(e,t,r){super(e,t,r)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class G5 extends ql{constructor(){super(...arguments),this.noteHeads=null,this.restGlyph=null}getNoteX(e,t){if(this.noteHeads){let r=this.noteHeads.x;switch(t){case et.Left:break;case et.Center:r+=this.noteHeads.width/2;break;case et.Right:r+=this.noteHeads.width;break}return r}return 0}buildBoundingsLookup(e,t,r){if(this.noteHeads&&this.container.beat.notes.length>0){const s=new td;s.note=this.container.beat.notes[0],s.noteHeadBounds=new Ti,s.noteHeadBounds.x=t+this.x+this.noteHeads.x,s.noteHeadBounds.y=r+this.y+this.noteHeads.y-this.noteHeads.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,e.addNote(s)}}getNoteY(e,t){if(this.noteHeads){let r=this.y+this.noteHeads.y;switch(t){case j.Top:case j.TopWithStem:r-=this.noteHeads.height/2+2*this.scale;break;case j.Center:break;case j.Bottom:case j.BottomWithStem:r+=this.noteHeads.height/2;break}return r}return 0}updateBeamingHelper(){this.noteHeads?this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.container.beat,this.container.x+this.x+this.noteHeads.x+this.noteHeads.width,this.container.x+this.x+this.noteHeads.x+this.noteHeads.width):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){let e=this.renderer;const t=e.getNoteLine(),r=e.getLineY(t);if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const s=new z5(0,r,this.container.beat.duration);this.restGlyph=s,s.beat=this.container.beat,s.beamingHelper=this.beamingHelper,this.addGlyph(s),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const s=this.container.beat.graceType!==K.None,n=new Xi(0,r,this.container.beat.duration,s);this.noteHeads=n,this.addGlyph(n)}if(this.container.beat.dots>0){this.addGlyph(new Fi(0,0,5*this.scale));for(let s=0;s<this.container.beat.dots;s++)this.addGlyph(new Ku(0,e.getLineY(e.getNoteLine())-e.getLineHeight(.5),1.5*this.scale))}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2}}class Qp extends so{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0}get lineSpacing(){return ht.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(e,t,r){super.paint(e,t,r),this.paintBeams(e,t,r),this.paintTuplets(e,t,r)}doLayout(){super.doLayout();let e=!1;for(let t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}e&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(e){return this.getLineY(0)-Xi.NoteHeadHeight/2*this.scale}getFlagBottomY(e){return this.getLineY(0)-Xi.NoteHeadHeight/2*this.scale}getBeamDirection(e){return D.Up}getNoteY(e,t){let r=super.getNoteY(e,t);return isNaN(r)&&(r=this.getLineY(0)),r}calculateBeamYWithDirection(e,t,r){return this.getLineY(0)-this.getFlagStemSize(e.shortestDuration)}getBarLineStart(e,t){return this.getLineY(0)-Xi.NoteHeadHeight/2*this.scale}createLinePreBeatGlyphs(){}createVoiceGlyphs(e){for(const t of e.beats){let r=new W5(t,this.getVoiceContainer(e));r.preNotes=new jl,r.onNotes=e.index==0?new G5:new ql,this.addBeatGlyph(r)}}paintBeamingStem(e,t,r,s,n,a){a.lineWidth=ht.StemWidth*this.scale,a.beginPath(),a.moveTo(r,s),a.lineTo(r,n),a.stroke(),a.lineWidth=this.scale}}Qp.StaffId="slash";class Dh extends rd{get staffId(){return Qp.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new Qp(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showSlash}constructor(){super()}}class vb{constructor(e,t){this.vertical=e,this.createLayout=t}}class xf{constructor(e,t){this.supportsWorkers=e,this.createCanvas=t}}class A{static createStyleElement(e,t){let r=e.getElementById("alphaTabStyle");if(!r){if(!t){L.error("AlphaTab","Font directory could not be detected, cannot create style element");return}r=e.createElement("style"),r.id="alphaTabStyle";let s=`
            @font-face {
                font-family: 'alphaTab';
                 src: url('${t}Bravura.eot');
                 src: url('${t}Bravura.eot?#iefix') format('embedded-opentype')
                      , url('${t}Bravura.woff') format('woff')
                      , url('${t}Bravura.otf') format('opentype')
                      , url('${t}Bravura.svg#Bravura') format('svg');
                 font-weight: normal;
                 font-style: normal;
            }
            .at-surface * {
                cursor: default;
                vertical-align: top;
                overflow: visible;
            }
            .at-surface-svg text {
                dominant-baseline: central;
            }
            .at {
                 font-family: 'alphaTab';
                 speak: none;
                 font-style: normal;
                 font-weight: normal;
                 font-variant: normal;
                 text-transform: none;
                 line-height: 1;
                 line-height: 1;
                 -webkit-font-smoothing: antialiased;
                 -moz-osx-font-smoothing: grayscale;
                 font-size: ${A.MusicFontSize}px;
                 overflow: visible !important;
            }`;r.innerHTML=s,e.getElementsByTagName("head").item(0).appendChild(r),A.bravuraFontChecker.checkForFontAvailability()}}static get globalThis(){if(A._globalThis===void 0){try{A._globalThis=globalThis}catch{}typeof A._globalThis>"u"&&(A._globalThis=self),typeof A._globalThis>"u"&&(A._globalThis=global),typeof A._globalThis>"u"&&(A._globalThis=window),typeof A._globalThis>"u"&&(A._globalThis=Function("return this")())}return this._globalThis}static get isRunningInWorker(){return"WorkerGlobalScope"in A.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in A.globalThis}static throttle(e,t){let r=0;return()=>{A.globalThis.clearTimeout(r),r=A.globalThis.setTimeout(e,t)}}static detectScriptFile(){if(!A.isRunningInWorker&&A.globalThis.ALPHATAB_ROOT){let e=A.globalThis.ALPHATAB_ROOT;return e=A.ensureFullUrl(e),e=A.appendScriptName(e),e}try{const e=import.meta.url;if(e&&e.indexOf("file://")===-1)return e}catch{}return"document"in A.globalThis&&document.currentScript?document.currentScript.src:null}static ensureFullUrl(e){var t,r,s;if(!e)return"";if(!e.startsWith("http")&&!e.startsWith("https")&&!e.startsWith("file")){let n="",a=A.globalThis.location;if(n+=(t=a.protocol)==null?void 0:t.toString(),n+="//",a.hostname&&(n+=(r=a.hostname)==null?void 0:r.toString()),a.port&&(n+=":",n+=(s=a.port)==null?void 0:s.toString()),!e.startsWith("/")){let o=a.pathname.split("/").slice(0,-1).join("/");o.length>0&&(o.startsWith("/")||(n+="/"),n+=o==null?void 0:o.toString())}return e.startsWith("/")||(n+="/"),n+=e==null?void 0:e.toString(),n}return e}static appendScriptName(e){return e&&!e.endsWith(".js")&&(e.endsWith("/")||(e+="/"),e+="alphaTab.js"),e}static detectFontDirectory(){if(!A.isRunningInWorker&&A.globalThis.ALPHATAB_FONT)return A.ensureFullUrl(A.globalThis.ALPHATAB_FONT);const e=A.scriptFile;if(e){let t=e.lastIndexOf("/");if(t>=0)return e.substr(0,t)+"/font/"}return null}static registerJQueryPlugin(){if(!A.isRunningInWorker&&A.globalThis&&"jQuery"in A.globalThis){let e=A.globalThis.jQuery,t=new Z1;e.fn.alphaTab=function(r){const s=Array.prototype.slice.call(arguments,1);return this.length===1?t.exec(this[0],r,s):this.each((n,a)=>{t.exec(a,r,s)})},e.alphaTab={restore:Z1.restore},e.fn.alphaTab.fn=t}}static getRenderEngineFactory(e){return!e||!A.renderEngines.has(e)?A.renderEngines.get("default"):A.renderEngines.get(e)}static getLayoutEngineFactory(e){return!e||!A.layoutEngines.has(e)?A.layoutEngines.get(Es.Page):A.layoutEngines.get(e)}static buildImporters(){return[new rs,new r4,new t4,new s4,new D5,new li]}static createDefaultRenderEngines(){const e=new Map;return e.set("svg",new xf(!0,()=>new E4)),e.set("default",e.get("svg")),e.set("skia",new xf(!1,()=>new Ue)),A.createPlatformSpecificRenderEngines(e),e}static enableAlphaSkia(e,t){Ue.enable(e,t)}static registerAlphaSkiaCustomFont(e,t){return Ue.registerFont(e,t)}static createPlatformSpecificRenderEngines(e){e.set("html5",new xf(!1,()=>new m4))}static createDefaultStaveProfiles(){const e=new Map;e.set(Ui.ScoreTab,[new Jr("top-effects",[new yf,new wf,new ff,new bf,new hf]),new Dh,new Jr("score-effects",[new cf,new ob,new Lh,new Ph(!0),new Rh,new Eh,new Fh,new Mh,new Oh,new lf]),new db,new Jr("tab-effects",[new rb,new Ph(!1),new sb,new Nh,new Lh,new Rh,new Eh,new Fh,new Mh,new ab,new uf,new ir(q.Natural),new ir(q.Artificial),new ir(q.Pinch),new ir(q.Tap),new ir(q.Semi),new ir(q.Feedback),new df,new ib,new nb,new pf,new mf,new gf,new Oh]),new Sf(!1,!1,!1)]),e.set(Ui.Score,[new Jr("top-effects",[new yf,new wf,new ff,new bf,new hf]),new Dh,new Jr("score-effects",[new cf,new ob,new Lh,new Ph(!0),new Rh,new Eh,new Fh,new Mh,new uf,new df,new pf,new mf,new gf,new Oh,new lf]),new db,new Jr("score-bottom-effects",[new rb,new Ph(!1),new sb,new Nh])]);let t=[new yf,new wf,new ff,new bf,new hf,new cf,new Lh,new Rh,new Eh,new Fh,new Mh,new ab,new uf,new ir(q.Artificial),new ir(q.Pinch),new ir(q.Tap),new ir(q.Semi),new ir(q.Feedback),new df,new ib,new nb,new pf,new mf,new gf,new Oh,new lf];return e.set(Ui.Tab,[new Dh,new Jr("tab-effects",t),new Sf(!0,!0,!0),new Jr("tab-bottom-effects",[new Nh])]),e.set(Ui.TabMixed,[new Dh,new Jr("tab-effects",t),new Sf(!1,!1,!1),new Jr("tab-bottom-effects",[new Nh])]),e}static createDefaultLayoutEngines(){const e=new Map;return e.set(Es.Page,new vb(!0,t=>new t5(t))),e.set(Es.Horizontal,new vb(!1,t=>new e5(t))),e}static initializeMain(e,t){A.isRunningInWorker||A.isRunningInAudioWorklet||((A.webPlatform===$i.Browser||A.webPlatform===$i.BrowserModule)&&(A.registerJQueryPlugin(),A.HighDpiFactor=window.devicePixelRatio,"ResizeObserver"in A.globalThis||(A.globalThis.ResizeObserver=A5),"IntersectionObserver"in A.globalThis||(A.globalThis.IntersectionObserver=V5),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...r){this.innerHTML="",this.append(...r)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(r,s){return this.replace(new RegExp(r,"g"),s)})),A.createWebWorker=e,A.createAudioWorklet=t)}static get alphaTabWorker(){return this.globalThis.Worker}static initializeWorker(){if(!A.isRunningInWorker)throw new Yt(Ut.General,"Not running in worker, cannot run worker initialization");Um.init(),Gm.init(),A.createWebWorker=e=>{throw new Yt(Ut.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!A.isRunningInAudioWorklet)throw new Yt(Ut.General,"Not running in audio worklet, cannot run worklet initialization");Nl.init()}static detectWebPack(){try{if(typeof __webpack_require__=="function")return!0}catch{}return!1}static detectVite(){try{if(typeof __BASE__=="string")return!0}catch{}return!1}static detectWebPlatform(){try{if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return $i.NodeJs}catch{}try{const e=import.meta.url;if(e&&typeof e=="string"&&!e.startsWith("file://"))return $i.BrowserModule}catch{}return $i.Browser}}A.MusicFontSize=34;A.HighDpiFactor=1;A._globalThis=void 0;A.webPlatform=A.detectWebPlatform();A.isWebPackBundled=A.detectWebPack();A.isViteBundled=A.detectVite();A.scriptFile=A.detectScriptFile();A.fontDirectory=A.detectFontDirectory();A.bravuraFontChecker=new Ux(["alphaTab"]);A.renderEngines=A.createDefaultRenderEngines();A.layoutEngines=A.createDefaultLayoutEngines();A.staveProfiles=A.createDefaultStaveProfiles();class Zx{constructor(){this.scriptFile=null,this.fontDirectory=null,this.file=null,this.tex=!1,this.tracks=null,this.enableLazyLoading=!0,this.engine="default",this.logLevel=Hr.Info,this.useWorkers=!0,this.includeNoteBounds=!1,this.scriptFile=A.scriptFile,this.fontDirectory=A.fontDirectory}}var F;(function(i){i[i.SteelGuitar=1]="SteelGuitar",i[i.AcousticGuitar=2]="AcousticGuitar",i[i.TwelveStringGuitar=3]="TwelveStringGuitar",i[i.ElectricGuitar=4]="ElectricGuitar",i[i.Bass=5]="Bass",i[i.ClassicalGuitar=23]="ClassicalGuitar",i[i.UprightBass=6]="UprightBass",i[i.Ukulele=7]="Ukulele",i[i.Banjo=8]="Banjo",i[i.Mandolin=9]="Mandolin",i[i.Piano=10]="Piano",i[i.Synth=12]="Synth",i[i.Strings=11]="Strings",i[i.Brass=13]="Brass",i[i.Reed=14]="Reed",i[i.Woodwind=15]="Woodwind",i[i.Vocal=16]="Vocal",i[i.PitchedIdiophone=17]="PitchedIdiophone",i[i.Fx=21]="Fx",i[i.PercussionKit=18]="PercussionKit",i[i.Idiophone=19]="Idiophone",i[i.Membraphone=20]="Membraphone"})(F||(F={}));class I{constructor(e,t,r=null){if(this.icon=F.Piano,this.icon=e,this.instrumentSetName=t,r)this.instrumentSetType=r;else{const s=t.split(" ");s[0]=s[0].substr(0,1).toLowerCase()+s[0].substr(1),this.instrumentSetType=s.join("")}}}new I(F.Piano,"Acoustic Piano"),new I(F.Piano,"Acoustic Piano"),new I(F.Piano,"Electric Piano"),new I(F.Piano,"Acoustic Piano"),new I(F.Piano,"Electric Piano"),new I(F.Piano,"Electric Piano"),new I(F.Piano,"Harpsichord"),new I(F.Piano,"Harpsichord"),new I(F.PitchedIdiophone,"Celesta"),new I(F.PitchedIdiophone,"Vibraphone"),new I(F.PitchedIdiophone,"Vibraphone"),new I(F.PitchedIdiophone,"Vibraphone"),new I(F.PitchedIdiophone,"Xylophone"),new I(F.PitchedIdiophone,"Xylophone"),new I(F.PitchedIdiophone,"Vibraphone"),new I(F.Banjo,"Banjo"),new I(F.Piano,"Electric Organ"),new I(F.Piano,"Electric Organ"),new I(F.Piano,"Electric Organ"),new I(F.Piano,"Electric Organ"),new I(F.Piano,"Electric Organ"),new I(F.Piano,"Electric Organ"),new I(F.Woodwind,"Recorder"),new I(F.Piano,"Electric Organ"),new I(F.ClassicalGuitar,"Nylon Guitar"),new I(F.SteelGuitar,"Steel Guitar"),new I(F.SteelGuitar,"Electric Guitar"),new I(F.ElectricGuitar,"Electric Guitar"),new I(F.ElectricGuitar,"Electric Guitar"),new I(F.ElectricGuitar,"Electric Guitar"),new I(F.SteelGuitar,"Electric Guitar"),new I(F.SteelGuitar,"Electric Guitar"),new I(F.Bass,"Acoustic Bass"),new I(F.Bass,"Electric Bass"),new I(F.Bass,"Electric Bass"),new I(F.Bass,"Acoustic Bass"),new I(F.Bass,"Electric Bass"),new I(F.Bass,"Electric Bass"),new I(F.Synth,"Synth Bass"),new I(F.Synth,"Synth Bass"),new I(F.Strings,"Violin"),new I(F.Strings,"Viola"),new I(F.Strings,"Cello"),new I(F.Strings,"Contrabass"),new I(F.Strings,"Violin"),new I(F.Strings,"Violin"),new I(F.Piano,"Harp"),new I(F.Membraphone,"Timpani"),new I(F.Strings,"Violin"),new I(F.Strings,"Violin"),new I(F.Strings,"Violin"),new I(F.Strings,"Violin"),new I(F.Vocal,"Voice"),new I(F.Vocal,"Voice"),new I(F.Vocal,"Voice"),new I(F.Synth,"Pad Synthesizer"),new I(F.Brass,"Trumpet"),new I(F.Brass,"Trombone"),new I(F.Brass,"Tuba"),new I(F.Brass,"Trumpet"),new I(F.Brass,"French Horn"),new I(F.Brass,"Trumpet"),new I(F.Brass,"Trumpet"),new I(F.Brass,"Trumpet"),new I(F.Reed,"Saxophone"),new I(F.Reed,"Saxophone"),new I(F.Reed,"Saxophone"),new I(F.Reed,"Saxophone"),new I(F.Reed,"Oboe"),new I(F.Reed,"English Horn"),new I(F.Reed,"Bassoon"),new I(F.Reed,"Clarinet"),new I(F.Reed,"Piccolo"),new I(F.Woodwind,"Flute"),new I(F.Woodwind,"Recorder"),new I(F.Woodwind,"Flute"),new I(F.Woodwind,"Recorder"),new I(F.Woodwind,"Flute"),new I(F.Woodwind,"Recorder"),new I(F.Woodwind,"Flute"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Lead Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Synth,"Pad Synthesizer"),new I(F.Fx,"Pad Synthesizer"),new I(F.Fx,"Pad Synthesizer"),new I(F.Fx,"Pad Synthesizer"),new I(F.Fx,"Pad Synthesizer"),new I(F.Fx,"Lead Synthesizer"),new I(F.Fx,"Lead Synthesizer"),new I(F.Fx,"Lead Synthesizer"),new I(F.Fx,"Trumpet"),new I(F.ElectricGuitar,"Banjo"),new I(F.Banjo,"Banjo"),new I(F.Ukulele,"Ukulele"),new I(F.Banjo,"Banjo"),new I(F.PitchedIdiophone,"Xylophone"),new I(F.Reed,"Bassoon"),new I(F.Strings,"Violin"),new I(F.Woodwind,"Flute"),new I(F.PitchedIdiophone,"Xylophone"),new I(F.Idiophone,"Celesta"),new I(F.PitchedIdiophone,"Vibraphone"),new I(F.Idiophone,"Xylophone"),new I(F.Membraphone,"Xylophone"),new I(F.Membraphone,"Xylophone"),new I(F.Membraphone,"Xylophone"),new I(F.Idiophone,"Celesta"),new I(F.Fx,"Steel Guitar"),new I(F.Fx,"Recorder"),new I(F.Fx,"Recorder"),new I(F.Fx,"Recorder"),new I(F.Fx,"Recorder"),new I(F.Fx,"Recorder"),new I(F.Fx,"Recorder"),new I(F.Fx,"Timpani");new I(F.PercussionKit,"Drums","drumKit");class Yn{static buildCrc32Lookup(){const t=new Uint32Array(256);for(let r=0;r<t.length;r++){let s=r;for(let n=0;n<8;n++)s=(s&1)===1?s>>>1^3988292384:s>>>1;t[r]=s}return t}get value(){return~this._checkValue}constructor(){this._checkValue=Yn.CrcInit,this.reset()}update(e,t,r){for(let s=0;s<r;s++)this._checkValue=Yn.Crc32Lookup[(this._checkValue^e[t+s])&255]^this._checkValue>>>8}reset(){this._checkValue=Yn.CrcInit}}Yn.Crc32Lookup=Yn.buildCrc32Lookup();Yn.CrcInit=4294967295;class ut{}ut.MAX_WBITS=15;ut.WSIZE=1<<ut.MAX_WBITS;ut.WMASK=ut.WSIZE-1;ut.MIN_MATCH=3;ut.MAX_MATCH=258;ut.DEFAULT_MEM_LEVEL=8;ut.PENDING_BUF_SIZE=1<<ut.DEFAULT_MEM_LEVEL+8;ut.HASH_BITS=ut.DEFAULT_MEM_LEVEL+7;ut.HASH_SIZE=1<<ut.HASH_BITS;ut.HASH_SHIFT=(ut.HASH_BITS+ut.MIN_MATCH-1)/ut.MIN_MATCH;ut.HASH_MASK=ut.HASH_SIZE-1;ut.MIN_LOOKAHEAD=ut.MAX_MATCH+ut.MIN_MATCH+1;ut.MAX_DIST=ut.WSIZE-ut.MIN_LOOKAHEAD;class ar{constructor(e,t,r,s){this.length=null,this.numCodes=0,this.codes=null,this.huffman=e,this.minNumCodes=r,this.maxLength=s,this.freqs=new Int16Array(t),this.bitLengthCounts=new Int32Array(s)}reset(){for(let e=0;e<this.freqs.length;e++)this.freqs[e]=0;this.codes=null,this.length=null}buildTree(){let e=this.freqs.length,t=new Int32Array(e),r=0,s=0;for(let h=0;h<e;h++){let u=this.freqs[h];if(u!==0){let c=r++;for(;c>0;){let d=Math.floor((c-1)/2);if(this.freqs[t[d]]>u)t[c]=t[d],c=d;else break}t[c]=h,s=h}}for(;r<2;){let h=s<2?++s:0;t[r++]=h}this.numCodes=Math.max(s+1,this.minNumCodes);let n=r,a=new Int32Array(4*r-2),o=new Int32Array(2*r-1),l=n;for(let h=0;h<r;h++){let u=t[h];a[2*h]=u,a[2*h+1]=-1,o[h]=this.freqs[u]<<8,t[h]=h}do{let h=t[0],u=t[--r],c=0,d=1;for(;d<r;)d+1<r&&o[t[d]]>o[t[d+1]]&&d++,t[c]=t[d],c=d,d=d*2+1;let p=o[u];for(;d=c,c>0;)if(c=Math.floor((d-1)/2),o[t[c]]>p)t[d]=t[c];else break;t[d]=u;let f=t[0];u=l++,a[2*u]=h,a[2*u+1]=f;let m=Math.min(o[h]&255,o[f]&255);for(p=o[h]+o[f]-m+1,o[u]=p,c=0,d=1;d<r;)d+1<r&&o[t[d]]>o[t[d+1]]&&d++,t[c]=t[d],c=d,d=c*2+1;for(;d=c,d>0;)if(c=Math.floor((d-1)/2),o[t[c]]>p)t[d]=t[c];else break;t[d]=u}while(r>1);this.buildLength(a)}buildLength(e){this.length=new Uint8Array(this.freqs.length);let t=Math.floor(e.length/2),r=Math.floor((t+1)/2),s=0;for(let l=0;l<this.maxLength;l++)this.bitLengthCounts[l]=0;let n=new Int32Array(t);n[t-1]=0;for(let l=t-1;l>=0;l--)if(e[2*l+1]!=-1){let h=n[l]+1;h>this.maxLength&&(h=this.maxLength,s++),n[e[2*l]]=h,n[e[2*l+1]]=h}else{let h=n[l];this.bitLengthCounts[h-1]++,this.length[e[2*l]]=n[l]}if(s==0)return;let a=this.maxLength-1;do{for(;this.bitLengthCounts[--a]==0;);do this.bitLengthCounts[a]--,this.bitLengthCounts[++a]++,s-=1<<this.maxLength-1-a;while(s>0&&a<this.maxLength-1)}while(s>0);this.bitLengthCounts[this.maxLength-1]+=s,this.bitLengthCounts[this.maxLength-2]-=s;let o=2*r;for(let l=this.maxLength;l!=0;l--){let h=this.bitLengthCounts[l-1];for(;h>0;){let u=2*e[o++];e[u+1]==-1&&(this.length[e[u]]=l,h--)}}}getEncodedLength(){let e=0;for(let t=0;t<this.freqs.length;t++)e+=this.freqs[t]*this.length[t];return e}calcBLFreq(e){let t,r,s,n=-1,a=0;for(;a<this.numCodes;){s=1;let o=this.length[a];for(o==0?(t=138,r=3):(t=6,r=3,n!=o&&(e.freqs[o]++,s=0)),n=o,a++;a<this.numCodes&&n==this.length[a]&&(a++,!(++s>=t)););s<r?e.freqs[n]+=s:n!=0?e.freqs[ar.Repeat3To6]++:s<=10?e.freqs[ar.Repeat3To10]++:e.freqs[ar.Repeat11To138]++}}setStaticCodes(e,t){this.codes=e,this.length=t}buildCodes(){let e=new Int32Array(this.maxLength),t=0;this.codes=new Int16Array(this.freqs.length);for(let r=0;r<this.maxLength;r++)e[r]=t,t+=this.bitLengthCounts[r]<<15-r;for(let r=0;r<this.numCodes;r++){let s=this.length[r];s>0&&(this.codes[r]=J.bitReverse(e[s-1]),e[s-1]+=1<<16-s)}}writeTree(e){let t,r,s,n=-1,a=0;for(;a<this.numCodes;){s=1;let o=this.length[a];for(o==0?(t=138,r=3):(t=6,r=3,n!=o&&(e.writeSymbol(o),s=0)),n=o,a++;a<this.numCodes&&n==this.length[a]&&(a++,!(++s>=t)););if(s<r)for(;s-- >0;)e.writeSymbol(n);else n!=0?(e.writeSymbol(ar.Repeat3To6),this.huffman.pending.writeBits(s-3,2)):s<=10?(e.writeSymbol(ar.Repeat3To10),this.huffman.pending.writeBits(s-3,3)):(e.writeSymbol(ar.Repeat11To138),this.huffman.pending.writeBits(s-11,7))}}writeSymbol(e){this.huffman.pending.writeBits(this.codes[e]&65535,this.length[e])}}ar.Repeat3To6=16;ar.Repeat3To10=17;ar.Repeat11To138=18;class J{static staticInit(){let e=0;for(;e<144;)J.staticLCodes[e]=J.bitReverse(48+e<<8),J.staticLLength[e++]=8;for(;e<256;)J.staticLCodes[e]=J.bitReverse(256+e<<7),J.staticLLength[e++]=9;for(;e<280;)J.staticLCodes[e]=J.bitReverse(-256+e<<9),J.staticLLength[e++]=7;for(;e<J.LITERAL_NUM;)J.staticLCodes[e]=J.bitReverse(-88+e<<8),J.staticLLength[e++]=8;for(e=0;e<J.DIST_NUM;e++)J.staticDCodes[e]=J.bitReverse(e<<11),J.staticDLength[e]=5}static bitReverse(e){return J.bit4Reverse[e&15]<<12|J.bit4Reverse[e>>4&15]<<8|J.bit4Reverse[e>>8&15]<<4|J.bit4Reverse[e>>12]}constructor(e){this.last_lit=0,this.extra_bits=0,this.pending=e,this.literalTree=new ar(this,J.LITERAL_NUM,257,15),this.distTree=new ar(this,J.DIST_NUM,1,15),this.blTree=new ar(this,J.BITLEN_NUM,4,7),this.d_buf=new Int16Array(J.BUFSIZE),this.l_buf=new Uint8Array(J.BUFSIZE)}isFull(){return this.last_lit>=J.BUFSIZE}reset(){this.last_lit=0,this.extra_bits=0,this.literalTree.reset(),this.distTree.reset(),this.blTree.reset()}flushStoredBlock(e,t,r,s){this.pending.writeBits((J.STORED_BLOCK<<1)+(s?1:0),3),this.pending.alignToByte(),this.pending.writeShort(r),this.pending.writeShort(~r),this.pending.writeBlock(e,t,r),this.reset()}flushBlock(e,t,r,s){this.literalTree.freqs[J.EOF_SYMBOL]++,this.literalTree.buildTree(),this.distTree.buildTree(),this.literalTree.calcBLFreq(this.blTree),this.distTree.calcBLFreq(this.blTree),this.blTree.buildTree();let n=4;for(let l=18;l>n;l--)this.blTree.length[J.BL_ORDER[l]]>0&&(n=l+1);let a=14+n*3+this.blTree.getEncodedLength()+this.literalTree.getEncodedLength()+this.distTree.getEncodedLength()+this.extra_bits,o=this.extra_bits;for(let l=0;l<J.LITERAL_NUM;l++)o+=this.literalTree.freqs[l]*J.staticLLength[l];for(let l=0;l<J.DIST_NUM;l++)o+=this.distTree.freqs[l]*J.staticDLength[l];a>=o&&(a=o),t>=0&&r+4<a>>3?this.flushStoredBlock(e,t,r,s):a==o?(this.pending.writeBits((J.STATIC_TREES<<1)+(s?1:0),3),this.literalTree.setStaticCodes(J.staticLCodes,J.staticLLength),this.distTree.setStaticCodes(J.staticDCodes,J.staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits((J.DYN_TREES<<1)+(s?1:0),3),this.sendAllTrees(n),this.compressBlock(),this.reset())}sendAllTrees(e){this.blTree.buildCodes(),this.literalTree.buildCodes(),this.distTree.buildCodes(),this.pending.writeBits(this.literalTree.numCodes-257,5),this.pending.writeBits(this.distTree.numCodes-1,5),this.pending.writeBits(e-4,4);for(let t=0;t<e;t++)this.pending.writeBits(this.blTree.length[J.BL_ORDER[t]],3);this.literalTree.writeTree(this.blTree),this.distTree.writeTree(this.blTree)}compressBlock(){for(let e=0;e<this.last_lit;e++){let t=this.l_buf[e]&255,r=this.d_buf[e];if(r--!=0){let s=J.Lcode(t);this.literalTree.writeSymbol(s);let n=Math.floor((s-261)/4);n>0&&n<=5&&this.pending.writeBits(t&(1<<n)-1,n);let a=J.Dcode(r);this.distTree.writeSymbol(a),n=Math.floor(a/2)-1,n>0&&this.pending.writeBits(r&(1<<n)-1,n)}else this.literalTree.writeSymbol(t)}this.literalTree.writeSymbol(J.EOF_SYMBOL)}tallyDist(e,t){this.d_buf[this.last_lit]=e,this.l_buf[this.last_lit++]=t-3;let r=J.Lcode(t-3);this.literalTree.freqs[r]++,r>=265&&r<285&&(this.extra_bits+=Math.floor((r-261)/4));let s=J.Dcode(e-1);return this.distTree.freqs[s]++,s>=4&&(this.extra_bits+=Math.floor(s/2)-1),this.isFull()}tallyLit(e){return this.d_buf[this.last_lit]=0,this.l_buf[this.last_lit++]=e,this.literalTree.freqs[e]++,this.isFull()}static Lcode(e){if(e==255)return 285;let t=257;for(;e>=8;)t+=4,e=e>>1;return t+e}static Dcode(e){let t=0;for(;e>=4;)t+=2,e=e>>1;return t+e}}J.BUFSIZE=1<<ut.DEFAULT_MEM_LEVEL+6;J.LITERAL_NUM=286;J.STORED_BLOCK=0;J.STATIC_TREES=1;J.DYN_TREES=2;J.DIST_NUM=30;J.staticLCodes=new Int16Array(J.LITERAL_NUM);J.staticLLength=new Uint8Array(J.LITERAL_NUM);J.staticDCodes=new Int16Array(J.DIST_NUM);J.staticDLength=new Uint8Array(J.DIST_NUM);J.BL_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];J.bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]);J.BITLEN_NUM=19;J.EOF_SYMBOL=256;J.staticInit();var U5=Object.freeze({__proto__:null,ActiveBeatsChangedEventArgs:Gx,AlphaSynth:Ix,AlphaSynthAudioWorkletOutput:$x,AlphaSynthScriptProcessorOutput:Yx,AlphaSynthWebAudioOutputBase:or,AlphaSynthWebWorkerApi:jp,CircularSampleBuffer:Ym,MidiEventsPlayedEventArgs:Wm,PlaybackRange:zx,PlaybackRangeChangedEventArgs:zm,get PlayerState(){return Nt},PlayerStateChangedEventArgs:Yo,PositionChangedEventArgs:xl});A.isRunningInWorker?A.initializeWorker():A.isRunningInAudioWorklet?A.initializeAudioWorklet():A.initializeMain(i=>{if(A.webPlatform==$i.NodeJs)throw new Yt(Ut.General,"Workers not yet supported in Node.js");if(A.webPlatform==$i.BrowserModule||A.isWebPackBundled||A.isViteBundled)return L.debug("AlphaTab","Creating webworker"),new A.alphaTabWorker(new URL(new URL(""+new URL("alphaTab.worker-BMMGxjGv.js",import.meta.url).href,import.meta.url),import.meta.url),{type:"module"});if(!i.core.scriptFile)throw new Yt(Ut.General,"Could not detect alphaTab script file, cannot initialize renderer");try{L.debug("AlphaTab","Creating Blob worker");const e=`importScripts('${i.core.scriptFile}')`,t=new Blob([e]);return new Worker(URL.createObjectURL(t))}catch{return L.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(i.core.scriptFile)}},(i,e)=>{if(A.webPlatform==$i.NodeJs)throw new Yt(Ut.General,"Audio Worklets not yet supported in Node.js");return A.webPlatform==$i.BrowserModule||A.isWebPackBundled||A.isViteBundled?(L.debug("AlphaTab","Creating Module worklet"),i.audioWorklet.addModule(new URL(new URL(""+new URL("alphaTab.worklet-B0C3JhQ6.js",import.meta.url).href,import.meta.url),import.meta.url))):(L.debug("AlphaTab","Creating Script worklet"),i.audioWorklet.addModule(e.core.scriptFile))});const Y5={tex:!0,fontDirectory:"font/",engine:"svg"},$5={staveProfile:"Default",justifyLastSystem:!0,barsPerRow:4,resources:{staffLineColor:"#ffffff80",barSeparatorColor:"#fff",mainGlyphColor:"#fff",secondaryGlyphColor:"#fff",scoreInfoColor:"#fff",barNumberColor:"#fff"}},X5=i=>({scrollElement:i,enableCursor:!0,enableAnimatedBeatCursor:!0,enableElementHighlighting:!0,enablePlayer:!0,enableUserInteraction:!0,soundFont:"https://cdn.jsdelivr.net/npm/@coderline/alphatab@latest/dist/soundfont/sonivox.sf2"}),j5=i=>({core:Y5,display:$5,player:X5(i)}),q5=M`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0.9;
  height: 100%;
  cursor: pointer;
  &:hover {
    opacity: 1;
  }
`,Q5=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
`,K5=M`
  font-size: 2.6em;
  color: #fff;
`,J5=M`
  font-size: 2em;
  color: #fff;
`,Z5=M`
  font-size: 2em;
  color: #ffffff99;
`,eD=M`
  font-size: 0.85em;
  color: #ffffff99;
`,tD=()=>k.jsx("a",{href:"https://alphatab.net",target:"_blank",children:k.jsxs("span",{className:q5,children:[k.jsx("span",{className:eD,children:"Tabs & score rendered by:"}),k.jsxs("span",{className:Q5,children:[k.jsx(QM,{className:K5}),k.jsxs("span",{children:[k.jsx("span",{className:J5,children:"alpha"}),k.jsx("span",{className:Z5,children:"Tab"})]})]})]})});function iD(i){return at({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M3.35355 1.85355C3.54882 1.65829 3.54882 1.34171 3.35355 1.14645C3.15829 0.951184 2.84171 0.951184 2.64645 1.14645L0.646447 3.14645C0.451184 3.34171 0.451184 3.65829 0.646447 3.85355L2.64645 5.85355C2.84171 6.04882 3.15829 6.04882 3.35355 5.85355C3.54882 5.65829 3.54882 5.34171 3.35355 5.14645L2.20711 4H9.5C11.433 4 13 5.567 13 7.5C13 7.77614 13.2239 8 13.5 8C13.7761 8 14 7.77614 14 7.5C14 5.01472 11.9853 3 9.5 3H2.20711L3.35355 1.85355ZM2 7.5C2 7.22386 1.77614 7 1.5 7C1.22386 7 1 7.22386 1 7.5C1 9.98528 3.01472 12 5.5 12H12.7929L11.6464 13.1464C11.4512 13.3417 11.4512 13.6583 11.6464 13.8536C11.8417 14.0488 12.1583 14.0488 12.3536 13.8536L14.3536 11.8536C14.5488 11.6583 14.5488 11.3417 14.3536 11.1464L12.3536 9.14645C12.1583 8.95118 11.8417 8.95118 11.6464 9.14645C11.4512 9.34171 11.4512 9.65829 11.6464 9.85355L12.7929 11H5.5C3.567 11 2 9.433 2 7.5Z",fill:"currentColor"},child:[]}]})(i)}const rD=M`
  border-radius: 50%;
  width: 100px;
  height: 100px;
  background-color: #ffffff15;
  color: #ffffff;
  font-size: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease, outline 0.2s ease;
  border: none;
  &:hover {
    background-color: #ffffff40;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,eB=M`
  border-radius: 50%;
  width: 60px;
  height: 60px;
  background-color: transparent;
  color: #ffffff;
  font-size: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease, outline 0.2s ease;
  background-color: #ffffff20;
  border: none;
  &:hover {
    background-color: #ffffff40;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,sD=M`
  background-color: #ffffff60;
  &:hover {
    background-color: #ffffff60;
  }
`,nD=({onClick:i,isToggled:e})=>k.jsx("button",{className:rD,onClick:i,children:e?k.jsx(HM,{}):k.jsx(WM,{})}),aD=({onClick:i,isToggled:e})=>{const t=ea(eB,e?sD:null);return k.jsx("button",{className:t,onClick:i,children:k.jsx(iD,{})})},oD=({onClick:i})=>k.jsx("button",{className:eB,onClick:i,children:k.jsx(zM,{})}),lD=M`
  /** Fill Parent */
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 3;

  /* Blurry dark shade */
  backdrop-filter: blur(3px);
  background: rgba(0, 0, 0, 0.5);

  /** center content */
  display: flex;
  justify-content: center;
  align-items: flex-start;
`,hD=M`
  margin-top: 20px;
  background: #fff;
  box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.3);
  padding: 10px;
`,uD=({isVisible:i})=>i?k.jsx("div",{className:lD,children:k.jsx("div",{className:hD,children:"Score is loading..."})}):null,cD=M`
  display: flex;
  flex-direction: row;
  gap: 14px;
  align-items: center;
  justify-content: center;
`,dD=M`
  appearance: none;
  background-color: transparent;
  width: 180px;

  &::-webkit-slider-runnable-track {
    position: relative;
    height: 8px;
    background-color: #ffffff60;
    border-radius: 8px;
  }

  &::-moz-range-track {
    position: relative;
    height: 8px;
    background-color: #ffffff60;
    border-radius: 8px;
  }

  &::-webkit-slider-thumb {
    box-sizing: border-box;
    appearance: none;
    position: relative;
    background-color: #ffffffdd;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    top: 50%;
    translate: 0 -50%;
    transition: background-color 0.2s ease, transform 0.2s ease;
    cursor: pointer;
    &:hover {
      background-color: #ffffff;
      transform: scale(1.4);
    }
  }

  &::-moz-range-thumb {
    box-sizing: border-box;
    appearance: none;
    position: relative;
    background-color: #ffffffdd;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    transition: background-color 0.2s ease, transform 0.2s ease;
    cursor: pointer;
    &:hover {
      background-color: #ffffff;
      transform: scale(1.4);
    }
  }
`,kb=M`
  font-size: 1.6em;
  color: #ffffffdd;
  cursor: pointer;
  &:hover {
    color: #ffffff;
  }
`,fD=M`
  font-size: 1.8em;
  margin-right: 10px;
  color: #ffffff;
`,Bf=({value:i,onChange:e,Icon:t})=>k.jsxs("div",{className:cD,children:[k.jsx(t,{className:fD}),k.jsx(GM,{className:kb,onClick:()=>e(0)}),k.jsx("input",{type:"range",className:dD,min:0,max:1,step:.02,value:i,onChange:r=>e(r.target.valueAsNumber)}),k.jsx(UM,{className:kb,onClick:()=>e(1)})]});function pD(i){return[`\\track "${i.name}" "${i.shortName}"`,i.instrument?`\\instrument "${i.instrument}"`:void 0,i.tuning?`\\tuning ${i.tuning.join(" ")}`:void 0].filter(e=>e!==void 0)}function Jm(i,e){return[i,Te(e)?void 0:`{ch "${e}"}`].filter(r=>r!==void 0).join(" ")}function gD(i){return`${i} {bd 120}`}function mD(i){return Jm(`${i.fret}.${i.string}.${i.duration}`,i.label)}function yD(i){const e=i.notes.map(t=>`${t.fret}.${t.string}`);return gD(Jm(`(${e.join(" ")}).${i.duration}`,i.label))}function bD(i){return Jm(`r.${i.duration}`,i.label)}function wD(i){switch(i.type){case"note":return mD(i);case"chord":return yD(i);case"rest":return bD(i)}}function xb(i){return i.items.map(e=>wD(e)).join(" ")}function SD(i){if(i.bars.length===0)return[];const e=[`\\clef ${i.clef}`,`\\ts ${i.timeSignature.top} ${i.timeSignature.bottom}`,`\\ks ${i.keySignature}`].join(" "),[t,...r]=i.bars;return[`${e} ${xb(t)}`,...r.map(n=>xb(n))]}function Bb(i){return[pD(i).join(" "),SD(i).join(`
|`)].join(`
`)}function vD(i,e){return{tuning:e,instrument:"AcousticBass",clef:"Bass",name:"Bass",shortName:"",keySignature:"C",timeSignature:{bottom:4,top:4},bars:i.map(({chords:t})=>({items:t.flatMap(s=>s.pitches).map(({duration:s,fret:n,string:a,meta:o})=>({type:"note",duration:s,fret:n,string:a,label:o}))}))}}function kD(i){return{tuning:Hv,instrument:"AcousticGrandPiano",clef:"Treble",name:"Chords",shortName:"",keySignature:"C",timeSignature:{bottom:4,top:4},bars:i.map(e=>({items:e.chords.map(({duration:r,pitches:s})=>({type:"chord",duration:r,notes:s.map(({fret:n,string:a})=>({fret:n,string:a}))}))}))}}function _b(i,e,t=!0){const r=e.filter(s=>{const n=Za.freq(i),a=Za.freq(s);return!Te(n)&&!Te(a)&&n>=a}).map(s=>({fret:Tn.semitones(dl(s,i)),note:i,string:e.indexOf(s)+1})).filter(({fret:s})=>s<=24);if(!t&&r.length===0)throw new TypeError(`Can't place ${i} in tuning: ${e.join(", ")}`);return r}function xD(i){return am[i]}const BD=(i,e)=>i.fret-e.fret,_D=i=>(e,t)=>Math.abs(i-e.fret)-Math.abs(i-t.fret);function TD(i,e,t){const r=[];return i.forEach((s,n)=>{const a=e[s.id],o=s.id;if(n===i.length-1){const h=s.root;r.push({id:cs(),progressionId:t,barId:a,chordId:o,note:h,fret:-1,duration:-1,string:-1,meta:$u(s)});return}const l=xD(s.transitionId);Uv(s,i[n+1],l).forEach((h,u)=>{r.push({id:cs(),progressionId:t,barId:a,chordId:o,note:h,fret:-1,duration:-1,string:-1,meta:u===0?$u(s):void 0})})}),r}function CD(i,e){if(i.length===0)return;const t=i[0],s=_b(t.note,e,!1).sort(BD)[0];t.fret=s.fret,t.string=s.string;for(let n=1;n<i.length;n+=1){const a=i[n],o=i[n-1],h=_b(a.note,e,!1).sort(_D(o.fret))[0];a.fret=h.fret,a.string=h.string}}function ND(i,e){return e.map(t=>{const r=t.chords.map(s=>({chordId:s,pitches:i.filter(n=>n.chordId===s)}));return{barId:t.id,chords:r}})}function PD(i){i.forEach(e=>{const t=e.chords.length;e.chords.forEach(r=>{const s=t*r.pitches.length;r.pitches.forEach(n=>n.duration=s)})})}function ED(i){return i.reduce((e,t)=>(t.chords.forEach(r=>{e[r]=t.id}),e),{})}function MD(i,e){const t=ai.selectors.getProgression(i,e),r=t.tuning,s=t.bars.map(h=>ur.selectors.getBar(i,h)),n=ED(s),a=s.flatMap(h=>h.chords.map(u=>Wt.selectors.getChord(i,u))),o=TD(a,n,e);CD(o,r);const l=ND(o,s);return PD(l),l}const LD={"A#":{note:"A#5",fret:6,string:6},Bb:{note:"Bb5",fret:6,string:6},B:{note:"B5",fret:7,string:6},C:{note:"C6",fret:8,string:6},"C#":{note:"C#6",fret:9,string:6},Db:{note:"Db6",fret:9,string:6},D:{note:"D6",fret:10,string:6},"D#":{note:"D#6",fret:10,string:6},Eb:{note:"Eb6",fret:11,string:6},E:{note:"E6",fret:7,string:5},F:{note:"F6",fret:8,string:5},"F#":{note:"F#6",fret:9,string:5},Gb:{note:"Gb6",fret:9,string:5},G:{note:"G6",fret:10,string:5},"G#":{note:"G#6",fret:11,string:5},Ab:{note:"Ab6",fret:11,string:5},A:{note:"A6",fret:12,string:5}};function RD(i){const[e]=fl(i.root),t=LD[e],r=t.string-1,s=hm(i.type,!1);return Pv.notes(s,e).map((a,o)=>{if(a===e)return t;const l=Hv[r-o],[h]=fl(l);return{note:void 0,string:t.string-o,fret:Tn.semitones(dl(h,a))}})}function FD(i,e){return ai.selectors.getProgression(i,e).bars.map(s=>ur.selectors.getBar(i,s)).map(s=>{const n=s.chords.map(o=>Wt.selectors.getChord(i,o)),a=n.map(o=>({chordId:o.id,pitches:RD(o),duration:n.length}));return{barId:s.id,chords:a}})}function ID(i,e){const t=ai.selectors.getProgression(i,e),r=vD(MD(i,e),t.tuning),s=kD(FD(i,e));return`${Bb(r)}
${Bb(s)}`}function Tb(i,e,t){T.useEffect(()=>{Kp(i.current,e,t)},[e,t])}function OD(i,e){T.useEffect(()=>{const t=i.current;Te(t)||(t.metronomeVolume=e)},[e])}function Kp(i,e,t){var s;if(Te(i))return;const r=(s=i.score)==null?void 0:s.tracks[e];Te(r)||i.changeTrackVolume([r],t)}function DD(i){return at({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 19v-6"},child:[]},{tag:"path",attr:{d:"M8 5v8h2v-8"},child:[]},{tag:"path",attr:{d:"M15 19v-6"},child:[]},{tag:"path",attr:{d:"M14 5v8h2v-8"},child:[]}]})(i)}function AD(i){return at({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M228.2 26.89c-15.2-.25-27.7 33.46-12.3 39.8l8.9 3.61 17.8-15.5-1.8-23.5-8.7-3.6c-1.1-.43-2.1-.68-3.2-.78h-.7zm134.4 7.92h-2.3c-7.4.3-15.3 2.12-23.3 5.75-21.2 9.67-43.6 32.67-59.7 75.74L174.4 394.7l-.1.2v.2c.9.5 3.6 1.9 8 4 9.8 4.8 24 15.7 26.1 38.8v.5l-1 55.6H304c-.1-17.6 1.4-34.5 8.1-51.5 11.7-29.4 39.3-54.9 97-77 0-.2 0 0 .1-.4.3-2 .4-6 0-11-1-10.1-4-24.9-8.6-42.2-9.2-34.7-24.8-80.2-42.4-124.9l-2.4-6.2 5.2-4.2c36.1-28.2 51.1-56.4 53.8-79.56 2.7-23.06-6.5-41.48-21.3-52.25-8.7-6.31-19.3-9.99-30.9-10.02zM260.5 52.44l.7 10.01-7.6 6.6 21.7 8.93c1.2-2.17 2.5-4.28 3.8-6.33l4-9.89zm69 18.56c8.8 0 16 7.16 16 16s-7.2 16-16 16-16-7.16-16-16 7.2-16 16-16zm-136.7 49.7c-15.2-.3-27.9 33.4-12.3 39.8l8.8 3.6 17.8-15.5-1.7-23.6-8.8-3.6c-1.1-.4-2.1-.6-3.1-.7zm32.2 25.5l.7 10-7.6 6.6 19.9 8.1 6.2-16.8zm71.6 19.8c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm-139.8 50.6c-15.3-.3-27.8 33.4-12.4 39.8l8.9 3.6 17.8-15.5-1.8-23.6-8.7-3.6c-1.1-.4-2.1-.6-3.1-.7zm32.2 25.5l.7 10-7.6 6.6 20.4 8.3 6.2-16.8zm67.2 19.3c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm-140.1 54.4c-15.2-.3-27.78 33.4-12.3 39.8l8.8 3.6 17.8-15.5-1.8-23.6-8.7-3.6c-1.1-.4-2.1-.6-3.1-.7zm32.2 25.5l.7 10-7.6 6.6 22.8 9.3 6.8-16.6zm69.3 18.5c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"},child:[]}]})(i)}const VD=M`
  padding: 0px 40px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  position: relative;
  height: 160px;
  width: 100%;
  background-color: #ffffff15;
`,HD=M`
  //.at-wrap
  width: 100vw;
  height: calc(100vh - 100px);
  margin: 0 auto;
  border: 1px solid rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
`,WD=M`
  // .at-content
  position: relative;
  overflow: hidden;
  flex: 1 1 auto;
`,zD=M`
  // .at-viewport
  overflow-y: auto;
  position: absolute;
  top: 0px;
  left: 0px;
  right: 0px;
  bottom: 0px;
  padding: 20px;
`,GD=M`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,UD=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 10px;
`,YD=()=>{const i=T.useRef(null),e=T.useRef(null),t=T.useRef(null),r=T.useRef(),[s,n]=T.useState(!1),[a,o]=T.useState(!1),l=Hi(),h=Zt(v=>ID(v,l.id)),{isLooping:u,bassVolume:c,metronomeVolume:d,chordsVolume:p}=Zt(v=>v.config),f=wr();T.useEffect(()=>{var C;const{current:v}=r;(C=v==null?void 0:v.tex)==null||C.call(v,h)},[h]),T.useEffect(()=>{const{current:v}=r;Te(v)||(v.isLooping=u)},[u]),Tb(r,0,c),Tb(r,1,p),OD(r,d),T.useEffect(()=>{const v=new id(t.current,j5(e.current));return v.renderStarted.on(()=>n(!0)),v.renderFinished.on(()=>n(!1)),v.playerStateChanged.on(({state:C})=>o(C===U5.PlayerState.Playing)),v.render(),v.tex(h,[0]),v.isLooping=u,v.metronomeVolume=d,Kp(v,0,c),Kp(v,1,p),r.current=v,()=>v.destroy()},[]);const m=()=>{var v;return(v=r.current)==null?void 0:v.playPause()},S=()=>f(Po.actions.updateConfig({isLooping:!u})),y=()=>{var v;return(v=r.current)==null?void 0:v.stop()},b=v=>f(Po.actions.updateConfig({bassVolume:v})),w=v=>f(Po.actions.updateConfig({chordsVolume:v})),x=v=>f(Po.actions.updateConfig({metronomeVolume:v}));return k.jsxs("div",{className:HD,ref:i,children:[k.jsx(uD,{isVisible:s}),k.jsx("div",{className:WD,children:k.jsx("div",{className:zD,ref:e,children:k.jsx("div",{className:"at-main",ref:t})})}),k.jsxs("div",{className:VD,children:[k.jsxs("div",{className:GD,children:[k.jsx(Bf,{Icon:jM,value:d,onChange:x}),k.jsx(Bf,{Icon:AD,value:c,onChange:b}),k.jsx(Bf,{Icon:DD,value:p,onChange:w})]}),k.jsxs("div",{className:UD,children:[k.jsx(oD,{onClick:y}),k.jsx(nD,{onClick:m,isToggled:a}),k.jsx(aD,{onClick:S,isToggled:u})]}),k.jsx(tD,{})]})]})},$D=M`
  display: flex;
  flex-direction: column;
  color: #fff;
  align-items: center;
  justify-content: center;
  height: calc(100vh - 200px);
`,XD=M`
  font-size: 8em;
`,jD=M`
  font-size: 2.6em;
  font-weight: bold;
`,qD=M`
  display: flex;
  flex-direction: column;
  gap: 6px;
  background-color: #ffffff20;
  border-radius: 10px;
  padding: 12px 20px;
  font-size: 1.1em;
  margin-top: 20px;
`,QD=M`
  font-size: 1.2em;
  font-weight: bold;
`,KD=M`
  display: block;
  list-style-position: inside;
`,JD=()=>k.jsxs("div",{className:$D,children:[k.jsx(Ck,{className:XD}),k.jsx("span",{className:jD,children:"Score cannot be generated!"}),k.jsxs("div",{className:qD,children:[k.jsx("span",{className:QD,children:"What's missing?"}),k.jsxs("ul",{className:KD,children:[k.jsx("li",{children:"You should have at least 2 bars"}),k.jsx("li",{children:"Each bar should have at least 1 chord in it"}),k.jsx("li",{children:"Each chord should have a transition defined to the next chord"})]})]})]}),ZD=M`
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
`,eA=()=>{const i=Hi(),{canGenerateScore:e}=Zt(t=>Nk(t,i.id));return k.jsxs(k.Fragment,{children:[k.jsx(Rm,{children:k.jsx(dx,{})}),k.jsxs("div",{className:ZD,children:[e?null:k.jsx(JD,{}),e?k.jsx(YD,{}):null]})]})},tA=[{name:"From scratch",Icon:_k,description:"Create your own progression from scratch.",factory:(i,e)=>Ga(e,ox,i)},{name:"A Minor Blues",Icon:wl,description:"Simple minor blues progression, focusing on i, iv and v chords.",factory:(i,e)=>Ga(e,lx,i)},{name:"Autumn Leaves",Icon:wl,description:"Autumn Leaves in G minor. For practicing both the major and minor ii V I",factory:(i,e)=>Ga(e,ax,i)}],tB=M`
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
  padding: 12px 20px 20px 20px;
  border-radius: 10px;
  background-color: #ffffff15;
`,iB=M`
  font-size: 1.6em;
  color: #fff;
  font-weight: normal;
`,rB=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-radius: 10px;
  padding: 10px 14px;
  cursor: pointer;
  gap: 10px;
  width: 100%;
  &:hover {
    background-color: #ffffff30;
  }
`,iA=M`
  outline: 2px solid #ffffff50;
  background-color: #ffffff30;
  color: #ffffff;
  &:hover {
    outline: 2px solid #ffffff50;
    background-color: #ffffff30;
    color: #ffffff;
  }
`,sB=M`
  font-size: 2em;
  color: #ffffff;
`,nB=M`
  display: flex;
  flex-direction: column;
  flex: 1;
`,aB=M`
  color: #ffffff;
`,oB=M`
  color: #ffffff88;
`,rA=M`
  display: flex;
  flex-direction: row;
  gap: 10px;
  margin-top: 10px;
`,sA=M`
  border-radius: 6px;
  background-color: #ffffff20;
  flex: 1;
  color: #ffffff;
  border: none;
  outline: none;
  padding: 10px 14px;
  font-size: 1em;
  &:hover {
    background-color: #ffffff30;
  }

  &:focus {
    background-color: #ffffff50;
  }
`,nA=M`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  border: none;
  color: #ffffffdd;
  padding: 8px 16px;
  gap: 6px;
  cursor: pointer;
  font-size: 1em;
  border-radius: 6px;
  background-color: transparent;
  background-color: #ffffff20;
  &:hover {
    color: #fff;
    background-color: #ffffff30;
  }
  &:disabled {
    background-color: transparent;
    color: #ffffff50;
    cursor: not-allowed;
  }
`,aA=()=>{const i=Zt(ai.selectors.getProgressions);return i.length===0?null:k.jsxs("div",{className:tB,children:[k.jsx("h2",{className:iB,children:"Recent progressions"}),i.map(e=>k.jsxs("a",{className:rB,href:`#/${e.id}/editor`,children:[k.jsx(wl,{className:sB}),k.jsxs("div",{className:nB,children:[k.jsx("span",{className:aB,children:e.name}),k.jsxs("span",{className:oB,children:[e.bars.length," Bars"]})]})]}))]})},oA=()=>{const[i,e]=T.useState(""),[t,r]=T.useState(),[s,n]=T.useState(!0),a=Zt(d=>d),o=Gc(),l=Zt(ai.selectors.getProgressions),h=T.useMemo(()=>{const d=Te(t)?"":t.name;return lm(d,new Set(l.map(({name:p})=>p))," ")},[t,l]),u=wr(),c=()=>{if(Te(t))return;const d=t.factory(s?h:i,a);u({type:"global/createProgressionFromTemplate",payload:{template:d}}),o(Ul.editor(d.progression.id))};return k.jsxs("div",{className:tB,children:[k.jsx("h2",{className:iB,children:"New progression"}),tA.map(d=>{const p=ea(rB,d===t?iA:null);return k.jsxs("div",{className:p,onClick:()=>r(d),children:[k.jsx(d.Icon,{className:sB}),k.jsxs("div",{className:nB,children:[k.jsx("span",{className:aB,children:d.name}),k.jsx("span",{className:oB,children:d.description})]})]},d.name)}),k.jsxs("div",{className:rA,children:[k.jsx("input",{type:"text",placeholder:"Progression name...",className:sA,value:s?h:i,onChange:d=>{e(d.target.value),n(!1)},onBlur:()=>{i.length===0&&n(!0)}}),k.jsxs("button",{type:"button",className:nA,disabled:Te(t),onClick:c,children:[k.jsx(Uc,{})," Create"]})]})]})},lA=M`
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px 60px;
  overflow: auto;
  height: calc(100vh - 100px);
`,hA=()=>k.jsxs(k.Fragment,{children:[k.jsx(Rm,{}),k.jsxs("div",{className:lA,children:[k.jsx(aA,{}),k.jsx(oA,{})]})]}),uA=M`
  width: 100%;
  display: flex;
  flex-direction: column;
`,cA=()=>k.jsx("div",{className:uA,children:k.jsxs(MM,{children:[k.jsx(Eo,{path:"/",Component:hA}),k.jsxs(Eo,{path:"/:progressionId",children:[k.jsx(Eo,{path:"score",Component:eA}),k.jsx(Eo,{path:"editor",Component:$3})]})]})});/**
 * React Router DOM v6.24.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const dA="6";try{window.__reactRouterVersion=dA}catch{}const fA="startTransition",Cb=$o[fA];function pA(i){let{basename:e,children:t,future:r,window:s}=i,n=T.useRef();n.current==null&&(n.current=zE({window:s,v5Compat:!0}));let a=n.current,[o,l]=T.useState({action:a.action,location:a.location}),{v7_startTransition:h}=r||{},u=T.useCallback(c=>{h&&Cb?Cb(()=>l(c)):l(c)},[l,h]);return T.useLayoutEffect(()=>a.listen(u),[a,u]),T.createElement(EM,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:r})}var Nb;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(Nb||(Nb={}));var Pb;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(Pb||(Pb={}));const gA=document.getElementById("root");US(gA).render(k.jsx(ZT,{store:W2,children:k.jsxs(pA,{children:[k.jsx(DE,{styles:VE}),k.jsx(cA,{})]})}));
